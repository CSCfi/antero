USE [VipunenTK_DW]
GO
/****** Object:  View [dbo].[_v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvojen_avaimet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[_v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvojen_avaimet]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[_v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvojen_avaimet] AS

-- Asettaa tilanteiden 1-8 avaimet
-- Lisätty saavutetun koulutuksen tiedot /Jarmo 24.5.2013
-- Lisätty kandi-tutkintolajit /Jarmo 23.1.2014

-- Select * from vipunen_ETL.v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvojen_avaimet order by rivinumero
SELECT rivinumero
,[1a_koodi] = Case 
	when [1a_tutkinto_alkuperaisessa_tutkintolajissa]>0 then ''1a_tutkinto_alkuperaisessa_tutkintolajissa''
	when [1a_tutkinto_kandi_tutkintolajissa]>0 then ''1a_tutkinto_kandi_tutkintolajissa''
	when [1a_tutkinto_muussa_tutkintolajissa]>0 then ''1a_tutkinto_muussa_tutkintolajissa''
	when [1a_opiskelee_alkuperaisessa_tutkintolajissa]>0 then ''1a_opiskelee_alkuperaisessa_tutkintolajissa''
	when [1a_opiskelee_muussa_tutkintolajissa]>0 then ''1a_opiskelee_muussa_tutkintolajissa''
	when [1a_keskeyttanyt_tyollinen]>0 then ''1a_keskeyttanyt_tyollinen''
	when [1a_keskeyttanyt_ei_tyollinen]>0 then ''1a_keskeyttanyt_ei_tyollinen''
	end
,[1b_koodi] = Case 
	when [1b_tutkinto_alkuperaisessa_tutkintolajissa]>0 then ''1b_tutkinto_alkuperaisessa_tutkintolajissa''
	when [1b_opiskelee_alkuperaisessa_tutkintolajissa]>0 then ''1b_opiskelee_alkuperaisessa_tutkintolajissa''
	when [1b_tutkinto_kandi_tutkintolajissa]>0 then ''1b_tutkinto_kandi_tutkintolajissa''
	when [1b_tutkinto_muussa_tutkintolajissa]>0 then ''1b_tutkinto_muussa_tutkintolajissa''
	when [1b_opiskelee_muussa_tutkintolajissa]>0 then ''1b_opiskelee_muussa_tutkintolajissa''
	when [1b_keskeyttanyt_tyollinen]>0 then ''1b_keskeyttanyt_tyollinen''
	when [1b_keskeyttanyt_ei_tyollinen]>0 then ''1b_keskeyttanyt_ei_tyollinen''
	end
,[1c_koodi] = Case 
	when [1c_tutkinto_lukiokoulutuksesta]>0 then ''1c_tutkinto_lukiokoulutuksesta''
	when [1c_ammatillinen_perustutkinto]>0 then ''1c_ammatillinen_perustutkinto''
	when [1c_ammatillinen_lisakoulutus_ammattitutkinto_tai_erikoisammattitutkinto]>0 then ''1c_ammatillinen_lisakoulutus_ammattitutkinto_tai_erikoisammattitutkinto''
	when [1c_muu_korkein_ja_viimeisimmaksi_suoritettu_tutkinto_korkeakoulututkinto]>0 then ''1c_muu_korkein_ja_viimeisimmaksi_suoritettu_tutkinto_korkeakoulututkinto''
	when [1c_ammattikorkeakoulututkinto]>0 then ''1c_ammattikorkeakoulututkinto''
	when [1c_alempi_korkeakoulututkinto]>0 then ''1c_alempi_korkeakoulututkinto''
	when [1c_ylempi_ammattikorkeakoulututkinto]>0 then ''1c_ylempi_ammattikorkeakoulututkinto''
	when [1c_ylempi_korkeakoulututkinto]>0 then ''1c_ylempi_korkeakoulututkinto''
	when [1c_tutkijakoulutusasteen_tutkinto]>0 then ''1c_tutkijakoulutusasteen_tutkinto''
	when [1c_muu_korkein_ja_viimeisimmaksi_suoritettu_tutkinto_toinen_aste]>0 then ''1c_muu_korkein_ja_viimeisimmaksi_suoritettu_tutkinto_toinen_aste''
	when [1c_ei_tutkintoa]>0 then ''1c_ei_tutkintoa''
	end
,[1d_koodi] = Case 
	when [1d_opiskelee_lukiokoulutuksessa]>0 then ''1d_opiskelee_lukiokoulutuksessa''
	when [1d_opiskelee_ammatillista_perustutkintoa]>0 then ''1d_opiskelee_ammatillista_perustutkintoa''
	when [1d_opiskelee_ammatillisessa_lisakoulutuksessa]>0 then ''1d_opiskelee_ammatillisessa_lisakoulutuksessa''
	when [1d_opiskelee_muussa_koulutuksessa_korkeakoulututkinto]>0 then ''1d_opiskelee_muussa_koulutuksessa_korkeakoulututkinto''
	when [1d_opiskelee_ammattikorkeakoulututkintoa]>0 then ''1d_opiskelee_ammattikorkeakoulututkintoa''
	when [1d_opiskelee_alempaa_korkeakoulututkintoa]>0 then ''1d_opiskelee_alempaa_korkeakoulututkintoa''
	when [1d_opiskelee_ylempaa_ammattikorkeakoulututkintoa]>0 then ''1d_opiskelee_ylempaa_ammattikorkeakoulututkintoa''
	when [1d_opiskelee_ylempaa_korkeakoulututkintoa]>0 then ''1d_opiskelee_ylempaa_korkeakoulututkintoa''
	when [1d_opiskelee_tieteellista_jatkotutkintoa]>0 then ''1d_opiskelee_tieteellista_jatkotutkintoa''
	when [1d_opiskelu_muuhun_kuin_korkeakoulututkintoon_johtavassa_koulutuksessa_toisen_asteen_opiskelu_ammatillinen_poimitaan_ensisij]>0 then ''1d_opiskelu_muuhun_kuin_korkeakoulututkintoon_johtavassa_koulutuksessa_toisen_asteen_opiskelu_ammatillinen_poimitaan_ensisij''
	when [1d_ei_opiskele]>0 then ''1d_ei_opiskele''
	end
,[1e_koodi] = Case 
	when [1e_kylla]>0 then ''1e_kylla''
	when [1e_ei]>0 then ''1e_ei''	
	end
,[1f_koodi] = Case 
	when [1f_kylla]>0 then ''1f_kylla''
	when [1f_ei]>0 then ''1f_ei''
	end
,[1g_koodi] = Case 
	when [1g_kylla]>0 then ''1g_kylla''
	when [1g_ei]>0 then ''1g_ei''
	end
,[1h_koodi] = Case 
	when [1h_kylla]>0 then ''1h_kylla''
	when [1h_ei]>0 then ''1h_ei''
	end
,[2a_koodi] = Case 
	when [2a_tutkinto_alkuperaisella_koulutusalalla_2002]>0 then ''2a_tutkinto_alkuperaisella_koulutusalalla_2002''
	when [2a_tutkinto_muulla_koulutusalalla_2002]>0 then ''2a_tutkinto_muulla_koulutusalalla_2002''
	when [2a_opiskelee_alkuperaisella_koulutusalalla_2002]>0 then ''2a_opiskelee_alkuperaisella_koulutusalalla_2002''
	when [2a_opiskelee_muulla_koulutusalalla_2002]>0 then ''2a_opiskelee_muulla_koulutusalalla_2002''
	when [2a_keskeyttanyt_tyollinen]>0 then ''2a_keskeyttanyt_tyollinen''
	when [2a_keskeyttanyt_ei_tyollinen]>0 then ''2a_keskeyttanyt_ei_tyollinen''
	end
,[2b_koodi] = Case 
	when [2b_tutkinto_alkuperaisella_koulutusalalla_2002]>0 then ''2b_tutkinto_alkuperaisella_koulutusalalla_2002''
	when [2b_opiskelee_alkuperaisella_koulutusalalla_2002]>0 then ''2b_opiskelee_alkuperaisella_koulutusalalla_2002''
	when [2b_tutkinto_muulla_koulutusalalla_2002]>0 then ''2b_tutkinto_muulla_koulutusalalla_2002''
	when [2b_opiskelee_muulla_koulutusalalla_2002]>0 then ''2b_opiskelee_muulla_koulutusalalla_2002''
	when [2b_keskeyttanyt_tyollinen]>0 then ''2b_keskeyttanyt_tyollinen''
	when [2b_keskeyttanyt_ei_tyollinen]>0 then ''2b_keskeyttanyt_ei_tyollinen''
	end
,[2e_koodi] = Case 
	when [2e_kylla]>0 then ''2e_kylla''
	when [2e_ei]>0 then ''2e_ei''
	end
,[2f_koodi] = Case 
	when [2f_kylla]>0 then ''2f_kylla''
	when [2f_ei]>0 then ''2f_ei''
	end
,[2g_koodi] = Case 
	when [2g_kylla]>0 then ''2g_kylla''
	when [2g_ei]>0 then ''2g_ei''
	end
,[2h_koodi] = Case 
	when [2h_kylla]>0 then ''2h_kylla''
	when [2h_ei]>0 then ''2h_ei''
	end
,[3a_koodi] = Case 
	when [3a_tutkinto_alkuperaisella_opintoalalla_2002]>0 then ''3a_tutkinto_alkuperaisella_opintoalalla_2002''
	when [3a_tutkinto_muulla_opintoalalla_2002]>0 then ''3a_tutkinto_muulla_opintoalalla_2002''
	when [3a_opiskelee_alkuperaisella_opintoalalla_2002]>0 then ''3a_opiskelee_alkuperaisella_opintoalalla_2002''
	when [3a_opiskelee_muulla_opintoalalla_2002]>0 then ''3a_opiskelee_muulla_opintoalalla_2002''
	when [3a_keskeyttanyt_tyollinen]>0 then ''3a_keskeyttanyt_tyollinen''
	when [3a_keskeyttanyt_ei_tyollinen]>0 then ''3a_keskeyttanyt_ei_tyollinen''
	end
,[3b_koodi] = Case 
	when [3b_tutkinto_alkuperaisella_opintoalalla_2002]>0 then ''3b_tutkinto_alkuperaisella_opintoalalla_2002''
	when [3b_opiskelee_alkuperaisella_opintoalalla_2002]>0 then ''3b_opiskelee_alkuperaisella_opintoalalla_2002''
	when [3b_tutkinto_muulla_opintoalalla_2002]>0 then ''3b_tutkinto_muulla_opintoalalla_2002''
	when [3b_opiskelee_muulla_opintoalalla_2002]>0 then ''3b_opiskelee_muulla_opintoalalla_2002''
	when [3b_keskeyttanyt_tyollinen]>0 then ''3b_keskeyttanyt_tyollinen''
	when [3b_keskeyttanyt_ei_tyollinen]>0 then ''3b_keskeyttanyt_ei_tyollinen''
	end
,[3e_koodi] = Case 
	when [3e_kylla]>0 then ''3e_kylla''
	when [3e_ei]>0 then ''3e_ei''
	end
,[3f_koodi] = Case 
	when [3f_kylla]>0 then ''3f_kylla''
	when [3f_ei]>0 then ''3f_ei''
	end
,[3g_koodi] = Case 
	when [3g_kylla]>0 then ''3g_kylla''
	when [3g_ei]>0 then ''3g_ei''
	end
,[3h_koodi] = Case 
	when [3h_kylla]>0 then ''3h_kylla''
	when [3h_ei]>0 then ''3h_ei''
	end
,[4a_koodi] = Case 
	when [4a_tutkinto_alkuperaisella_jarjestajalla]>0 then ''4a_tutkinto_alkuperaisella_jarjestajalla''
	when [4a_tutkinto_muulla_jarjestajalla]>0 then ''4a_tutkinto_muulla_jarjestajalla''
	when [4a_opiskelee_alkuperaisella_jarjestajalla]>0 then ''4a_opiskelee_alkuperaisella_jarjestajalla''
	when [4a_opiskelee_muulla_jarjestajalla]>0 then ''4a_opiskelee_muulla_jarjestajalla''
	when [4a_keskeyttanyt_tyollinen]>0 then ''4a_keskeyttanyt_tyollinen''
	when [4a_keskeyttanyt_ei_tyollinen]>0 then ''4a_keskeyttanyt_ei_tyollinen''
	end
,[4b_koodi] = Case 
	when [4b_tutkinto_alkuperaisella_jarjestajalla]>0 then ''4b_tutkinto_alkuperaisella_jarjestajalla''
	when [4b_opiskelee_alkuperaisella_jarjestajalla]>0 then ''4b_opiskelee_alkuperaisella_jarjestajalla''
	when [4b_tutkinto_muulla_jarjestajalla]>0 then ''4b_tutkinto_muulla_jarjestajalla''
	when [4b_opiskelee_muulla_jarjestajalla]>0 then ''4b_opiskelee_muulla_jarjestajalla''
	when [4b_keskeyttanyt_tyollinen]>0 then ''4b_keskeyttanyt_tyollinen''
	when [4b_keskeyttanyt_ei_tyollinen]>0 then ''4b_keskeyttanyt_ei_tyollinen''
	end
,[4e_koodi] = Case 
	when [4e_kylla]>0 then ''4e_kylla''
	when [4e_ei]>0 then ''4e_ei''
	end
,[4f_koodi] = Case 
	when [4f_kylla]>0 then ''4f_kylla''
	when [4f_ei]>0 then ''4f_ei''
	end
,[4g_koodi] = Case 
	when [4g_kylla]>0 then ''4g_kylla''
	when [4g_ei]>0 then ''4g_ei''
	end
,[4h_koodi] = Case 
	when [4h_kylla]>0 then ''4h_kylla''
	when [4h_ei]>0 then ''4h_ei''
	end
,[5a_koodi] = Case 
	when [5a_tutkinto_alkuperaisessa_oppilaitoksessa]>0 then ''5a_tutkinto_alkuperaisessa_oppilaitoksessa''
	when [5a_tutkinto_muussa_oppilaitoksessa]>0 then ''5a_tutkinto_muussa_oppilaitoksessa''
	when [5a_opiskelee_alkuperaisessa_oppilaitoksessa]>0 then ''5a_opiskelee_alkuperaisessa_oppilaitoksessa''
	when [5a_opiskelee_muussa_oppilaitoksessa]>0 then ''5a_opiskelee_muussa_oppilaitoksessa''
	when [5a_keskeyttanyt_tyollinen]>0 then ''5a_keskeyttanyt_tyollinen''
	when [5a_keskeyttanyt_ei_tyollinen]>0 then ''5a_keskeyttanyt_ei_tyollinen''
	end
,[5b_koodi] = Case 
	when [5b_tutkinto_alkuperaisessa_oppilaitoksessa]>0 then ''5b_tutkinto_alkuperaisessa_oppilaitoksessa''
	when [5b_opiskelee_alkuperaisessa_oppilaitoksessa]>0 then ''5b_opiskelee_alkuperaisessa_oppilaitoksessa''
	when [5b_tutkinto_muussa_oppilaitoksessa]>0 then ''5b_tutkinto_muussa_oppilaitoksessa''
	when [5b_opiskelee_muussa_oppilaitoksessa]>0 then ''5b_opiskelee_muussa_oppilaitoksessa''
	when [5b_keskeyttanyt_tyollinen]>0 then ''5b_keskeyttanyt_tyollinen''
	when [5b_keskeyttanyt_ei_tyollinen]>0 then ''5b_keskeyttanyt_ei_tyollinen''
	end
,[5e_koodi] = Case 
	when [5e_kylla]>0 then ''5e_kylla''
	when [5e_ei]>0 then ''5e_ei''
	end
,[5f_koodi] = Case 
	when [5f_kylla]>0 then ''5f_kylla''
	when [5f_ei]>0 then ''5f_ei''
	end
,[5g_koodi] = Case 
	when [5g_kylla]>0 then ''5g_kylla''
	when [5g_ei]>0 then ''5g_ei''
	end
,[5h_koodi] = Case 
	when [5h_kylla]>0 then ''5h_kylla''
	when [5h_ei]>0 then ''5h_ei''
	end
,[6a_koodi] = Case 
	when [6a_tutkinto_alkuperaisessa_maakunnassa]>0 then ''6a_tutkinto_alkuperaisessa_maakunnassa''
	when [6a_tutkinto_muussa_maakunnassa]>0 then ''6a_tutkinto_muussa_maakunnassa''
	when [6a_opiskelee_alkuperaisessa_maakunnassa]>0 then ''6a_opiskelee_alkuperaisessa_maakunnassa''
	when [6a_opiskelee_muussa_maakunnassa]>0 then ''6a_opiskelee_muussa_maakunnassa''
	when [6a_keskeyttanyt_tyollinen]>0 then ''6a_keskeyttanyt_tyollinen''
	when [6a_keskeyttanyt_ei_tyollinen]>0 then ''6a_keskeyttanyt_ei_tyollinen''
	end
,[6b_koodi] = Case 
	when [6b_tutkinto_alkuperaisessa_maakunnassa]>0 then ''6b_tutkinto_alkuperaisessa_maakunnassa''
	when [6b_opiskelee_alkuperaisessa_maakunnassa]>0 then ''6b_opiskelee_alkuperaisessa_maakunnassa''
	when [6b_tutkinto_muussa_maakunnassa]>0 then ''6b_tutkinto_muussa_maakunnassa''
	when [6b_opiskelee_muussa_maakunnassa]>0 then ''6b_opiskelee_muussa_maakunnassa''
	when [6b_keskeyttanyt_tyollinen]>0 then ''6b_keskeyttanyt_tyollinen''
	when [6b_keskeyttanyt_ei_tyollinen]>0 then ''6b_keskeyttanyt_ei_tyollinen''
	end
,[6e_koodi] = Case 
	when [6e_kylla]>0 then ''6e_kylla''
	when [6e_ei]>0 then ''6e_ei''
	end
,[6f_koodi] = Case 
	when [6f_kylla]>0 then ''6f_kylla''
	when [6f_ei]>0 then ''6f_ei''
	end
,[6g_koodi] = Case 
	when [6g_kylla]>0 then ''6g_kylla''
	when [6g_ei]>0 then ''6g_ei''
	end
,[6h_koodi] = Case 
	when [6h_kylla]>0 then ''6h_kylla''
	when [6h_ei]>0 then ''6h_ei''
	end
,[7a_koodi] = Case 
	when [7a_tutkinto_alkuperaisella_koulutussektorilla]>0 then ''7a_tutkinto_alkuperaisella_koulutussektorilla''
	when [7a_tutkinto_muulla_koulutussektorilla]>0 then ''7a_tutkinto_muulla_koulutussektorilla''
	when [7a_opiskelee_alkuperaisella_koulutussektorilla]>0 then ''7a_opiskelee_alkuperaisella_koulutussektorilla''
	when [7a_opiskelee_muulla_koulutussektorilla]>0 then ''7a_opiskelee_muulla_koulutussektorilla''
	when [7a_keskeyttanyt_tyollinen]>0 then ''7a_keskeyttanyt_tyollinen''
	when [7a_keskeyttanyt_ei_tyollinen]>0 then ''7a_keskeyttanyt_ei_tyollinen''
	end
,[7b_koodi] = Case 
	when [7b_tutkinto_alkuperaisella_koulutussektorilla]>0 then ''7b_tutkinto_alkuperaisella_koulutussektorilla''
	when [7b_opiskelee_alkuperaisella_koulutussektorilla]>0 then ''7b_opiskelee_alkuperaisella_koulutussektorilla''
	when [7b_tutkinto_muulla_koulutussektorilla]>0 then ''7b_tutkinto_muulla_koulutussektorilla''
	when [7b_opiskelee_muulla_koulutussektorilla]>0 then ''7b_opiskelee_muulla_koulutussektorilla''
	when [7b_keskeyttanyt_tyollinen]>0 then ''7b_keskeyttanyt_tyollinen''
	when [7b_keskeyttanyt_ei_tyollinen]>0 then ''7b_keskeyttanyt_ei_tyollinen''
	end
,[7e_koodi] = Case 
	when [7e_kylla]>0 then ''7e_kylla''
	when [7e_ei]>0 then ''7e_ei''
	end
,[7f_koodi] = Case 
	when [7f_kylla]>0 then ''7f_kylla''
	when [7f_ei]>0 then ''7f_ei''
	end
,[7g_koodi] = Case 
	when [7g_kylla]>0 then ''7g_kylla''
	when [7g_ei]>0 then ''7g_ei''
	end
,[7h_koodi] = Case 
	when [7h_kylla]>0 then ''7h_kylla''
	when [7h_ei]>0 then ''7h_ei''
	end
,[8a_koodi] = Case 
	when [8a_tutkinto_alkuperaisella_opintoalalla_1995]>0 then ''8a_tutkinto_alkuperaisella_opintoalalla_1995''
	when [8a_tutkinto_muulla_opintoalalla_1995]>0 then ''8a_tutkinto_muulla_opintoalalla_1995''
	when [8a_opiskelee_alkuperaisella_opintoalalla_1995]>0 then ''8a_opiskelee_alkuperaisella_opintoalalla_1995''
	when [8a_opiskelee_muulla_opintoalalla_1995]>0 then ''8a_opiskelee_muulla_opintoalalla_1995''
	when [8a_keskeyttanyt_tyollinen]>0 then ''8a_keskeyttanyt_tyollinen''
	when [8a_keskeyttanyt_ei_tyollinen]>0 then ''8a_keskeyttanyt_ei_tyollinen''
	end
,[8b_koodi] = Case 
	when [8b_tutkinto_alkuperaisella_opintoalalla_1995]>0 then ''8b_tutkinto_alkuperaisella_opintoalalla_1995''
	when [8b_opiskelee_alkuperaisella_opintoalalla_1995]>0 then ''8b_opiskelee_alkuperaisella_opintoalalla_1995''
	when [8b_tutkinto_muulla_opintoalalla_1995]>0 then ''8b_tutkinto_muulla_opintoalalla_1995''
	when [8b_opiskelee_muulla_opintoalalla_1995]>0 then ''8b_opiskelee_muulla_opintoalalla_1995''
	when [8b_keskeyttanyt_tyollinen]>0 then ''8b_keskeyttanyt_tyollinen''
	when [8b_keskeyttanyt_ei_tyollinen]>0 then ''8b_keskeyttanyt_ei_tyollinen''
	end
,[8e_koodi] = Case 
	when [8e_kylla]>0 then ''8e_kylla''
	when [8e_ei]>0 then ''8e_ei''
	end
,[8f_koodi] = Case 
	when [8f_kylla]>0 then ''8f_kylla''
	when [8f_ei]>0 then ''8f_ei''
	end
,[8g_koodi] = Case 
	when [8g_kylla]>0 then ''8g_kylla''
	when [8g_ei]>0 then ''8g_ei''
	end
,[8h_koodi] = Case 
	when [8h_kylla]>0 then ''8h_kylla''
	when [8h_ei]>0 then ''8h_ei''
	end
,saavutettu_suorv
,saavutettu_suorlk
,saavutettu_tutkmaak
,saavutettu_tutkjarj
,saavutettu_tutkopp
,saavutettu_tutkkoulk
,saavutettu_tutkopmala
,saavutettu_tutkopmopa
,saavutettu_tutkopmast
,saavutettu_tutkopm95opa
,saavutettu_tutkkoulutussektori
,lkm_laskettu=lkm

FROM [_aloittaneiden_lapaisy_lasketut_sarakkeet]
' 
GO
/****** Object:  View [dbo].[_v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[_v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvot]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[_v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvot] AS

-- Select * from vipunen_ETL.v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvot order by rivinumero
SELECT rivinumero
,[1a Aloittaneiden opintojen kulku koulutuslajin mukaan prioriteettina mikä tahansa tutkinto] = ISNULL([1a].selite, ''Virhetilanne'')
,[1a_jarjestys] = ISNULL([1a].jarjestys, ''ÖÖÖ'')
,[1b Aloittaneiden opintojen kulku koulutuslajin mukaan prioriteettina tutkinto ja opiskelu alkuperäisessä tutkintolajissa] = ISNULL([1b].selite, ''Virhetilanne'')
,[1b_jarjestys] = ISNULL([1b].jarjestys, ''ÖÖÖ'')
,[1c Aloittaneista tutkinnon suorittaneet koulutuslajin mukaan] = ISNULL([1c].selite, ''Virhetilanne'')
,[1c_jarjestys] = ISNULL([1c].jarjestys, ''ÖÖÖ'')
,[1d Aloittaneista ilman tutkintoa opiskelua jatkavat koulutuslajin mukaan] = ISNULL([1d].selite, ''Virhetilanne'')
,[1d_jarjestys] = ISNULL([1d].jarjestys, ''ÖÖÖ'')
,[1e Aloittaneista alkuperäisen koulutuslajin tutkinnon suorittaneet koulutuslajin mukaan] = ISNULL([1e].selite, ''Virhetilanne'')
,[1e_jarjestys] = ISNULL([1e].jarjestys, ''ÖÖÖ'')
,[1f Aloittaneista muun kuin alkuperäisen tutkintolajin tutkinnon suorittaneet koulutuslajin mukaan] = ISNULL([1f].selite, ''Virhetilanne'')
,[1f_jarjestys] = ISNULL([1f].jarjestys, ''ÖÖÖ'')
,[1g Aloittaneista alkuperäisen tutkintolajin opiskelua jatkavat koulutuslajin mukaan] = ISNULL([1g].selite, ''Virhetilanne'')
,[1g_jarjestys] = ISNULL([1g].jarjestys, ''ÖÖÖ'')
,[1h Aloittaneista muun tutkintolajin opiskelua jatkavat koulutuslajin mukaan] = ISNULL([1h].selite, ''Virhetilanne'')
,[1h_jarjestys] = ISNULL([1h].jarjestys, ''ÖÖÖ'')
,[2a Aloittaneiden opintojen kulku koulutusalan (2002) mukaan prioriteettina mikä tahansa tutkinto] = ISNULL([2a].selite, ''Virhetilanne'')
,[2a_jarjestys] = ISNULL([2a].jarjestys, ''ÖÖÖ'')
,[2b Aloittaneiden opintojen kulku koulutusalan (2002) mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä] = ISNULL([2b].selite, ''Virhetilanne'')
,[2b_jarjestys] = ISNULL([2b].jarjestys, ''ÖÖÖ'')
,[2e Aloittaneista alkuperäisen koulutusalan (2002) tutkinnon suorittaneet koulutusalan mukaan] = ISNULL([2e].selite, ''Virhetilanne'')
,[2e_jarjestys] = ISNULL([2e].jarjestys, ''ÖÖÖ'')
,[2f Aloittaneista muun kuin alkuperäisen tutkintolajin tutkinnon suorittaneet koulutuslajin mukaan] = ISNULL([2f].selite, ''Virhetilanne'')
,[2f_jarjestys] = ISNULL([2f].jarjestys, ''ÖÖÖ'')
,[2g Aloittaneista alkuperäisellä koulutusalalla opiskelua jatkavat koulutusalan mukaan] = ISNULL([2g].selite, ''Virhetilanne'')
,[2g_jarjestys] = ISNULL([2g].jarjestys, ''ÖÖÖ'')
,[2h Aloittaneista muulla koulutusalalla opiskelua jatkavat koulutusalan mukaan] = ISNULL([2h].selite, ''Virhetilanne'')
,[2h_jarjestys] = ISNULL([2h].jarjestys, ''ÖÖÖ'')
,[3a Aloittaneiden opintojen kulku opintoalan (2002) mukaan prioriteettina mikä tahansa tutkinto] = ISNULL([3a].selite, ''Virhetilanne'')
,[3a_jarjestys] = ISNULL([3a].jarjestys, ''ÖÖÖ'')
,[3b Aloittaneiden opintojen kulku opintoalan (2002) mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä] = ISNULL([3b].selite, ''Virhetilanne'')
,[3b_jarjestys] = ISNULL([3b].jarjestys, ''ÖÖÖ'')
,[3e Aloittaneista alkuperäisen opintoalan (2002) tutkinnon suorittaneet opintoalan mukaan] = ISNULL([3e].selite, ''Virhetilanne'')
,[3e_jarjestys] = ISNULL([3e].jarjestys, ''ÖÖÖ'')
,[3f Aloittaneista muun opintoalan (2002) tutkinnon suorittaneet opintoalan mukaan] = ISNULL([3f].selite, ''Virhetilanne'')
,[3f_jarjestys] = ISNULL([3f].jarjestys, ''ÖÖÖ'')
,[3g Aloittaneista alkuperäisellä opintoalalla (2002) opiskelua jatkavat opintoalan mukaan] = ISNULL([3g].selite, ''Virhetilanne'')
,[3g_jarjestys] = ISNULL([3g].jarjestys, ''ÖÖÖ'')
,[3h Aloittaneista muulla opintoalalla (2002) opiskelua jatkavat opintoalan mukaan] = ISNULL([3h].selite, ''Virhetilanne'')
,[3h_jarjestys] = ISNULL([3h].jarjestys, ''ÖÖÖ'')
,[4a Aloittaneiden opintojen kulku koulutuksen järjestäjän mukaan, toinen aste prioriteettina tutkinto missä tahansa] = ISNULL([4a].selite, ''Virhetilanne'')
,[4a_jarjestys] = ISNULL([4a].jarjestys, ''ÖÖÖ'')
,[4b Aloittaneiden opintojen kulku koulutuksen järjestäjän mukaan, toinen aste prioriteettina tutkinto ja opiskelu alkuperäisellä] = ISNULL([4b].selite, ''Virhetilanne'')
,[4b_jarjestys] = ISNULL([4b].jarjestys, ''ÖÖÖ'')
,[4e Aloittaneista alkuperäisen koulutuksen järjestäjän tutkinnon suorittaneet järjestäjän mukaan] = ISNULL([4e].selite, ''Virhetilanne'')
,[4e_jarjestys] = ISNULL([4e].jarjestys, ''ÖÖÖ'')
,[4f Aloittaneista muun koulutuksen järjestäjän tutkinnon suorittaneet järjestäjän mukaan] = ISNULL([4f].selite, ''Virhetilanne'')
,[4f_jarjestys] = ISNULL([4f].jarjestys, ''ÖÖÖ'')
,[4g Aloittaneista alkuperäisellä järjestäjällä opiskelua jatkavat järjestäjän mukaan] = ISNULL([4g].selite, ''Virhetilanne'')
,[4g_jarjestys] = ISNULL([4g].jarjestys, ''ÖÖÖ'')
,[4h Aloittaneista muulla järjestäjällä opiskelua jatkavat järjestäjän mukaan] = ISNULL([4h].selite, ''Virhetilanne'')
,[4h_jarjestys] = ISNULL([4h].jarjestys, ''ÖÖÖ'')
,[5a Aloittaneiden opintojen kulku oppilaitoksen mukaan prioriteettina tutkinto missä tahansa] = ISNULL([5a].selite, ''Virhetilanne'')
,[5a_jarjestys] = ISNULL([5a].jarjestys, ''ÖÖÖ'')
,[5b Aloittaneiden opintojen kulku oppilaitoksen mukaan prioriteettina tutkinto ja opiskelu alkuperäisessä] = ISNULL([5b].selite, ''Virhetilanne'')
,[5b_jarjestys] = ISNULL([5b].jarjestys, ''ÖÖÖ'')
,[5e Aloittaneista alkuperäisessä oppilaitoksessa tutkinnon suorittaneet oppilaitoksen mukaan] = ISNULL([5e].selite, ''Virhetilanne'')
,[5e_jarjestys] = ISNULL([5e].jarjestys, ''ÖÖÖ'')
,[5f Aloittaneista muussa oppilaitoksessa tutkinnon suorittaneet oppilaitoksen mukaan] = ISNULL([5f].selite, ''Virhetilanne'')
,[5f_jarjestys] = ISNULL([5f].jarjestys, ''ÖÖÖ'')
,[5g Aloittaneista alkuperäisessä oppilaitoksessa opiskelua jatkavat oppilaitoksen mukaan] = ISNULL([5g].selite, ''Virhetilanne'')
,[5g_jarjestys] = ISNULL([5g].jarjestys, ''ÖÖÖ'')
,[5h Aloittaneista muussa oppilaitoksessa opiskelua jatkavat oppilaitoksen mukaan] = ISNULL([5h].selite, ''Virhetilanne'')
,[5h_jarjestys] = ISNULL([5h].jarjestys, ''ÖÖÖ'')
,[6a Aloittaneiden opintojen kulku maakunnan mukaan prioriteettina tutkinto missä tahansa] = ISNULL([6a].selite, ''Virhetilanne'')
,[6a_jarjestys] = ISNULL([6a].jarjestys, ''ÖÖÖ'')
,[6b Aloittaneiden opintojen kulku maakunnan mukaan prioriteettina tutkinto ja opiskelu alkuperäisessä] = ISNULL([6b].selite, ''Virhetilanne'')
,[6b_jarjestys] = ISNULL([6b].jarjestys, ''ÖÖÖ'')
,[6e Aloittaneista alkuperäisessä maakunnassa tutkinnon suorittaneet maakunnan mukaan] = ISNULL([6e].selite, ''Virhetilanne'')
,[6e_jarjestys] = ISNULL([6e].jarjestys, ''ÖÖÖ'')
,[6f Aloittaneista muussa maakunnassa tutkinnon suorittaneet maakunnan mukaan] = ISNULL([6f].selite, ''Virhetilanne'')
,[6f_jarjestys] = ISNULL([6f].jarjestys, ''ÖÖÖ'')
,[6g Aloittaneista alkuperäisessä maakunnassa opiskelua jatkavat maakunnan mukaan] = ISNULL([6g].selite, ''Virhetilanne'')
,[6g_jarjestys] = ISNULL([6g].jarjestys, ''ÖÖÖ'')
,[6h Aloittaneista muussa maakunnassa opiskelua jatkavat maakunnan mukaan] = ISNULL([6h].selite, ''Virhetilanne'')
,[6h_jarjestys] = ISNULL([6h].jarjestys, ''ÖÖÖ'')
,[7a Aloittaneiden opintojen kulku koulutussektorin mukaan prioriteettina tutkinto missä tahansa] = ISNULL([7a].selite, ''Virhetilanne'')
,[7a_jarjestys] = ISNULL([7a].jarjestys, ''ÖÖÖ'')
,[7b Aloittaneiden opintojen kulku koulutussektorin mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä] = ISNULL([7b].selite, ''Virhetilanne'')
,[7b_jarjestys] = ISNULL([7b].jarjestys, ''ÖÖÖ'')
,[7e Aloittaneista alkuperäisen koulutussektorin tutkinnon suorittaneet koulutussektorin mukaan] = ISNULL([7e].selite, ''Virhetilanne'')
,[7e_jarjestys] = ISNULL([7e].jarjestys, ''ÖÖÖ'')
,[7f Aloittaneista muun koulutussektorin tutkinnon suorittaneet koulutussektorin mukaan] = ISNULL([7f].selite, ''Virhetilanne'')
,[7f_jarjestys] = ISNULL([7f].jarjestys, ''ÖÖÖ'')
,[7g Aloittaneista alkuperäisellä koulutussektorilla opiskelua jatkavat koulutussektorin mukaan] = ISNULL([7g].selite, ''Virhetilanne'')
,[7g_jarjestys] = ISNULL([7g].jarjestys, ''ÖÖÖ'')
,[7h Aloittaneista muulla koulutussektorilla opiskelua jatkavat koulutussektorin mukaan] = ISNULL([7h].selite, ''Virhetilanne'')
,[7h_jarjestys] = ISNULL([7h].jarjestys, ''ÖÖÖ'')
,[8a Aloittaneiden opintojen kulku opintoalan (1995) mukaan prioriteettina mikä tahansa tutkinto] = ISNULL([8a].selite, ''Virhetilanne'')
,[8a_jarjestys] = ISNULL([8a].jarjestys, ''ÖÖÖ'')
,[8b Aloittaneiden opintojen kulku opintoalan (1995) mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä] = ISNULL([8b].selite, ''Virhetilanne'')
,[8b_jarjestys] = ISNULL([8b].jarjestys, ''ÖÖÖ'')
,[8e Aloittaneista alkuperäisen opintoalan (1995) tutkinnon suorittaneet opintoalan mukaan] = ISNULL([8e].selite, ''Virhetilanne'')
,[8e_jarjestys] = ISNULL([8e].jarjestys, ''ÖÖÖ'')
,[8f Aloittaneista muun opintoalan (1995) tutkinnon suorittaneet opintoalan mukaan] = ISNULL([8f].selite, ''Virhetilanne'')
,[8f_jarjestys] = ISNULL([8f].jarjestys, ''ÖÖÖ'')
,[8g Aloittaneista alkuperäisellä opintoalalla (1995) opiskelua jatkavat opintoalan mukaan] = ISNULL([8g].selite, ''Virhetilanne'')
,[8g_jarjestys] = ISNULL([8g].jarjestys, ''ÖÖÖ'')
,[8h Aloittaneista muulla opintoalalla (1995) opiskelua jatkavat opintoalan mukaan] = ISNULL([8h].selite, ''Virhetilanne'')
,[8h_jarjestys] = ISNULL([8h].jarjestys, ''ÖÖÖ'')
,saavutettu_suorv
,saavutettu_suorlk
,saavutettu_tutkmaak
,saavutettu_tutkjarj
,saavutettu_tutkopp
,saavutettu_tutkkoulk
,saavutettu_tutkopmala
,saavutettu_tutkopmopa
,saavutettu_tutkopmast
,saavutettu_tutkopm95opa
,saavutettu_tutkkoulutussektori
,lkm_laskettu

FROM _v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvojen_avaimet
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1a] ON [1a].koodi=[1a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1b] ON [1b].koodi=[1b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1c] ON [1c].koodi=[1c_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1d] ON [1d].koodi=[1d_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1e] ON [1e].koodi=[1e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1f] ON [1f].koodi=[1f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1g] ON [1g].koodi=[1g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [1h] ON [1h].koodi=[1h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [2a] ON [2a].koodi=[2a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [2b] ON [2b].koodi=[2b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [2e] ON [2e].koodi=[2e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [2f] ON [2f].koodi=[2f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [2g] ON [2g].koodi=[2g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [2h] ON [2h].koodi=[2h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [3a] ON [3a].koodi=[3a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [3b] ON [3b].koodi=[3b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [3e] ON [3e].koodi=[3e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [3f] ON [3f].koodi=[3f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [3g] ON [3g].koodi=[3g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [3h] ON [3h].koodi=[3h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [4a] ON [4a].koodi=[4a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [4b] ON [4b].koodi=[4b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [4e] ON [4e].koodi=[4e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [4f] ON [4f].koodi=[4f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [4g] ON [4g].koodi=[4g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [4h] ON [4h].koodi=[4h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [5a] ON [5a].koodi=[5a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [5b] ON [5b].koodi=[5b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [5e] ON [5e].koodi=[5e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [5f] ON [5f].koodi=[5f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [5g] ON [5g].koodi=[5g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [5h] ON [5h].koodi=[5h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [6a] ON [6a].koodi=[6a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [6b] ON [6b].koodi=[6b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [6e] ON [6e].koodi=[6e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [6f] ON [6f].koodi=[6f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [6g] ON [6g].koodi=[6g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [6h] ON [6h].koodi=[6h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [7a] ON [7a].koodi=[7a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [7b] ON [7b].koodi=[7b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [7e] ON [7e].koodi=[7e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [7f] ON [7f].koodi=[7f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [7g] ON [7g].koodi=[7g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [7h] ON [7h].koodi=[7h_koodi]

LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [8a] ON [8a].koodi=[8a_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [8b] ON [8b].koodi=[8b_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [8e] ON [8e].koodi=[8e_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [8f] ON [8f].koodi=[8f_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [8g] ON [8g].koodi=[8g_koodi]
LEFT JOIN VipunenTK_lisatiedot.dbo.aloittaneiden_lapaisy_seuranta [8h] ON [8h].koodi=[8h_koodi]
' 
GO
/****** Object:  View [dbo].[v_aloittaneiden_lapaisy_lasketut_sarakkeet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aloittaneiden_lapaisy_lasketut_sarakkeet]'))
EXEC dbo.sp_executesql @statement = N'-- Select * from [vipunen_ETL].[v_aloittaneiden_lapaisy_lasketut_sarakkeet] 

CREATE VIEW [dbo].[v_aloittaneiden_lapaisy_lasketut_sarakkeet] AS
SELECT 
-- lähtötiedot
  tiiv.[rivinumero]
      ,[tilv]
      ,tilv_date = CAST(tilv+''-01-01'' as date)
      ,[lahde]
      ,[opp] = CAST(opp as nvarchar(5))
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[klaji]
      ,[ophal]
      ,[jarj]
      ,[kkun]
      ,[maak]
      ,[koulk]
      ,[opmala]
      ,[opmopa]
      ,[opmast]
      ,[opm95opa]
      ,[koulutussektori]
      ,[pohjkoulk]
      ,[alvv_kk]
      ,[allk_kk]
      ,[ololk]
      ,[rahlahde]
      ,[koulutuslaji2]
      ,saavutettu_suorv
	  ,saavutettu_suorlk
	  ,saavutettu_tutkmaak
	  ,saavutettu_tutkjarj
	  ,saavutettu_tutkopp
	  ,saavutettu_tutkkoulk
	  ,saavutettu_tutkopmala
	  ,saavutettu_tutkopmopa
	  ,saavutettu_tutkopmast
	  ,saavutettu_tutkopm95opa
	  ,saavutettu_tutkkoulutussektori
      ,[tarkasteluperiodi]
      ,[tarkasteluperiodi_char] = [tarkasteluperiodi]
  --    ,[tarkasteluperiodi_char] = Case [tarkasteluperiodi] 
		--when 0.5 then ''0,5'' when 1.5 then ''1,5'' when 2.5 then ''2,5'' when 3.5 then ''3,5'' when 4.5 then ''4,5'' when 5.5 then ''5,5'' when 6.5 then ''6,5''
		--when 1 then ''1'' when 2 then ''2'' when 3 then ''3'' when 4 then ''4'' when 5 then ''5'' when 6 then ''6'' when 7 then ''7'' when 8 then ''8'' when 9 then ''9'' 
		--else ''-1'' end
      ,[tietolahde]
      ,[aineistorivinumero]
      ,[lkm_int]=lask.lkm_laskettu
      --,[Sarakeryhma1_ID]
      --,[Sarakeryhma1_opp]
      --,[Sarakeryhma1_opmala]
      --,[Sarakeryhma1_opmopa]
      --,[Sarakeryhma1_opmast]
      --,[Sarakeryhma1_opm95opa]
      --,[Sarakeryhma1_koulutussektori]
      --,[Sarakeryhma1_suorv]
      --,[Sarakeryhma1_suorlk]
      --,[Sarakeryhma1_kmaak]
      --,[Sarakeryhma1_olotamm]
      --,[Sarakeryhma1_olosyys]
      --,[Sarakeryhma1_ptoim1r5]
      --,[Sarakeryhma1_amas]
      --,[Sarakeryhma1_koulk]
      --,[Sarakeryhma2_ID]
      --,[Sarakeryhma2_opp]
      --,[Sarakeryhma2_opmala]
      --,[Sarakeryhma2_opmopa]
      --,[Sarakeryhma2_opmast]
      --,[Sarakeryhma2_opm95opa]
      --,[Sarakeryhma2_koulutussektori]
      --,[Sarakeryhma2_suorv]
      --,[Sarakeryhma2_suorlk]
      --,[Sarakeryhma2_kmaak]
      --,[Sarakeryhma2_olotamm]
      --,[Sarakeryhma2_olosyys]
      --,[Sarakeryhma2_ptoim1r5]
      --,[Sarakeryhma2_amas]
      --,[Sarakeryhma2_koulk]
      --,[Sarakeryhma3_ID]
      --,[Sarakeryhma3_opp]
      --,[Sarakeryhma3_opmala]
      --,[Sarakeryhma3_opmopa]
      --,[Sarakeryhma3_opmast]
      --,[Sarakeryhma3_opm95opa]
      --,[Sarakeryhma3_koulutussektori]
      --,[Sarakeryhma3_suorv]
      --,[Sarakeryhma3_suorlk]
      --,[Sarakeryhma3_kmaak]
      --,[Sarakeryhma3_olotamm]
      --,[Sarakeryhma3_olosyys]
      --,[Sarakeryhma3_ptoim1r5]
      --,[Sarakeryhma3_amas]
      --,[Sarakeryhma3_koulk]
      --,[Sarakeryhma4_ID]
      --,[Sarakeryhma4_opp]
      --,[Sarakeryhma4_opmala]
      --,[Sarakeryhma4_opmopa]
      --,[Sarakeryhma4_opmast]
      --,[Sarakeryhma4_opm95opa]
      --,[Sarakeryhma4_koulutussektori]
      --,[Sarakeryhma4_suorv]
      --,[Sarakeryhma4_suorlk]
      --,[Sarakeryhma4_kmaak]
      --,[Sarakeryhma4_olotamm]
      --,[Sarakeryhma4_olosyys]
      --,[Sarakeryhma4_ptoim1r5]
      --,[Sarakeryhma4_amas]
      --,[Sarakeryhma4_koulk]
      --,[Sarakeryhma5_ID]
      --,[Sarakeryhma5_opp]
      --,[Sarakeryhma5_opmala]
      --,[Sarakeryhma5_opmopa]
      --,[Sarakeryhma5_opmast]
      --,[Sarakeryhma5_opm95opa]
      --,[Sarakeryhma5_koulutussektori]
      --,[Sarakeryhma5_suorv]
      --,[Sarakeryhma5_suorlk]
      --,[Sarakeryhma5_kmaak]
      --,[Sarakeryhma5_olotamm]
      --,[Sarakeryhma5_olosyys]
      --,[Sarakeryhma5_ptoim1r5]
      --,[Sarakeryhma5_amas]
      --,[Sarakeryhma5_koulk]
      --,[Sarakeryhma6_ID]
      --,[Sarakeryhma6_opp]
      --,[Sarakeryhma6_opmala]
      --,[Sarakeryhma6_opmopa]
      --,[Sarakeryhma6_opmast]
      --,[Sarakeryhma6_opm95opa]
      --,[Sarakeryhma6_koulutussektori]
      --,[Sarakeryhma6_suorv]
      --,[Sarakeryhma6_suorlk]
      --,[Sarakeryhma6_kmaak]
      --,[Sarakeryhma6_olotamm]
      --,[Sarakeryhma6_olosyys]
      --,[Sarakeryhma6_ptoim1r5]
      --,[Sarakeryhma6_amas]
      --,[Sarakeryhma6_koulk]
      --,[Sarakeryhma7_ID]
      --,[Sarakeryhma7_opp]
      --,[Sarakeryhma7_opmala]
      --,[Sarakeryhma7_opmopa]
      --,[Sarakeryhma7_opmast]
      --,[Sarakeryhma7_opm95opa]
      --,[Sarakeryhma7_koulutussektori]
      --,[Sarakeryhma7_suorv]
      --,[Sarakeryhma7_suorlk]
      --,[Sarakeryhma7_kmaak]
      --,[Sarakeryhma7_olotamm]
      --,[Sarakeryhma7_olosyys]
      --,[Sarakeryhma7_ptoim1r5]
      --,[Sarakeryhma7_amas]
      --,[Sarakeryhma7_koulk]
      --,[Sarakeryhma8_ID]
      --,[Sarakeryhma8_opp]
      --,[Sarakeryhma8_opmala]
      --,[Sarakeryhma8_opmopa]
      --,[Sarakeryhma8_opmast]
      --,[Sarakeryhma8_opm95opa]
      --,[Sarakeryhma8_koulutussektori]
      --,[Sarakeryhma8_suorv]
      --,[Sarakeryhma8_suorlk]
      --,[Sarakeryhma8_kmaak]
      --,[Sarakeryhma8_olotamm]
      --,[Sarakeryhma8_olosyys]
      --,[Sarakeryhma8_ptoim1r5]
      --,[Sarakeryhma8_amas]
      --,[Sarakeryhma8_koulk]
      --,[Sarakeryhma9_ID]
      --,[Sarakeryhma9_opp]
      --,[Sarakeryhma9_opmala]
      --,[Sarakeryhma9_opmopa]
      --,[Sarakeryhma9_opmast]
      --,[Sarakeryhma9_opm95opa]
      --,[Sarakeryhma9_koulutussektori]
      --,[Sarakeryhma9_suorv]
      --,[Sarakeryhma9_suorlk]
      --,[Sarakeryhma9_kmaak]
      --,[Sarakeryhma9_olotamm]
      --,[Sarakeryhma9_olosyys]
      --,[Sarakeryhma9_ptoim1r5]
      --,[Sarakeryhma9_amas]
      --,[Sarakeryhma9_koulk]
      --,[Sarakeryhma10_ID]
      --,[Sarakeryhma10_opp]
      --,[Sarakeryhma10_opmala]
      --,[Sarakeryhma10_opmopa]
      --,[Sarakeryhma10_opmast]
      --,[Sarakeryhma10_opm95opa]
      --,[Sarakeryhma10_koulutussektori]
      --,[Sarakeryhma10_suorv]
      --,[Sarakeryhma10_suorlk]
      --,[Sarakeryhma10_kmaak]
      --,[Sarakeryhma10_olotamm]
      --,[Sarakeryhma10_olosyys]
      --,[Sarakeryhma10_ptoim1r5]
      --,[Sarakeryhma10_amas]
      --,[Sarakeryhma10_koulk]
      --,[Sarakeryhma11_ID]
      --,[Sarakeryhma11_opp]
      --,[Sarakeryhma11_opmala]
      --,[Sarakeryhma11_opmopa]
      --,[Sarakeryhma11_opmast]
      --,[Sarakeryhma11_opm95opa]
      --,[Sarakeryhma11_koulutussektori]
      --,[Sarakeryhma11_suorv]
      --,[Sarakeryhma11_suorlk]
      --,[Sarakeryhma11_kmaak]
      --,[Sarakeryhma11_olotamm]
      --,[Sarakeryhma11_olosyys]
      --,[Sarakeryhma11_ptoim1r5]
      --,[Sarakeryhma11_amas]
      --,[Sarakeryhma11_koulk]
      --,[Sarakeryhma12_ID]
      --,[Sarakeryhma12_opp]
      --,[Sarakeryhma12_opmala]
      --,[Sarakeryhma12_opmopa]
      --,[Sarakeryhma12_opmast]
      --,[Sarakeryhma12_opm95opa]
      --,[Sarakeryhma12_koulutussektori]
      --,[Sarakeryhma12_suorv]
      --,[Sarakeryhma12_suorlk]
      --,[Sarakeryhma12_kmaak]
      --,[Sarakeryhma12_olotamm]
      --,[Sarakeryhma12_olosyys]
      --,[Sarakeryhma12_ptoim1r5]
      --,[Sarakeryhma12_amas]
      --,[Sarakeryhma12_koulk]
      --,[Sarakeryhma13_ID]
      --,[Sarakeryhma13_opp]
      --,[Sarakeryhma13_opmala]
      --,[Sarakeryhma13_opmopa]
      --,[Sarakeryhma13_opmast]
      --,[Sarakeryhma13_opm95opa]
      --,[Sarakeryhma13_koulutussektori]
      --,[Sarakeryhma13_suorv]
      --,[Sarakeryhma13_suorlk]
      --,[Sarakeryhma13_kmaak]
      --,[Sarakeryhma13_olotamm]
      --,[Sarakeryhma13_olosyys]
      --,[Sarakeryhma13_ptoim1r5]
      --,[Sarakeryhma13_amas]
      --,[Sarakeryhma13_koulk]
      --,[Sarakeryhma14_ID]
      --,[Sarakeryhma14_opp]
      --,[Sarakeryhma14_opmala]
      --,[Sarakeryhma14_opmopa]
      --,[Sarakeryhma14_opmast]
      --,[Sarakeryhma14_opm95opa]
      --,[Sarakeryhma14_koulutussektori]
      --,[Sarakeryhma14_suorv]
      --,[Sarakeryhma14_suorlk]
      --,[Sarakeryhma14_kmaak]
      --,[Sarakeryhma14_olotamm]
      --,[Sarakeryhma14_olosyys]
      --,[Sarakeryhma14_ptoim1r5]
      --,[Sarakeryhma14_amas]
      --,[Sarakeryhma14_koulk]
      --,[Sarakeryhma15_ID]
      --,[Sarakeryhma15_opp]
      --,[Sarakeryhma15_opmala]
      --,[Sarakeryhma15_opmopa]
      --,[Sarakeryhma15_opmast]
      --,[Sarakeryhma15_opm95opa]
      --,[Sarakeryhma15_koulutussektori]
      --,[Sarakeryhma15_suorv]
      --,[Sarakeryhma15_suorlk]
      --,[Sarakeryhma15_kmaak]
      --,[Sarakeryhma15_olotamm]
      --,[Sarakeryhma15_olosyys]
      --,[Sarakeryhma15_ptoim1r5]
      --,[Sarakeryhma15_amas]
      --,[Sarakeryhma15_koulk]
      --,[Sarakeryhma16_ID]
      --,[Sarakeryhma16_opp]
      --,[Sarakeryhma16_opmala]
      --,[Sarakeryhma16_opmopa]
      --,[Sarakeryhma16_opmast]
      --,[Sarakeryhma16_opm95opa]
      --,[Sarakeryhma16_koulutussektori]
      --,[Sarakeryhma16_suorv]
      --,[Sarakeryhma16_suorlk]
      --,[Sarakeryhma16_kmaak]
      --,[Sarakeryhma16_olotamm]
      --,[Sarakeryhma16_olosyys]
      --,[Sarakeryhma16_ptoim1r5]
      --,[Sarakeryhma16_amas]
      --,[Sarakeryhma16_koulk]
      --,[Sarakeryhma17_ID]
      --,[Sarakeryhma17_opp]
      --,[Sarakeryhma17_opmala]
      --,[Sarakeryhma17_opmopa]
      --,[Sarakeryhma17_opmast]
      --,[Sarakeryhma17_opm95opa]
      --,[Sarakeryhma17_koulutussektori]
      --,[Sarakeryhma17_suorv]
      --,[Sarakeryhma17_suorlk]
      --,[Sarakeryhma17_kmaak]
      --,[Sarakeryhma17_olotamm]
      --,[Sarakeryhma17_olosyys]
      --,[Sarakeryhma17_ptoim1r5]
      --,[Sarakeryhma17_amas]
      --,[Sarakeryhma17_koulk]
      --,[Sarakeryhma18_ID]
      --,[Sarakeryhma18_opp]
      --,[Sarakeryhma18_opmala]
      --,[Sarakeryhma18_opmopa]
      --,[Sarakeryhma18_opmast]
      --,[Sarakeryhma18_opm95opa]
      --,[Sarakeryhma18_koulutussektori]
      --,[Sarakeryhma18_suorv]
      --,[Sarakeryhma18_suorlk]
      --,[Sarakeryhma18_kmaak]
      --,[Sarakeryhma18_olotamm]
      --,[Sarakeryhma18_olosyys]
      --,[Sarakeryhma18_ptoim1r5]
      --,[Sarakeryhma18_amas]
      --,[Sarakeryhma18_koulk]
      --,[Sarakeryhma19_ID]
      --,[Sarakeryhma19_opp]
      --,[Sarakeryhma19_opmala]
      --,[Sarakeryhma19_opmopa]
      --,[Sarakeryhma19_opmast]
      --,[Sarakeryhma19_opm95opa]
      --,[Sarakeryhma19_koulutussektori]
      --,[Sarakeryhma19_suorv]
      --,[Sarakeryhma19_suorlk]
      --,[Sarakeryhma19_kmaak]
      --,[Sarakeryhma19_olotamm]
      --,[Sarakeryhma19_olosyys]
      --,[Sarakeryhma19_ptoim1r5]
      --,[Sarakeryhma19_amas]
      --,[Sarakeryhma19_koulk]
      --,[Sarakeryhma20_ID]
      --,[Sarakeryhma20_opp]
      --,[Sarakeryhma20_opmala]
      --,[Sarakeryhma20_opmopa]
      --,[Sarakeryhma20_opmast]
      --,[Sarakeryhma20_opm95opa]
      --,[Sarakeryhma20_koulutussektori]
      --,[Sarakeryhma20_suorv]
      --,[Sarakeryhma20_suorlk]
      --,[Sarakeryhma20_kmaak]
      --,[Sarakeryhma20_olotamm]
      --,[Sarakeryhma20_olosyys]
      --,[Sarakeryhma20_ptoim1r5]
      --,[Sarakeryhma20_amas]
      --,[Sarakeryhma20_koulk]
      --,[Sarakeryhma21_ID]
      --,[Sarakeryhma21_opp]
      --,[Sarakeryhma21_opmala]
      --,[Sarakeryhma21_opmopa]
      --,[Sarakeryhma21_opmast]
      --,[Sarakeryhma21_opm95opa]
      --,[Sarakeryhma21_koulutussektori]
      --,[Sarakeryhma21_suorv]
      --,[Sarakeryhma21_suorlk]
      --,[Sarakeryhma21_kmaak]
      --,[Sarakeryhma21_olotamm]
      --,[Sarakeryhma21_olosyys]
      --,[Sarakeryhma21_ptoim1r5]
      --,[Sarakeryhma21_amas]
      --,[Sarakeryhma21_koulk]
      --,[Sarakeryhma22_ID]
      --,[Sarakeryhma22_opp]
      --,[Sarakeryhma22_opmala]
      --,[Sarakeryhma22_opmopa]
      --,[Sarakeryhma22_opmast]
      --,[Sarakeryhma22_opm95opa]
      --,[Sarakeryhma22_koulutussektori]
      --,[Sarakeryhma22_suorv]
      --,[Sarakeryhma22_suorlk]
      --,[Sarakeryhma22_kmaak]
      --,[Sarakeryhma22_olotamm]
      --,[Sarakeryhma22_olosyys]
      --,[Sarakeryhma22_ptoim1r5]
      --,[Sarakeryhma22_amas]
      --,[Sarakeryhma22_koulk]
      --,[Sarakeryhma23_ID]
      --,[Sarakeryhma23_opp]
      --,[Sarakeryhma23_opmala]
      --,[Sarakeryhma23_opmopa]
      --,[Sarakeryhma23_opmast]
      --,[Sarakeryhma23_opm95opa]
      --,[Sarakeryhma23_koulutussektori]
      --,[Sarakeryhma23_suorv]
      --,[Sarakeryhma23_suorlk]
      --,[Sarakeryhma23_kmaak]
      --,[Sarakeryhma23_olotamm]
      --,[Sarakeryhma23_olosyys]
      --,[Sarakeryhma23_ptoim1r5]
      --,[Sarakeryhma23_amas]
      --,[Sarakeryhma23_koulk]
      --,[Sarakeryhma24_ID]
      --,[Sarakeryhma24_opp]
      --,[Sarakeryhma24_opmala]
      --,[Sarakeryhma24_opmopa]
      --,[Sarakeryhma24_opmast]
      --,[Sarakeryhma24_opm95opa]
      --,[Sarakeryhma24_koulutussektori]
      --,[Sarakeryhma24_suorv]
      --,[Sarakeryhma24_suorlk]
      --,[Sarakeryhma24_kmaak]
      --,[Sarakeryhma24_olotamm]
      --,[Sarakeryhma24_olosyys]
      --,[Sarakeryhma24_ptoim1r5]
      --,[Sarakeryhma24_amas]
      --,[Sarakeryhma24_koulk]
      --,[Sarakeryhma25_ID]
      --,[Sarakeryhma25_opp]
      --,[Sarakeryhma25_opmala]
      --,[Sarakeryhma25_opmopa]
      --,[Sarakeryhma25_opmast]
      --,[Sarakeryhma25_opm95opa]
      --,[Sarakeryhma25_koulutussektori]
      --,[Sarakeryhma25_suorv]
      --,[Sarakeryhma25_suorlk]
      --,[Sarakeryhma25_kmaak]
      --,[Sarakeryhma25_olotamm]
      --,[Sarakeryhma25_olosyys]
      --,[Sarakeryhma25_ptoim1r5]
      --,[Sarakeryhma25_amas]
      --,[Sarakeryhma25_koulk]
      --,[Sarakeryhma26_ID]
      --,[Sarakeryhma26_opp]
      --,[Sarakeryhma26_opmala]
      --,[Sarakeryhma26_opmopa]
      --,[Sarakeryhma26_opmast]
      --,[Sarakeryhma26_opm95opa]
      --,[Sarakeryhma26_koulutussektori]
      --,[Sarakeryhma26_suorv]
      --,[Sarakeryhma26_suorlk]
      --,[Sarakeryhma26_kmaak]
      --,[Sarakeryhma26_olotamm]
      --,[Sarakeryhma26_olosyys]
      --,[Sarakeryhma26_ptoim1r5]
      --,[Sarakeryhma26_amas]
      --,[Sarakeryhma26_koulk]
      --,[Sarakeryhma27_ID]
      --,[Sarakeryhma27_opp]
      --,[Sarakeryhma27_opmala]
      --,[Sarakeryhma27_opmopa]
      --,[Sarakeryhma27_opmast]
      --,[Sarakeryhma27_opm95opa]
      --,[Sarakeryhma27_koulutussektori]
      --,[Sarakeryhma27_suorv]
      --,[Sarakeryhma27_suorlk]
      --,[Sarakeryhma27_kmaak]
      --,[Sarakeryhma27_olotamm]
      --,[Sarakeryhma27_olosyys]
      --,[Sarakeryhma27_ptoim1r5]
      --,[Sarakeryhma27_amas]
      --,[Sarakeryhma27_koulk]
      --,[Sarakeryhma28_ID]
      --,[Sarakeryhma28_opp]
      --,[Sarakeryhma28_opmala]
      --,[Sarakeryhma28_opmopa]
      --,[Sarakeryhma28_opmast]
      --,[Sarakeryhma28_opm95opa]
      --,[Sarakeryhma28_koulutussektori]
      --,[Sarakeryhma28_suorv]
      --,[Sarakeryhma28_suorlk]
      --,[Sarakeryhma28_kmaak]
      --,[Sarakeryhma28_olotamm]
      --,[Sarakeryhma28_olosyys]
      --,[Sarakeryhma28_ptoim1r5]
      --,[Sarakeryhma28_amas]
      --,[Sarakeryhma28_koulk]
      --,[Sarakeryhma29_ID]
      --,[Sarakeryhma29_opp]
      --,[Sarakeryhma29_opmala]
      --,[Sarakeryhma29_opmopa]
      --,[Sarakeryhma29_opmast]
      --,[Sarakeryhma29_opm95opa]
      --,[Sarakeryhma29_koulutussektori]
      --,[Sarakeryhma29_suorv]
      --,[Sarakeryhma29_suorlk]
      --,[Sarakeryhma29_kmaak]
      --,[Sarakeryhma29_olotamm]
      --,[Sarakeryhma29_olosyys]
      --,[Sarakeryhma29_ptoim1r5]
      --,[Sarakeryhma29_amas]
      --,[Sarakeryhma29_koulk]
      --,[Sarakeryhma30_ID]
      --,[Sarakeryhma30_opp]
      --,[Sarakeryhma30_opmala]
      --,[Sarakeryhma30_opmopa]
      --,[Sarakeryhma30_opmast]
      --,[Sarakeryhma30_opm95opa]
      --,[Sarakeryhma30_koulutussektori]
      --,[Sarakeryhma30_suorv]
      --,[Sarakeryhma30_suorlk]
      --,[Sarakeryhma30_kmaak]
      --,[Sarakeryhma30_olotamm]
      --,[Sarakeryhma30_olosyys]
      --,[Sarakeryhma30_ptoim1r5]
      --,[Sarakeryhma30_amas]
      --,[Sarakeryhma30_koulk]
      --,[Sarakeryhma31_ID]
      --,[Sarakeryhma31_opp]
      --,[Sarakeryhma31_opmala]
      --,[Sarakeryhma31_opmopa]
      --,[Sarakeryhma31_opmast]
      --,[Sarakeryhma31_opm95opa]
      --,[Sarakeryhma31_koulutussektori]
      --,[Sarakeryhma31_suorv]
      --,[Sarakeryhma31_suorlk]
      --,[Sarakeryhma31_kmaak]
      --,[Sarakeryhma31_olotamm]
      --,[Sarakeryhma31_olosyys]
      --,[Sarakeryhma31_ptoim1r5]
      --,[Sarakeryhma31_amas]
      --,[Sarakeryhma31_koulk]
      --,[Sarakeryhma32_ID]
      --,[Sarakeryhma32_opp]
      --,[Sarakeryhma32_opmala]
      --,[Sarakeryhma32_opmopa]
      --,[Sarakeryhma32_opmast]
      --,[Sarakeryhma32_opm95opa]
      --,[Sarakeryhma32_koulutussektori]
      --,[Sarakeryhma32_suorv]
      --,[Sarakeryhma32_suorlk]
      --,[Sarakeryhma32_kmaak]
      --,[Sarakeryhma32_olotamm]
      --,[Sarakeryhma32_olosyys]
      --,[Sarakeryhma32_ptoim1r5]
      --,[Sarakeryhma32_amas]
      --,[Sarakeryhma32_koulk]
      --,[Sarakeryhma33_ID]
      --,[Sarakeryhma33_opp]
      --,[Sarakeryhma33_opmala]
      --,[Sarakeryhma33_opmopa]
      --,[Sarakeryhma33_opmast]
      --,[Sarakeryhma33_opm95opa]
      --,[Sarakeryhma33_koulutussektori]
      --,[Sarakeryhma33_suorv]
      --,[Sarakeryhma33_suorlk]
      --,[Sarakeryhma33_kmaak]
      --,[Sarakeryhma33_olotamm]
      --,[Sarakeryhma33_olosyys]
      --,[Sarakeryhma33_ptoim1r5]
      --,[Sarakeryhma33_amas]
      --,[Sarakeryhma33_koulk]
      --,[Sarakeryhma34_ID]
      --,[Sarakeryhma34_opp]
      --,[Sarakeryhma34_opmala]
      --,[Sarakeryhma34_opmopa]
      --,[Sarakeryhma34_opmast]
      --,[Sarakeryhma34_opm95opa]
      --,[Sarakeryhma34_koulutussektori]
      --,[Sarakeryhma34_suorv]
      --,[Sarakeryhma34_suorlk]
      --,[Sarakeryhma34_kmaak]
      --,[Sarakeryhma34_olotamm]
      --,[Sarakeryhma34_olosyys]
      --,[Sarakeryhma34_ptoim1r5]
      --,[Sarakeryhma34_amas]
      --,[Sarakeryhma34_koulk]
      --,[Sarakeryhma35_ID]
      --,[Sarakeryhma35_opp]
      --,[Sarakeryhma35_opmala]
      --,[Sarakeryhma35_opmopa]
      --,[Sarakeryhma35_opmast]
      --,[Sarakeryhma35_opm95opa]
      --,[Sarakeryhma35_koulutussektori]
      --,[Sarakeryhma35_suorv]
      --,[Sarakeryhma35_suorlk]
      --,[Sarakeryhma35_kmaak]
      --,[Sarakeryhma35_olotamm]
      --,[Sarakeryhma35_olosyys]
      --,[Sarakeryhma35_ptoim1r5]
      --,[Sarakeryhma35_amas]
      --,[Sarakeryhma35_koulk]
      --,[Sarakeryhma36_ID]
      --,[Sarakeryhma36_opp]
      --,[Sarakeryhma36_opmala]
      --,[Sarakeryhma36_opmopa]
      --,[Sarakeryhma36_opmast]
      --,[Sarakeryhma36_opm95opa]
      --,[Sarakeryhma36_koulutussektori]
      --,[Sarakeryhma36_suorv]
      --,[Sarakeryhma36_suorlk]
      --,[Sarakeryhma36_kmaak]
      --,[Sarakeryhma36_olotamm]
      --,[Sarakeryhma36_olosyys]
      --,[Sarakeryhma36_ptoim1r5]
      --,[Sarakeryhma36_amas]
      --,[Sarakeryhma36_koulk]
      --,[Sarakeryhma37_ID]
      --,[Sarakeryhma37_opp]
      --,[Sarakeryhma37_opmala]
      --,[Sarakeryhma37_opmopa]
      --,[Sarakeryhma37_opmast]
      --,[Sarakeryhma37_opm95opa]
      --,[Sarakeryhma37_koulutussektori]
      --,[Sarakeryhma37_suorv]
      --,[Sarakeryhma37_suorlk]
      --,[Sarakeryhma37_kmaak]
      --,[Sarakeryhma37_olotamm]
      --,[Sarakeryhma37_olosyys]
      --,[Sarakeryhma37_ptoim1r5]
      --,[Sarakeryhma37_amas]
      --,[Sarakeryhma37_koulk]
      --,[Sarakeryhma38_ID]
      --,[Sarakeryhma38_opp]
      --,[Sarakeryhma38_opmala]
      --,[Sarakeryhma38_opmopa]
      --,[Sarakeryhma38_opmast]
      --,[Sarakeryhma38_opm95opa]
      --,[Sarakeryhma38_koulutussektori]
      --,[Sarakeryhma38_suorv]
      --,[Sarakeryhma38_suorlk]
      --,[Sarakeryhma38_kmaak]
      --,[Sarakeryhma38_olotamm]
      --,[Sarakeryhma38_olosyys]
      --,[Sarakeryhma38_ptoim1r5]
      --,[Sarakeryhma38_amas]
      --,[Sarakeryhma38_koulk]
      --,[Sarakeryhma39_ID]
      --,[Sarakeryhma39_opp]
      --,[Sarakeryhma39_opmala]
      --,[Sarakeryhma39_opmopa]
      --,[Sarakeryhma39_opmast]
      --,[Sarakeryhma39_opm95opa]
      --,[Sarakeryhma39_koulutussektori]
      --,[Sarakeryhma39_suorv]
      --,[Sarakeryhma39_suorlk]
      --,[Sarakeryhma39_kmaak]
      --,[Sarakeryhma39_olotamm]
      --,[Sarakeryhma39_olosyys]
      --,[Sarakeryhma39_ptoim1r5]
      --,[Sarakeryhma39_amas]
      --,[Sarakeryhma39_koulk]
      --,[Sarakeryhma40_ID]
      --,[Sarakeryhma40_opp]
      --,[Sarakeryhma40_opmala]
      --,[Sarakeryhma40_opmopa]
      --,[Sarakeryhma40_opmast]
      --,[Sarakeryhma40_opm95opa]
      --,[Sarakeryhma40_koulutussektori]
      --,[Sarakeryhma40_suorv]
      --,[Sarakeryhma40_suorlk]
      --,[Sarakeryhma40_kmaak]
      --,[Sarakeryhma40_olotamm]
      --,[Sarakeryhma40_olosyys]
      --,[Sarakeryhma40_ptoim1r5]
      --,[Sarakeryhma40_amas]
      --,[Sarakeryhma40_koulk]
      --,[Sarakeryhma41_ID]
      --,[Sarakeryhma41_opp]
      --,[Sarakeryhma41_opmala]
      --,[Sarakeryhma41_opmopa]
      --,[Sarakeryhma41_opmast]
      --,[Sarakeryhma41_opm95opa]
      --,[Sarakeryhma41_koulutussektori]
      --,[Sarakeryhma41_suorv]
      --,[Sarakeryhma41_suorlk]
      --,[Sarakeryhma41_kmaak]
      --,[Sarakeryhma41_olotamm]
      --,[Sarakeryhma41_olosyys]
      --,[Sarakeryhma41_ptoim1r5]
      --,[Sarakeryhma41_amas]
      --,[Sarakeryhma41_koulk]
      --,[Sarakeryhma42_ID]
      --,[Sarakeryhma42_opp]
      --,[Sarakeryhma42_opmala]
      --,[Sarakeryhma42_opmopa]
      --,[Sarakeryhma42_opmast]
      --,[Sarakeryhma42_opm95opa]
      --,[Sarakeryhma42_koulutussektori]
      --,[Sarakeryhma42_suorv]
      --,[Sarakeryhma42_suorlk]
      --,[Sarakeryhma42_kmaak]
      --,[Sarakeryhma42_olotamm]
      --,[Sarakeryhma42_olosyys]
      --,[Sarakeryhma42_ptoim1r5]
      --,[Sarakeryhma42_amas]
      --,[Sarakeryhma42_koulk]
      --,[Sarakeryhma43_ID]
      --,[Sarakeryhma43_opp]
      --,[Sarakeryhma43_opmala]
      --,[Sarakeryhma43_opmopa]
      --,[Sarakeryhma43_opmast]
      --,[Sarakeryhma43_opm95opa]
      --,[Sarakeryhma43_koulutussektori]
      --,[Sarakeryhma43_suorv]
      --,[Sarakeryhma43_suorlk]
      --,[Sarakeryhma43_kmaak]
      --,[Sarakeryhma43_olotamm]
      --,[Sarakeryhma43_olosyys]
      --,[Sarakeryhma43_ptoim1r5]
      --,[Sarakeryhma43_amas]
      --,[Sarakeryhma43_koulk]
      --,[Sarakeryhma44_ID]
      --,[Sarakeryhma44_opp]
      --,[Sarakeryhma44_opmala]
      --,[Sarakeryhma44_opmopa]
      --,[Sarakeryhma44_opmast]
      --,[Sarakeryhma44_opm95opa]
      --,[Sarakeryhma44_koulutussektori]
      --,[Sarakeryhma44_suorv]
      --,[Sarakeryhma44_suorlk]
      --,[Sarakeryhma44_kmaak]
      --,[Sarakeryhma44_olotamm]
      --,[Sarakeryhma44_olosyys]
      --,[Sarakeryhma44_ptoim1r5]
      --,[Sarakeryhma44_amas]
      --,[Sarakeryhma44_koulk]
      --,[Sarakeryhma45_ID]
      --,[Sarakeryhma45_opp]
      --,[Sarakeryhma45_opmala]
      --,[Sarakeryhma45_opmopa]
      --,[Sarakeryhma45_opmast]
      --,[Sarakeryhma45_opm95opa]
      --,[Sarakeryhma45_koulutussektori]
      --,[Sarakeryhma45_suorv]
      --,[Sarakeryhma45_suorlk]
      --,[Sarakeryhma45_kmaak]
      --,[Sarakeryhma45_olotamm]
      --,[Sarakeryhma45_olosyys]
      --,[Sarakeryhma45_ptoim1r5]
      --,[Sarakeryhma45_amas]
      --,[Sarakeryhma45_koulk]
      --,[Sarakeryhma46_ID]
      --,[Sarakeryhma46_opp]
      --,[Sarakeryhma46_opmala]
      --,[Sarakeryhma46_opmopa]
      --,[Sarakeryhma46_opmast]
      --,[Sarakeryhma46_opm95opa]
      --,[Sarakeryhma46_koulutussektori]
      --,[Sarakeryhma46_suorv]
      --,[Sarakeryhma46_suorlk]
      --,[Sarakeryhma46_kmaak]
      --,[Sarakeryhma46_olotamm]
      --,[Sarakeryhma46_olosyys]
      --,[Sarakeryhma46_ptoim1r5]
      --,[Sarakeryhma46_amas]
      --,[Sarakeryhma46_koulk]
      --,[Sarakeryhma47_ID]
      --,[Sarakeryhma47_opp]
      --,[Sarakeryhma47_opmala]
      --,[Sarakeryhma47_opmopa]
      --,[Sarakeryhma47_opmast]
      --,[Sarakeryhma47_opm95opa]
      --,[Sarakeryhma47_koulutussektori]
      --,[Sarakeryhma47_suorv]
      --,[Sarakeryhma47_suorlk]
      --,[Sarakeryhma47_kmaak]
      --,[Sarakeryhma47_olotamm]
      --,[Sarakeryhma47_olosyys]
      --,[Sarakeryhma47_ptoim1r5]
      --,[Sarakeryhma47_amas]
      --,[Sarakeryhma47_koulk]
      --,[Sarakeryhma48_ID]
      --,[Sarakeryhma48_opp]
      --,[Sarakeryhma48_opmala]
      --,[Sarakeryhma48_opmopa]
      --,[Sarakeryhma48_opmast]
      --,[Sarakeryhma48_opm95opa]
      --,[Sarakeryhma48_koulutussektori]
      --,[Sarakeryhma48_suorv]
      --,[Sarakeryhma48_suorlk]
      --,[Sarakeryhma48_kmaak]
      --,[Sarakeryhma48_olotamm]
      --,[Sarakeryhma48_olosyys]
      --,[Sarakeryhma48_ptoim1r5]
      --,[Sarakeryhma48_amas]
      --,[Sarakeryhma48_koulk]
      --,[Sarakeryhma49_ID]
      --,[Sarakeryhma49_opp]
      --,[Sarakeryhma49_opmala]
      --,[Sarakeryhma49_opmopa]
      --,[Sarakeryhma49_opmast]
      --,[Sarakeryhma49_opm95opa]
      --,[Sarakeryhma49_koulutussektori]
      --,[Sarakeryhma49_suorv]
      --,[Sarakeryhma49_suorlk]
      --,[Sarakeryhma49_kmaak]
      --,[Sarakeryhma49_olotamm]
      --,[Sarakeryhma49_olosyys]
      --,[Sarakeryhma49_ptoim1r5]
      --,[Sarakeryhma49_amas]
      --,[Sarakeryhma49_koulk]
      --,[Sarakeryhma50_ID]
      --,[Sarakeryhma50_opp]
      --,[Sarakeryhma50_opmala]
      --,[Sarakeryhma50_opmopa]
      --,[Sarakeryhma50_opmast]
      --,[Sarakeryhma50_opm95opa]
      --,[Sarakeryhma50_koulutussektori]
      --,[Sarakeryhma50_suorv]
      --,[Sarakeryhma50_suorlk]
      --,[Sarakeryhma50_kmaak]
      --,[Sarakeryhma50_olotamm]
      --,[Sarakeryhma50_olosyys]
      --,[Sarakeryhma50_ptoim1r5]
      --,[Sarakeryhma50_amas]
      --,[Sarakeryhma50_koulk]
 --lasketut sarakkeet      
      ,[1a Aloittaneiden opintojen kulku koulutuslajin mukaan prioriteettina mikä tahansa tutkinto]
      ,[1a_jarjestys]
      ,[1b Aloittaneiden opintojen kulku koulutuslajin mukaan prioriteettina tutkinto ja opiskelu alkuperäisessä tutkintolajissa]
      ,[1b_jarjestys]
      ,[1c Aloittaneista tutkinnon suorittaneet koulutuslajin mukaan]
      ,[1c_jarjestys]
      ,[1d Aloittaneista ilman tutkintoa opiskelua jatkavat koulutuslajin mukaan]
      ,[1d_jarjestys]
      ,[1e Aloittaneista alkuperäisen koulutuslajin tutkinnon suorittaneet koulutuslajin mukaan]
      ,[1e_jarjestys]
      ,[1f Aloittaneista muun kuin alkuperäisen tutkintolajin tutkinnon suorittaneet koulutuslajin mukaan]
      ,[1f_jarjestys]
      ,[1g Aloittaneista alkuperäisen tutkintolajin opiskelua jatkavat koulutuslajin mukaan]
      ,[1g_jarjestys]
      ,[1h Aloittaneista muun tutkintolajin opiskelua jatkavat koulutuslajin mukaan]
      ,[1h_jarjestys]
      ,[2a Aloittaneiden opintojen kulku koulutusalan (2002) mukaan prioriteettina mikä tahansa tutkinto]
      ,[2a_jarjestys]
      ,[2b Aloittaneiden opintojen kulku koulutusalan (2002) mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä]
      ,[2b_jarjestys]
      ,[2e Aloittaneista alkuperäisen koulutusalan (2002) tutkinnon suorittaneet koulutusalan mukaan]
      ,[2e_jarjestys]
      ,[2f Aloittaneista muun kuin alkuperäisen tutkintolajin tutkinnon suorittaneet koulutuslajin mukaan]
      ,[2f_jarjestys]
      ,[2g Aloittaneista alkuperäisellä koulutusalalla opiskelua jatkavat koulutusalan mukaan]
      ,[2g_jarjestys]
      ,[2h Aloittaneista muulla koulutusalalla opiskelua jatkavat koulutusalan mukaan]
      ,[2h_jarjestys]
      ,[3a Aloittaneiden opintojen kulku opintoalan (2002) mukaan prioriteettina mikä tahansa tutkinto]
      ,[3a_jarjestys]
      ,[3b Aloittaneiden opintojen kulku opintoalan (2002) mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä]
      ,[3b_jarjestys]
      ,[3e Aloittaneista alkuperäisen opintoalan (2002) tutkinnon suorittaneet opintoalan mukaan]
      ,[3e_jarjestys]
      ,[3f Aloittaneista muun opintoalan (2002) tutkinnon suorittaneet opintoalan mukaan]
      ,[3f_jarjestys]
      ,[3g Aloittaneista alkuperäisellä opintoalalla (2002) opiskelua jatkavat opintoalan mukaan]
      ,[3g_jarjestys]
      ,[3h Aloittaneista muulla opintoalalla (2002) opiskelua jatkavat opintoalan mukaan]
      ,[3h_jarjestys]
      ,[4a Aloittaneiden opintojen kulku koulutuksen järjestäjän mukaan, toinen aste prioriteettina tutkinto missä tahansa]
      ,[4a_jarjestys]
      ,[4b Aloittaneiden opintojen kulku koulutuksen järjestäjän mukaan, toinen aste prioriteettina tutkinto ja opiskelu alkuperäisellä]
      ,[4b_jarjestys]
      ,[4e Aloittaneista alkuperäisen koulutuksen järjestäjän tutkinnon suorittaneet järjestäjän mukaan]
      ,[4e_jarjestys]
      ,[4f Aloittaneista muun koulutuksen järjestäjän tutkinnon suorittaneet järjestäjän mukaan]
      ,[4f_jarjestys]
      ,[4g Aloittaneista alkuperäisellä järjestäjällä opiskelua jatkavat järjestäjän mukaan]
      ,[4g_jarjestys]
      ,[4h Aloittaneista muulla järjestäjällä opiskelua jatkavat järjestäjän mukaan]
      ,[4h_jarjestys]
      ,[5a Aloittaneiden opintojen kulku oppilaitoksen mukaan prioriteettina tutkinto missä tahansa]
      ,[5a_jarjestys]
      ,[5b Aloittaneiden opintojen kulku oppilaitoksen mukaan prioriteettina tutkinto ja opiskelu alkuperäisessä]
      ,[5b_jarjestys]
      ,[5e Aloittaneista alkuperäisessä oppilaitoksessa tutkinnon suorittaneet oppilaitoksen mukaan]
      ,[5e_jarjestys]
      ,[5f Aloittaneista muussa oppilaitoksessa tutkinnon suorittaneet oppilaitoksen mukaan]
      ,[5f_jarjestys]
      ,[5g Aloittaneista alkuperäisessä oppilaitoksessa opiskelua jatkavat oppilaitoksen mukaan]
      ,[5g_jarjestys]
      ,[5h Aloittaneista muussa oppilaitoksessa opiskelua jatkavat oppilaitoksen mukaan]
      ,[5h_jarjestys]
      ,[6a Aloittaneiden opintojen kulku maakunnan mukaan prioriteettina tutkinto missä tahansa]
      ,[6a_jarjestys]
      ,[6b Aloittaneiden opintojen kulku maakunnan mukaan prioriteettina tutkinto ja opiskelu alkuperäisessä]
      ,[6b_jarjestys]
      ,[6e Aloittaneista alkuperäisessä maakunnassa tutkinnon suorittaneet maakunnan mukaan]
      ,[6e_jarjestys]
      ,[6f Aloittaneista muussa maakunnassa tutkinnon suorittaneet maakunnan mukaan]
      ,[6f_jarjestys]
      ,[6g Aloittaneista alkuperäisessä maakunnassa opiskelua jatkavat maakunnan mukaan]
      ,[6g_jarjestys]
      ,[6h Aloittaneista muussa maakunnassa opiskelua jatkavat maakunnan mukaan]
      ,[6h_jarjestys]
      ,[7a Aloittaneiden opintojen kulku koulutussektorin mukaan prioriteettina tutkinto missä tahansa]
      ,[7a_jarjestys]
      ,[7b Aloittaneiden opintojen kulku koulutussektorin mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä]
      ,[7b_jarjestys]
      ,[7e Aloittaneista alkuperäisen koulutussektorin tutkinnon suorittaneet koulutussektorin mukaan]
      ,[7e_jarjestys]
      ,[7f Aloittaneista muun koulutussektorin tutkinnon suorittaneet koulutussektorin mukaan]
      ,[7f_jarjestys]
      ,[7g Aloittaneista alkuperäisellä koulutussektorilla opiskelua jatkavat koulutussektorin mukaan]
      ,[7g_jarjestys]
      ,[7h Aloittaneista muulla koulutussektorilla opiskelua jatkavat koulutussektorin mukaan]
      ,[7h_jarjestys]
      ,[8a Aloittaneiden opintojen kulku opintoalan (1995) mukaan prioriteettina mikä tahansa tutkinto]
      ,[8a_jarjestys]
      ,[8b Aloittaneiden opintojen kulku opintoalan (1995) mukaan prioriteettina tutkinto ja opiskelu alkuperäisellä]
      ,[8b_jarjestys]
      ,[8e Aloittaneista alkuperäisen opintoalan (1995) tutkinnon suorittaneet opintoalan mukaan]
      ,[8e_jarjestys]
      ,[8f Aloittaneista muun opintoalan (1995) tutkinnon suorittaneet opintoalan mukaan]
      ,[8f_jarjestys]
      ,[8g Aloittaneista alkuperäisellä opintoalalla (1995) opiskelua jatkavat opintoalan mukaan]
      ,[8g_jarjestys]
      ,[8h Aloittaneista muulla opintoalalla (1995) opiskelua jatkavat opintoalan mukaan]
      ,[8h_jarjestys]
  FROM [_aloittaneiden_lapaisy_tiivistetty] tiiv
--LEFT 
JOIN _v_aloittaneiden_lapaisy_lasketut_sarakkeet_dimensioarvot lask
	ON tiiv.rivinumero = lask.rivinumero
' 
GO
/****** Object:  View [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot] AS
--
--Select * into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot

--Delete from VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot 
--Insert into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot Select * from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot 


SELECT [tilastovuosi]
      ,[tilv_date]
      ,f.[oppilaitos_avain]
      ,[oppilaitos_id] = ISNULL(d_ol.id, -2)
      --,[oppilaitos_sijaintikunta_avain] = ISNULL(d_ol.sijaintikuntakoodi, ''-1'')
      --,[oppilaitos_sijaintikunta_id] = ISNULL(d_ol_al.id, -1)
      ,f.[tieteenala_avain]
      ,[tieteenala_id] = ISNULL(d_ta.id, -2)
      ,[virkaryhma_avain]
      ,[virkaryhma_id] = ISNULL(d_vr.id, -2)
      ,f.[ika_avain]
      ,[ika_id] = ISNULL(d_ika.id, -2)
      ,[sukupuoli_avain]
      ,[sukupuoli_id] = ISNULL(d_sp.id, -1)
      ,[tutkintotaso_avain]
      ,[tutkintotaso_id] = ISNULL(d_tt.id, -2)
      ,[lkm_tutkimushenkilokunta]
      ,f.[tietolahde]
      ,[rivinumero]
  FROM [dbo].[f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain] f
LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
LEFT JOIN VipunenTK.dbo.d_ika 
	ON d_ika.ika_avain = f.ika_avain
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = f.oppilaitos_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
--	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_tieteenala d_ta
	ON d_ta.tieteenala_avain = f.tieteenala_avain
LEFT JOIN VipunenTK.dbo.d_virkaryhma d_vr
	ON d_vr.virkaryhma_koodi = f.virkaryhma_avain
LEFT JOIN VipunenTK.dbo.d_tutkintotaso d_tt
	ON d_tt.tutkintotaso_koodi = f.tutkintotaso_avain


' 
GO
/****** Object:  View [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet] AS
--
--Select * into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet

--Delete from VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet 
--Insert into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet Select * from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet 


SELECT [tilastovuosi]
      ,[tilv_date]
      ,f.[oppilaitos_avain]
      ,[oppilaitos_id] = ISNULL(d_ol.id, -2)
      --,[oppilaitos_sijaintikunta_avain] = ISNULL(d_ol.sijaintikuntakoodi, ''-1'')
      --,[oppilaitos_sijaintikunta_id] = ISNULL(d_ol_al.id, -1)
      ,f.[tieteenala_avain]
      ,[tieteenala_id] = ISNULL(d_ta.id, -2)
      ,[virkaryhma_avain]
      ,[virkaryhma_id] = ISNULL(d_vr.id, -2)
      ,f.[ika_avain]
      ,[ika_id] = ISNULL(d_ika.id, -2)
      ,[sukupuoli_avain]
      ,[sukupuoli_id] = ISNULL(d_sp.id, -1)
      ,[tutkintotaso_avain]
      ,[tutkintotaso_id] = ISNULL(d_tt.id, -2)
      ,[lkm_tutkimustyovuodet]
      ,f.[tietolahde]
      ,[rivinumero]
  FROM [dbo].[f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain] f
LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
LEFT JOIN VipunenTK.dbo.d_ika 
	ON d_ika.ika_avain = f.ika_avain
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = f.oppilaitos_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
--	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_tieteenala d_ta
	ON d_ta.tieteenala_avain = f.tieteenala_avain
LEFT JOIN VipunenTK.dbo.d_virkaryhma d_vr
	ON d_vr.virkaryhma_koodi = f.virkaryhma_avain
LEFT JOIN VipunenTK.dbo.d_tutkintotaso d_tt
	ON d_tt.tutkintotaso_koodi = f.tutkintotaso_avain


' 
GO
/****** Object:  View [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet] AS

--Select * into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet

--Delete from VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet
--Insert into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet Select * from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot_5_2_tyovuodet

SELECT [tilastovuosi]
      ,[tilv_date]
      ,[oppilaitos_avain]
      ,[oppilaitos_id]
      --,[oppilaitos_sijaintikunta_avain]
      --,[oppilaitos_sijaintikunta_id]
      ,[tieteenala_avain]
      ,[tieteenala_id]
      ,[virkaryhma_avain]
      ,[virkaryhma_id]
      ,[ika_avain]
      ,[ika_id]
      ,[sukupuoli_avain]
      ,[sukupuoli_id]
      ,[tutkintotaso_avain]
      ,[tutkintotaso_id]
      ,[lkm_tutkimushenkilokunta]
      ,[lkm_tutkimustyovuodet] = Cast(NULL as decimal(8,4))
      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_1_henkilot]

UNION ALL

SELECT [tilastovuosi]
      ,[tilv_date]
      ,[oppilaitos_avain]
      ,[oppilaitos_id]
      --,[oppilaitos_sijaintikunta_avain]
      --,[oppilaitos_sijaintikunta_id]
      ,[tieteenala_avain]
      ,[tieteenala_id]
      ,[virkaryhma_avain]
      ,[virkaryhma_id]
      ,[ika_avain]
      ,[ika_id]
      ,[sukupuoli_avain]
      ,[sukupuoli_id]
      ,[tutkintotaso_avain]
      ,[tutkintotaso_id]
      ,[lkm_tutkimushenkilokunta] = Cast(NULL as int)
      ,[lkm_tutkimustyovuodet]
      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_2_tyovuodet]
' 
GO
/****** Object:  View [dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] AS

-- CSC Jarmo 24.9.2013
-- 24.2.2014 Jarmo. Lisätty oppilaitos_avain-kenttä ja sen vaatima käsittely.

-- Palautetaan dimension nykytila
-- HUOM [VipunenTK].[dbo].[d_oppilaitoksen_taustatiedot_historia] pitää olla olemassa
-- Näkymän avaimena on oppilaitoskoodi
-- Kenttien id, alkaa ja paattyy tietoja ei enää tarvita hauissa
--
-- Select * from VipunenTK..[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu]

SELECT [id]
	  ,d.[oppilaitos_avain]
      ,d.[oppilaitoskoodi]
      ,nullif([oppilaitoksen_korvaavakoodi],'''') as oppilaitoksen_korvaavakoodi
      --,[alkaa]
      --,[paattyy]
      ,[oppilaitos]
      ,[oppilaitos_SV]
      ,[oppilaitos_EN]
      ,[sairaalakoulukoodi]
      ,[sairaalakoulu]
      ,[sairaalakoulu_SV]
      ,[sairaalakoulu_EN]
      ,[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi]
      ,[oppilaitostyyppi_SV]
      ,[oppilaitostyyppi_EN]
      ,[peruskoulujen_ryhmityskoodi]
      ,[peruskoulujen_ryhmitys]
      ,[peruskoulujen_ryhmitys_SV]
      ,[peruskoulujen_ryhmitys_EN]
      ,[peruskoulujen_vuosilkskoodi]
      ,[peruskoulujen_vuosilks]
      ,[peruskoulujen_vuosilks_SV]
      ,[peruskoulujen_vuosilks_EN]
      ,[oppilaitoksen_omistajatyyppikoodi]
      ,[oppilaitoksen_omistajatyyppi]
      ,[oppilaitoksen_omistajatyyppi_SV]
      ,[oppilaitoksen_omistajatyyppi_EN]
      ,[opetuskielikoodi]
      ,[opetuskieli]
      ,[opetuskieli_SV]
      ,[opetuskieli_EN]
      ,[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta]
      ,[oppilaitoksen_sijaintikunta_SV]
      ,[oppilaitoksen_sijaintikunta_EN]
      ,[koordinaatti_itakoodi]
      ,[koordinaatti_pohjoiskoodi]
      ,[postinumerokoodi]
      ,[jarjestys_oppilaitos]
      ,[jarjestys_sairaalakoulu]
      ,[jarjestys_oppilaitostyyppi]
      ,[jarjestys_peruskoulujen_ryhmitys]
      ,[jarjestys_peruskoulujen_vuosilks]
      ,[jarjestys_omistajatyyppi]
      ,[jarjestys_opetuskieli]
      ,[jarjestys_koulutuksen_jarjestaja]
      ,[jarjestys_sijaintikunta]
      ,[jarjestys_koordinaatti_ita]
      ,[jarjestys_koordinaatti_pohjois]
      ,[jarjestys_postinumero]
      ,[tietolahde_oppilaitos]
      ,[koulutuksen_jarjestajakoodi]
      ,[koulutuksen_jarjestajan_korvaavakoodi]
      ,[koulutuksen_jarjestaja]
      ,[koulutuksen_jarjestaja_SV]
      ,[koulutuksen_jarjestaja_EN]
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi]
      ,[koulutuksen_jarjestajan_omistajatyyppi]
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV]
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN]
      ,[koulutuksen_jarjestajan_kielikoodi]
      ,[koulutuksen_jarjestajan_kieli]
      ,[koulutuksen_jarjestajan_kieli_SV]
      ,[koulutuksen_jarjestajan_kieli_EN]
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi]
      ,[koulutuksen_jarjestajan_sijaintikunta]
      ,[koulutuksen_jarjestajan_sijaintikunta_SV]
      ,[koulutuksen_jarjestajan_sijaintikunta_EN]
      ,[jarjestys_koulutuksenjarjestaja]
      ,[jarjestys_koulutuksen_jarjestajan_kieli]
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja]
      ,[tietolahde_koulutuksenjarjestaja]
      ,koulutuksen_jarjestajan_ainoa_oppilaitos
FROM [VipunenTK].[dbo].[d_oppilaitoksen_taustatiedot_historia] d
JOIN ( Select 
			oppilaitos_avain
			,viimeinen_paattyy = max(paattyy)
		 from [VipunenTK].[dbo].[d_oppilaitoksen_taustatiedot_historia] 
		 group by oppilaitos_avain
	 ) d_paattyy
	ON d_paattyy.oppilaitos_avain = d.oppilaitos_avain
WHERE d.paattyy = d_paattyy.viimeinen_paattyy

' 
GO
/****** Object:  View [dbo].[v_oppilaitoksen_taustatiedot_nykytila]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitoksen_taustatiedot_nykytila]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_oppilaitoksen_taustatiedot_nykytila] AS
/*
-- HUOM [VipunenTK].[dbo].[d_oppilaitoksen_taustatiedot_historia] pitää olla olemassa
Drop table VipunenTK.dbo.d_oppilaitoksen_taustatiedot
Select * into VipunenTK.dbo.d_oppilaitoksen_taustatiedot from VipunenTK_DW.dbo.v_oppilaitoksen_taustatiedot_nykytila
Truncate table VipunenTK.dbo.d_oppilaitoksen_taustatiedot
Insert into VipunenTK.dbo.d_oppilaitoksen_taustatiedot
  Select * from VipunenTK_DW.dbo.v_oppilaitoksen_taustatiedot_nykytila
*/

SELECT 
 ol.id
,[oppilaitos_avain] = ol.oppilaitos_avain
,[oppilaitoskoodi] = ol.[oppilaitoskoodi]
--,oppilaitoskoodi1 = ol_uusi.oppilaitoskoodi
--,oppilaitoskoodi2 = ol_uusi_2.oppilaitoskoodi
--,oppilaitoskoodi3 = ol_uusi_3.oppilaitoskoodi
--,oppilaitoskoodi4 = ol_uusi_4.oppilaitoskoodi
--,oppilaitoskoodi5 = ol_uusi_5.oppilaitoskoodi
--,oppilaitoskoodi6 = ol_uusi_6.oppilaitoskoodi

--,[oppilaitoksen_korvaavakoodi] = ol_uusi_6.oppilaitoksen_korvaavakoodi --Muutettu 21.3.2014 / CSC Jarmo
,[oppilaitoksen_korvaavakoodi] = Case when ol_uusi_6.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_6.oppilaitoksen_korvaavakoodi when ol_uusi_5.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_5.oppilaitoksen_korvaavakoodi when ol_uusi_4.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_4.oppilaitoksen_korvaavakoodi when ol_uusi_3.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_3.oppilaitoksen_korvaavakoodi when ol_uusi_2.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_2.oppilaitoksen_korvaavakoodi when ol_uusi.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi.oppilaitoksen_korvaavakoodi else nullif(ol.oppilaitoksen_korvaavakoodi,'''') end --else muutettu nullista ol.oppilaitoksen_korvaavakoodi, Anssi 8.11.2016
,[oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitos] else ol.[oppilaitos] end
,[oppilaitos_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitos_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitos_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitos_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitos_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitos_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitos_SV] else ol.[oppilaitos_SV] end
,[oppilaitos_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitos_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitos_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitos_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitos_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitos_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitos_EN] else ol.[oppilaitos_EN] end
,[sairaalakoulukoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulukoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulukoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulukoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulukoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulukoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulukoodi] else ol.[sairaalakoulukoodi] end
,[sairaalakoulu] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulu] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulu] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulu] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulu] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulu] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulu] else ol.[sairaalakoulu] end
,[sairaalakoulu_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulu_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulu_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulu_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulu_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulu_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulu_SV] else ol.[sairaalakoulu_SV] end
,[sairaalakoulu_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulu_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulu_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulu_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulu_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulu_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulu_EN] else ol.[sairaalakoulu_EN] end
,[oppilaitostyyppikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppikoodi] else ol.[oppilaitostyyppikoodi] end
,[oppilaitostyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppi] else ol.[oppilaitostyyppi] end
,[oppilaitostyyppi_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppi_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppi_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppi_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppi_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppi_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppi_SV] else ol.[oppilaitostyyppi_SV] end
,[oppilaitostyyppi_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppi_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppi_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppi_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppi_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppi_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppi_EN] else ol.[oppilaitostyyppi_EN] end
,[peruskoulujen_ryhmityskoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmityskoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmityskoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmityskoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmityskoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmityskoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmityskoodi] else ol.[peruskoulujen_ryhmityskoodi] end
,[peruskoulujen_ryhmitys] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmitys] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmitys] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmitys] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmitys] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmitys] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmitys] else ol.[peruskoulujen_ryhmitys] end
,[peruskoulujen_ryhmitys_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmitys_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmitys_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmitys_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmitys_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmitys_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmitys_SV] else ol.[peruskoulujen_ryhmitys_SV] end
,[peruskoulujen_ryhmitys_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmitys_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmitys_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmitys_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmitys_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmitys_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmitys_EN] else ol.[peruskoulujen_ryhmitys_EN] end
,[peruskoulujen_vuosilkskoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilkskoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilkskoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilkskoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilkskoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilkskoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilkskoodi] else ol.[peruskoulujen_vuosilkskoodi] end
,[peruskoulujen_vuosilks] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilks] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilks] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilks] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilks] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilks] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilks] else ol.[peruskoulujen_vuosilks] end
,[peruskoulujen_vuosilks_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilks_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilks_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilks_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilks_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilks_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilks_SV] else ol.[peruskoulujen_vuosilks_SV] end
,[peruskoulujen_vuosilks_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilks_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilks_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilks_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilks_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilks_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilks_EN] else ol.[peruskoulujen_vuosilks_EN] end
,[oppilaitoksen_omistajatyyppikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppikoodi] else ol.[oppilaitoksen_omistajatyyppikoodi] end
,[oppilaitoksen_omistajatyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppi] else ol.[oppilaitoksen_omistajatyyppi] end
,[oppilaitoksen_omistajatyyppi_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppi_SV] else ol.[oppilaitoksen_omistajatyyppi_SV] end
,[oppilaitoksen_omistajatyyppi_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppi_EN] else ol.[oppilaitoksen_omistajatyyppi_EN] end
,[opetuskielikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskielikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskielikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskielikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskielikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskielikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskielikoodi] else ol.[opetuskielikoodi] end
,[opetuskieli] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskieli] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskieli] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskieli] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskieli] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskieli] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskieli] else ol.[opetuskieli] end
,[opetuskieli_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskieli_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskieli_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskieli_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskieli_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskieli_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskieli_SV] else ol.[opetuskieli_SV] end
,[opetuskieli_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskieli_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskieli_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskieli_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskieli_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskieli_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskieli_EN] else ol.[opetuskieli_EN] end
,[sijaintikuntakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sijaintikuntakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sijaintikuntakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sijaintikuntakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sijaintikuntakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sijaintikuntakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sijaintikuntakoodi] else ol.[sijaintikuntakoodi] end
,[oppilaitoksen_sijaintikunta] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_sijaintikunta] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_sijaintikunta] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_sijaintikunta] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_sijaintikunta] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_sijaintikunta] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_sijaintikunta] else ol.[oppilaitoksen_sijaintikunta] end
,[oppilaitoksen_sijaintikunta_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_sijaintikunta_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_sijaintikunta_SV] else ol.[oppilaitoksen_sijaintikunta_SV] end
,[oppilaitoksen_sijaintikunta_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_sijaintikunta_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_sijaintikunta_EN] else ol.[oppilaitoksen_sijaintikunta_EN] end
,[koordinaatti_itakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koordinaatti_itakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koordinaatti_itakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koordinaatti_itakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koordinaatti_itakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koordinaatti_itakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koordinaatti_itakoodi] else ol.[koordinaatti_itakoodi] end
,[koordinaatti_pohjoiskoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koordinaatti_pohjoiskoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koordinaatti_pohjoiskoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koordinaatti_pohjoiskoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koordinaatti_pohjoiskoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koordinaatti_pohjoiskoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koordinaatti_pohjoiskoodi] else ol.[koordinaatti_pohjoiskoodi] end
,[postinumerokoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[postinumerokoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[postinumerokoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[postinumerokoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[postinumerokoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[postinumerokoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[postinumerokoodi] else ol.[postinumerokoodi] end
,[jarjestys_oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_oppilaitos] else ol.[jarjestys_oppilaitos] end
,[jarjestys_sairaalakoulu] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_sairaalakoulu] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_sairaalakoulu] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_sairaalakoulu] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_sairaalakoulu] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_sairaalakoulu] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_sairaalakoulu] else ol.[jarjestys_sairaalakoulu] end
,[jarjestys_oppilaitostyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_oppilaitostyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_oppilaitostyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_oppilaitostyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_oppilaitostyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_oppilaitostyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_oppilaitostyyppi] else ol.[jarjestys_oppilaitostyyppi] end
,[jarjestys_peruskoulujen_ryhmitys] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_peruskoulujen_ryhmitys] else ol.[jarjestys_peruskoulujen_ryhmitys] end
,[jarjestys_peruskoulujen_vuosilks] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_peruskoulujen_vuosilks] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_peruskoulujen_vuosilks] else ol.[jarjestys_peruskoulujen_vuosilks] end
,[jarjestys_omistajatyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_omistajatyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_omistajatyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_omistajatyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_omistajatyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_omistajatyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_omistajatyyppi] else ol.[jarjestys_omistajatyyppi] end
,[jarjestys_opetuskieli] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_opetuskieli] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_opetuskieli] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_opetuskieli] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_opetuskieli] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_opetuskieli] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_opetuskieli] else ol.[jarjestys_opetuskieli] end
,[jarjestys_koulutuksen_jarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koulutuksen_jarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koulutuksen_jarjestaja] else ol.[jarjestys_koulutuksen_jarjestaja] end
,[jarjestys_sijaintikunta] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_sijaintikunta] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_sijaintikunta] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_sijaintikunta] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_sijaintikunta] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_sijaintikunta] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_sijaintikunta] else ol.[jarjestys_sijaintikunta] end
,[jarjestys_koordinaatti_ita] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koordinaatti_ita] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koordinaatti_ita] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koordinaatti_ita] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koordinaatti_ita] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koordinaatti_ita] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koordinaatti_ita] else ol.[jarjestys_koordinaatti_ita] end
,[jarjestys_koordinaatti_pohjois] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koordinaatti_pohjois] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koordinaatti_pohjois] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koordinaatti_pohjois] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koordinaatti_pohjois] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koordinaatti_pohjois] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koordinaatti_pohjois] else ol.[jarjestys_koordinaatti_pohjois] end
,[jarjestys_postinumero] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_postinumero] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_postinumero] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_postinumero] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_postinumero] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_postinumero] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_postinumero] else ol.[jarjestys_postinumero] end
,[tietolahde_oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[tietolahde_oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[tietolahde_oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[tietolahde_oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[tietolahde_oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[tietolahde_oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[tietolahde_oppilaitos] else ol.[tietolahde_oppilaitos] end
,[koulutuksen_jarjestajakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajakoodi] else ol.[koulutuksen_jarjestajakoodi] end
,[koulutuksen_jarjestajan_korvaavakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_korvaavakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_korvaavakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_korvaavakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_korvaavakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_korvaavakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_korvaavakoodi] else ol.[koulutuksen_jarjestajan_korvaavakoodi] end
,[koulutuksen_jarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestaja] else ol.[koulutuksen_jarjestaja] end
,[koulutuksen_jarjestaja_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestaja_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestaja_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestaja_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestaja_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestaja_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestaja_SV] else ol.[koulutuksen_jarjestaja_SV] end
,[koulutuksen_jarjestaja_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestaja_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestaja_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestaja_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestaja_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestaja_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestaja_EN] else ol.[koulutuksen_jarjestaja_EN] end
,[koulutuksen_jarjestajan_omistajatyyppikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_omistajatyyppikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_omistajatyyppikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_omistajatyyppikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_omistajatyyppikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_omistajatyyppikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_omistajatyyppikoodi] else ol.[koulutuksen_jarjestajan_omistajatyyppikoodi] end
,[koulutuksen_jarjestajan_omistajatyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_omistajatyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_omistajatyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_omistajatyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_omistajatyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_omistajatyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi] else ol.[koulutuksen_jarjestajan_omistajatyyppi] end
,[koulutuksen_jarjestajan_omistajatyyppi_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_omistajatyyppi_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_omistajatyyppi_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_omistajatyyppi_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_omistajatyyppi_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_omistajatyyppi_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi_SV] else ol.[koulutuksen_jarjestajan_omistajatyyppi_SV] end
,[koulutuksen_jarjestajan_omistajatyyppi_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_omistajatyyppi_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_omistajatyyppi_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_omistajatyyppi_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_omistajatyyppi_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_omistajatyyppi_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi_EN] else ol.[koulutuksen_jarjestajan_omistajatyyppi_EN] end
,[koulutuksen_jarjestajan_kielikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_kielikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_kielikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_kielikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_kielikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_kielikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_kielikoodi] else ol.[koulutuksen_jarjestajan_kielikoodi] end
,[koulutuksen_jarjestajan_kieli] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_kieli] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_kieli] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_kieli] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_kieli] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_kieli] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_kieli] else ol.[koulutuksen_jarjestajan_kieli] end
,[koulutuksen_jarjestajan_kieli_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_kieli_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_kieli_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_kieli_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_kieli_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_kieli_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_kieli_SV] else ol.[koulutuksen_jarjestajan_kieli_SV] end
,[koulutuksen_jarjestajan_kieli_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_kieli_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_kieli_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_kieli_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_kieli_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_kieli_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_kieli_EN] else ol.[koulutuksen_jarjestajan_kieli_EN] end
,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_ksijaintikuntakoodi] else ol.[koulutuksen_jarjestajan_ksijaintikuntakoodi] end
,[koulutuksen_jarjestajan_sijaintikunta] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_sijaintikunta] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_sijaintikunta] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_sijaintikunta] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_sijaintikunta] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_sijaintikunta] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_sijaintikunta] else ol.[koulutuksen_jarjestajan_sijaintikunta] end
,[koulutuksen_jarjestajan_sijaintikunta_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_sijaintikunta_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_sijaintikunta_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_sijaintikunta_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_sijaintikunta_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_sijaintikunta_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_sijaintikunta_SV] else ol.[koulutuksen_jarjestajan_sijaintikunta_SV] end
,[koulutuksen_jarjestajan_sijaintikunta_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_sijaintikunta_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_sijaintikunta_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_sijaintikunta_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_sijaintikunta_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_sijaintikunta_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_sijaintikunta_EN] else ol.[koulutuksen_jarjestajan_sijaintikunta_EN] end
,[jarjestys_koulutuksenjarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koulutuksenjarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koulutuksenjarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koulutuksenjarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koulutuksenjarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koulutuksenjarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koulutuksenjarjestaja] else ol.[jarjestys_koulutuksenjarjestaja] end
,[jarjestys_koulutuksen_jarjestajan_kieli] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koulutuksen_jarjestajan_kieli] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koulutuksen_jarjestajan_kieli] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koulutuksen_jarjestajan_kieli] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koulutuksen_jarjestajan_kieli] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koulutuksen_jarjestajan_kieli] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koulutuksen_jarjestajan_kieli] else ol.[jarjestys_koulutuksen_jarjestajan_kieli] end
,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_sijaintikunta_koulutuksenjarjestaja] else ol.[jarjestys_sijaintikunta_koulutuksenjarjestaja] end
,[tietolahde_koulutuksenjarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[tietolahde_koulutuksenjarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[tietolahde_koulutuksenjarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[tietolahde_koulutuksenjarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[tietolahde_koulutuksenjarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[tietolahde_koulutuksenjarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[tietolahde_koulutuksenjarjestaja] else ol.[tietolahde_koulutuksenjarjestaja] end
,[koulutuksen_jarjestajan_ainoa_oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koulutuksen_jarjestajan_ainoa_oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koulutuksen_jarjestajan_ainoa_oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koulutuksen_jarjestajan_ainoa_oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koulutuksen_jarjestajan_ainoa_oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koulutuksen_jarjestajan_ainoa_oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koulutuksen_jarjestajan_ainoa_oppilaitos] else ol.[koulutuksen_jarjestajan_ainoa_oppilaitos] end

      --,[oppilaitoksen_korvaavakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_korvaavakoodi] else ol_uusi.[oppilaitoksen_korvaavakoodi] end
      --,[oppilaitos] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitos] else ol_uusi.[oppilaitos] end
      --,[oppilaitos_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitos_SV] else ol_uusi.[oppilaitos_SV] end
      --,[oppilaitos_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitos_EN] else ol_uusi.[oppilaitos_EN] end
      --,[sairaalakoulukoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulukoodi] else ol_uusi.[sairaalakoulukoodi] end
      --,[sairaalakoulu] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulu] else ol_uusi.[sairaalakoulu] end
      --,[sairaalakoulu_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulu_SV] else ol_uusi.[sairaalakoulu_SV] end
      --,[sairaalakoulu_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulu_EN] else ol_uusi.[sairaalakoulu_EN] end
      --,[oppilaitostyyppikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppikoodi] else ol_uusi.[oppilaitostyyppikoodi] end
      --,[oppilaitostyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppi] else ol_uusi.[oppilaitostyyppi] end
      --,[oppilaitostyyppi_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppi_SV] else ol_uusi.[oppilaitostyyppi_SV] end
      --,[oppilaitostyyppi_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppi_EN] else ol_uusi.[oppilaitostyyppi_EN] end
      --,[peruskoulujen_ryhmityskoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmityskoodi] else ol_uusi.[peruskoulujen_ryhmityskoodi] end
      --,[peruskoulujen_ryhmitys] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmitys] else ol_uusi.[peruskoulujen_ryhmitys] end
      --,[peruskoulujen_ryhmitys_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmitys_SV] else ol_uusi.[peruskoulujen_ryhmitys_SV] end
      --,[peruskoulujen_ryhmitys_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmitys_EN] else ol_uusi.[peruskoulujen_ryhmitys_EN] end
      --,[peruskoulujen_vuosilkskoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilkskoodi] else ol_uusi.[peruskoulujen_vuosilkskoodi] end
      --,[peruskoulujen_vuosilks] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilks] else ol_uusi.[peruskoulujen_vuosilks] end
      --,[peruskoulujen_vuosilks_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilks_SV] else ol_uusi.[peruskoulujen_vuosilks_SV] end
      --,[peruskoulujen_vuosilks_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilks_EN] else ol_uusi.[peruskoulujen_vuosilks_EN] end
      --,[oppilaitoksen_omistajatyyppikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppikoodi] else ol_uusi.[oppilaitoksen_omistajatyyppikoodi] end
      --,[oppilaitoksen_omistajatyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppi] else ol_uusi.[oppilaitoksen_omistajatyyppi] end
      --,[oppilaitoksen_omistajatyyppi_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppi_SV] else ol_uusi.[oppilaitoksen_omistajatyyppi_SV] end
      --,[oppilaitoksen_omistajatyyppi_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppi_EN] else ol_uusi.[oppilaitoksen_omistajatyyppi_EN] end
      --,[opetuskielikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskielikoodi] else ol_uusi.[opetuskielikoodi] end
      --,[opetuskieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskieli] else ol_uusi.[opetuskieli] end
      --,[opetuskieli_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskieli_SV] else ol_uusi.[opetuskieli_SV] end
      --,[opetuskieli_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskieli_EN] else ol_uusi.[opetuskieli_EN] end
      --,[sijaintikuntakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sijaintikuntakoodi] else ol_uusi.[sijaintikuntakoodi] end
      --,[oppilaitoksen_sijaintikunta] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_sijaintikunta] else ol_uusi.[oppilaitoksen_sijaintikunta] end
      --,[oppilaitoksen_sijaintikunta_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_sijaintikunta_SV] else ol_uusi.[oppilaitoksen_sijaintikunta_SV] end
      --,[oppilaitoksen_sijaintikunta_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_sijaintikunta_EN] else ol_uusi.[oppilaitoksen_sijaintikunta_EN] end
      --,[koordinaatti_itakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koordinaatti_itakoodi] else ol_uusi.[koordinaatti_itakoodi] end
      --,[koordinaatti_pohjoiskoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koordinaatti_pohjoiskoodi] else ol_uusi.[koordinaatti_pohjoiskoodi] end
      --,[postinumerokoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[postinumerokoodi] else ol_uusi.[postinumerokoodi] end
      --,[jarjestys_oppilaitos] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_oppilaitos] else ol_uusi.[jarjestys_oppilaitos] end
      --,[jarjestys_sairaalakoulu] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_sairaalakoulu] else ol_uusi.[jarjestys_sairaalakoulu] end
      --,[jarjestys_oppilaitostyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_oppilaitostyyppi] else ol_uusi.[jarjestys_oppilaitostyyppi] end
      --,[jarjestys_peruskoulujen_ryhmitys] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_peruskoulujen_ryhmitys] else ol_uusi.[jarjestys_peruskoulujen_ryhmitys] end
      --,[jarjestys_peruskoulujen_vuosilks] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_peruskoulujen_vuosilks] else ol_uusi.[jarjestys_peruskoulujen_vuosilks] end
      --,[jarjestys_omistajatyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_omistajatyyppi] else ol_uusi.[jarjestys_omistajatyyppi] end
      --,[jarjestys_opetuskieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_opetuskieli] else ol_uusi.[jarjestys_opetuskieli] end
      --,[jarjestys_koulutuksen_jarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koulutuksen_jarjestaja] else ol_uusi.[jarjestys_koulutuksen_jarjestaja] end
      --,[jarjestys_sijaintikunta] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_sijaintikunta] else ol_uusi.[jarjestys_sijaintikunta] end
      --,[jarjestys_koordinaatti_ita] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koordinaatti_ita] else ol_uusi.[jarjestys_koordinaatti_ita] end
      --,[jarjestys_koordinaatti_pohjois] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koordinaatti_pohjois] else ol_uusi.[jarjestys_koordinaatti_pohjois] end
      --,[jarjestys_postinumero] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_postinumero] else ol_uusi.[jarjestys_postinumero] end
      --,[tietolahde_oppilaitos] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[tietolahde_oppilaitos] else ol_uusi.[tietolahde_oppilaitos] end
      --,[koulutuksen_jarjestajakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajakoodi] else ol_uusi.[koulutuksen_jarjestajakoodi] end
      --,[koulutuksen_jarjestajan_korvaavakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_korvaavakoodi] else ol_uusi.[koulutuksen_jarjestajan_korvaavakoodi] end
      --,[koulutuksen_jarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestaja] else ol_uusi.[koulutuksen_jarjestaja] end
      --,[koulutuksen_jarjestaja_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestaja_SV] else ol_uusi.[koulutuksen_jarjestaja_SV] end
      --,[koulutuksen_jarjestaja_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestaja_EN] else ol_uusi.[koulutuksen_jarjestaja_EN] end
      --,[koulutuksen_jarjestajan_omistajatyyppikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppikoodi] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppikoodi] end
      --,[koulutuksen_jarjestajan_omistajatyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppi] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi] end
      --,[koulutuksen_jarjestajan_omistajatyyppi_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppi_SV] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi_SV] end
      --,[koulutuksen_jarjestajan_omistajatyyppi_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppi_EN] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi_EN] end
      --,[koulutuksen_jarjestajan_kielikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kielikoodi] else ol_uusi.[koulutuksen_jarjestajan_kielikoodi] end
      --,[koulutuksen_jarjestajan_kieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kieli] else ol_uusi.[koulutuksen_jarjestajan_kieli] end
      --,[koulutuksen_jarjestajan_kieli_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kieli_SV] else ol_uusi.[koulutuksen_jarjestajan_kieli_SV] end
      --,[koulutuksen_jarjestajan_kieli_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kieli_EN] else ol_uusi.[koulutuksen_jarjestajan_kieli_EN] end
      --,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_ksijaintikuntakoodi] else ol_uusi.[koulutuksen_jarjestajan_ksijaintikuntakoodi] end
      --,[koulutuksen_jarjestajan_sijaintikunta] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_sijaintikunta] else ol_uusi.[koulutuksen_jarjestajan_sijaintikunta] end
      --,[koulutuksen_jarjestajan_sijaintikunta_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_sijaintikunta_SV] else ol_uusi.[koulutuksen_jarjestajan_sijaintikunta_SV] end
      --,[koulutuksen_jarjestajan_sijaintikunta_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_sijaintikunta_EN] else ol_uusi.[koulutuksen_jarjestajan_sijaintikunta_EN] end
      --,[jarjestys_koulutuksenjarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koulutuksenjarjestaja] else ol_uusi.[jarjestys_koulutuksenjarjestaja] end
      --,[jarjestys_koulutuksen_jarjestajan_kieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koulutuksen_jarjestajan_kieli] else ol_uusi.[jarjestys_koulutuksen_jarjestajan_kieli] end
      --,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_sijaintikunta_koulutuksenjarjestaja] else ol_uusi.[jarjestys_sijaintikunta_koulutuksenjarjestaja] end
      --,[tietolahde_koulutuksenjarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[tietolahde_koulutuksenjarjestaja] else ol_uusi.[tietolahde_koulutuksenjarjestaja] end

--SELECT [oppilaitoskoodi] = ol.[oppilaitoskoodi]
--      ,ol.[oppilaitoksen_korvaavakoodi]
--      ,ol.[oppilaitos]
--      ,ol.[oppilaitos_SV]
--      ,ol.[oppilaitos_EN]
--      ,ol.[sairaalakoulukoodi]
--      ,ol.[sairaalakoulu]
--      ,ol.[sairaalakoulu_SV]
--      ,ol.[sairaalakoulu_EN]
--      ,ol.[oppilaitostyyppikoodi]
--      ,ol.[oppilaitostyyppi]
--      ,ol.[oppilaitostyyppi_SV]
--      ,ol.[oppilaitostyyppi_EN]
--      ,ol.[peruskoulujen_ryhmityskoodi]
--      ,ol.[peruskoulujen_ryhmitys]
--      ,ol.[peruskoulujen_ryhmitys_SV]
--      ,ol.[peruskoulujen_ryhmitys_EN]
--      ,ol.[peruskoulujen_vuosilkskoodi]
--      ,ol.[peruskoulujen_vuosilks]
--      ,ol.[peruskoulujen_vuosilks_SV]
--      ,ol.[peruskoulujen_vuosilks_EN]
--      ,ol.[oppilaitoksen_omistajatyyppikoodi]
--      ,ol.[oppilaitoksen_omistajatyyppi]
--      ,ol.[oppilaitoksen_omistajatyyppi_SV]
--      ,ol.[oppilaitoksen_omistajatyyppi_EN]
--      ,ol.[opetuskielikoodi]
--      ,ol.[opetuskieli]
--      ,ol.[opetuskieli_SV]
--      ,ol.[opetuskieli_EN]
--      ,ol.[sijaintikuntakoodi]
--      ,ol.[oppilaitoksen_sijaintikunta]
--      ,ol.[oppilaitoksen_sijaintikunta_SV]
--      ,ol.[oppilaitoksen_sijaintikunta_EN]
--      ,ol.[koordinaatti_itakoodi]
--      ,ol.[koordinaatti_pohjoiskoodi]
--      ,ol.[postinumerokoodi]
--      ,ol.[jarjestys_oppilaitos]
--      ,ol.[jarjestys_sairaalakoulu]
--      ,ol.[jarjestys_oppilaitostyyppi]
--      ,ol.[jarjestys_peruskoulujen_ryhmitys]
--      ,ol.[jarjestys_peruskoulujen_vuosilks]
--      ,ol.[jarjestys_omistajatyyppi]
--      ,ol.[jarjestys_opetuskieli]
--      ,ol.[jarjestys_koulutuksen_jarjestaja]
--      ,ol.[jarjestys_sijaintikunta]
--      ,ol.[jarjestys_koordinaatti_ita]
--      ,ol.[jarjestys_koordinaatti_pohjois]
--      ,ol.[jarjestys_postinumero]
--      ,ol.[tietolahde_oppilaitos]
--      ,ol.[koulutuksen_jarjestajakoodi]
--      ,ol.[koulutuksen_jarjestajan_korvaavakoodi]
--      ,ol.[koulutuksen_jarjestaja]
--      ,ol.[koulutuksen_jarjestaja_SV]
--      ,ol.[koulutuksen_jarjestaja_EN]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppikoodi]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppi]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppi_SV]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppi_EN]
--      ,ol.[koulutuksen_jarjestajan_kielikoodi]
--      ,ol.[koulutuksen_jarjestajan_kieli]
--      ,ol.[koulutuksen_jarjestajan_kieli_SV]
--      ,ol.[koulutuksen_jarjestajan_kieli_EN]
--      ,ol.[koulutuksen_jarjestajan_ksijaintikuntakoodi]
--      ,ol.[koulutuksen_jarjestajan_sijaintikunta]
--      ,ol.[koulutuksen_jarjestajan_sijaintikunta_SV]
--      ,ol.[koulutuksen_jarjestajan_sijaintikunta_EN]
--      ,ol.[jarjestys_koulutuksenjarjestaja]
--      ,ol.[jarjestys_koulutuksen_jarjestajan_kieli]
--      ,ol.[jarjestys_sijaintikunta_koulutuksenjarjestaja]
--      ,ol.[tietolahde_koulutuksenjarjestaja]
  FROM [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi
	on ol.oppilaitoksen_korvaavakoodi = ol_uusi.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_2
	on ol_uusi.oppilaitoksen_korvaavakoodi = ol_uusi_2.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_3
	on ol_uusi_2.oppilaitoksen_korvaavakoodi = ol_uusi_3.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_4
	on ol_uusi_3.oppilaitoksen_korvaavakoodi = ol_uusi_4.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_5
	on ol_uusi_4.oppilaitoksen_korvaavakoodi = ol_uusi_5.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_6
	on ol_uusi_5.oppilaitoksen_korvaavakoodi = ol_uusi_6.oppilaitoskoodi


' 
GO
/****** Object:  View [dbo].[v_oppilaitoksen_taustatiedot_nykytila_TESTI_ANSSI]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitoksen_taustatiedot_nykytila_TESTI_ANSSI]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_oppilaitoksen_taustatiedot_nykytila_TESTI_ANSSI] AS
/*
-- HUOM [VipunenTK].[dbo].[d_oppilaitoksen_taustatiedot_historia] pitää olla olemassa
Drop table VipunenTK.dbo.d_oppilaitoksen_taustatiedot
Select * into VipunenTK.dbo.d_oppilaitoksen_taustatiedot from VipunenTK_DW.dbo.v_oppilaitoksen_taustatiedot_nykytila
Truncate table VipunenTK.dbo.d_oppilaitoksen_taustatiedot
Insert into VipunenTK.dbo.d_oppilaitoksen_taustatiedot
  Select * from VipunenTK_DW.dbo.v_oppilaitoksen_taustatiedot_nykytila
*/

SELECT 
 ol.id
,[oppilaitos_avain] = ol.oppilaitos_avain
,[oppilaitoskoodi] = ol.[oppilaitoskoodi]
--,oppilaitoskoodi1 = ol_uusi.oppilaitoskoodi
--,oppilaitoskoodi2 = ol_uusi_2.oppilaitoskoodi
--,oppilaitoskoodi3 = ol_uusi_3.oppilaitoskoodi
--,oppilaitoskoodi4 = ol_uusi_4.oppilaitoskoodi
--,oppilaitoskoodi5 = ol_uusi_5.oppilaitoskoodi
--,oppilaitoskoodi6 = ol_uusi_6.oppilaitoskoodi

--,[oppilaitoksen_korvaavakoodi] = ol_uusi_6.oppilaitoksen_korvaavakoodi --Muutettu 21.3.2014 / CSC Jarmo
,[oppilaitoksen_korvaavakoodi] = Case when ol_uusi_6.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_6.oppilaitoksen_korvaavakoodi when ol_uusi_5.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_5.oppilaitoksen_korvaavakoodi when ol_uusi_4.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_4.oppilaitoksen_korvaavakoodi when ol_uusi_3.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_3.oppilaitoksen_korvaavakoodi when ol_uusi_2.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi_2.oppilaitoksen_korvaavakoodi when ol_uusi.oppilaitoksen_korvaavakoodi IS NOT NULL then ol_uusi.oppilaitoksen_korvaavakoodi else NULL end
,[oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitos] else ol.[oppilaitos] end
,[oppilaitos_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitos_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitos_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitos_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitos_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitos_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitos_SV] else ol.[oppilaitos_SV] end
,[oppilaitos_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitos_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitos_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitos_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitos_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitos_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitos_EN] else ol.[oppilaitos_EN] end
,[sairaalakoulukoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulukoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulukoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulukoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulukoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulukoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulukoodi] else ol.[sairaalakoulukoodi] end
,[sairaalakoulu] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulu] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulu] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulu] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulu] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulu] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulu] else ol.[sairaalakoulu] end
,[sairaalakoulu_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulu_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulu_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulu_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulu_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulu_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulu_SV] else ol.[sairaalakoulu_SV] end
,[sairaalakoulu_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sairaalakoulu_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sairaalakoulu_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sairaalakoulu_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sairaalakoulu_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sairaalakoulu_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sairaalakoulu_EN] else ol.[sairaalakoulu_EN] end
,[oppilaitostyyppikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppikoodi] else ol.[oppilaitostyyppikoodi] end
,[oppilaitostyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppi] else ol.[oppilaitostyyppi] end
,[oppilaitostyyppi_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppi_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppi_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppi_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppi_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppi_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppi_SV] else ol.[oppilaitostyyppi_SV] end
,[oppilaitostyyppi_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitostyyppi_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitostyyppi_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitostyyppi_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitostyyppi_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitostyyppi_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitostyyppi_EN] else ol.[oppilaitostyyppi_EN] end
,[peruskoulujen_ryhmityskoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmityskoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmityskoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmityskoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmityskoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmityskoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmityskoodi] else ol.[peruskoulujen_ryhmityskoodi] end
,[peruskoulujen_ryhmitys] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmitys] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmitys] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmitys] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmitys] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmitys] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmitys] else ol.[peruskoulujen_ryhmitys] end
,[peruskoulujen_ryhmitys_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmitys_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmitys_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmitys_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmitys_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmitys_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmitys_SV] else ol.[peruskoulujen_ryhmitys_SV] end
,[peruskoulujen_ryhmitys_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_ryhmitys_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_ryhmitys_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_ryhmitys_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_ryhmitys_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_ryhmitys_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_ryhmitys_EN] else ol.[peruskoulujen_ryhmitys_EN] end
,[peruskoulujen_vuosilkskoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilkskoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilkskoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilkskoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilkskoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilkskoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilkskoodi] else ol.[peruskoulujen_vuosilkskoodi] end
,[peruskoulujen_vuosilks] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilks] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilks] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilks] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilks] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilks] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilks] else ol.[peruskoulujen_vuosilks] end
,[peruskoulujen_vuosilks_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilks_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilks_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilks_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilks_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilks_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilks_SV] else ol.[peruskoulujen_vuosilks_SV] end
,[peruskoulujen_vuosilks_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[peruskoulujen_vuosilks_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[peruskoulujen_vuosilks_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[peruskoulujen_vuosilks_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[peruskoulujen_vuosilks_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[peruskoulujen_vuosilks_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[peruskoulujen_vuosilks_EN] else ol.[peruskoulujen_vuosilks_EN] end
,[oppilaitoksen_omistajatyyppikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppikoodi] else ol.[oppilaitoksen_omistajatyyppikoodi] end
,[oppilaitoksen_omistajatyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppi] else ol.[oppilaitoksen_omistajatyyppi] end
,[oppilaitoksen_omistajatyyppi_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppi_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppi_SV] else ol.[oppilaitoksen_omistajatyyppi_SV] end
,[oppilaitoksen_omistajatyyppi_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_omistajatyyppi_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_omistajatyyppi_EN] else ol.[oppilaitoksen_omistajatyyppi_EN] end
,[opetuskielikoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskielikoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskielikoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskielikoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskielikoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskielikoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskielikoodi] else ol.[opetuskielikoodi] end
,[opetuskieli] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskieli] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskieli] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskieli] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskieli] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskieli] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskieli] else ol.[opetuskieli] end
,[opetuskieli_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskieli_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskieli_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskieli_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskieli_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskieli_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskieli_SV] else ol.[opetuskieli_SV] end
,[opetuskieli_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[opetuskieli_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[opetuskieli_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[opetuskieli_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[opetuskieli_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[opetuskieli_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[opetuskieli_EN] else ol.[opetuskieli_EN] end
,[sijaintikuntakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[sijaintikuntakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[sijaintikuntakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[sijaintikuntakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[sijaintikuntakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[sijaintikuntakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[sijaintikuntakoodi] else ol.[sijaintikuntakoodi] end
,[oppilaitoksen_sijaintikunta] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_sijaintikunta] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_sijaintikunta] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_sijaintikunta] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_sijaintikunta] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_sijaintikunta] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_sijaintikunta] else ol.[oppilaitoksen_sijaintikunta] end
,[oppilaitoksen_sijaintikunta_SV] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_sijaintikunta_SV] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_sijaintikunta_SV] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_sijaintikunta_SV] else ol.[oppilaitoksen_sijaintikunta_SV] end
,[oppilaitoksen_sijaintikunta_EN] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[oppilaitoksen_sijaintikunta_EN] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[oppilaitoksen_sijaintikunta_EN] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[oppilaitoksen_sijaintikunta_EN] else ol.[oppilaitoksen_sijaintikunta_EN] end
,[koordinaatti_itakoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koordinaatti_itakoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koordinaatti_itakoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koordinaatti_itakoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koordinaatti_itakoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koordinaatti_itakoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koordinaatti_itakoodi] else ol.[koordinaatti_itakoodi] end
,[koordinaatti_pohjoiskoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[koordinaatti_pohjoiskoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[koordinaatti_pohjoiskoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[koordinaatti_pohjoiskoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[koordinaatti_pohjoiskoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[koordinaatti_pohjoiskoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[koordinaatti_pohjoiskoodi] else ol.[koordinaatti_pohjoiskoodi] end
,[postinumerokoodi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[postinumerokoodi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[postinumerokoodi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[postinumerokoodi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[postinumerokoodi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[postinumerokoodi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[postinumerokoodi] else ol.[postinumerokoodi] end
,[jarjestys_oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_oppilaitos] else ol.[jarjestys_oppilaitos] end
,[jarjestys_sairaalakoulu] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_sairaalakoulu] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_sairaalakoulu] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_sairaalakoulu] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_sairaalakoulu] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_sairaalakoulu] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_sairaalakoulu] else ol.[jarjestys_sairaalakoulu] end
,[jarjestys_oppilaitostyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_oppilaitostyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_oppilaitostyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_oppilaitostyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_oppilaitostyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_oppilaitostyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_oppilaitostyyppi] else ol.[jarjestys_oppilaitostyyppi] end
,[jarjestys_peruskoulujen_ryhmitys] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_peruskoulujen_ryhmitys] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_peruskoulujen_ryhmitys] else ol.[jarjestys_peruskoulujen_ryhmitys] end
,[jarjestys_peruskoulujen_vuosilks] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_peruskoulujen_vuosilks] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_peruskoulujen_vuosilks] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_peruskoulujen_vuosilks] else ol.[jarjestys_peruskoulujen_vuosilks] end
,[jarjestys_omistajatyyppi] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_omistajatyyppi] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_omistajatyyppi] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_omistajatyyppi] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_omistajatyyppi] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_omistajatyyppi] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_omistajatyyppi] else ol.[jarjestys_omistajatyyppi] end
,[jarjestys_opetuskieli] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_opetuskieli] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_opetuskieli] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_opetuskieli] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_opetuskieli] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_opetuskieli] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_opetuskieli] else ol.[jarjestys_opetuskieli] end
,[jarjestys_koulutuksen_jarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koulutuksen_jarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koulutuksen_jarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koulutuksen_jarjestaja] else ol.[jarjestys_koulutuksen_jarjestaja] end
,[jarjestys_sijaintikunta] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_sijaintikunta] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_sijaintikunta] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_sijaintikunta] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_sijaintikunta] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_sijaintikunta] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_sijaintikunta] else ol.[jarjestys_sijaintikunta] end
,[jarjestys_koordinaatti_ita] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koordinaatti_ita] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koordinaatti_ita] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koordinaatti_ita] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koordinaatti_ita] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koordinaatti_ita] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koordinaatti_ita] else ol.[jarjestys_koordinaatti_ita] end
,[jarjestys_koordinaatti_pohjois] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_koordinaatti_pohjois] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_koordinaatti_pohjois] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_koordinaatti_pohjois] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_koordinaatti_pohjois] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_koordinaatti_pohjois] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_koordinaatti_pohjois] else ol.[jarjestys_koordinaatti_pohjois] end
,[jarjestys_postinumero] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[jarjestys_postinumero] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[jarjestys_postinumero] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[jarjestys_postinumero] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[jarjestys_postinumero] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[jarjestys_postinumero] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[jarjestys_postinumero] else ol.[jarjestys_postinumero] end
,[tietolahde_oppilaitos] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[tietolahde_oppilaitos] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[tietolahde_oppilaitos] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[tietolahde_oppilaitos] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[tietolahde_oppilaitos] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[tietolahde_oppilaitos] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[tietolahde_oppilaitos] else ol.[tietolahde_oppilaitos] end
,[koulutuksen_jarjestajakoodi] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajakoodi] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajakoodi] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajakoodi] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajakoodi] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajakoodi] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajakoodi] else ol.[koulutuksen_jarjestajakoodi] end
,[koulutuksen_jarjestajan_korvaavakoodi] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_korvaavakoodi] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_korvaavakoodi] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_korvaavakoodi] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_korvaavakoodi] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_korvaavakoodi] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_korvaavakoodi] else ol.[koulutuksen_jarjestajan_korvaavakoodi] end
,[koulutuksen_jarjestaja] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestaja] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestaja] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestaja] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestaja] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestaja] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestaja] else ol.[koulutuksen_jarjestaja] end
,[koulutuksen_jarjestaja_SV] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestaja_SV] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestaja_SV] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestaja_SV] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestaja_SV] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestaja_SV] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestaja_SV] else ol.[koulutuksen_jarjestaja_SV] end
,[koulutuksen_jarjestaja_EN] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestaja_EN] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestaja_EN] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestaja_EN] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestaja_EN] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestaja_EN] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestaja_EN] else ol.[koulutuksen_jarjestaja_EN] end
,[koulutuksen_jarjestajan_omistajatyyppikoodi] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_omistajatyyppikoodi] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_omistajatyyppikoodi] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_omistajatyyppikoodi] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_omistajatyyppikoodi] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_omistajatyyppikoodi] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_omistajatyyppikoodi] else ol.[koulutuksen_jarjestajan_omistajatyyppikoodi] end
,[koulutuksen_jarjestajan_omistajatyyppi] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_omistajatyyppi] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_omistajatyyppi] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_omistajatyyppi] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_omistajatyyppi] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_omistajatyyppi] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_omistajatyyppi] else ol.[koulutuksen_jarjestajan_omistajatyyppi] end
,[koulutuksen_jarjestajan_omistajatyyppi_SV] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_omistajatyyppi_SV] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_omistajatyyppi_SV] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_omistajatyyppi_SV] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_omistajatyyppi_SV] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_omistajatyyppi_SV] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_omistajatyyppi_SV] else ol.[koulutuksen_jarjestajan_omistajatyyppi_SV] end
,[koulutuksen_jarjestajan_omistajatyyppi_EN] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_omistajatyyppi_EN] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_omistajatyyppi_EN] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_omistajatyyppi_EN] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_omistajatyyppi_EN] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_omistajatyyppi_EN] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_omistajatyyppi_EN] else ol.[koulutuksen_jarjestajan_omistajatyyppi_EN] end
,[koulutuksen_jarjestajan_kielikoodi] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_kielikoodi] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_kielikoodi] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_kielikoodi] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_kielikoodi] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_kielikoodi] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_kielikoodi] else ol.[koulutuksen_jarjestajan_kielikoodi] end
,[koulutuksen_jarjestajan_kieli] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_kieli] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_kieli] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_kieli] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_kieli] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_kieli] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_kieli] else ol.[koulutuksen_jarjestajan_kieli] end
,[koulutuksen_jarjestajan_kieli_SV] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_kieli_SV] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_kieli_SV] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_kieli_SV] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_kieli_SV] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_kieli_SV] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_kieli_SV] else ol.[koulutuksen_jarjestajan_kieli_SV] end
,[koulutuksen_jarjestajan_kieli_EN] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_kieli_EN] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_kieli_EN] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_kieli_EN] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_kieli_EN] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_kieli_EN] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_kieli_EN] else ol.[koulutuksen_jarjestajan_kieli_EN] end
,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_ksijaintikuntakoodi] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_ksijaintikuntakoodi] else ol.[koulutuksen_jarjestajan_ksijaintikuntakoodi] end
,[koulutuksen_jarjestajan_sijaintikunta] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_sijaintikunta] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_sijaintikunta] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_sijaintikunta] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_sijaintikunta] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_sijaintikunta] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_sijaintikunta] else ol.[koulutuksen_jarjestajan_sijaintikunta] end
,[koulutuksen_jarjestajan_sijaintikunta_SV] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_sijaintikunta_SV] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_sijaintikunta_SV] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_sijaintikunta_SV] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_sijaintikunta_SV] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_sijaintikunta_SV] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_sijaintikunta_SV] else ol.[koulutuksen_jarjestajan_sijaintikunta_SV] end
,[koulutuksen_jarjestajan_sijaintikunta_EN] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_sijaintikunta_EN] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_sijaintikunta_EN] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_sijaintikunta_EN] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_sijaintikunta_EN] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_sijaintikunta_EN] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_sijaintikunta_EN] else ol.[koulutuksen_jarjestajan_sijaintikunta_EN] end
,[jarjestys_koulutuksenjarjestaja] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[jarjestys_koulutuksenjarjestaja] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[jarjestys_koulutuksenjarjestaja] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[jarjestys_koulutuksenjarjestaja] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[jarjestys_koulutuksenjarjestaja] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[jarjestys_koulutuksenjarjestaja] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[jarjestys_koulutuksenjarjestaja] else ol.[jarjestys_koulutuksenjarjestaja] end
,[jarjestys_koulutuksen_jarjestajan_kieli] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[jarjestys_koulutuksen_jarjestajan_kieli] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[jarjestys_koulutuksen_jarjestajan_kieli] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[jarjestys_koulutuksen_jarjestajan_kieli] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[jarjestys_koulutuksen_jarjestajan_kieli] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[jarjestys_koulutuksen_jarjestajan_kieli] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[jarjestys_koulutuksen_jarjestajan_kieli] else ol.[jarjestys_koulutuksen_jarjestajan_kieli] end
,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[jarjestys_sijaintikunta_koulutuksenjarjestaja] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[jarjestys_sijaintikunta_koulutuksenjarjestaja] else ol.[jarjestys_sijaintikunta_koulutuksenjarjestaja] end
,[tietolahde_koulutuksenjarjestaja] = Case when ol_uusi_6.oppilaitoskoodi IS NOT NULL then ol_uusi_6.[tietolahde_koulutuksenjarjestaja] when ol_uusi_5.oppilaitoskoodi IS NOT NULL then ol_uusi_5.[tietolahde_koulutuksenjarjestaja] when ol_uusi_4.oppilaitoskoodi IS NOT NULL then ol_uusi_4.[tietolahde_koulutuksenjarjestaja] when ol_uusi_3.oppilaitoskoodi IS NOT NULL then ol_uusi_3.[tietolahde_koulutuksenjarjestaja] when ol_uusi_2.oppilaitoskoodi IS NOT NULL then ol_uusi_2.[tietolahde_koulutuksenjarjestaja] when ol_uusi.oppilaitoskoodi IS NOT NULL then ol_uusi.[tietolahde_koulutuksenjarjestaja] else ol.[tietolahde_koulutuksenjarjestaja] end
,[koulutuksen_jarjestajan_ainoa_oppilaitos] = Case when kj_uusi_6.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_6.[koulutuksen_jarjestajan_ainoa_oppilaitos] when kj_uusi_5.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_5.[koulutuksen_jarjestajan_ainoa_oppilaitos] when kj_uusi_4.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_4.[koulutuksen_jarjestajan_ainoa_oppilaitos] when kj_uusi_3.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_3.[koulutuksen_jarjestajan_ainoa_oppilaitos] when kj_uusi_2.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi_2.[koulutuksen_jarjestajan_ainoa_oppilaitos] when kj_uusi.koulutuksen_jarjestajakoodi IS NOT NULL then kj_uusi.[koulutuksen_jarjestajan_ainoa_oppilaitos] else ol.[koulutuksen_jarjestajan_ainoa_oppilaitos] end

      --,[oppilaitoksen_korvaavakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_korvaavakoodi] else ol_uusi.[oppilaitoksen_korvaavakoodi] end
      --,[oppilaitos] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitos] else ol_uusi.[oppilaitos] end
      --,[oppilaitos_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitos_SV] else ol_uusi.[oppilaitos_SV] end
      --,[oppilaitos_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitos_EN] else ol_uusi.[oppilaitos_EN] end
      --,[sairaalakoulukoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulukoodi] else ol_uusi.[sairaalakoulukoodi] end
      --,[sairaalakoulu] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulu] else ol_uusi.[sairaalakoulu] end
      --,[sairaalakoulu_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulu_SV] else ol_uusi.[sairaalakoulu_SV] end
      --,[sairaalakoulu_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sairaalakoulu_EN] else ol_uusi.[sairaalakoulu_EN] end
      --,[oppilaitostyyppikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppikoodi] else ol_uusi.[oppilaitostyyppikoodi] end
      --,[oppilaitostyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppi] else ol_uusi.[oppilaitostyyppi] end
      --,[oppilaitostyyppi_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppi_SV] else ol_uusi.[oppilaitostyyppi_SV] end
      --,[oppilaitostyyppi_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitostyyppi_EN] else ol_uusi.[oppilaitostyyppi_EN] end
      --,[peruskoulujen_ryhmityskoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmityskoodi] else ol_uusi.[peruskoulujen_ryhmityskoodi] end
      --,[peruskoulujen_ryhmitys] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmitys] else ol_uusi.[peruskoulujen_ryhmitys] end
      --,[peruskoulujen_ryhmitys_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmitys_SV] else ol_uusi.[peruskoulujen_ryhmitys_SV] end
      --,[peruskoulujen_ryhmitys_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_ryhmitys_EN] else ol_uusi.[peruskoulujen_ryhmitys_EN] end
      --,[peruskoulujen_vuosilkskoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilkskoodi] else ol_uusi.[peruskoulujen_vuosilkskoodi] end
      --,[peruskoulujen_vuosilks] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilks] else ol_uusi.[peruskoulujen_vuosilks] end
      --,[peruskoulujen_vuosilks_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilks_SV] else ol_uusi.[peruskoulujen_vuosilks_SV] end
      --,[peruskoulujen_vuosilks_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[peruskoulujen_vuosilks_EN] else ol_uusi.[peruskoulujen_vuosilks_EN] end
      --,[oppilaitoksen_omistajatyyppikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppikoodi] else ol_uusi.[oppilaitoksen_omistajatyyppikoodi] end
      --,[oppilaitoksen_omistajatyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppi] else ol_uusi.[oppilaitoksen_omistajatyyppi] end
      --,[oppilaitoksen_omistajatyyppi_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppi_SV] else ol_uusi.[oppilaitoksen_omistajatyyppi_SV] end
      --,[oppilaitoksen_omistajatyyppi_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_omistajatyyppi_EN] else ol_uusi.[oppilaitoksen_omistajatyyppi_EN] end
      --,[opetuskielikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskielikoodi] else ol_uusi.[opetuskielikoodi] end
      --,[opetuskieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskieli] else ol_uusi.[opetuskieli] end
      --,[opetuskieli_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskieli_SV] else ol_uusi.[opetuskieli_SV] end
      --,[opetuskieli_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[opetuskieli_EN] else ol_uusi.[opetuskieli_EN] end
      --,[sijaintikuntakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[sijaintikuntakoodi] else ol_uusi.[sijaintikuntakoodi] end
      --,[oppilaitoksen_sijaintikunta] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_sijaintikunta] else ol_uusi.[oppilaitoksen_sijaintikunta] end
      --,[oppilaitoksen_sijaintikunta_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_sijaintikunta_SV] else ol_uusi.[oppilaitoksen_sijaintikunta_SV] end
      --,[oppilaitoksen_sijaintikunta_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[oppilaitoksen_sijaintikunta_EN] else ol_uusi.[oppilaitoksen_sijaintikunta_EN] end
      --,[koordinaatti_itakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koordinaatti_itakoodi] else ol_uusi.[koordinaatti_itakoodi] end
      --,[koordinaatti_pohjoiskoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koordinaatti_pohjoiskoodi] else ol_uusi.[koordinaatti_pohjoiskoodi] end
      --,[postinumerokoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[postinumerokoodi] else ol_uusi.[postinumerokoodi] end
      --,[jarjestys_oppilaitos] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_oppilaitos] else ol_uusi.[jarjestys_oppilaitos] end
      --,[jarjestys_sairaalakoulu] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_sairaalakoulu] else ol_uusi.[jarjestys_sairaalakoulu] end
      --,[jarjestys_oppilaitostyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_oppilaitostyyppi] else ol_uusi.[jarjestys_oppilaitostyyppi] end
      --,[jarjestys_peruskoulujen_ryhmitys] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_peruskoulujen_ryhmitys] else ol_uusi.[jarjestys_peruskoulujen_ryhmitys] end
      --,[jarjestys_peruskoulujen_vuosilks] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_peruskoulujen_vuosilks] else ol_uusi.[jarjestys_peruskoulujen_vuosilks] end
      --,[jarjestys_omistajatyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_omistajatyyppi] else ol_uusi.[jarjestys_omistajatyyppi] end
      --,[jarjestys_opetuskieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_opetuskieli] else ol_uusi.[jarjestys_opetuskieli] end
      --,[jarjestys_koulutuksen_jarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koulutuksen_jarjestaja] else ol_uusi.[jarjestys_koulutuksen_jarjestaja] end
      --,[jarjestys_sijaintikunta] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_sijaintikunta] else ol_uusi.[jarjestys_sijaintikunta] end
      --,[jarjestys_koordinaatti_ita] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koordinaatti_ita] else ol_uusi.[jarjestys_koordinaatti_ita] end
      --,[jarjestys_koordinaatti_pohjois] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koordinaatti_pohjois] else ol_uusi.[jarjestys_koordinaatti_pohjois] end
      --,[jarjestys_postinumero] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_postinumero] else ol_uusi.[jarjestys_postinumero] end
      --,[tietolahde_oppilaitos] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[tietolahde_oppilaitos] else ol_uusi.[tietolahde_oppilaitos] end
      --,[koulutuksen_jarjestajakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajakoodi] else ol_uusi.[koulutuksen_jarjestajakoodi] end
      --,[koulutuksen_jarjestajan_korvaavakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_korvaavakoodi] else ol_uusi.[koulutuksen_jarjestajan_korvaavakoodi] end
      --,[koulutuksen_jarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestaja] else ol_uusi.[koulutuksen_jarjestaja] end
      --,[koulutuksen_jarjestaja_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestaja_SV] else ol_uusi.[koulutuksen_jarjestaja_SV] end
      --,[koulutuksen_jarjestaja_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestaja_EN] else ol_uusi.[koulutuksen_jarjestaja_EN] end
      --,[koulutuksen_jarjestajan_omistajatyyppikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppikoodi] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppikoodi] end
      --,[koulutuksen_jarjestajan_omistajatyyppi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppi] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi] end
      --,[koulutuksen_jarjestajan_omistajatyyppi_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppi_SV] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi_SV] end
      --,[koulutuksen_jarjestajan_omistajatyyppi_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_omistajatyyppi_EN] else ol_uusi.[koulutuksen_jarjestajan_omistajatyyppi_EN] end
      --,[koulutuksen_jarjestajan_kielikoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kielikoodi] else ol_uusi.[koulutuksen_jarjestajan_kielikoodi] end
      --,[koulutuksen_jarjestajan_kieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kieli] else ol_uusi.[koulutuksen_jarjestajan_kieli] end
      --,[koulutuksen_jarjestajan_kieli_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kieli_SV] else ol_uusi.[koulutuksen_jarjestajan_kieli_SV] end
      --,[koulutuksen_jarjestajan_kieli_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_kieli_EN] else ol_uusi.[koulutuksen_jarjestajan_kieli_EN] end
      --,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_ksijaintikuntakoodi] else ol_uusi.[koulutuksen_jarjestajan_ksijaintikuntakoodi] end
      --,[koulutuksen_jarjestajan_sijaintikunta] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_sijaintikunta] else ol_uusi.[koulutuksen_jarjestajan_sijaintikunta] end
      --,[koulutuksen_jarjestajan_sijaintikunta_SV] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_sijaintikunta_SV] else ol_uusi.[koulutuksen_jarjestajan_sijaintikunta_SV] end
      --,[koulutuksen_jarjestajan_sijaintikunta_EN] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[koulutuksen_jarjestajan_sijaintikunta_EN] else ol_uusi.[koulutuksen_jarjestajan_sijaintikunta_EN] end
      --,[jarjestys_koulutuksenjarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koulutuksenjarjestaja] else ol_uusi.[jarjestys_koulutuksenjarjestaja] end
      --,[jarjestys_koulutuksen_jarjestajan_kieli] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_koulutuksen_jarjestajan_kieli] else ol_uusi.[jarjestys_koulutuksen_jarjestajan_kieli] end
      --,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[jarjestys_sijaintikunta_koulutuksenjarjestaja] else ol_uusi.[jarjestys_sijaintikunta_koulutuksenjarjestaja] end
      --,[tietolahde_koulutuksenjarjestaja] = Case when ol_uusi.oppilaitoskoodi IS NULL then ol.[tietolahde_koulutuksenjarjestaja] else ol_uusi.[tietolahde_koulutuksenjarjestaja] end

--SELECT [oppilaitoskoodi] = ol.[oppilaitoskoodi]
--      ,ol.[oppilaitoksen_korvaavakoodi]
--      ,ol.[oppilaitos]
--      ,ol.[oppilaitos_SV]
--      ,ol.[oppilaitos_EN]
--      ,ol.[sairaalakoulukoodi]
--      ,ol.[sairaalakoulu]
--      ,ol.[sairaalakoulu_SV]
--      ,ol.[sairaalakoulu_EN]
--      ,ol.[oppilaitostyyppikoodi]
--      ,ol.[oppilaitostyyppi]
--      ,ol.[oppilaitostyyppi_SV]
--      ,ol.[oppilaitostyyppi_EN]
--      ,ol.[peruskoulujen_ryhmityskoodi]
--      ,ol.[peruskoulujen_ryhmitys]
--      ,ol.[peruskoulujen_ryhmitys_SV]
--      ,ol.[peruskoulujen_ryhmitys_EN]
--      ,ol.[peruskoulujen_vuosilkskoodi]
--      ,ol.[peruskoulujen_vuosilks]
--      ,ol.[peruskoulujen_vuosilks_SV]
--      ,ol.[peruskoulujen_vuosilks_EN]
--      ,ol.[oppilaitoksen_omistajatyyppikoodi]
--      ,ol.[oppilaitoksen_omistajatyyppi]
--      ,ol.[oppilaitoksen_omistajatyyppi_SV]
--      ,ol.[oppilaitoksen_omistajatyyppi_EN]
--      ,ol.[opetuskielikoodi]
--      ,ol.[opetuskieli]
--      ,ol.[opetuskieli_SV]
--      ,ol.[opetuskieli_EN]
--      ,ol.[sijaintikuntakoodi]
--      ,ol.[oppilaitoksen_sijaintikunta]
--      ,ol.[oppilaitoksen_sijaintikunta_SV]
--      ,ol.[oppilaitoksen_sijaintikunta_EN]
--      ,ol.[koordinaatti_itakoodi]
--      ,ol.[koordinaatti_pohjoiskoodi]
--      ,ol.[postinumerokoodi]
--      ,ol.[jarjestys_oppilaitos]
--      ,ol.[jarjestys_sairaalakoulu]
--      ,ol.[jarjestys_oppilaitostyyppi]
--      ,ol.[jarjestys_peruskoulujen_ryhmitys]
--      ,ol.[jarjestys_peruskoulujen_vuosilks]
--      ,ol.[jarjestys_omistajatyyppi]
--      ,ol.[jarjestys_opetuskieli]
--      ,ol.[jarjestys_koulutuksen_jarjestaja]
--      ,ol.[jarjestys_sijaintikunta]
--      ,ol.[jarjestys_koordinaatti_ita]
--      ,ol.[jarjestys_koordinaatti_pohjois]
--      ,ol.[jarjestys_postinumero]
--      ,ol.[tietolahde_oppilaitos]
--      ,ol.[koulutuksen_jarjestajakoodi]
--      ,ol.[koulutuksen_jarjestajan_korvaavakoodi]
--      ,ol.[koulutuksen_jarjestaja]
--      ,ol.[koulutuksen_jarjestaja_SV]
--      ,ol.[koulutuksen_jarjestaja_EN]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppikoodi]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppi]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppi_SV]
--      ,ol.[koulutuksen_jarjestajan_omistajatyyppi_EN]
--      ,ol.[koulutuksen_jarjestajan_kielikoodi]
--      ,ol.[koulutuksen_jarjestajan_kieli]
--      ,ol.[koulutuksen_jarjestajan_kieli_SV]
--      ,ol.[koulutuksen_jarjestajan_kieli_EN]
--      ,ol.[koulutuksen_jarjestajan_ksijaintikuntakoodi]
--      ,ol.[koulutuksen_jarjestajan_sijaintikunta]
--      ,ol.[koulutuksen_jarjestajan_sijaintikunta_SV]
--      ,ol.[koulutuksen_jarjestajan_sijaintikunta_EN]
--      ,ol.[jarjestys_koulutuksenjarjestaja]
--      ,ol.[jarjestys_koulutuksen_jarjestajan_kieli]
--      ,ol.[jarjestys_sijaintikunta_koulutuksenjarjestaja]
--      ,ol.[tietolahde_koulutuksenjarjestaja]
  FROM [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol
--oppilaitosten korvaavakoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi
	on ol.oppilaitoksen_korvaavakoodi = ol_uusi.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_2
	on ol_uusi.oppilaitoksen_korvaavakoodi = ol_uusi_2.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_3
	on ol_uusi_2.oppilaitoksen_korvaavakoodi = ol_uusi_3.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_4
	on ol_uusi_3.oppilaitoksen_korvaavakoodi = ol_uusi_4.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_5
	on ol_uusi_4.oppilaitoksen_korvaavakoodi = ol_uusi_5.oppilaitoskoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_6
	on ol_uusi_5.oppilaitoksen_korvaavakoodi = ol_uusi_6.oppilaitoskoodi

--koulutuksen järjestäjän korvaavakoodi
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi
	on ol.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi.koulutuksen_jarjestajakoodi and kj_uusi.oppilaitoskoodi=''-1''
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_2
	on kj_uusi.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_2.koulutuksen_jarjestajakoodi and kj_uusi_2.oppilaitoskoodi=''-1''
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_3
	on kj_uusi_2.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_3.koulutuksen_jarjestajakoodi and kj_uusi_3.oppilaitoskoodi=''-1''
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_4
	on kj_uusi_3.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_4.koulutuksen_jarjestajakoodi and kj_uusi_4.oppilaitoskoodi=''-1''
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_5
	on kj_uusi_4.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_5.koulutuksen_jarjestajakoodi and kj_uusi_5.oppilaitoskoodi=''-1''
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_6
	on kj_uusi_5.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_6.koulutuksen_jarjestajakoodi and kj_uusi_6.oppilaitoskoodi=''-1''

/*
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi
	on ol.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi.koulutuksen_jarjestajakoodi and kj_uusi.koulutuksen_jarjestaja in (select top 1 koulutuksen_jarjestaja from [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] d where d.koulutuksen_jarjestajakoodi=kj_uusi.koulutuksen_jarjestajakoodi)
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_2
	on kj_uusi.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_2.koulutuksen_jarjestajakoodi and kj_uusi_2.koulutuksen_jarjestaja in (select top 1 koulutuksen_jarjestaja from [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] d where d.koulutuksen_jarjestajakoodi=kj_uusi_2.koulutuksen_jarjestajakoodi)
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_3
	on kj_uusi_2.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_3.koulutuksen_jarjestajakoodi and kj_uusi_3.koulutuksen_jarjestaja in (select top 1 koulutuksen_jarjestaja from [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] d where d.koulutuksen_jarjestajakoodi=kj_uusi_3.koulutuksen_jarjestajakoodi)
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_4
	on kj_uusi_3.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_4.koulutuksen_jarjestajakoodi and kj_uusi_4.koulutuksen_jarjestaja in (select top 1 koulutuksen_jarjestaja from [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] d where d.koulutuksen_jarjestajakoodi=kj_uusi_4.koulutuksen_jarjestajakoodi)
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_5
	on kj_uusi_4.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_5.koulutuksen_jarjestajakoodi and kj_uusi_5.koulutuksen_jarjestaja in (select top 1 koulutuksen_jarjestaja from [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] d where d.koulutuksen_jarjestajakoodi=kj_uusi_5.koulutuksen_jarjestajakoodi)
  left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] kj_uusi_6
	on kj_uusi_5.koulutuksen_jarjestajan_korvaavakoodi = kj_uusi_6.koulutuksen_jarjestajakoodi and kj_uusi_6.koulutuksen_jarjestaja in (select top 1 koulutuksen_jarjestaja from [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] d where d.koulutuksen_jarjestajakoodi=kj_uusi_6.koulutuksen_jarjestajakoodi)
*/



' 
GO
/****** Object:  View [dbo].[v_alueluokitus_nykytila_koodiaeikorvattu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] AS

-- CSC Jarmo 24.3.2014

-- Palautetaan dimension nykytila
-- HUOM [VipunenTK].[dbo].[d_alueluokitus_historia] pitää olla olemassa
-- Näkymän avaimena on alueluokitus_avain
-- Kenttien luotu, alkaa ja paattyy tietoja ei enää tarvita hauissa
--
-- Select * from VipunenTK..[v_alueluokitus_nykytila_koodiaeikorvattu]

SELECT [id]
      --,[luotu]
      --,[alkaa]
      --,[paattyy]
      ,d.[alueluokitus_avain]
      ,d.[kunta_koodi]
      ,[viimeisin_tilv]
      ,[liitoskunta_koodi]
      ,[kunta]
      ,[kunta_SV]
      ,[kunta_EN]
      ,[maakunta_koodi]
      ,[maakunta]
      ,[maakunta_SV]
      ,[maakunta_EN]
      ,[avi_koodi]
      ,[avi]
      ,[avi_SV]
      ,[avi_EN]
      ,[ely_koodi]
      ,[ely]
      ,[ely_SV]
      ,[ely_EN]
      ,[seutukunta_koodi]
      ,[seutukunta]
      ,[seutukunta_SV]
      ,[seutukunta_EN]
      ,[suuralue_koodi]
      ,[suuralue]
      ,[suuralue_SV]
      ,[suuralue_EN]
      ,[kuntaryhma_koodi]
      ,[kuntaryhma]
      ,[kuntaryhma_SV]
      ,[kuntaryhma_EN]
      ,[laani_koodi]
      ,[laani]
      ,[laani_SV]
      ,[laani_EN]
      ,[tyovoima_elinkeinokeskus_koodi]
      ,[tyovoima_elinkeinokeskus]
      ,[tyovoima_elinkeinokeskus_SV]
      ,[tyovoima_elinkeinokeskus_EN]
      ,[kielisuhde_koodi]
      ,[kielisuhde]
      ,[kielisuhde_SV]
      ,[kielisuhde_EN]
      ,[mannersuomi_ahvenanmaa_koodi]
      ,[mannersuomi_ahvenanmaa]
      ,[mannersuomi_ahvenanmaa_SV]
      ,[mannersuomi_ahvenanmaa_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[jarjestys]
      ,[jarjestys_maakunta]
      ,[jarjestys_avi]
      ,[jarjestys_ely]
      ,[jarjestys_seutukunta]
      ,[jarjestys_suuralue]
      ,[jarjestys_kuntaryhma]
      ,[jarjestys_laani]
      ,[jarjestys_tyovoima_elinkeinokeskus]
      ,[jarjestys_kielisuhde]
      ,[jarjestys_mannersuomi_ahvenanmaa]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK].[dbo].[d_alueluokitus_historia] d
JOIN ( Select 
			alueluokitus_avain
			,viimeinen_paattyy = max(paattyy)
		 from [VipunenTK].[dbo].[d_alueluokitus_historia] 
		 group by alueluokitus_avain
	 ) d_paattyy
	ON d_paattyy.alueluokitus_avain = d.alueluokitus_avain
WHERE d.paattyy = d_paattyy.viimeinen_paattyy
' 
GO
/****** Object:  View [dbo].[v_alueluokitus_nykytila]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_alueluokitus_nykytila]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_alueluokitus_nykytila] AS
/*
-- HUOM [VipunenTK].[dbo].[d_alueluokitus_historia] pitää olla olemassa
Drop table VipunenTK.dbo.d_alueluokitus_nykytila
Select * into VipunenTK.dbo.d_alueluokitus_nykytila from VipunenTK_DW.dbo.v_alueluokitus_nykytila
Truncate table VipunenTK.dbo.d_alueluokitus_nykytila
Insert into VipunenTK.dbo.d_alueluokitus_nykytila
  Select * from VipunenTK_DW.dbo.v_alueluokitus_nykytila
*/

SELECT al.id
      ,al.alueluokitus_avain
      ,al.kunta_koodi
      --,[viimeisin_tilv]
      ,[liitoskunta_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.liitoskunta_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.liitoskunta_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.liitoskunta_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.liitoskunta_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.liitoskunta_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.liitoskunta_koodi else NULL end
      ,[kunta] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kunta when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kunta when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kunta when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kunta when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kunta when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kunta else al.kunta end 
      ,[kunta_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kunta_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kunta_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kunta_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kunta_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kunta_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kunta_SV else al.kunta_SV end
      ,[kunta_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kunta_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kunta_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kunta_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kunta_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kunta_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kunta_EN else al.kunta_EN end
      ,[maakunta_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.maakunta_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.maakunta_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.maakunta_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.maakunta_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.maakunta_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.maakunta_koodi else al.maakunta_koodi end
      ,[maakunta] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.maakunta when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.maakunta when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.maakunta when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.maakunta when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.maakunta when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.maakunta else al.maakunta end
      ,[maakunta_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.maakunta_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.maakunta_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.maakunta_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.maakunta_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.maakunta_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.maakunta_SV else al.maakunta_SV end
      ,[maakunta_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.maakunta_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.maakunta_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.maakunta_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.maakunta_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.maakunta_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.maakunta_EN else al.maakunta_EN end
      ,[avi_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.avi_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.avi_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.avi_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.avi_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.avi_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.avi_koodi else al.avi_koodi end
      ,[avi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.avi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.avi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.avi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.avi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.avi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.avi else al.avi end
      ,[avi_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.avi_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.avi_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.avi_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.avi_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.avi_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.avi_SV else al.avi_SV end
      ,[avi_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.avi_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.avi_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.avi_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.avi_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.avi_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.avi_EN else al.avi_EN end
      ,[ely_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.ely_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.ely_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.ely_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.ely_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.ely_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.ely_koodi else al.ely_koodi end
      ,[ely] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.ely when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.ely when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.ely when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.ely when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.ely when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.ely else al.ely end
      ,[ely_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.ely_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.ely_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.ely_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.ely_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.ely_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.ely_SV else al.ely_SV end
      ,[ely_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.ely_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.ely_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.ely_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.ely_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.ely_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.ely_EN else al.ely_EN end
      ,[seutukunta_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.seutukunta_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.seutukunta_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.seutukunta_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.seutukunta_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.seutukunta_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.seutukunta_koodi else al.seutukunta_koodi end
      ,[seutukunta] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.seutukunta when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.seutukunta when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.seutukunta when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.seutukunta when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.seutukunta when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.seutukunta else al.seutukunta end
      ,[seutukunta_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.seutukunta_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.seutukunta_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.seutukunta_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.seutukunta_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.seutukunta_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.seutukunta_SV else al.seutukunta_SV end
      ,[seutukunta_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.seutukunta_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.seutukunta_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.seutukunta_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.seutukunta_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.seutukunta_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.seutukunta_EN else al.seutukunta_EN end
      ,[suuralue_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.suuralue_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.suuralue_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.suuralue_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.suuralue_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.suuralue_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.suuralue_koodi else al.suuralue_koodi end
      ,[suuralue] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.suuralue when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.suuralue when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.suuralue when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.suuralue when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.suuralue when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.suuralue else al.suuralue end
      ,[suuralue_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.suuralue_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.suuralue_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.suuralue_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.suuralue_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.suuralue_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.suuralue_SV else al.suuralue_SV end
      ,[suuralue_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.suuralue_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.suuralue_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.suuralue_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.suuralue_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.suuralue_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.suuralue_EN else al.suuralue_EN end
      ,[kuntaryhma_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kuntaryhma_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kuntaryhma_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kuntaryhma_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kuntaryhma_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kuntaryhma_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kuntaryhma_koodi else al.kuntaryhma_koodi end
      ,[kuntaryhma] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kuntaryhma when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kuntaryhma when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kuntaryhma when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kuntaryhma when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kuntaryhma when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kuntaryhma else al.kuntaryhma end
      ,[kuntaryhma_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kuntaryhma_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kuntaryhma_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kuntaryhma_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kuntaryhma_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kuntaryhma_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kuntaryhma_SV else al.kuntaryhma_SV end
      ,[kuntaryhma_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kuntaryhma_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kuntaryhma_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kuntaryhma_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kuntaryhma_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kuntaryhma_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kuntaryhma_EN else al.kuntaryhma_EN end
      ,[laani_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.laani_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.laani_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.laani_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.laani_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.laani_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.laani_koodi else al.laani_koodi end
      ,[laani] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.laani when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.laani when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.laani when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.laani when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.laani when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.laani else al.laani end
      ,[laani_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.laani_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.laani_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.laani_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.laani_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.laani_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.laani_SV else al.laani_SV end
      ,[laani_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.laani_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.laani_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.laani_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.laani_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.laani_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.laani_EN else al.laani_EN end
      ,[tyovoima_elinkeinokeskus_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.tyovoima_elinkeinokeskus_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.tyovoima_elinkeinokeskus_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.tyovoima_elinkeinokeskus_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.tyovoima_elinkeinokeskus_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.tyovoima_elinkeinokeskus_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.tyovoima_elinkeinokeskus_koodi else al.tyovoima_elinkeinokeskus_koodi end
      ,[tyovoima_elinkeinokeskus] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.tyovoima_elinkeinokeskus when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.tyovoima_elinkeinokeskus when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.tyovoima_elinkeinokeskus when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.tyovoima_elinkeinokeskus when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.tyovoima_elinkeinokeskus when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.tyovoima_elinkeinokeskus else al.tyovoima_elinkeinokeskus end
      ,[tyovoima_elinkeinokeskus_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.tyovoima_elinkeinokeskus_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.tyovoima_elinkeinokeskus_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.tyovoima_elinkeinokeskus_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.tyovoima_elinkeinokeskus_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.tyovoima_elinkeinokeskus_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.tyovoima_elinkeinokeskus_SV else al.tyovoima_elinkeinokeskus_SV end
      ,[tyovoima_elinkeinokeskus_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.tyovoima_elinkeinokeskus_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.tyovoima_elinkeinokeskus_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.tyovoima_elinkeinokeskus_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.tyovoima_elinkeinokeskus_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.tyovoima_elinkeinokeskus_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.tyovoima_elinkeinokeskus_EN else al.tyovoima_elinkeinokeskus_EN end
      ,[kielisuhde_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kielisuhde_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kielisuhde_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kielisuhde_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kielisuhde_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kielisuhde_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kielisuhde_koodi else al.kielisuhde_koodi end
      ,[kielisuhde] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kielisuhde when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kielisuhde when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kielisuhde when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kielisuhde when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kielisuhde when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kielisuhde else al.kielisuhde end
      ,[kielisuhde_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kielisuhde_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kielisuhde_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kielisuhde_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kielisuhde_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kielisuhde_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kielisuhde_SV else al.kielisuhde_SV end
      ,[kielisuhde_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.kielisuhde_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.kielisuhde_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.kielisuhde_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.kielisuhde_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.kielisuhde_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.kielisuhde_EN else al.kielisuhde_EN end
      ,[mannersuomi_ahvenanmaa_koodi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.mannersuomi_ahvenanmaa_koodi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.mannersuomi_ahvenanmaa_koodi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.mannersuomi_ahvenanmaa_koodi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.mannersuomi_ahvenanmaa_koodi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.mannersuomi_ahvenanmaa_koodi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.mannersuomi_ahvenanmaa_koodi else al.mannersuomi_ahvenanmaa_koodi end
      ,[mannersuomi_ahvenanmaa] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.mannersuomi_ahvenanmaa when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.mannersuomi_ahvenanmaa when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.mannersuomi_ahvenanmaa when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.mannersuomi_ahvenanmaa when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.mannersuomi_ahvenanmaa when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.mannersuomi_ahvenanmaa else al.mannersuomi_ahvenanmaa end
      ,[mannersuomi_ahvenanmaa_SV] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.mannersuomi_ahvenanmaa_SV when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.mannersuomi_ahvenanmaa_SV when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.mannersuomi_ahvenanmaa_SV when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.mannersuomi_ahvenanmaa_SV when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.mannersuomi_ahvenanmaa_SV when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.mannersuomi_ahvenanmaa_SV else al.mannersuomi_ahvenanmaa_SV end
      ,[mannersuomi_ahvenanmaa_EN] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.mannersuomi_ahvenanmaa_EN when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.mannersuomi_ahvenanmaa_EN when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.mannersuomi_ahvenanmaa_EN when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.mannersuomi_ahvenanmaa_EN when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.mannersuomi_ahvenanmaa_EN when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.mannersuomi_ahvenanmaa_EN else al.mannersuomi_ahvenanmaa_EN end
      ,[SCD_alkaa] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.SCD_alkaa when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.SCD_alkaa when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.SCD_alkaa when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.SCD_alkaa when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.SCD_alkaa when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.SCD_alkaa else al.SCD_alkaa end
      ,[SCD_paattyy] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.SCD_paattyy when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.SCD_paattyy when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.SCD_paattyy when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.SCD_paattyy when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.SCD_paattyy when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.SCD_paattyy else al.SCD_paattyy end
      ,[jarjestys] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys else al.jarjestys end
      ,[jarjestys_maakunta] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_maakunta when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_maakunta when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_maakunta when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_maakunta when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_maakunta when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_maakunta else al.jarjestys_maakunta end
      ,[jarjestys_avi] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_avi when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_avi when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_avi when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_avi when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_avi when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_avi else al.jarjestys_avi end
      ,[jarjestys_ely] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_ely when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_ely when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_ely when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_ely when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_ely when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_ely else al.jarjestys_ely end
      ,[jarjestys_seutukunta] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_seutukunta when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_seutukunta when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_seutukunta when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_seutukunta when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_seutukunta when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_seutukunta else al.jarjestys_seutukunta end
      ,[jarjestys_suuralue] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_suuralue when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_suuralue when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_suuralue when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_suuralue when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_suuralue when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_suuralue else al.jarjestys_suuralue end
      ,[jarjestys_kuntaryhma] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_kuntaryhma when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_kuntaryhma when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_kuntaryhma when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_kuntaryhma when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_kuntaryhma when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_kuntaryhma else al.jarjestys_kuntaryhma end
      ,[jarjestys_laani] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_laani when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_laani when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_laani when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_laani when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_laani when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_laani else al.jarjestys_laani end
      ,[jarjestys_tyovoima_elinkeinokeskus] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_tyovoima_elinkeinokeskus when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_tyovoima_elinkeinokeskus when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_tyovoima_elinkeinokeskus when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_tyovoima_elinkeinokeskus when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_tyovoima_elinkeinokeskus when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_tyovoima_elinkeinokeskus else al.jarjestys_tyovoima_elinkeinokeskus end
      ,[jarjestys_kielisuhde] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_kielisuhde when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_kielisuhde when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_kielisuhde when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_kielisuhde when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_kielisuhde when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_kielisuhde else al.jarjestys_kielisuhde end
      ,[jarjestys_mannersuomi_ahvenanmaa] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.jarjestys_mannersuomi_ahvenanmaa when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.jarjestys_mannersuomi_ahvenanmaa when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.jarjestys_mannersuomi_ahvenanmaa when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.jarjestys_mannersuomi_ahvenanmaa when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.jarjestys_mannersuomi_ahvenanmaa when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.jarjestys_mannersuomi_ahvenanmaa else al.jarjestys_mannersuomi_ahvenanmaa end
      ,[virhetilanne] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.virhetilanne when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.virhetilanne when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.virhetilanne when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.virhetilanne when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.virhetilanne when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.virhetilanne else al.virhetilanne end
      ,[tietolahde] = Case when al_uusi_6.liitoskunta_koodi IS NOT NULL then al_uusi_6.tietolahde when al_uusi_5.liitoskunta_koodi IS NOT NULL then al_uusi_5.tietolahde when al_uusi_4.liitoskunta_koodi IS NOT NULL then al_uusi_4.tietolahde when al_uusi_3.liitoskunta_koodi IS NOT NULL then al_uusi_3.tietolahde when al_uusi_2.liitoskunta_koodi IS NOT NULL then al_uusi_2.tietolahde when al_uusi.liitoskunta_koodi IS NOT NULL then al_uusi.tietolahde else al.tietolahde end
  FROM [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al


  left join [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al_uusi
	on al.liitoskunta_koodi = al_uusi.alueluokitus_avain
  left join [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al_uusi_2
	on al_uusi.liitoskunta_koodi = al_uusi_2.alueluokitus_avain
  left join [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al_uusi_3
	on al_uusi_2.liitoskunta_koodi = al_uusi_3.alueluokitus_avain
  left join [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al_uusi_4
	on al_uusi_3.liitoskunta_koodi = al_uusi_4.alueluokitus_avain
  left join [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al_uusi_5
	on al_uusi_4.liitoskunta_koodi = al_uusi_5.alueluokitus_avain
  left join [VipunenTK_DW].[dbo].[v_alueluokitus_nykytila_koodiaeikorvattu] al_uusi_6
	on al_uusi_5.liitoskunta_koodi = al_uusi_6.alueluokitus_avain


' 
GO
/****** Object:  View [dbo].[v_f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin] AS

/*** surrogaatit ***

TK-kanta ladataan näkymästä v_f_elakkeelle_siirtyneet_ja_kuolleet

***/


SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,f.[ika]
      ,[elaji]
      ,[elk_koodi]      
      ,f.[ptoim1r8_2x]
      ,[tmaak2x]
      ,[amm2001_m1_2x]
      ,[amm2001_m2_2x]
      ,f.[tietolahde]
      ,[rivinumero]      
      ,f.[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,lkm_yht = [lkm]
      ,NULL as lkm_elakkeelle_siirtyneet
      ,NULL as lkm_kuolleet
      
  FROM [VipunenTK_DW].[dbo].[f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin] f

UNION ALL

SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,f.[ika]
      ,[elaji]
      ,[elk_koodi]      
      ,f.[ptoim1r8_2x]
      ,[tmaak2x]
      ,[amm2001_m1_2x]
      ,[amm2001_m2_2x]
      ,f.[tietolahde]
      ,[rivinumero]      
      ,f.[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,NULL as lkm_yht
      ,[lkm] as lkm_elakkeelle_siirtyneet
      ,NULL as lkm_kuolleet
      
  FROM [VipunenTK_DW].[dbo].[f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin] f
  WHERE lahde = ''E''


UNION ALL

SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,f.[ika]
      ,[elaji]
      ,[elk_koodi]      
      ,f.[ptoim1r8_2x]
      ,[tmaak2x]
      ,[amm2001_m1_2x]
      ,[amm2001_m2_2x]
      ,f.[tietolahde]
      ,[rivinumero]      
      ,f.[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,NULL as lkm_yht
      ,NULL as lkm_elakkeelle_siirtyneet
      ,[lkm] as lkm_kuolleet
      
  FROM [VipunenTK_DW].[dbo].[f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin] f
  WHERE lahde = ''K''
' 
GO
/****** Object:  View [dbo].[v_f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti] AS

/*** surrogaatit ***

TK-kanta ladataan näkymästä v_f_elakkeelle_siirtyneet_ja_kuolleet

***/


SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,f.[ika]
      ,[elaji] 
      ,[elk_koodi]
      ,f.[ptoim1r8x]
      ,[tmaakx]
      ,[amm2001_m1x]
      ,[amm2001_m2x]
      ,f.[tietolahde]
      ,[rivinumero]
      ,f.[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,lkm_yht = [lkm]
      ,NULL as lkm_elakkeelle_siirtyneet
      ,NULL as lkm_kuolleet
      
  FROM [VipunenTK_DW].[dbo].[f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti] f


UNION ALL

SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,f.[ika]
      ,[elaji] 
      ,[elk_koodi]
      ,f.[ptoim1r8x]
      ,[tmaakx]
      ,[amm2001_m1x]
      ,[amm2001_m2x]
      ,f.[tietolahde]
      ,[rivinumero]
      ,f.[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,NULL as lkm_yht
      ,[lkm] as lkm_elakkeelle_siirtyneet
      ,NULL as lkm_kuolleet
      
  FROM [VipunenTK_DW].[dbo].[f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti] f
  WHERE lahde = ''E''

UNION ALL

SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,f.[ika]
      ,[elaji] 
      ,[elk_koodi]      
      ,f.[ptoim1r8x]
      ,[tmaakx]
      ,[amm2001_m1x]
      ,[amm2001_m2x]
      ,f.[tietolahde]
      ,[rivinumero]
      ,f.[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,NULL as lkm_yht
      ,NULL as lkm_elakkeelle_siirtyneet
      ,[lkm] as lkm_kuolleet
      
  FROM [VipunenTK_DW].[dbo].[f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti] f
  WHERE lahde = ''K''
' 
GO
/****** Object:  View [dbo].[v_f_elakkeelle_siirtyneet_ja_kuolleet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_elakkeelle_siirtyneet_ja_kuolleet]'))
EXEC dbo.sp_executesql @statement = N'
/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_f_elakkeelle_siirtyneet_ja_kuolleet] AS

/*** 

delete from VipunenTK.dbo.f_elakkeelle_siirtyneet_ja_kuolleet
Insert into VipunenTK.dbo.f_elakkeelle_siirtyneet_ja_kuolleet
select * from [dbo].[v_f_elakkeelle_siirtyneet_ja_kuolleet]

***/

SELECT [tilv]
      ,[tilv_date]
      ,[sukupuoli_id]=ISNULL(d7.id,-2)       
      ,[aidinkieli_versio1_id]=ISNULL(d1.id,-2)      
      ,[ika_id]=ISNULL(d2.id,''-2'')      
      ,[elakkeelle_siirtynyt_tai_kuollut_id]=ISNULL(d8.id,-2)            
      ,paaasiallinen_toiminta_id =ISNULL(d5.id,-2)
      ,[alueluokitus_id]=ISNULL(d3.id,-2)
      ,[alueluokitus_historia_id]=ISNULL(d3h.id,-2)
      ,[mitenna_ammatti_id]=ISNULL(d4.id,-2)
      ,[tietojen_ajankohta_id]=ISNULL(d6.id,-2)
      ,[tiet_ak]      
      ,[tiet_akdate]
      ,[lkm_yht]
      ,[lkm_elakkeelle_siirtyneet]
      ,[lkm_kuolleet]

  FROM 
  
  (
  
  SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,[ika]
      ,[elaji] 
      ,[elk_koodi]
      ,[ptoim1r8x]
      ,[tmaakx]
      ,[amm2001_m1x]
      ,[amm2001_m2x]
      ,[tietolahde]
      ,[rivinumero]
      ,[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,lkm_yht
      ,lkm_elakkeelle_siirtyneet
      ,lkm_kuolleet
      
FROM [VipunenTK_DW].[dbo].[v_f_R4_17_Elakkeelle_siirt_ja_heidan_ammatti]
  
UNION ALL
  
SELECT [tilv]
      ,[tilv_date]
      ,[lahde]
      ,[sp]
      ,[aikielir1]
      ,[ika]
      ,[elaji]
      ,[elk_koodi]      
      ,[ptoim1r8_2x]
      ,[tmaak2x]
      ,[amm2001_m1_2x]
      ,[amm2001_m2_2x]
      ,[tietolahde]
      ,[rivinumero]      
      ,[tietojen_ajankohta]
      ,[tiet_ak]
      ,[tiet_akdate]
      ,[aineisto]
      ,lkm_yht
      ,lkm_elakkeelle_siirtyneet
      ,lkm_kuolleet
      
FROM [VipunenTK_DW].[dbo].[v_f_R4_18_Elakkeelle_siirt_ja_heidan_ammatti_2v_aiemmin]
  
  ) f

  LEFT JOIN VipunenTK..d_aidinkieli_versio1 d1
	on d1.aidinkieli_versio1_koodi=f.aikielir1
	and f.tilv_date between d1.alkaa and d1.paattyy	
	
  LEFT JOIN VipunenTK..d_ika d2
	on d2.ika_avain=f.ika

  LEFT JOIN VipunenTK..d_alueluokitus d3
	on d3.alueluokitus_avain = ''MAAK'' + f.tmaakx
	
  LEFT JOIN VipunenTK..d_alueluokitus_historia d3h
	on d3h.alueluokitus_avain = ''MAAK'' + f.tmaakx
	and f.tilv_date between d3h.alkaa and d3h.paattyy	


  LEFT JOIN VipunenTK..d_mitenna_ammatti d4
	on d4.mitenna_ammatti_koodi = f.[amm2001_m2x]
	and f.tilv_date between d4.alkaa and d4.paattyy

  LEFT JOIN VipunenTK..d_paaasiallinen_toiminta d5
	on d5.paaasiallinen_toiminta_koodi = f.[ptoim1r8x]
	and f.tilv_date between d5.alkaa and d5.paattyy
	
  LEFT JOIN VipunenTK..d_tietojen_ajankohta d6
    on d6.tietojen_ajankohta_koodi = f.tietojen_ajankohta

  LEFT JOIN VipunenTK..d_sukupuoli d7
    on d7.sukupuoli_koodi = f.sp

  LEFT JOIN VipunenTK..d_elakkeelle_siirtynyt_tai_kuollut d8
    on d8.elakkeelle_siirtynyt_tai_kuollut_koodi = f.elk_koodi

' 
GO
/****** Object:  View [dbo].[v_koulutusluokitus_nykytila_koodiaeikorvattu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusluokitus_nykytila_koodiaeikorvattu]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_koulutusluokitus_nykytila_koodiaeikorvattu] AS

-- CSC Jarmo 24.3.2014

-- Palautetaan dimension nykytila
-- HUOM [VipunenTK].[dbo].[d_koulutusluokitus_historia] pitää olla olemassa
-- Näkymän avaimena on alueluokitus_avain
-- Kenttien luotu, alkaa ja paattyy tietoja ei enää tarvita hauissa
--
-- Select * from VipunenTK_DW..[v_koulutusluokitus_nykytila_koodiaeikorvattu]

-- CSC Jarmo 25.5.2015
-- Muutetaan opintoala1995 kuvauksen haku niin, että vanhojen poistuneidenkin koulutuskoodien opintoala1995 kuvaukset päivitetään nykytilaan.
-- Tehdään sama muutos koulutusaloille
-- Select distinct [opintoala1995_koodi], [opintoala1995] from VipunenTK_DW..[v_koulutusluokitus_nykytila_koodiaeikorvattu] order by 1,2
-- Select distinct [opintoala2002_koodi], [opintoala2002] from VipunenTK_DW..[v_koulutusluokitus_nykytila_koodiaeikorvattu] order by 1,2
-- Select distinct [koulutusala_koodi], [koulutusala] from VipunenTK_DW..[v_koulutusluokitus_nykytila_koodiaeikorvattu] order by 1,2
-- Select distinct [koulutusala2002_koodi], [koulutusala2002] from VipunenTK_DW..[v_koulutusluokitus_nykytila_koodiaeikorvattu] order by 1,2


SELECT [id]
      --,[luotu]
      --,[alkaa]
      --,[paattyy]
      ,d.[koulutusluokitus_avain]
      ,d.[koulutus_koodi]
      ,[viimeisin_tilv]
      ,[koulutus]
      ,[koulutus_SV]
      ,[koulutus_EN]
      ,[koulutuslyhyt]
      ,[koulutuslyhyt_SV]
      ,[koulutuslyhyt_EN]
      ,[taso_koodi]
      ,[koulutusala_koodi]
      ,[koulutusala] = (Select top 1 koulutusala from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.koulutusala_koodi = d.koulutusala_koodi order by d_h.alkaa desc)
      ,[koulutusala_SV] = (Select top 1 koulutusala_SV from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.koulutusala_koodi = d.koulutusala_koodi order by d_h.alkaa desc)
      ,[koulutusala_EN] = (Select top 1 koulutusala_EN from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.koulutusala_koodi = d.koulutusala_koodi order by d_h.alkaa desc)
      ,[koulutusaste_koodi]
      ,[koulutusaste]
      ,[koulutusaste_SV]
      ,[koulutusaste_EN]
      ,[koulutusala2002_koodi]
      ,[koulutusala2002] = (Select top 1 koulutusala2002 from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.koulutusala2002_koodi = d.koulutusala2002_koodi order by d_h.alkaa desc)
      ,[koulutusala2002_SV] = (Select top 1 koulutusala2002_SV from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.koulutusala2002_koodi = d.koulutusala2002_koodi order by d_h.alkaa desc)
      ,[koulutusala2002_EN] = (Select top 1 koulutusala2002_EN from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.koulutusala2002_koodi = d.koulutusala2002_koodi order by d_h.alkaa desc)
      ,[opintoala2002_koodi]
      ,[opintoala2002] = (Select top 1 opintoala2002 from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.opintoala2002_koodi = d.opintoala2002_koodi order by d_h.alkaa desc)
      ,[opintoala2002_SV] = (Select top 1 opintoala2002_SV from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.opintoala2002_koodi = d.opintoala2002_koodi order by d_h.alkaa desc)
      ,[opintoala2002_EN] = (Select top 1 opintoala2002_EN from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.opintoala2002_koodi = d.opintoala2002_koodi order by d_h.alkaa desc)
      ,[koulutusaste2002_koodi]
      ,[koulutusaste2002]
      ,[koulutusaste2002_SV]
      ,[koulutusaste2002_EN]
      ,[koulutusala1995_koodi]
      ,[koulutusala1995]
      ,[koulutusala1995_SV]
      ,[koulutusala1995_EN]
      ,[opintoala1995_koodi]
      ,[opintoala1995] = (Select top 1 opintoala1995 from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.opintoala1995_koodi = d.opintoala1995_koodi order by d_h.alkaa desc)
      ,[opintoala1995_SV] = (Select top 1 opintoala1995_SV from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.opintoala1995_koodi = d.opintoala1995_koodi order by d_h.alkaa desc)
      ,[opintoala1995_EN] = (Select top 1 opintoala1995_EN from [VipunenTK].[dbo].[d_koulutusluokitus_historia] d_h where d_h.opintoala1995_koodi = d.opintoala1995_koodi order by d_h.alkaa desc)
      ,[koulutusaste1995_koodi]
      ,[koulutusaste1995]
      ,[koulutusaste1995_SV]
      ,[koulutusaste1995_EN]
      ,[isclek_koodi]
      ,[isclek]
      ,[isclek_SV]
      ,[isclek_EN]
      ,[iscle_koodi]
      ,[iscle]
      ,[iscle_SV]
      ,[iscle_EN]
      ,[iscfik_koodi]
      ,[iscfik]
      ,[iscfik_SV]
      ,[iscfik_EN]
      ,[iscde_koodi]
      ,[iscde]
      ,[iscde_SV]
      ,[iscde_EN]
      ,[iscor_koodi]
      ,[iscor]
      ,[iscor_SV]
      ,[iscor_EN]
      ,[iscst_koodi]
      ,[iscst]
      ,[iscst_SV]
      ,[iscst_EN]
      ,[iscdu_koodi]
      ,[iscdu]
      ,[iscdu_SV]
      ,[iscdu_EN]
	  ,[iscle2011_koodi]
	  ,[iscle2011]
	  ,[iscle2011_SV]
	  ,[iscle2011_EN]
	  ,[isccat2011_koodi]
	  ,[isccat2011]
	  ,[isccat2011_SV]
	  ,[isccat2011_EN]
	  ,[iscsubcat2011_koodi]
	  ,[iscsubcat2011]
	  ,[iscsubcat2011_SV]
	  ,[iscsubcat2011_EN]
	  ,[iscfi2013_koodi]
	  ,[iscfi2013]
	  ,[iscfi2013_SV]
	  ,[iscfi2013_EN]
	  ,[iscfinarrow2013_koodi]
	  ,[iscfinarrow2013]
	  ,[iscfinarrow2013_SV]
	  ,[iscfinarrow2013_EN]
	  ,[iscfibroad2013_koodi]
	  ,[iscfibroad2013]
	  ,[iscfibroad2013_SV]
	  ,[iscfibroad2013_EN]
	  ,[OKM_ohjauksen_ala_koodi]
	  ,[OKM_ohjauksen_ala]
	  ,[OKM_ohjauksen_ala_SV]
	  ,[OKM_ohjauksen_ala_EN]
	  ,[OKM_ohjauksen_ala_yo_tav_koodi]
	  ,[OKM_ohjauksen_ala_yo_tav]
	  ,[OKM_ohjauksen_ala_yo_tav_SV]
	  ,[OKM_ohjauksen_ala_yo_tav_EN]
	  ,[OKM_ohjauksen_ala_amk_tav_koodi]
	  ,[OKM_ohjauksen_ala_amk_tav]
	  ,[OKM_ohjauksen_ala_amk_tav_SV]
	  ,[OKM_ohjauksen_ala_amk_tav_EN]
	  ,[Koulutusaste_taso2_koodi]
	  ,[Koulutusaste_taso2]
	  ,[Koulutusaste_taso2_SV]
	  ,[Koulutusaste_taso2_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[olo_koodi]
      ,[lakkautusvuosi]
      ,[korvaava_koulutus_koodi]
      ,[muutosvuosi]
      ,[jarjestys]
      ,[jarjestys_taso]
      ,[jarjestys_koulutusala]
      ,[jarjestys_koulutusaste]
      ,[jarjestys_koulutusala2002]
      ,[jarjestys_opintoala2002]
      ,[jarjestys_koulutusaste2002]
      ,[jarjestys_koulutusala1995]
      ,[jarjestys_opintoala1995]
      ,[jarjestys_koulutusaste1995]
      ,[jarjestys_isclek]
      ,[jarjestys_iscle]
      ,[jarjestys_iscfik]
      ,[jarjestys_iscde]
      ,[jarjestys_iscor]
      ,[jarjestys_iscst]
      ,[jarjestys_iscdu]
	  ,[jarjestys_iscle2011]
	  ,[jarjestys_isccat2011]
	  ,[jarjestys_iscsubcat2011]
	  ,[jarjestys_iscfi2013]
	  ,[jarjestys_iscfinarrow2013]
	  ,[jarjestys_iscfibroad2013]
	  ,[jarjestys_OKM_ohjauksen_ala]
	  ,[jarjestys_OKM_ohjauksen_ala_yo_tav]
	  ,[jarjestys_OKM_ohjauksen_ala_amk_tav]
	  ,[jarjestys_Koulutusaste_taso2]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK].[dbo].[d_koulutusluokitus_historia] d
JOIN ( Select 
			koulutusluokitus_avain
			,viimeinen_paattyy = max(paattyy)
		 from [VipunenTK].[dbo].[d_koulutusluokitus_historia] 
		 group by koulutusluokitus_avain
	 ) d_paattyy
	ON d_paattyy.koulutusluokitus_avain = d.koulutusluokitus_avain
WHERE d.paattyy = d_paattyy.viimeinen_paattyy



' 
GO
/****** Object:  View [dbo].[v_koulutusluokitus_nykytila]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusluokitus_nykytila]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_koulutusluokitus_nykytila] AS
/*
-- HUOM [VipunenTK].[dbo].[d_koulutusluokitus_historia] pitää olla olemassa
Drop table VipunenTK.dbo.d_koulutusluokitus_nykytila
Select * into VipunenTK.dbo.d_koulutusluokitus_nykytila from VipunenTK_DW.dbo.v_koulutusluokitus_nykytila
Truncate table VipunenTK.dbo.d_koulutusluokitus_nykytila
Insert into VipunenTK.dbo.d_koulutusluokitus_nykytila
  Select * from VipunenTK_DW.dbo.v_koulutusluokitus_nykytila
*/

SELECT [id]
      ,[koulutusluokitus_avain]
      ,[koulutus_koodi]
      --,[viimeisin_tilv]
      ,[koulutus]
      ,[koulutus_SV]
      ,[koulutus_EN]
      ,[koulutuslyhyt]
      ,[koulutuslyhyt_SV]
      ,[koulutuslyhyt_EN]
      ,[taso_koodi]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[koulutusaste_koodi]
      ,[koulutusaste]
      ,[koulutusaste_SV]
      ,[koulutusaste_EN]
      ,[koulutusala2002_koodi]
      ,[koulutusala2002]
      ,[koulutusala2002_SV]
      ,[koulutusala2002_EN]
      ,[opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[koulutusaste2002_koodi]
      ,[koulutusaste2002]
      ,[koulutusaste2002_SV]
      ,[koulutusaste2002_EN]
      ,[koulutusala1995_koodi]
      ,[koulutusala1995]
      ,[koulutusala1995_SV]
      ,[koulutusala1995_EN]
      ,[opintoala1995_koodi]
      ,[opintoala1995]
      ,[opintoala1995_SV]
      ,[opintoala1995_EN]
      ,[koulutusaste1995_koodi]
      ,[koulutusaste1995]
      ,[koulutusaste1995_SV]
      ,[koulutusaste1995_EN]
      ,[isclek_koodi]
      ,[isclek]
      ,[isclek_SV]
      ,[isclek_EN]
      ,[iscle_koodi]
      ,[iscle]
      ,[iscle_SV]
      ,[iscle_EN]
      ,[iscfik_koodi]
      ,[iscfik]
      ,[iscfik_SV]
      ,[iscfik_EN]
      ,[iscde_koodi]
      ,[iscde]
      ,[iscde_SV]
      ,[iscde_EN]
      ,[iscor_koodi]
      ,[iscor]
      ,[iscor_SV]
      ,[iscor_EN]
      ,[iscst_koodi]
      ,[iscst]
      ,[iscst_SV]
      ,[iscst_EN]
      ,[iscdu_koodi]
      ,[iscdu]
      ,[iscdu_SV]
      ,[iscdu_EN]
	  ,[iscle2011_koodi]
	  ,[iscle2011]
	  ,[iscle2011_SV]
	  ,[iscle2011_EN]
	  ,[isccat2011_koodi]
	  ,[isccat2011]
	  ,[isccat2011_SV]
	  ,[isccat2011_EN]
	  ,[iscsubcat2011_koodi]
	  ,[iscsubcat2011]
	  ,[iscsubcat2011_SV]
	  ,[iscsubcat2011_EN]
	  ,[iscfi2013_koodi]
	  ,[iscfi2013]
	  ,[iscfi2013_SV]
	  ,[iscfi2013_EN]
	  ,[iscfinarrow2013_koodi]
	  ,[iscfinarrow2013]
	  ,[iscfinarrow2013_SV]
	  ,[iscfinarrow2013_EN]
	  ,[iscfibroad2013_koodi]
	  ,[iscfibroad2013]
	  ,[iscfibroad2013_SV]
	  ,[iscfibroad2013_EN]
	  ,[OKM_ohjauksen_ala_koodi]
	  ,[OKM_ohjauksen_ala]
	  ,[OKM_ohjauksen_ala_SV]
	  ,[OKM_ohjauksen_ala_EN]
	  ,[OKM_ohjauksen_ala_yo_tav_koodi]
	  ,[OKM_ohjauksen_ala_yo_tav]
	  ,[OKM_ohjauksen_ala_yo_tav_SV]
	  ,[OKM_ohjauksen_ala_yo_tav_EN]
	  ,[OKM_ohjauksen_ala_amk_tav_koodi]
	  ,[OKM_ohjauksen_ala_amk_tav]
	  ,[OKM_ohjauksen_ala_amk_tav_SV]
	  ,[OKM_ohjauksen_ala_amk_tav_EN]
	  ,[Koulutusaste_taso2_koodi]
	  ,[Koulutusaste_taso2]
	  ,[Koulutusaste_taso2_SV]
	  ,[Koulutusaste_taso2_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[olo_koodi]
      ,[lakkautusvuosi]
      ,[korvaava_koulutus_koodi]
      ,[muutosvuosi]
      ,[jarjestys]
      ,[jarjestys_taso]
      ,[jarjestys_koulutusala]
      ,[jarjestys_koulutusaste]
      ,[jarjestys_koulutusala2002]
      ,[jarjestys_opintoala2002]
      ,[jarjestys_koulutusaste2002]
      ,[jarjestys_koulutusala1995]
      ,[jarjestys_opintoala1995]
      ,[jarjestys_koulutusaste1995]
      ,[jarjestys_isclek]
      ,[jarjestys_iscle]
      ,[jarjestys_iscfik]
      ,[jarjestys_iscde]
      ,[jarjestys_iscor]
      ,[jarjestys_iscst]
      ,[jarjestys_iscdu]
	  ,[jarjestys_iscle2011]
	  ,[jarjestys_isccat2011]
	  ,[jarjestys_iscsubcat2011]
	  ,[jarjestys_iscfi2013]
	  ,[jarjestys_iscfinarrow2013]
	  ,[jarjestys_iscfibroad2013]
	  ,[jarjestys_OKM_ohjauksen_ala]
	  ,[jarjestys_OKM_ohjauksen_ala_yo_tav]
	  ,[jarjestys_OKM_ohjauksen_ala_amk_tav]
	  ,[jarjestys_Koulutusaste_taso2]
      --,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[v_koulutusluokitus_nykytila_koodiaeikorvattu]

-- Tehdään koodien korvaus, kun korvaavassa koodissa on jotain dataa
 -- left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi
	--on ol.oppilaitoksen_korvaavakoodi = ol_uusi.oppilaitoskoodi
 -- left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_2
	--on ol_uusi.oppilaitoksen_korvaavakoodi = ol_uusi_2.oppilaitoskoodi
 -- left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_3
	--on ol_uusi_2.oppilaitoksen_korvaavakoodi = ol_uusi_3.oppilaitoskoodi
 -- left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_4
	--on ol_uusi_3.oppilaitoksen_korvaavakoodi = ol_uusi_4.oppilaitoskoodi
 -- left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_5
	--on ol_uusi_4.oppilaitoksen_korvaavakoodi = ol_uusi_5.oppilaitoskoodi
 -- left join [VipunenTK_DW].[dbo].[v_oppilaitoksen_taustatiedot_nykytila_koodiaeikorvattu] ol_uusi_6
	--on ol_uusi_5.oppilaitoksen_korvaavakoodi = ol_uusi_6.oppilaitoskoodi




' 
GO
/****** Object:  View [dbo].[_v_aloittaneiden_lapaisy_sarakeryhmat_nykytila]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[_v_aloittaneiden_lapaisy_sarakeryhmat_nykytila]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[_v_aloittaneiden_lapaisy_sarakeryhmat_nykytila] AS

SELECT [tilv]
      ,[lahde]
      ,[opp]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[klaji]
      ,[ophal]
      ,[jarj]
      ,[kkun]
      ,[maak]
      ,[koulk]
      ,[opmala]
      ,[opmopa]
      ,[opmast]
      ,[opm95opa]
      ,[koulutussektori]
      ,[pohjkoulk]
      ,[alvv_kk]
      ,[allk_kk]
      ,[ololk]
      ,[rahlahde]
      ,[koulutuslaji2]
      ,[tutkintolaji] = Case when [koulutuslaji2] in (''21'', ''22'') then ''lu''
							when [koulutuslaji2] in (''31'', ''32'', ''35'', ''36'') then ''ampt''
							when [koulutuslaji2] in (''33'', ''34'', ''37'', ''38'') then ''amlk''
							when [koulutuslaji2] in (''41'', ''42'') then ''amk''
							when [koulutuslaji2] = ''46'' then ''ylamk''
							when [koulutuslaji2] = ''51a'' then ''alkk''
							when [koulutuslaji2] = ''51b'' then ''ylkk''
							when [koulutuslaji2] = ''52'' then ''tk'' 
							else ''muu'' end
      ,[tietolahde]
      ,[aineistorivinumero]
      ,[lkm_int]
      ,[Sarakeryhma1_ID]
      ,[Sarakeryhma1_tyyppi]
      ,[Sarakeryhma1_opp]
      ,[Sarakeryhma1_opmala]
      ,[Sarakeryhma1_opmopa]
      ,[Sarakeryhma1_opmast]
      ,[Sarakeryhma1_opm95opa]
      ,[Sarakeryhma1_koulutussektori]
      ,[Sarakeryhma1_suorv]
      ,[Sarakeryhma1_suorlk]
      ,[Sarakeryhma1_kmaak]
      ,[Sarakeryhma1_olotamm]
      ,[Sarakeryhma1_olosyys]
      ,[Sarakeryhma1_ptoim1r5]
      ,[Sarakeryhma1_amas]
      ,[Sarakeryhma1_koulk]
      ,[Sarakeryhma1_jarj]
      ,[Sarakeryhma1_tutkintolaji]
      ,[Sarakeryhma2_ID]
      ,[Sarakeryhma2_tyyppi]
      ,[Sarakeryhma2_opp]
      ,[Sarakeryhma2_opmala]
      ,[Sarakeryhma2_opmopa]
      ,[Sarakeryhma2_opmast]
      ,[Sarakeryhma2_opm95opa]
      ,[Sarakeryhma2_koulutussektori]
      ,[Sarakeryhma2_suorv]
      ,[Sarakeryhma2_suorlk]
      ,[Sarakeryhma2_kmaak]
      ,[Sarakeryhma2_olotamm]
      ,[Sarakeryhma2_olosyys]
      ,[Sarakeryhma2_ptoim1r5]
      ,[Sarakeryhma2_amas]
      ,[Sarakeryhma2_koulk]
      ,[Sarakeryhma2_jarj]
      ,[Sarakeryhma2_tutkintolaji]
      ,[Sarakeryhma3_ID]
      ,[Sarakeryhma3_tyyppi]
      ,[Sarakeryhma3_opp]
      ,[Sarakeryhma3_opmala]
      ,[Sarakeryhma3_opmopa]
      ,[Sarakeryhma3_opmast]
      ,[Sarakeryhma3_opm95opa]
      ,[Sarakeryhma3_koulutussektori]
      ,[Sarakeryhma3_suorv]
      ,[Sarakeryhma3_suorlk]
      ,[Sarakeryhma3_kmaak]
      ,[Sarakeryhma3_olotamm]
      ,[Sarakeryhma3_olosyys]
      ,[Sarakeryhma3_ptoim1r5]
      ,[Sarakeryhma3_amas]
      ,[Sarakeryhma3_koulk]
      ,[Sarakeryhma3_jarj]
      ,[Sarakeryhma3_tutkintolaji]
      ,[Sarakeryhma4_ID]
      ,[Sarakeryhma4_tyyppi]
      ,[Sarakeryhma4_opp]
      ,[Sarakeryhma4_opmala]
      ,[Sarakeryhma4_opmopa]
      ,[Sarakeryhma4_opmast]
      ,[Sarakeryhma4_opm95opa]
      ,[Sarakeryhma4_koulutussektori]
      ,[Sarakeryhma4_suorv]
      ,[Sarakeryhma4_suorlk]
      ,[Sarakeryhma4_kmaak]
      ,[Sarakeryhma4_olotamm]
      ,[Sarakeryhma4_olosyys]
      ,[Sarakeryhma4_ptoim1r5]
      ,[Sarakeryhma4_amas]
      ,[Sarakeryhma4_koulk]
      ,[Sarakeryhma4_jarj]
      ,[Sarakeryhma4_tutkintolaji]
      ,[Sarakeryhma5_ID]
      ,[Sarakeryhma5_tyyppi]
      ,[Sarakeryhma5_opp]
      ,[Sarakeryhma5_opmala]
      ,[Sarakeryhma5_opmopa]
      ,[Sarakeryhma5_opmast]
      ,[Sarakeryhma5_opm95opa]
      ,[Sarakeryhma5_koulutussektori]
      ,[Sarakeryhma5_suorv]
      ,[Sarakeryhma5_suorlk]
      ,[Sarakeryhma5_kmaak]
      ,[Sarakeryhma5_olotamm]
      ,[Sarakeryhma5_olosyys]
      ,[Sarakeryhma5_ptoim1r5]
      ,[Sarakeryhma5_amas]
      ,[Sarakeryhma5_koulk]
      ,[Sarakeryhma5_jarj]
      ,[Sarakeryhma5_tutkintolaji]
      ,[Sarakeryhma6_ID]
      ,[Sarakeryhma6_tyyppi]
      ,[Sarakeryhma6_opp]
      ,[Sarakeryhma6_opmala]
      ,[Sarakeryhma6_opmopa]
      ,[Sarakeryhma6_opmast]
      ,[Sarakeryhma6_opm95opa]
      ,[Sarakeryhma6_koulutussektori]
      ,[Sarakeryhma6_suorv]
      ,[Sarakeryhma6_suorlk]
      ,[Sarakeryhma6_kmaak]
      ,[Sarakeryhma6_olotamm]
      ,[Sarakeryhma6_olosyys]
      ,[Sarakeryhma6_ptoim1r5]
      ,[Sarakeryhma6_amas]
      ,[Sarakeryhma6_koulk]
      ,[Sarakeryhma6_jarj]
      ,[Sarakeryhma6_tutkintolaji]
      ,[Sarakeryhma7_ID]
      ,[Sarakeryhma7_tyyppi]
      ,[Sarakeryhma7_opp]
      ,[Sarakeryhma7_opmala]
      ,[Sarakeryhma7_opmopa]
      ,[Sarakeryhma7_opmast]
      ,[Sarakeryhma7_opm95opa]
      ,[Sarakeryhma7_koulutussektori]
      ,[Sarakeryhma7_suorv]
      ,[Sarakeryhma7_suorlk]
      ,[Sarakeryhma7_kmaak]
      ,[Sarakeryhma7_olotamm]
      ,[Sarakeryhma7_olosyys]
      ,[Sarakeryhma7_ptoim1r5]
      ,[Sarakeryhma7_amas]
      ,[Sarakeryhma7_koulk]
      ,[Sarakeryhma7_jarj]
      ,[Sarakeryhma7_tutkintolaji]
      ,[Sarakeryhma8_ID]
      ,[Sarakeryhma8_tyyppi]
      ,[Sarakeryhma8_opp]
      ,[Sarakeryhma8_opmala]
      ,[Sarakeryhma8_opmopa]
      ,[Sarakeryhma8_opmast]
      ,[Sarakeryhma8_opm95opa]
      ,[Sarakeryhma8_koulutussektori]
      ,[Sarakeryhma8_suorv]
      ,[Sarakeryhma8_suorlk]
      ,[Sarakeryhma8_kmaak]
      ,[Sarakeryhma8_olotamm]
      ,[Sarakeryhma8_olosyys]
      ,[Sarakeryhma8_ptoim1r5]
      ,[Sarakeryhma8_amas]
      ,[Sarakeryhma8_koulk]
      ,[Sarakeryhma8_jarj]
      ,[Sarakeryhma8_tutkintolaji]
      ,[Sarakeryhma9_ID]
      ,[Sarakeryhma9_tyyppi]
      ,[Sarakeryhma9_opp]
      ,[Sarakeryhma9_opmala]
      ,[Sarakeryhma9_opmopa]
      ,[Sarakeryhma9_opmast]
      ,[Sarakeryhma9_opm95opa]
      ,[Sarakeryhma9_koulutussektori]
      ,[Sarakeryhma9_suorv]
      ,[Sarakeryhma9_suorlk]
      ,[Sarakeryhma9_kmaak]
      ,[Sarakeryhma9_olotamm]
      ,[Sarakeryhma9_olosyys]
      ,[Sarakeryhma9_ptoim1r5]
      ,[Sarakeryhma9_amas]
      ,[Sarakeryhma9_koulk]
      ,[Sarakeryhma9_jarj]
      ,[Sarakeryhma9_tutkintolaji]
      ,[Sarakeryhma10_ID]
      ,[Sarakeryhma10_tyyppi]
      ,[Sarakeryhma10_opp]
      ,[Sarakeryhma10_opmala]
      ,[Sarakeryhma10_opmopa]
      ,[Sarakeryhma10_opmast]
      ,[Sarakeryhma10_opm95opa]
      ,[Sarakeryhma10_koulutussektori]
      ,[Sarakeryhma10_suorv]
      ,[Sarakeryhma10_suorlk]
      ,[Sarakeryhma10_kmaak]
      ,[Sarakeryhma10_olotamm]
      ,[Sarakeryhma10_olosyys]
      ,[Sarakeryhma10_ptoim1r5]
      ,[Sarakeryhma10_amas]
      ,[Sarakeryhma10_koulk]
      ,[Sarakeryhma10_jarj]
      ,[Sarakeryhma10_tutkintolaji]
      ,[Sarakeryhma11_ID]
      ,[Sarakeryhma11_tyyppi]
      ,[Sarakeryhma11_opp]
      ,[Sarakeryhma11_opmala]
      ,[Sarakeryhma11_opmopa]
      ,[Sarakeryhma11_opmast]
      ,[Sarakeryhma11_opm95opa]
      ,[Sarakeryhma11_koulutussektori]
      ,[Sarakeryhma11_suorv]
      ,[Sarakeryhma11_suorlk]
      ,[Sarakeryhma11_kmaak]
      ,[Sarakeryhma11_olotamm]
      ,[Sarakeryhma11_olosyys]
      ,[Sarakeryhma11_ptoim1r5]
      ,[Sarakeryhma11_amas]
      ,[Sarakeryhma11_koulk]
      ,[Sarakeryhma11_jarj]
      ,[Sarakeryhma11_tutkintolaji]
      ,[Sarakeryhma12_ID]
      ,[Sarakeryhma12_tyyppi]
      ,[Sarakeryhma12_opp]
      ,[Sarakeryhma12_opmala]
      ,[Sarakeryhma12_opmopa]
      ,[Sarakeryhma12_opmast]
      ,[Sarakeryhma12_opm95opa]
      ,[Sarakeryhma12_koulutussektori]
      ,[Sarakeryhma12_suorv]
      ,[Sarakeryhma12_suorlk]
      ,[Sarakeryhma12_kmaak]
      ,[Sarakeryhma12_olotamm]
      ,[Sarakeryhma12_olosyys]
      ,[Sarakeryhma12_ptoim1r5]
      ,[Sarakeryhma12_amas]
      ,[Sarakeryhma12_koulk]
      ,[Sarakeryhma12_jarj]
      ,[Sarakeryhma12_tutkintolaji]
      ,[Sarakeryhma13_ID]
      ,[Sarakeryhma13_tyyppi]
      ,[Sarakeryhma13_opp]
      ,[Sarakeryhma13_opmala]
      ,[Sarakeryhma13_opmopa]
      ,[Sarakeryhma13_opmast]
      ,[Sarakeryhma13_opm95opa]
      ,[Sarakeryhma13_koulutussektori]
      ,[Sarakeryhma13_suorv]
      ,[Sarakeryhma13_suorlk]
      ,[Sarakeryhma13_kmaak]
      ,[Sarakeryhma13_olotamm]
      ,[Sarakeryhma13_olosyys]
      ,[Sarakeryhma13_ptoim1r5]
      ,[Sarakeryhma13_amas]
      ,[Sarakeryhma13_koulk]
      ,[Sarakeryhma13_jarj]
      ,[Sarakeryhma13_tutkintolaji]
      ,[Sarakeryhma14_ID]
      ,[Sarakeryhma14_tyyppi]
      ,[Sarakeryhma14_opp]
      ,[Sarakeryhma14_opmala]
      ,[Sarakeryhma14_opmopa]
      ,[Sarakeryhma14_opmast]
      ,[Sarakeryhma14_opm95opa]
      ,[Sarakeryhma14_koulutussektori]
      ,[Sarakeryhma14_suorv]
      ,[Sarakeryhma14_suorlk]
      ,[Sarakeryhma14_kmaak]
      ,[Sarakeryhma14_olotamm]
      ,[Sarakeryhma14_olosyys]
      ,[Sarakeryhma14_ptoim1r5]
      ,[Sarakeryhma14_amas]
      ,[Sarakeryhma14_koulk]
      ,[Sarakeryhma14_jarj]
      ,[Sarakeryhma14_tutkintolaji]
      ,[Sarakeryhma15_ID]
      ,[Sarakeryhma15_tyyppi]
      ,[Sarakeryhma15_opp]
      ,[Sarakeryhma15_opmala]
      ,[Sarakeryhma15_opmopa]
      ,[Sarakeryhma15_opmast]
      ,[Sarakeryhma15_opm95opa]
      ,[Sarakeryhma15_koulutussektori]
      ,[Sarakeryhma15_suorv]
      ,[Sarakeryhma15_suorlk]
      ,[Sarakeryhma15_kmaak]
      ,[Sarakeryhma15_olotamm]
      ,[Sarakeryhma15_olosyys]
      ,[Sarakeryhma15_ptoim1r5]
      ,[Sarakeryhma15_amas]
      ,[Sarakeryhma15_koulk]
      ,[Sarakeryhma15_jarj]
      ,[Sarakeryhma15_tutkintolaji]
      ,[Sarakeryhma16_ID]
      ,[Sarakeryhma16_tyyppi]
      ,[Sarakeryhma16_opp]
      ,[Sarakeryhma16_opmala]
      ,[Sarakeryhma16_opmopa]
      ,[Sarakeryhma16_opmast]
      ,[Sarakeryhma16_opm95opa]
      ,[Sarakeryhma16_koulutussektori]
      ,[Sarakeryhma16_suorv]
      ,[Sarakeryhma16_suorlk]
      ,[Sarakeryhma16_kmaak]
      ,[Sarakeryhma16_olotamm]
      ,[Sarakeryhma16_olosyys]
      ,[Sarakeryhma16_ptoim1r5]
      ,[Sarakeryhma16_amas]
      ,[Sarakeryhma16_koulk]
      ,[Sarakeryhma16_jarj]
      ,[Sarakeryhma16_tutkintolaji]
      ,[Sarakeryhma17_ID]
      ,[Sarakeryhma17_tyyppi]
      ,[Sarakeryhma17_opp]
      ,[Sarakeryhma17_opmala]
      ,[Sarakeryhma17_opmopa]
      ,[Sarakeryhma17_opmast]
      ,[Sarakeryhma17_opm95opa]
      ,[Sarakeryhma17_koulutussektori]
      ,[Sarakeryhma17_suorv]
      ,[Sarakeryhma17_suorlk]
      ,[Sarakeryhma17_kmaak]
      ,[Sarakeryhma17_olotamm]
      ,[Sarakeryhma17_olosyys]
      ,[Sarakeryhma17_ptoim1r5]
      ,[Sarakeryhma17_amas]
      ,[Sarakeryhma17_koulk]
      ,[Sarakeryhma17_jarj]
      ,[Sarakeryhma17_tutkintolaji]
      ,[Sarakeryhma18_ID]
      ,[Sarakeryhma18_tyyppi]
      ,[Sarakeryhma18_opp]
      ,[Sarakeryhma18_opmala]
      ,[Sarakeryhma18_opmopa]
      ,[Sarakeryhma18_opmast]
      ,[Sarakeryhma18_opm95opa]
      ,[Sarakeryhma18_koulutussektori]
      ,[Sarakeryhma18_suorv]
      ,[Sarakeryhma18_suorlk]
      ,[Sarakeryhma18_kmaak]
      ,[Sarakeryhma18_olotamm]
      ,[Sarakeryhma18_olosyys]
      ,[Sarakeryhma18_ptoim1r5]
      ,[Sarakeryhma18_amas]
      ,[Sarakeryhma18_koulk]
      ,[Sarakeryhma18_jarj]
      ,[Sarakeryhma18_tutkintolaji]
      ,[Sarakeryhma19_ID]
      ,[Sarakeryhma19_tyyppi]
      ,[Sarakeryhma19_opp]
      ,[Sarakeryhma19_opmala]
      ,[Sarakeryhma19_opmopa]
      ,[Sarakeryhma19_opmast]
      ,[Sarakeryhma19_opm95opa]
      ,[Sarakeryhma19_koulutussektori]
      ,[Sarakeryhma19_suorv]
      ,[Sarakeryhma19_suorlk]
      ,[Sarakeryhma19_kmaak]
      ,[Sarakeryhma19_olotamm]
      ,[Sarakeryhma19_olosyys]
      ,[Sarakeryhma19_ptoim1r5]
      ,[Sarakeryhma19_amas]
      ,[Sarakeryhma19_koulk]
      ,[Sarakeryhma19_jarj]
      ,[Sarakeryhma19_tutkintolaji]
      ,[Sarakeryhma20_ID]
      ,[Sarakeryhma20_tyyppi]
      ,[Sarakeryhma20_opp]
      ,[Sarakeryhma20_opmala]
      ,[Sarakeryhma20_opmopa]
      ,[Sarakeryhma20_opmast]
      ,[Sarakeryhma20_opm95opa]
      ,[Sarakeryhma20_koulutussektori]
      ,[Sarakeryhma20_suorv]
      ,[Sarakeryhma20_suorlk]
      ,[Sarakeryhma20_kmaak]
      ,[Sarakeryhma20_olotamm]
      ,[Sarakeryhma20_olosyys]
      ,[Sarakeryhma20_ptoim1r5]
      ,[Sarakeryhma20_amas]
      ,[Sarakeryhma20_koulk]
      ,[Sarakeryhma20_jarj]
      ,[Sarakeryhma20_tutkintolaji]
      ,[Sarakeryhma21_ID]
      ,[Sarakeryhma21_tyyppi]
      ,[Sarakeryhma21_opp]
      ,[Sarakeryhma21_opmala]
      ,[Sarakeryhma21_opmopa]
      ,[Sarakeryhma21_opmast]
      ,[Sarakeryhma21_opm95opa]
      ,[Sarakeryhma21_koulutussektori]
      ,[Sarakeryhma21_suorv]
      ,[Sarakeryhma21_suorlk]
      ,[Sarakeryhma21_kmaak]
      ,[Sarakeryhma21_olotamm]
      ,[Sarakeryhma21_olosyys]
      ,[Sarakeryhma21_ptoim1r5]
      ,[Sarakeryhma21_amas]
      ,[Sarakeryhma21_koulk]
      ,[Sarakeryhma21_jarj]
      ,[Sarakeryhma21_tutkintolaji]
      ,[Sarakeryhma22_ID]
      ,[Sarakeryhma22_tyyppi]
      ,[Sarakeryhma22_opp]
      ,[Sarakeryhma22_opmala]
      ,[Sarakeryhma22_opmopa]
      ,[Sarakeryhma22_opmast]
      ,[Sarakeryhma22_opm95opa]
      ,[Sarakeryhma22_koulutussektori]
      ,[Sarakeryhma22_suorv]
      ,[Sarakeryhma22_suorlk]
      ,[Sarakeryhma22_kmaak]
      ,[Sarakeryhma22_olotamm]
      ,[Sarakeryhma22_olosyys]
      ,[Sarakeryhma22_ptoim1r5]
      ,[Sarakeryhma22_amas]
      ,[Sarakeryhma22_koulk]
      ,[Sarakeryhma22_jarj]
      ,[Sarakeryhma22_tutkintolaji]
      ,[Sarakeryhma23_ID]
      ,[Sarakeryhma23_tyyppi]
      ,[Sarakeryhma23_opp]
      ,[Sarakeryhma23_opmala]
      ,[Sarakeryhma23_opmopa]
      ,[Sarakeryhma23_opmast]
      ,[Sarakeryhma23_opm95opa]
      ,[Sarakeryhma23_koulutussektori]
      ,[Sarakeryhma23_suorv]
      ,[Sarakeryhma23_suorlk]
      ,[Sarakeryhma23_kmaak]
      ,[Sarakeryhma23_olotamm]
      ,[Sarakeryhma23_olosyys]
      ,[Sarakeryhma23_ptoim1r5]
      ,[Sarakeryhma23_amas]
      ,[Sarakeryhma23_koulk]
      ,[Sarakeryhma23_jarj]
      ,[Sarakeryhma23_tutkintolaji]
      ,[Sarakeryhma24_ID]
      ,[Sarakeryhma24_tyyppi]
      ,[Sarakeryhma24_opp]
      ,[Sarakeryhma24_opmala]
      ,[Sarakeryhma24_opmopa]
      ,[Sarakeryhma24_opmast]
      ,[Sarakeryhma24_opm95opa]
      ,[Sarakeryhma24_koulutussektori]
      ,[Sarakeryhma24_suorv]
      ,[Sarakeryhma24_suorlk]
      ,[Sarakeryhma24_kmaak]
      ,[Sarakeryhma24_olotamm]
      ,[Sarakeryhma24_olosyys]
      ,[Sarakeryhma24_ptoim1r5]
      ,[Sarakeryhma24_amas]
      ,[Sarakeryhma24_koulk]
      ,[Sarakeryhma24_jarj]
      ,[Sarakeryhma24_tutkintolaji]
      ,[Sarakeryhma25_ID]
      ,[Sarakeryhma25_tyyppi]
      ,[Sarakeryhma25_opp]
      ,[Sarakeryhma25_opmala]
      ,[Sarakeryhma25_opmopa]
      ,[Sarakeryhma25_opmast]
      ,[Sarakeryhma25_opm95opa]
      ,[Sarakeryhma25_koulutussektori]
      ,[Sarakeryhma25_suorv]
      ,[Sarakeryhma25_suorlk]
      ,[Sarakeryhma25_kmaak]
      ,[Sarakeryhma25_olotamm]
      ,[Sarakeryhma25_olosyys]
      ,[Sarakeryhma25_ptoim1r5]
      ,[Sarakeryhma25_amas]
      ,[Sarakeryhma25_koulk]
      ,[Sarakeryhma25_jarj]
      ,[Sarakeryhma25_tutkintolaji]
      ,[Sarakeryhma26_ID]
      ,[Sarakeryhma26_tyyppi]
      ,[Sarakeryhma26_opp]
      ,[Sarakeryhma26_opmala]
      ,[Sarakeryhma26_opmopa]
      ,[Sarakeryhma26_opmast]
      ,[Sarakeryhma26_opm95opa]
      ,[Sarakeryhma26_koulutussektori]
      ,[Sarakeryhma26_suorv]
      ,[Sarakeryhma26_suorlk]
      ,[Sarakeryhma26_kmaak]
      ,[Sarakeryhma26_olotamm]
      ,[Sarakeryhma26_olosyys]
      ,[Sarakeryhma26_ptoim1r5]
      ,[Sarakeryhma26_amas]
      ,[Sarakeryhma26_koulk]
      ,[Sarakeryhma26_jarj]
      ,[Sarakeryhma26_tutkintolaji]
      ,[Sarakeryhma27_ID]
      ,[Sarakeryhma27_tyyppi]
      ,[Sarakeryhma27_opp]
      ,[Sarakeryhma27_opmala]
      ,[Sarakeryhma27_opmopa]
      ,[Sarakeryhma27_opmast]
      ,[Sarakeryhma27_opm95opa]
      ,[Sarakeryhma27_koulutussektori]
      ,[Sarakeryhma27_suorv]
      ,[Sarakeryhma27_suorlk]
      ,[Sarakeryhma27_kmaak]
      ,[Sarakeryhma27_olotamm]
      ,[Sarakeryhma27_olosyys]
      ,[Sarakeryhma27_ptoim1r5]
      ,[Sarakeryhma27_amas]
      ,[Sarakeryhma27_koulk]
      ,[Sarakeryhma27_jarj]
      ,[Sarakeryhma27_tutkintolaji]
      ,[Sarakeryhma28_ID]
      ,[Sarakeryhma28_tyyppi]
      ,[Sarakeryhma28_opp]
      ,[Sarakeryhma28_opmala]
      ,[Sarakeryhma28_opmopa]
      ,[Sarakeryhma28_opmast]
      ,[Sarakeryhma28_opm95opa]
      ,[Sarakeryhma28_koulutussektori]
      ,[Sarakeryhma28_suorv]
      ,[Sarakeryhma28_suorlk]
      ,[Sarakeryhma28_kmaak]
      ,[Sarakeryhma28_olotamm]
      ,[Sarakeryhma28_olosyys]
      ,[Sarakeryhma28_ptoim1r5]
      ,[Sarakeryhma28_amas]
      ,[Sarakeryhma28_koulk]
      ,[Sarakeryhma28_jarj]
      ,[Sarakeryhma28_tutkintolaji]
      ,[Sarakeryhma29_ID]
      ,[Sarakeryhma29_tyyppi]
      ,[Sarakeryhma29_opp]
      ,[Sarakeryhma29_opmala]
      ,[Sarakeryhma29_opmopa]
      ,[Sarakeryhma29_opmast]
      ,[Sarakeryhma29_opm95opa]
      ,[Sarakeryhma29_koulutussektori]
      ,[Sarakeryhma29_suorv]
      ,[Sarakeryhma29_suorlk]
      ,[Sarakeryhma29_kmaak]
      ,[Sarakeryhma29_olotamm]
      ,[Sarakeryhma29_olosyys]
      ,[Sarakeryhma29_ptoim1r5]
      ,[Sarakeryhma29_amas]
      ,[Sarakeryhma29_koulk]
      ,[Sarakeryhma29_jarj]
      ,[Sarakeryhma29_tutkintolaji]
      ,[Sarakeryhma30_ID]
      ,[Sarakeryhma30_tyyppi]
      ,[Sarakeryhma30_opp]
      ,[Sarakeryhma30_opmala]
      ,[Sarakeryhma30_opmopa]
      ,[Sarakeryhma30_opmast]
      ,[Sarakeryhma30_opm95opa]
      ,[Sarakeryhma30_koulutussektori]
      ,[Sarakeryhma30_suorv]
      ,[Sarakeryhma30_suorlk]
      ,[Sarakeryhma30_kmaak]
      ,[Sarakeryhma30_olotamm]
      ,[Sarakeryhma30_olosyys]
      ,[Sarakeryhma30_ptoim1r5]
      ,[Sarakeryhma30_amas]
      ,[Sarakeryhma30_koulk]
      ,[Sarakeryhma30_jarj]
      ,[Sarakeryhma30_tutkintolaji]
      ,[Sarakeryhma31_ID]
      ,[Sarakeryhma31_tyyppi]
      ,[Sarakeryhma31_opp]
      ,[Sarakeryhma31_opmala]
      ,[Sarakeryhma31_opmopa]
      ,[Sarakeryhma31_opmast]
      ,[Sarakeryhma31_opm95opa]
      ,[Sarakeryhma31_koulutussektori]
      ,[Sarakeryhma31_suorv]
      ,[Sarakeryhma31_suorlk]
      ,[Sarakeryhma31_kmaak]
      ,[Sarakeryhma31_olotamm]
      ,[Sarakeryhma31_olosyys]
      ,[Sarakeryhma31_ptoim1r5]
      ,[Sarakeryhma31_amas]
      ,[Sarakeryhma31_koulk]
      ,[Sarakeryhma31_jarj]
      ,[Sarakeryhma31_tutkintolaji]
      ,[Sarakeryhma32_ID]
      ,[Sarakeryhma32_tyyppi]
      ,[Sarakeryhma32_opp]
      ,[Sarakeryhma32_opmala]
      ,[Sarakeryhma32_opmopa]
      ,[Sarakeryhma32_opmast]
      ,[Sarakeryhma32_opm95opa]
      ,[Sarakeryhma32_koulutussektori]
      ,[Sarakeryhma32_suorv]
      ,[Sarakeryhma32_suorlk]
      ,[Sarakeryhma32_kmaak]
      ,[Sarakeryhma32_olotamm]
      ,[Sarakeryhma32_olosyys]
      ,[Sarakeryhma32_ptoim1r5]
      ,[Sarakeryhma32_amas]
      ,[Sarakeryhma32_koulk]
      ,[Sarakeryhma32_jarj]
      ,[Sarakeryhma32_tutkintolaji]
      ,[Sarakeryhma33_ID]
      ,[Sarakeryhma33_tyyppi]
      ,[Sarakeryhma33_opp]
      ,[Sarakeryhma33_opmala]
      ,[Sarakeryhma33_opmopa]
      ,[Sarakeryhma33_opmast]
      ,[Sarakeryhma33_opm95opa]
      ,[Sarakeryhma33_koulutussektori]
      ,[Sarakeryhma33_suorv]
      ,[Sarakeryhma33_suorlk]
      ,[Sarakeryhma33_kmaak]
      ,[Sarakeryhma33_olotamm]
      ,[Sarakeryhma33_olosyys]
      ,[Sarakeryhma33_ptoim1r5]
      ,[Sarakeryhma33_amas]
      ,[Sarakeryhma33_koulk]
      ,[Sarakeryhma33_jarj]
      ,[Sarakeryhma33_tutkintolaji]
      ,[Sarakeryhma34_ID]
      ,[Sarakeryhma34_tyyppi]
      ,[Sarakeryhma34_opp]
      ,[Sarakeryhma34_opmala]
      ,[Sarakeryhma34_opmopa]
      ,[Sarakeryhma34_opmast]
      ,[Sarakeryhma34_opm95opa]
      ,[Sarakeryhma34_koulutussektori]
      ,[Sarakeryhma34_suorv]
      ,[Sarakeryhma34_suorlk]
      ,[Sarakeryhma34_kmaak]
      ,[Sarakeryhma34_olotamm]
      ,[Sarakeryhma34_olosyys]
      ,[Sarakeryhma34_ptoim1r5]
      ,[Sarakeryhma34_amas]
      ,[Sarakeryhma34_koulk]
      ,[Sarakeryhma34_jarj]
      ,[Sarakeryhma34_tutkintolaji]
      ,[Sarakeryhma35_ID]
      ,[Sarakeryhma35_tyyppi]
      ,[Sarakeryhma35_opp]
      ,[Sarakeryhma35_opmala]
      ,[Sarakeryhma35_opmopa]
      ,[Sarakeryhma35_opmast]
      ,[Sarakeryhma35_opm95opa]
      ,[Sarakeryhma35_koulutussektori]
      ,[Sarakeryhma35_suorv]
      ,[Sarakeryhma35_suorlk]
      ,[Sarakeryhma35_kmaak]
      ,[Sarakeryhma35_olotamm]
      ,[Sarakeryhma35_olosyys]
      ,[Sarakeryhma35_ptoim1r5]
      ,[Sarakeryhma35_amas]
      ,[Sarakeryhma35_koulk]
      ,[Sarakeryhma35_jarj]
      ,[Sarakeryhma35_tutkintolaji]
      ,[Sarakeryhma36_ID]
      ,[Sarakeryhma36_tyyppi]
      ,[Sarakeryhma36_opp]
      ,[Sarakeryhma36_opmala]
      ,[Sarakeryhma36_opmopa]
      ,[Sarakeryhma36_opmast]
      ,[Sarakeryhma36_opm95opa]
      ,[Sarakeryhma36_koulutussektori]
      ,[Sarakeryhma36_suorv]
      ,[Sarakeryhma36_suorlk]
      ,[Sarakeryhma36_kmaak]
      ,[Sarakeryhma36_olotamm]
      ,[Sarakeryhma36_olosyys]
      ,[Sarakeryhma36_ptoim1r5]
      ,[Sarakeryhma36_amas]
      ,[Sarakeryhma36_koulk]
      ,[Sarakeryhma36_jarj]
      ,[Sarakeryhma36_tutkintolaji]
      ,[Sarakeryhma37_ID]
      ,[Sarakeryhma37_tyyppi]
      ,[Sarakeryhma37_opp]
      ,[Sarakeryhma37_opmala]
      ,[Sarakeryhma37_opmopa]
      ,[Sarakeryhma37_opmast]
      ,[Sarakeryhma37_opm95opa]
      ,[Sarakeryhma37_koulutussektori]
      ,[Sarakeryhma37_suorv]
      ,[Sarakeryhma37_suorlk]
      ,[Sarakeryhma37_kmaak]
      ,[Sarakeryhma37_olotamm]
      ,[Sarakeryhma37_olosyys]
      ,[Sarakeryhma37_ptoim1r5]
      ,[Sarakeryhma37_amas]
      ,[Sarakeryhma37_koulk]
      ,[Sarakeryhma37_jarj]
      ,[Sarakeryhma37_tutkintolaji]
      ,[Sarakeryhma38_ID]
      ,[Sarakeryhma38_tyyppi]
      ,[Sarakeryhma38_opp]
      ,[Sarakeryhma38_opmala]
      ,[Sarakeryhma38_opmopa]
      ,[Sarakeryhma38_opmast]
      ,[Sarakeryhma38_opm95opa]
      ,[Sarakeryhma38_koulutussektori]
      ,[Sarakeryhma38_suorv]
      ,[Sarakeryhma38_suorlk]
      ,[Sarakeryhma38_kmaak]
      ,[Sarakeryhma38_olotamm]
      ,[Sarakeryhma38_olosyys]
      ,[Sarakeryhma38_ptoim1r5]
      ,[Sarakeryhma38_amas]
      ,[Sarakeryhma38_koulk]
      ,[Sarakeryhma38_jarj]
      ,[Sarakeryhma38_tutkintolaji]
      ,[Sarakeryhma39_ID]
      ,[Sarakeryhma39_tyyppi]
      ,[Sarakeryhma39_opp]
      ,[Sarakeryhma39_opmala]
      ,[Sarakeryhma39_opmopa]
      ,[Sarakeryhma39_opmast]
      ,[Sarakeryhma39_opm95opa]
      ,[Sarakeryhma39_koulutussektori]
      ,[Sarakeryhma39_suorv]
      ,[Sarakeryhma39_suorlk]
      ,[Sarakeryhma39_kmaak]
      ,[Sarakeryhma39_olotamm]
      ,[Sarakeryhma39_olosyys]
      ,[Sarakeryhma39_ptoim1r5]
      ,[Sarakeryhma39_amas]
      ,[Sarakeryhma39_koulk]
      ,[Sarakeryhma39_jarj]
      ,[Sarakeryhma39_tutkintolaji]
      ,[Sarakeryhma40_ID]
      ,[Sarakeryhma40_tyyppi]
      ,[Sarakeryhma40_opp]
      ,[Sarakeryhma40_opmala]
      ,[Sarakeryhma40_opmopa]
      ,[Sarakeryhma40_opmast]
      ,[Sarakeryhma40_opm95opa]
      ,[Sarakeryhma40_koulutussektori]
      ,[Sarakeryhma40_suorv]
      ,[Sarakeryhma40_suorlk]
      ,[Sarakeryhma40_kmaak]
      ,[Sarakeryhma40_olotamm]
      ,[Sarakeryhma40_olosyys]
      ,[Sarakeryhma40_ptoim1r5]
      ,[Sarakeryhma40_amas]
      ,[Sarakeryhma40_koulk]
      ,[Sarakeryhma40_jarj]
      ,[Sarakeryhma40_tutkintolaji]
      ,[Sarakeryhma41_ID]
      ,[Sarakeryhma41_tyyppi]
      ,[Sarakeryhma41_opp]
      ,[Sarakeryhma41_opmala]
      ,[Sarakeryhma41_opmopa]
      ,[Sarakeryhma41_opmast]
      ,[Sarakeryhma41_opm95opa]
      ,[Sarakeryhma41_koulutussektori]
      ,[Sarakeryhma41_suorv]
      ,[Sarakeryhma41_suorlk]
      ,[Sarakeryhma41_kmaak]
      ,[Sarakeryhma41_olotamm]
      ,[Sarakeryhma41_olosyys]
      ,[Sarakeryhma41_ptoim1r5]
      ,[Sarakeryhma41_amas]
      ,[Sarakeryhma41_koulk]
      ,[Sarakeryhma41_jarj]
      ,[Sarakeryhma41_tutkintolaji]
      ,[Sarakeryhma42_ID]
      ,[Sarakeryhma42_tyyppi]
      ,[Sarakeryhma42_opp]
      ,[Sarakeryhma42_opmala]
      ,[Sarakeryhma42_opmopa]
      ,[Sarakeryhma42_opmast]
      ,[Sarakeryhma42_opm95opa]
      ,[Sarakeryhma42_koulutussektori]
      ,[Sarakeryhma42_suorv]
      ,[Sarakeryhma42_suorlk]
      ,[Sarakeryhma42_kmaak]
      ,[Sarakeryhma42_olotamm]
      ,[Sarakeryhma42_olosyys]
      ,[Sarakeryhma42_ptoim1r5]
      ,[Sarakeryhma42_amas]
      ,[Sarakeryhma42_koulk]
      ,[Sarakeryhma42_jarj]
      ,[Sarakeryhma42_tutkintolaji]
      ,[Sarakeryhma43_ID]
      ,[Sarakeryhma43_tyyppi]
      ,[Sarakeryhma43_opp]
      ,[Sarakeryhma43_opmala]
      ,[Sarakeryhma43_opmopa]
      ,[Sarakeryhma43_opmast]
      ,[Sarakeryhma43_opm95opa]
      ,[Sarakeryhma43_koulutussektori]
      ,[Sarakeryhma43_suorv]
      ,[Sarakeryhma43_suorlk]
      ,[Sarakeryhma43_kmaak]
      ,[Sarakeryhma43_olotamm]
      ,[Sarakeryhma43_olosyys]
      ,[Sarakeryhma43_ptoim1r5]
      ,[Sarakeryhma43_amas]
      ,[Sarakeryhma43_koulk]
      ,[Sarakeryhma43_jarj]
      ,[Sarakeryhma43_tutkintolaji]
      ,[Sarakeryhma44_ID]
      ,[Sarakeryhma44_tyyppi]
      ,[Sarakeryhma44_opp]
      ,[Sarakeryhma44_opmala]
      ,[Sarakeryhma44_opmopa]
      ,[Sarakeryhma44_opmast]
      ,[Sarakeryhma44_opm95opa]
      ,[Sarakeryhma44_koulutussektori]
      ,[Sarakeryhma44_suorv]
      ,[Sarakeryhma44_suorlk]
      ,[Sarakeryhma44_kmaak]
      ,[Sarakeryhma44_olotamm]
      ,[Sarakeryhma44_olosyys]
      ,[Sarakeryhma44_ptoim1r5]
      ,[Sarakeryhma44_amas]
      ,[Sarakeryhma44_koulk]
      ,[Sarakeryhma44_jarj]
      ,[Sarakeryhma44_tutkintolaji]
      ,[Sarakeryhma45_ID]
      ,[Sarakeryhma45_tyyppi]
      ,[Sarakeryhma45_opp]
      ,[Sarakeryhma45_opmala]
      ,[Sarakeryhma45_opmopa]
      ,[Sarakeryhma45_opmast]
      ,[Sarakeryhma45_opm95opa]
      ,[Sarakeryhma45_koulutussektori]
      ,[Sarakeryhma45_suorv]
      ,[Sarakeryhma45_suorlk]
      ,[Sarakeryhma45_kmaak]
      ,[Sarakeryhma45_olotamm]
      ,[Sarakeryhma45_olosyys]
      ,[Sarakeryhma45_ptoim1r5]
      ,[Sarakeryhma45_amas]
      ,[Sarakeryhma45_koulk]
      ,[Sarakeryhma45_jarj]
      ,[Sarakeryhma45_tutkintolaji]
      ,[Sarakeryhma46_ID]
      ,[Sarakeryhma46_tyyppi]
      ,[Sarakeryhma46_opp]
      ,[Sarakeryhma46_opmala]
      ,[Sarakeryhma46_opmopa]
      ,[Sarakeryhma46_opmast]
      ,[Sarakeryhma46_opm95opa]
      ,[Sarakeryhma46_koulutussektori]
      ,[Sarakeryhma46_suorv]
      ,[Sarakeryhma46_suorlk]
      ,[Sarakeryhma46_kmaak]
      ,[Sarakeryhma46_olotamm]
      ,[Sarakeryhma46_olosyys]
      ,[Sarakeryhma46_ptoim1r5]
      ,[Sarakeryhma46_amas]
      ,[Sarakeryhma46_koulk]
      ,[Sarakeryhma46_jarj]
      ,[Sarakeryhma46_tutkintolaji]
      ,[Sarakeryhma47_ID]
      ,[Sarakeryhma47_tyyppi]
      ,[Sarakeryhma47_opp]
      ,[Sarakeryhma47_opmala]
      ,[Sarakeryhma47_opmopa]
      ,[Sarakeryhma47_opmast]
      ,[Sarakeryhma47_opm95opa]
      ,[Sarakeryhma47_koulutussektori]
      ,[Sarakeryhma47_suorv]
      ,[Sarakeryhma47_suorlk]
      ,[Sarakeryhma47_kmaak]
      ,[Sarakeryhma47_olotamm]
      ,[Sarakeryhma47_olosyys]
      ,[Sarakeryhma47_ptoim1r5]
      ,[Sarakeryhma47_amas]
      ,[Sarakeryhma47_koulk]
      ,[Sarakeryhma47_jarj]
      ,[Sarakeryhma47_tutkintolaji]
      ,[Sarakeryhma48_ID]
      ,[Sarakeryhma48_tyyppi]
      ,[Sarakeryhma48_opp]
      ,[Sarakeryhma48_opmala]
      ,[Sarakeryhma48_opmopa]
      ,[Sarakeryhma48_opmast]
      ,[Sarakeryhma48_opm95opa]
      ,[Sarakeryhma48_koulutussektori]
      ,[Sarakeryhma48_suorv]
      ,[Sarakeryhma48_suorlk]
      ,[Sarakeryhma48_kmaak]
      ,[Sarakeryhma48_olotamm]
      ,[Sarakeryhma48_olosyys]
      ,[Sarakeryhma48_ptoim1r5]
      ,[Sarakeryhma48_amas]
      ,[Sarakeryhma48_koulk]
      ,[Sarakeryhma48_jarj]
      ,[Sarakeryhma48_tutkintolaji]
      ,[Sarakeryhma49_ID]
      ,[Sarakeryhma49_tyyppi]
      ,[Sarakeryhma49_opp]
      ,[Sarakeryhma49_opmala]
      ,[Sarakeryhma49_opmopa]
      ,[Sarakeryhma49_opmast]
      ,[Sarakeryhma49_opm95opa]
      ,[Sarakeryhma49_koulutussektori]
      ,[Sarakeryhma49_suorv]
      ,[Sarakeryhma49_suorlk]
      ,[Sarakeryhma49_kmaak]
      ,[Sarakeryhma49_olotamm]
      ,[Sarakeryhma49_olosyys]
      ,[Sarakeryhma49_ptoim1r5]
      ,[Sarakeryhma49_amas]
      ,[Sarakeryhma49_koulk]
      ,[Sarakeryhma49_jarj]
      ,[Sarakeryhma49_tutkintolaji]
      ,[Sarakeryhma50_ID]
      ,[Sarakeryhma50_tyyppi]
      ,[Sarakeryhma50_opp]
      ,[Sarakeryhma50_opmala]
      ,[Sarakeryhma50_opmopa]
      ,[Sarakeryhma50_opmast]
      ,[Sarakeryhma50_opm95opa]
      ,[Sarakeryhma50_koulutussektori]
      ,[Sarakeryhma50_suorv]
      ,[Sarakeryhma50_suorlk]
      ,[Sarakeryhma50_kmaak]
      ,[Sarakeryhma50_olotamm]
      ,[Sarakeryhma50_olosyys]
      ,[Sarakeryhma50_ptoim1r5]
      ,[Sarakeryhma50_amas]
      ,[Sarakeryhma50_koulk]
      ,[Sarakeryhma50_jarj]
      ,[Sarakeryhma50_tutkintolaji]
      ,[Sarakeryhma51_ID]
      ,[Sarakeryhma51_tyyppi]
      ,[Sarakeryhma51_opp]
      ,[Sarakeryhma51_opmala]
      ,[Sarakeryhma51_opmopa]
      ,[Sarakeryhma51_opmast]
      ,[Sarakeryhma51_opm95opa]
      ,[Sarakeryhma51_koulutussektori]
      ,[Sarakeryhma51_suorv]
      ,[Sarakeryhma51_suorlk]
      ,[Sarakeryhma51_kmaak]
      ,[Sarakeryhma51_olotamm]
      ,[Sarakeryhma51_olosyys]
      ,[Sarakeryhma51_ptoim1r5]
      ,[Sarakeryhma51_amas]
      ,[Sarakeryhma51_koulk]
      ,[Sarakeryhma51_jarj]
      ,[Sarakeryhma51_tutkintolaji]
      ,[Sarakeryhma52_ID]
      ,[Sarakeryhma52_tyyppi]
      ,[Sarakeryhma52_opp]
      ,[Sarakeryhma52_opmala]
      ,[Sarakeryhma52_opmopa]
      ,[Sarakeryhma52_opmast]
      ,[Sarakeryhma52_opm95opa]
      ,[Sarakeryhma52_koulutussektori]
      ,[Sarakeryhma52_suorv]
      ,[Sarakeryhma52_suorlk]
      ,[Sarakeryhma52_kmaak]
      ,[Sarakeryhma52_olotamm]
      ,[Sarakeryhma52_olosyys]
      ,[Sarakeryhma52_ptoim1r5]
      ,[Sarakeryhma52_amas]
      ,[Sarakeryhma52_koulk]
      ,[Sarakeryhma52_jarj]
      ,[Sarakeryhma52_tutkintolaji]
      ,[Sarakeryhma53_ID]
      ,[Sarakeryhma53_tyyppi]
      ,[Sarakeryhma53_opp]
      ,[Sarakeryhma53_opmala]
      ,[Sarakeryhma53_opmopa]
      ,[Sarakeryhma53_opmast]
      ,[Sarakeryhma53_opm95opa]
      ,[Sarakeryhma53_koulutussektori]
      ,[Sarakeryhma53_suorv]
      ,[Sarakeryhma53_suorlk]
      ,[Sarakeryhma53_kmaak]
      ,[Sarakeryhma53_olotamm]
      ,[Sarakeryhma53_olosyys]
      ,[Sarakeryhma53_ptoim1r5]
      ,[Sarakeryhma53_amas]
      ,[Sarakeryhma53_koulk]
      ,[Sarakeryhma53_jarj]
      ,[Sarakeryhma53_tutkintolaji]
      ,[Sarakeryhma54_ID]
      ,[Sarakeryhma54_tyyppi]
      ,[Sarakeryhma54_opp]
      ,[Sarakeryhma54_opmala]
      ,[Sarakeryhma54_opmopa]
      ,[Sarakeryhma54_opmast]
      ,[Sarakeryhma54_opm95opa]
      ,[Sarakeryhma54_koulutussektori]
      ,[Sarakeryhma54_suorv]
      ,[Sarakeryhma54_suorlk]
      ,[Sarakeryhma54_kmaak]
      ,[Sarakeryhma54_olotamm]
      ,[Sarakeryhma54_olosyys]
      ,[Sarakeryhma54_ptoim1r5]
      ,[Sarakeryhma54_amas]
      ,[Sarakeryhma54_koulk]
      ,[Sarakeryhma54_jarj]
      ,[Sarakeryhma54_tutkintolaji]
      ,[Sarakeryhma55_ID]
      ,[Sarakeryhma55_tyyppi]
      ,[Sarakeryhma55_opp]
      ,[Sarakeryhma55_opmala]
      ,[Sarakeryhma55_opmopa]
      ,[Sarakeryhma55_opmast]
      ,[Sarakeryhma55_opm95opa]
      ,[Sarakeryhma55_koulutussektori]
      ,[Sarakeryhma55_suorv]
      ,[Sarakeryhma55_suorlk]
      ,[Sarakeryhma55_kmaak]
      ,[Sarakeryhma55_olotamm]
      ,[Sarakeryhma55_olosyys]
      ,[Sarakeryhma55_ptoim1r5]
      ,[Sarakeryhma55_amas]
      ,[Sarakeryhma55_koulk]
      ,[Sarakeryhma55_jarj]
      ,[Sarakeryhma55_tutkintolaji]

/*
SELECT [tilv]
      ,[lahde]
      ,[opp]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[klaji]
      ,[ophal]
      ,[jarj]
      ,[kkun]
      ,[maak]
      ,[koulk]
      ,[opmala]
      ,[opmopa]
      ,[opmast]
      ,[opm95opa]
      ,[koulutussektori]
      ,[pohjkoulk]
      ,[alvv_kk]
      ,[allk_kk]
      ,[ololk]
      ,[rahlahde]
      ,[koulutuslaji2]
      ,[tutkintolaji] = Case when [koulutuslaji2] in (''21'', ''22'') then ''lu''
							when [koulutuslaji2] in (''31'', ''32'', ''35'', ''36'') then ''ampt''
							when [koulutuslaji2] in (''33'', ''34'', ''37'', ''38'') then ''amlk''
							when [koulutuslaji2] in (''41'', ''42'') then ''amk''
							when [koulutuslaji2] = ''46'' then ''ylamk''
							when [koulutuslaji2] = ''51a'' then ''alkk''
							when [koulutuslaji2] = ''51b'' then ''ylkk''
							when [koulutuslaji2] = ''52'' then ''tk'' 
							else ''muu'' end
      ,[tietolahde]
      ,[aineistorivinumero]
      ,[lkm_int]
      ,[Sarakeryhma1_ID]
      ,[Sarakeryhma1_tyyppi]
      ,[Sarakeryhma1_opp]
      ,[Sarakeryhma1_opmala]
      ,[Sarakeryhma1_opmopa]
      ,[Sarakeryhma1_opmast]
      ,[Sarakeryhma1_opm95opa]
      ,[Sarakeryhma1_koulutussektori]
      ,[Sarakeryhma1_suorv]
      ,[Sarakeryhma1_suorlk]
      ,[Sarakeryhma1_kmaak]
      ,[Sarakeryhma1_olotamm]
      ,[Sarakeryhma1_olosyys]
      ,[Sarakeryhma1_ptoim1r5]
      ,[Sarakeryhma1_amas]
      ,[Sarakeryhma1_koulk]
      ,[Sarakeryhma1_tutkintolaji]
      ,[Sarakeryhma2_ID]
      ,[Sarakeryhma2_tyyppi]
      ,[Sarakeryhma2_opp]
      ,[Sarakeryhma2_opmala]
      ,[Sarakeryhma2_opmopa]
      ,[Sarakeryhma2_opmast]
      ,[Sarakeryhma2_opm95opa]
      ,[Sarakeryhma2_koulutussektori]
      ,[Sarakeryhma2_suorv]
      ,[Sarakeryhma2_suorlk]
      ,[Sarakeryhma2_kmaak]
      ,[Sarakeryhma2_olotamm]
      ,[Sarakeryhma2_olosyys]
      ,[Sarakeryhma2_ptoim1r5]
      ,[Sarakeryhma2_amas]
      ,[Sarakeryhma2_koulk]
      ,[Sarakeryhma2_tutkintolaji]
      ,[Sarakeryhma3_ID]
      ,[Sarakeryhma3_tyyppi]
      ,[Sarakeryhma3_opp]
      ,[Sarakeryhma3_opmala]
      ,[Sarakeryhma3_opmopa]
      ,[Sarakeryhma3_opmast]
      ,[Sarakeryhma3_opm95opa]
      ,[Sarakeryhma3_koulutussektori]
      ,[Sarakeryhma3_suorv]
      ,[Sarakeryhma3_suorlk]
      ,[Sarakeryhma3_kmaak]
      ,[Sarakeryhma3_olotamm]
      ,[Sarakeryhma3_olosyys]
      ,[Sarakeryhma3_ptoim1r5]
      ,[Sarakeryhma3_amas]
      ,[Sarakeryhma3_koulk]
      ,[Sarakeryhma3_tutkintolaji]
      ,[Sarakeryhma4_ID]
      ,[Sarakeryhma4_tyyppi]
      ,[Sarakeryhma4_opp]
      ,[Sarakeryhma4_opmala]
      ,[Sarakeryhma4_opmopa]
      ,[Sarakeryhma4_opmast]
      ,[Sarakeryhma4_opm95opa]
      ,[Sarakeryhma4_koulutussektori]
      ,[Sarakeryhma4_suorv]
      ,[Sarakeryhma4_suorlk]
      ,[Sarakeryhma4_kmaak]
      ,[Sarakeryhma4_olotamm]
      ,[Sarakeryhma4_olosyys]
      ,[Sarakeryhma4_ptoim1r5]
      ,[Sarakeryhma4_amas]
      ,[Sarakeryhma4_koulk]
      ,[Sarakeryhma4_tutkintolaji]
      ,[Sarakeryhma5_ID]
      ,[Sarakeryhma5_tyyppi]
      ,[Sarakeryhma5_opp]
      ,[Sarakeryhma5_opmala]
      ,[Sarakeryhma5_opmopa]
      ,[Sarakeryhma5_opmast]
      ,[Sarakeryhma5_opm95opa]
      ,[Sarakeryhma5_koulutussektori]
      ,[Sarakeryhma5_suorv]
      ,[Sarakeryhma5_suorlk]
      ,[Sarakeryhma5_kmaak]
      ,[Sarakeryhma5_olotamm]
      ,[Sarakeryhma5_olosyys]
      ,[Sarakeryhma5_ptoim1r5]
      ,[Sarakeryhma5_amas]
      ,[Sarakeryhma5_koulk]
      ,[Sarakeryhma5_tutkintolaji]
      ,[Sarakeryhma6_ID]
      ,[Sarakeryhma6_tyyppi]
      ,[Sarakeryhma6_opp]
      ,[Sarakeryhma6_opmala]
      ,[Sarakeryhma6_opmopa]
      ,[Sarakeryhma6_opmast]
      ,[Sarakeryhma6_opm95opa]
      ,[Sarakeryhma6_koulutussektori]
      ,[Sarakeryhma6_suorv]
      ,[Sarakeryhma6_suorlk]
      ,[Sarakeryhma6_kmaak]
      ,[Sarakeryhma6_olotamm]
      ,[Sarakeryhma6_olosyys]
      ,[Sarakeryhma6_ptoim1r5]
      ,[Sarakeryhma6_amas]
      ,[Sarakeryhma6_koulk]
      ,[Sarakeryhma6_tutkintolaji]
      ,[Sarakeryhma7_ID]
      ,[Sarakeryhma7_tyyppi]
      ,[Sarakeryhma7_opp]
      ,[Sarakeryhma7_opmala]
      ,[Sarakeryhma7_opmopa]
      ,[Sarakeryhma7_opmast]
      ,[Sarakeryhma7_opm95opa]
      ,[Sarakeryhma7_koulutussektori]
      ,[Sarakeryhma7_suorv]
      ,[Sarakeryhma7_suorlk]
      ,[Sarakeryhma7_kmaak]
      ,[Sarakeryhma7_olotamm]
      ,[Sarakeryhma7_olosyys]
      ,[Sarakeryhma7_ptoim1r5]
      ,[Sarakeryhma7_amas]
      ,[Sarakeryhma7_koulk]
      ,[Sarakeryhma7_tutkintolaji]
      ,[Sarakeryhma8_ID]
      ,[Sarakeryhma8_tyyppi]
      ,[Sarakeryhma8_opp]
      ,[Sarakeryhma8_opmala]
      ,[Sarakeryhma8_opmopa]
      ,[Sarakeryhma8_opmast]
      ,[Sarakeryhma8_opm95opa]
      ,[Sarakeryhma8_koulutussektori]
      ,[Sarakeryhma8_suorv]
      ,[Sarakeryhma8_suorlk]
      ,[Sarakeryhma8_kmaak]
      ,[Sarakeryhma8_olotamm]
      ,[Sarakeryhma8_olosyys]
      ,[Sarakeryhma8_ptoim1r5]
      ,[Sarakeryhma8_amas]
      ,[Sarakeryhma8_koulk]
      ,[Sarakeryhma8_tutkintolaji]
      ,[Sarakeryhma9_ID]
      ,[Sarakeryhma9_tyyppi]
      ,[Sarakeryhma9_opp]
      ,[Sarakeryhma9_opmala]
      ,[Sarakeryhma9_opmopa]
      ,[Sarakeryhma9_opmast]
      ,[Sarakeryhma9_opm95opa]
      ,[Sarakeryhma9_koulutussektori]
      ,[Sarakeryhma9_suorv]
      ,[Sarakeryhma9_suorlk]
      ,[Sarakeryhma9_kmaak]
      ,[Sarakeryhma9_olotamm]
      ,[Sarakeryhma9_olosyys]
      ,[Sarakeryhma9_ptoim1r5]
      ,[Sarakeryhma9_amas]
      ,[Sarakeryhma9_koulk]
      ,[Sarakeryhma9_tutkintolaji]
      ,[Sarakeryhma10_ID]
      ,[Sarakeryhma10_tyyppi]
      ,[Sarakeryhma10_opp]
      ,[Sarakeryhma10_opmala]
      ,[Sarakeryhma10_opmopa]
      ,[Sarakeryhma10_opmast]
      ,[Sarakeryhma10_opm95opa]
      ,[Sarakeryhma10_koulutussektori]
      ,[Sarakeryhma10_suorv]
      ,[Sarakeryhma10_suorlk]
      ,[Sarakeryhma10_kmaak]
      ,[Sarakeryhma10_olotamm]
      ,[Sarakeryhma10_olosyys]
      ,[Sarakeryhma10_ptoim1r5]
      ,[Sarakeryhma10_amas]
      ,[Sarakeryhma10_koulk]
      ,[Sarakeryhma10_tutkintolaji]
      ,[Sarakeryhma11_ID]
      ,[Sarakeryhma11_tyyppi]
      ,[Sarakeryhma11_opp]
      ,[Sarakeryhma11_opmala]
      ,[Sarakeryhma11_opmopa]
      ,[Sarakeryhma11_opmast]
      ,[Sarakeryhma11_opm95opa]
      ,[Sarakeryhma11_koulutussektori]
      ,[Sarakeryhma11_suorv]
      ,[Sarakeryhma11_suorlk]
      ,[Sarakeryhma11_kmaak]
      ,[Sarakeryhma11_olotamm]
      ,[Sarakeryhma11_olosyys]
      ,[Sarakeryhma11_ptoim1r5]
      ,[Sarakeryhma11_amas]
      ,[Sarakeryhma11_koulk]
      ,[Sarakeryhma11_tutkintolaji]
      ,[Sarakeryhma12_ID]
      ,[Sarakeryhma12_tyyppi]
      ,[Sarakeryhma12_opp]
      ,[Sarakeryhma12_opmala]
      ,[Sarakeryhma12_opmopa]
      ,[Sarakeryhma12_opmast]
      ,[Sarakeryhma12_opm95opa]
      ,[Sarakeryhma12_koulutussektori]
      ,[Sarakeryhma12_suorv]
      ,[Sarakeryhma12_suorlk]
      ,[Sarakeryhma12_kmaak]
      ,[Sarakeryhma12_olotamm]
      ,[Sarakeryhma12_olosyys]
      ,[Sarakeryhma12_ptoim1r5]
      ,[Sarakeryhma12_amas]
      ,[Sarakeryhma12_koulk]
      ,[Sarakeryhma12_tutkintolaji]
      ,[Sarakeryhma13_ID]
      ,[Sarakeryhma13_tyyppi]
      ,[Sarakeryhma13_opp]
      ,[Sarakeryhma13_opmala]
      ,[Sarakeryhma13_opmopa]
      ,[Sarakeryhma13_opmast]
      ,[Sarakeryhma13_opm95opa]
      ,[Sarakeryhma13_koulutussektori]
      ,[Sarakeryhma13_suorv]
      ,[Sarakeryhma13_suorlk]
      ,[Sarakeryhma13_kmaak]
      ,[Sarakeryhma13_olotamm]
      ,[Sarakeryhma13_olosyys]
      ,[Sarakeryhma13_ptoim1r5]
      ,[Sarakeryhma13_amas]
      ,[Sarakeryhma13_koulk]
      ,[Sarakeryhma13_tutkintolaji]
      ,[Sarakeryhma14_ID]
      ,[Sarakeryhma14_tyyppi]
      ,[Sarakeryhma14_opp]
      ,[Sarakeryhma14_opmala]
      ,[Sarakeryhma14_opmopa]
      ,[Sarakeryhma14_opmast]
      ,[Sarakeryhma14_opm95opa]
      ,[Sarakeryhma14_koulutussektori]
      ,[Sarakeryhma14_suorv]
      ,[Sarakeryhma14_suorlk]
      ,[Sarakeryhma14_kmaak]
      ,[Sarakeryhma14_olotamm]
      ,[Sarakeryhma14_olosyys]
      ,[Sarakeryhma14_ptoim1r5]
      ,[Sarakeryhma14_amas]
      ,[Sarakeryhma14_koulk]
      ,[Sarakeryhma14_tutkintolaji]
      ,[Sarakeryhma15_ID]
      ,[Sarakeryhma15_tyyppi]
      ,[Sarakeryhma15_opp]
      ,[Sarakeryhma15_opmala]
      ,[Sarakeryhma15_opmopa]
      ,[Sarakeryhma15_opmast]
      ,[Sarakeryhma15_opm95opa]
      ,[Sarakeryhma15_koulutussektori]
      ,[Sarakeryhma15_suorv]
      ,[Sarakeryhma15_suorlk]
      ,[Sarakeryhma15_kmaak]
      ,[Sarakeryhma15_olotamm]
      ,[Sarakeryhma15_olosyys]
      ,[Sarakeryhma15_ptoim1r5]
      ,[Sarakeryhma15_amas]
      ,[Sarakeryhma15_koulk]
      ,[Sarakeryhma15_tutkintolaji]
      ,[Sarakeryhma16_ID]
      ,[Sarakeryhma16_tyyppi]
      ,[Sarakeryhma16_opp]
      ,[Sarakeryhma16_opmala]
      ,[Sarakeryhma16_opmopa]
      ,[Sarakeryhma16_opmast]
      ,[Sarakeryhma16_opm95opa]
      ,[Sarakeryhma16_koulutussektori]
      ,[Sarakeryhma16_suorv]
      ,[Sarakeryhma16_suorlk]
      ,[Sarakeryhma16_kmaak]
      ,[Sarakeryhma16_olotamm]
      ,[Sarakeryhma16_olosyys]
      ,[Sarakeryhma16_ptoim1r5]
      ,[Sarakeryhma16_amas]
      ,[Sarakeryhma16_koulk]
      ,[Sarakeryhma16_tutkintolaji]
      ,[Sarakeryhma17_ID]
      ,[Sarakeryhma17_tyyppi]
      ,[Sarakeryhma17_opp]
      ,[Sarakeryhma17_opmala]
      ,[Sarakeryhma17_opmopa]
      ,[Sarakeryhma17_opmast]
      ,[Sarakeryhma17_opm95opa]
      ,[Sarakeryhma17_koulutussektori]
      ,[Sarakeryhma17_suorv]
      ,[Sarakeryhma17_suorlk]
      ,[Sarakeryhma17_kmaak]
      ,[Sarakeryhma17_olotamm]
      ,[Sarakeryhma17_olosyys]
      ,[Sarakeryhma17_ptoim1r5]
      ,[Sarakeryhma17_amas]
      ,[Sarakeryhma17_koulk]
      ,[Sarakeryhma17_tutkintolaji]
      ,[Sarakeryhma18_ID]
      ,[Sarakeryhma18_tyyppi]
      ,[Sarakeryhma18_opp]
      ,[Sarakeryhma18_opmala]
      ,[Sarakeryhma18_opmopa]
      ,[Sarakeryhma18_opmast]
      ,[Sarakeryhma18_opm95opa]
      ,[Sarakeryhma18_koulutussektori]
      ,[Sarakeryhma18_suorv]
      ,[Sarakeryhma18_suorlk]
      ,[Sarakeryhma18_kmaak]
      ,[Sarakeryhma18_olotamm]
      ,[Sarakeryhma18_olosyys]
      ,[Sarakeryhma18_ptoim1r5]
      ,[Sarakeryhma18_amas]
      ,[Sarakeryhma18_koulk]
      ,[Sarakeryhma18_tutkintolaji]
      ,[Sarakeryhma19_ID]
      ,[Sarakeryhma19_tyyppi]
      ,[Sarakeryhma19_opp]
      ,[Sarakeryhma19_opmala]
      ,[Sarakeryhma19_opmopa]
      ,[Sarakeryhma19_opmast]
      ,[Sarakeryhma19_opm95opa]
      ,[Sarakeryhma19_koulutussektori]
      ,[Sarakeryhma19_suorv]
      ,[Sarakeryhma19_suorlk]
      ,[Sarakeryhma19_kmaak]
      ,[Sarakeryhma19_olotamm]
      ,[Sarakeryhma19_olosyys]
      ,[Sarakeryhma19_ptoim1r5]
      ,[Sarakeryhma19_amas]
      ,[Sarakeryhma19_koulk]
      ,[Sarakeryhma19_tutkintolaji]
      ,[Sarakeryhma20_ID]
      ,[Sarakeryhma20_tyyppi]
      ,[Sarakeryhma20_opp]
      ,[Sarakeryhma20_opmala]
      ,[Sarakeryhma20_opmopa]
      ,[Sarakeryhma20_opmast]
      ,[Sarakeryhma20_opm95opa]
      ,[Sarakeryhma20_koulutussektori]
      ,[Sarakeryhma20_suorv]
      ,[Sarakeryhma20_suorlk]
      ,[Sarakeryhma20_kmaak]
      ,[Sarakeryhma20_olotamm]
      ,[Sarakeryhma20_olosyys]
      ,[Sarakeryhma20_ptoim1r5]
      ,[Sarakeryhma20_amas]
      ,[Sarakeryhma20_koulk]
      ,[Sarakeryhma20_tutkintolaji]
      ,[Sarakeryhma21_ID]
      ,[Sarakeryhma21_tyyppi]
      ,[Sarakeryhma21_opp]
      ,[Sarakeryhma21_opmala]
      ,[Sarakeryhma21_opmopa]
      ,[Sarakeryhma21_opmast]
      ,[Sarakeryhma21_opm95opa]
      ,[Sarakeryhma21_koulutussektori]
      ,[Sarakeryhma21_suorv]
      ,[Sarakeryhma21_suorlk]
      ,[Sarakeryhma21_kmaak]
      ,[Sarakeryhma21_olotamm]
      ,[Sarakeryhma21_olosyys]
      ,[Sarakeryhma21_ptoim1r5]
      ,[Sarakeryhma21_amas]
      ,[Sarakeryhma21_koulk]
      ,[Sarakeryhma21_tutkintolaji]
      ,[Sarakeryhma22_ID]
      ,[Sarakeryhma22_tyyppi]
      ,[Sarakeryhma22_opp]
      ,[Sarakeryhma22_opmala]
      ,[Sarakeryhma22_opmopa]
      ,[Sarakeryhma22_opmast]
      ,[Sarakeryhma22_opm95opa]
      ,[Sarakeryhma22_koulutussektori]
      ,[Sarakeryhma22_suorv]
      ,[Sarakeryhma22_suorlk]
      ,[Sarakeryhma22_kmaak]
      ,[Sarakeryhma22_olotamm]
      ,[Sarakeryhma22_olosyys]
      ,[Sarakeryhma22_ptoim1r5]
      ,[Sarakeryhma22_amas]
      ,[Sarakeryhma22_koulk]
      ,[Sarakeryhma22_tutkintolaji]
      ,[Sarakeryhma23_ID]
      ,[Sarakeryhma23_tyyppi]
      ,[Sarakeryhma23_opp]
      ,[Sarakeryhma23_opmala]
      ,[Sarakeryhma23_opmopa]
      ,[Sarakeryhma23_opmast]
      ,[Sarakeryhma23_opm95opa]
      ,[Sarakeryhma23_koulutussektori]
      ,[Sarakeryhma23_suorv]
      ,[Sarakeryhma23_suorlk]
      ,[Sarakeryhma23_kmaak]
      ,[Sarakeryhma23_olotamm]
      ,[Sarakeryhma23_olosyys]
      ,[Sarakeryhma23_ptoim1r5]
      ,[Sarakeryhma23_amas]
      ,[Sarakeryhma23_koulk]
      ,[Sarakeryhma23_tutkintolaji]
      ,[Sarakeryhma24_ID]
      ,[Sarakeryhma24_tyyppi]
      ,[Sarakeryhma24_opp]
      ,[Sarakeryhma24_opmala]
      ,[Sarakeryhma24_opmopa]
      ,[Sarakeryhma24_opmast]
      ,[Sarakeryhma24_opm95opa]
      ,[Sarakeryhma24_koulutussektori]
      ,[Sarakeryhma24_suorv]
      ,[Sarakeryhma24_suorlk]
      ,[Sarakeryhma24_kmaak]
      ,[Sarakeryhma24_olotamm]
      ,[Sarakeryhma24_olosyys]
      ,[Sarakeryhma24_ptoim1r5]
      ,[Sarakeryhma24_amas]
      ,[Sarakeryhma24_koulk]
      ,[Sarakeryhma24_tutkintolaji]
      ,[Sarakeryhma25_ID]
      ,[Sarakeryhma25_tyyppi]
      ,[Sarakeryhma25_opp]
      ,[Sarakeryhma25_opmala]
      ,[Sarakeryhma25_opmopa]
      ,[Sarakeryhma25_opmast]
      ,[Sarakeryhma25_opm95opa]
      ,[Sarakeryhma25_koulutussektori]
      ,[Sarakeryhma25_suorv]
      ,[Sarakeryhma25_suorlk]
      ,[Sarakeryhma25_kmaak]
      ,[Sarakeryhma25_olotamm]
      ,[Sarakeryhma25_olosyys]
      ,[Sarakeryhma25_ptoim1r5]
      ,[Sarakeryhma25_amas]
      ,[Sarakeryhma25_koulk]
      ,[Sarakeryhma25_tutkintolaji]
      ,[Sarakeryhma26_ID]
      ,[Sarakeryhma26_tyyppi]
      ,[Sarakeryhma26_opp]
      ,[Sarakeryhma26_opmala]
      ,[Sarakeryhma26_opmopa]
      ,[Sarakeryhma26_opmast]
      ,[Sarakeryhma26_opm95opa]
      ,[Sarakeryhma26_koulutussektori]
      ,[Sarakeryhma26_suorv]
      ,[Sarakeryhma26_suorlk]
      ,[Sarakeryhma26_kmaak]
      ,[Sarakeryhma26_olotamm]
      ,[Sarakeryhma26_olosyys]
      ,[Sarakeryhma26_ptoim1r5]
      ,[Sarakeryhma26_amas]
      ,[Sarakeryhma26_koulk]
      ,[Sarakeryhma26_tutkintolaji]
      ,[Sarakeryhma27_ID]
      ,[Sarakeryhma27_tyyppi]
      ,[Sarakeryhma27_opp]
      ,[Sarakeryhma27_opmala]
      ,[Sarakeryhma27_opmopa]
      ,[Sarakeryhma27_opmast]
      ,[Sarakeryhma27_opm95opa]
      ,[Sarakeryhma27_koulutussektori]
      ,[Sarakeryhma27_suorv]
      ,[Sarakeryhma27_suorlk]
      ,[Sarakeryhma27_kmaak]
      ,[Sarakeryhma27_olotamm]
      ,[Sarakeryhma27_olosyys]
      ,[Sarakeryhma27_ptoim1r5]
      ,[Sarakeryhma27_amas]
      ,[Sarakeryhma27_koulk]
      ,[Sarakeryhma27_tutkintolaji]
      ,[Sarakeryhma28_ID]
      ,[Sarakeryhma28_tyyppi]
      ,[Sarakeryhma28_opp]
      ,[Sarakeryhma28_opmala]
      ,[Sarakeryhma28_opmopa]
      ,[Sarakeryhma28_opmast]
      ,[Sarakeryhma28_opm95opa]
      ,[Sarakeryhma28_koulutussektori]
      ,[Sarakeryhma28_suorv]
      ,[Sarakeryhma28_suorlk]
      ,[Sarakeryhma28_kmaak]
      ,[Sarakeryhma28_olotamm]
      ,[Sarakeryhma28_olosyys]
      ,[Sarakeryhma28_ptoim1r5]
      ,[Sarakeryhma28_amas]
      ,[Sarakeryhma28_koulk]
      ,[Sarakeryhma28_tutkintolaji]
      ,[Sarakeryhma29_ID]
      ,[Sarakeryhma29_tyyppi]
      ,[Sarakeryhma29_opp]
      ,[Sarakeryhma29_opmala]
      ,[Sarakeryhma29_opmopa]
      ,[Sarakeryhma29_opmast]
      ,[Sarakeryhma29_opm95opa]
      ,[Sarakeryhma29_koulutussektori]
      ,[Sarakeryhma29_suorv]
      ,[Sarakeryhma29_suorlk]
      ,[Sarakeryhma29_kmaak]
      ,[Sarakeryhma29_olotamm]
      ,[Sarakeryhma29_olosyys]
      ,[Sarakeryhma29_ptoim1r5]
      ,[Sarakeryhma29_amas]
      ,[Sarakeryhma29_koulk]
      ,[Sarakeryhma29_tutkintolaji]
      ,[Sarakeryhma30_ID]
      ,[Sarakeryhma30_tyyppi]
      ,[Sarakeryhma30_opp]
      ,[Sarakeryhma30_opmala]
      ,[Sarakeryhma30_opmopa]
      ,[Sarakeryhma30_opmast]
      ,[Sarakeryhma30_opm95opa]
      ,[Sarakeryhma30_koulutussektori]
      ,[Sarakeryhma30_suorv]
      ,[Sarakeryhma30_suorlk]
      ,[Sarakeryhma30_kmaak]
      ,[Sarakeryhma30_olotamm]
      ,[Sarakeryhma30_olosyys]
      ,[Sarakeryhma30_ptoim1r5]
      ,[Sarakeryhma30_amas]
      ,[Sarakeryhma30_koulk]
      ,[Sarakeryhma30_tutkintolaji]
      ,[Sarakeryhma31_ID]
      ,[Sarakeryhma31_tyyppi]
      ,[Sarakeryhma31_opp]
      ,[Sarakeryhma31_opmala]
      ,[Sarakeryhma31_opmopa]
      ,[Sarakeryhma31_opmast]
      ,[Sarakeryhma31_opm95opa]
      ,[Sarakeryhma31_koulutussektori]
      ,[Sarakeryhma31_suorv]
      ,[Sarakeryhma31_suorlk]
      ,[Sarakeryhma31_kmaak]
      ,[Sarakeryhma31_olotamm]
      ,[Sarakeryhma31_olosyys]
      ,[Sarakeryhma31_ptoim1r5]
      ,[Sarakeryhma31_amas]
      ,[Sarakeryhma31_koulk]
      ,[Sarakeryhma31_tutkintolaji]
      ,[Sarakeryhma32_ID]
      ,[Sarakeryhma32_tyyppi]
      ,[Sarakeryhma32_opp]
      ,[Sarakeryhma32_opmala]
      ,[Sarakeryhma32_opmopa]
      ,[Sarakeryhma32_opmast]
      ,[Sarakeryhma32_opm95opa]
      ,[Sarakeryhma32_koulutussektori]
      ,[Sarakeryhma32_suorv]
      ,[Sarakeryhma32_suorlk]
      ,[Sarakeryhma32_kmaak]
      ,[Sarakeryhma32_olotamm]
      ,[Sarakeryhma32_olosyys]
      ,[Sarakeryhma32_ptoim1r5]
      ,[Sarakeryhma32_amas]
      ,[Sarakeryhma32_koulk]
      ,[Sarakeryhma32_tutkintolaji]
      ,[Sarakeryhma33_ID]
      ,[Sarakeryhma33_tyyppi]
      ,[Sarakeryhma33_opp]
      ,[Sarakeryhma33_opmala]
      ,[Sarakeryhma33_opmopa]
      ,[Sarakeryhma33_opmast]
      ,[Sarakeryhma33_opm95opa]
      ,[Sarakeryhma33_koulutussektori]
      ,[Sarakeryhma33_suorv]
      ,[Sarakeryhma33_suorlk]
      ,[Sarakeryhma33_kmaak]
      ,[Sarakeryhma33_olotamm]
      ,[Sarakeryhma33_olosyys]
      ,[Sarakeryhma33_ptoim1r5]
      ,[Sarakeryhma33_amas]
      ,[Sarakeryhma33_koulk]
      ,[Sarakeryhma33_tutkintolaji]
      ,[Sarakeryhma34_ID]
      ,[Sarakeryhma34_tyyppi]
      ,[Sarakeryhma34_opp]
      ,[Sarakeryhma34_opmala]
      ,[Sarakeryhma34_opmopa]
      ,[Sarakeryhma34_opmast]
      ,[Sarakeryhma34_opm95opa]
      ,[Sarakeryhma34_koulutussektori]
      ,[Sarakeryhma34_suorv]
      ,[Sarakeryhma34_suorlk]
      ,[Sarakeryhma34_kmaak]
      ,[Sarakeryhma34_olotamm]
      ,[Sarakeryhma34_olosyys]
      ,[Sarakeryhma34_ptoim1r5]
      ,[Sarakeryhma34_amas]
      ,[Sarakeryhma34_koulk]
      ,[Sarakeryhma34_tutkintolaji]
      ,[Sarakeryhma35_ID]
      ,[Sarakeryhma35_tyyppi]
      ,[Sarakeryhma35_opp]
      ,[Sarakeryhma35_opmala]
      ,[Sarakeryhma35_opmopa]
      ,[Sarakeryhma35_opmast]
      ,[Sarakeryhma35_opm95opa]
      ,[Sarakeryhma35_koulutussektori]
      ,[Sarakeryhma35_suorv]
      ,[Sarakeryhma35_suorlk]
      ,[Sarakeryhma35_kmaak]
      ,[Sarakeryhma35_olotamm]
      ,[Sarakeryhma35_olosyys]
      ,[Sarakeryhma35_ptoim1r5]
      ,[Sarakeryhma35_amas]
      ,[Sarakeryhma35_koulk]
      ,[Sarakeryhma35_tutkintolaji]
*/
  FROM (

SELECT --TOP 0
	   alo.[tilv]
      ,alo.[lahde]
      ,opp = (SELECT case
			when alo.lahde in (41,42,46,51,52) then 
				isnull(case when CHARINDEX(''K3.10'',alo.tietolahde)>0 then isnull(d17.oppilaitoskoodi,'''') else ''''end, '''')		
				--isnull(dop.oppilaitoskoodi,'''')
			else ''''
			end)

      ,alo.[sp]
      ,alo.[syntv]
      ,alo.[aikielir1]
      ,alo.[alvv]
      ,alo.[allk]
      ,alo.[klaji]
      ,alo.[ophal] --vain K3.9
      ,alo.[jarj]
      ,alo.[kkun]
	  ,maak = isnull(dal.maakunta_koodi,'''')
      ,alo.[koulk]
	  ,opmala = isnull(dko.koulutusala2002_koodi,'''')
	  ,opmopa = isnull(dko.opintoala2002_koodi,'''')
	  ,opmast = isnull(dko.koulutusaste2002_koodi,'''')
	  ,opm95opa = isnull(dko.opintoala1995_koodi,'''')
	  ,koulutussektori = (SELECT
				CASE isnull(dko.koulutusaste2002_koodi,'''')
					when '''' then ''''
					when ''31'' then ''Lukiokoulutus''
					when ''32'' then ''Ammatillinen koulutus''
					when ''62'' then ''Ammattikorkeakoulukoulutus''
					when ''71'' then ''Ammattikorkeakoulukoulutus''
					when ''63'' then ''Yiopistokoulutus''
					when ''72'' then ''Yiopistokoulutus''
					when ''73'' then ''Yiopistokoulutus''
					when ''81'' then ''Yiopistokoulutus'' 
					when ''82'' then ''Yiopistokoulutus''
					else ''Virhetilanne''
				END )
      ,alo.[pohjkoulk]
	  ,alo.alvv_kk -- vain K3.10
	  ,alo.allk_kk -- vain K3.10
	  ,alo.ololk -- vain K3.10
	  ,alo.rahlahde -- vain K3.10
	  ,koulutuslaji2 = (select	
		  case 
			-- Virhetilanne
			when (isnull(alo.klaji,'''')='''' or ISNULL(alo.koulk,'''')='''') then ''virhetilanne''
			-- Muut klajit
			when (isnull(alo.klaji,'''')!='''' and ISNULL(alo.koulk,'''')!='''' and alo.klaji != ''51'') then (SELECT alo.klaji)
			-- Alempaan korkeakoulututkintoon thtv koulutus
			when alo.klaji = ''51'' then
				case (select d.koulutusaste2002_koodi
					  from d_koulutusluokitus d 
-- Siirretty uuteen koulutusluokitus-dimensioon / Jarmo 10.5.2013
-- vipunen_tk.d_koulutusluokitus d
					  where d.koulutus_koodi = alo.koulk
--							and alo.tilv between YEAR(alkaa) and YEAR(paattyy))
							and alo.tilv between YEAR(alkaa) and YEAR(isnull(paattyy,''9999-01-01'')))
					  when ''63'' then
						case
							when (alo.koulk=''612101'' or alo.koulk=''634101'' or alo.koulk=''672401'') then ''51a''
							when (alo.koulk!=''612101'' and alo.koulk!=''634101'' and alo.koulk!=''672401'') then ''51b''
							else ''''
						end
				when ''72'' then ''51b''
				else ''''
				end
			-- Virhetilanne
			else ''''
		  end -- end of case
		)
      ,alo.[tietolahde]
      --,alo.[rivinumero]
      ,alo.[aineistorivinumero]
      ,alo.[lkm_int]
      
      ,''Sarakeryhma1_ID'' = alo.[Sarakeryhma_ID1]
      ,''Sarakeryhma1_tyyppi'' = ava1.tyyppi
      --,[Sarakeryhma_arvo1]
      ,''Sarakeryhma1_opp'' = ava1.opp
      ,''Sarakeryhma1_opmala'' = ava1.opmala
      ,''Sarakeryhma1_opmopa'' = ava1.opmopa
      ,''Sarakeryhma1_opmast'' = ava1.opmast
      ,''Sarakeryhma1_opm95opa'' = ava1.opm95opa
      ,''Sarakeryhma1_koulutussektori'' = ava1.koulutussektori
      ,''Sarakeryhma1_suorv'' = ava1.suorv
      ,''Sarakeryhma1_suorlk'' = ava1.suorlk
      ,''Sarakeryhma1_kmaak'' = Case when ava1.tutkmaak is not null then ava1.tutkmaak
								when ava1.kmaak is not null then ava1.kmaak
								when ava1.kmaak_2 is not null then ava1.kmaak_2 else null end
      ,''Sarakeryhma1_olotamm'' = ava1.olotamm_2
      ,''Sarakeryhma1_olosyys'' = ava1.olosyys_2
      ,''Sarakeryhma1_ptoim1r5'' = ava1.ptoim1r5
      ,''Sarakeryhma1_amas'' = ava1.amas
      ,''Sarakeryhma1_koulk'' = Case when ava1.tutkkoulk is not null then ava1.tutkkoulk
								when ava1.opiskkoulk is not null then ava1.opiskkoulk
								when ava1.opiskkoulk_2 is not null then ava1.opiskkoulk_2 else null end
      ,''Sarakeryhma1_jarj'' = Case when ava1.tutkjarj is not null then ava1.tutkjarj
								when ava1.opiskjarj is not null then ava1.opiskjarj
								when ava1.opiskjarj_2 is not null then ava1.opiskjarj_2 else null end
      ,''Sarakeryhma1_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID1],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID1],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID1],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID1],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID1],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID1],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID1],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID1],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID1],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID1],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID1] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma2_ID'' = alo.[Sarakeryhma_ID2]
      ,''Sarakeryhma2_tyyppi'' = ava2.tyyppi
      --,[Sarakeryhma_arvo2]
      ,''Sarakeryhma2_opp'' = ava2.opp
      ,''Sarakeryhma2_opmala'' = ava2.opmala
      ,''Sarakeryhma2_opmopa'' = ava2.opmopa
      ,''Sarakeryhma2_opmast'' = ava2.opmast
      ,''Sarakeryhma2_opm95opa'' = ava2.opm95opa
      ,''Sarakeryhma2_koulutussektori'' = ava2.koulutussektori
      ,''Sarakeryhma2_suorv'' = ava2.suorv
      ,''Sarakeryhma2_suorlk'' = ava2.suorlk
      ,''Sarakeryhma2_kmaak'' = Case when ava2.tutkmaak is not null then ava2.tutkmaak
								when ava2.kmaak is not null then ava2.kmaak
								when ava2.kmaak_2 is not null then ava2.kmaak_2 else null end
      ,''Sarakeryhma2_olotamm'' = ava2.olotamm_2
      ,''Sarakeryhma2_olosyys'' = ava2.olosyys_2
      ,''Sarakeryhma2_ptoim1r5'' = ava2.ptoim1r5
      ,''Sarakeryhma2_amas'' = ava2.amas
      ,''Sarakeryhma2_koulk'' = Case when ava2.tutkkoulk is not null then ava2.tutkkoulk
								when ava2.opiskkoulk is not null then ava2.opiskkoulk
								when ava2.opiskkoulk_2 is not null then ava2.opiskkoulk_2 else null end
      ,''Sarakeryhma2_jarj'' = Case when ava2.tutkjarj is not null then ava2.tutkjarj
								when ava2.opiskjarj is not null then ava2.opiskjarj
								when ava2.opiskjarj_2 is not null then ava2.opiskjarj_2 else null end
      ,''Sarakeryhma2_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID2],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID2],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID2],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID2],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID2],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID2],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID2],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID2],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID2],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID2],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID2] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma3_ID'' = alo.[Sarakeryhma_ID3]
      ,''Sarakeryhma3_tyyppi'' = ava3.tyyppi
      --,[Sarakeryhma_arvo3]
      ,''Sarakeryhma3_opp'' = ava3.opp
      ,''Sarakeryhma3_opmala'' = ava3.opmala
      ,''Sarakeryhma3_opmopa'' = ava3.opmopa
      ,''Sarakeryhma3_opmast'' = ava3.opmast
      ,''Sarakeryhma3_opm95opa'' = ava3.opm95opa
      ,''Sarakeryhma3_koulutussektori'' = ava3.koulutussektori
      ,''Sarakeryhma3_suorv'' = ava3.suorv
      ,''Sarakeryhma3_suorlk'' = ava3.suorlk
      ,''Sarakeryhma3_kmaak'' = Case when ava3.tutkmaak is not null then ava3.tutkmaak
								when ava3.kmaak is not null then ava3.kmaak
								when ava3.kmaak_2 is not null then ava3.kmaak_2 else null end
      ,''Sarakeryhma3_olotamm'' = ava3.olotamm_2
      ,''Sarakeryhma3_olosyys'' = ava3.olosyys_2
      ,''Sarakeryhma3_ptoim1r5'' = ava3.ptoim1r5
      ,''Sarakeryhma3_amas'' = ava3.amas
      ,''Sarakeryhma3_koulk'' = Case when ava3.tutkkoulk is not null then ava3.tutkkoulk
								when ava3.opiskkoulk is not null then ava3.opiskkoulk
								when ava3.opiskkoulk_2 is not null then ava3.opiskkoulk_2 else null end
      ,''Sarakeryhma3_jarj'' = Case when ava3.tutkjarj is not null then ava3.tutkjarj
								when ava3.opiskjarj is not null then ava3.opiskjarj
								when ava3.opiskjarj_2 is not null then ava3.opiskjarj_2 else null end
      ,''Sarakeryhma3_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID3],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID3],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID3],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID3],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID3],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID3],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID3],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID3],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID3],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID3],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID3] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma4_ID'' = alo.[Sarakeryhma_ID4]
      ,''Sarakeryhma4_tyyppi'' = ava4.tyyppi
      --,[Sarakeryhma_arvo4]
      ,''Sarakeryhma4_opp'' = ava4.opp
      ,''Sarakeryhma4_opmala'' = ava4.opmala
      ,''Sarakeryhma4_opmopa'' = ava4.opmopa
      ,''Sarakeryhma4_opmast'' = ava4.opmast
      ,''Sarakeryhma4_opm95opa'' = ava4.opm95opa
      ,''Sarakeryhma4_koulutussektori'' = ava4.koulutussektori
      ,''Sarakeryhma4_suorv'' = ava4.suorv
      ,''Sarakeryhma4_suorlk'' = ava4.suorlk
      ,''Sarakeryhma4_kmaak'' = Case when ava4.tutkmaak is not null then ava4.tutkmaak
								when ava4.kmaak is not null then ava4.kmaak
								when ava4.kmaak_2 is not null then ava4.kmaak_2 else null end
      ,''Sarakeryhma4_olotamm'' = ava4.olotamm_2
      ,''Sarakeryhma4_olosyys'' = ava4.olosyys_2
      ,''Sarakeryhma4_ptoim1r5'' = ava4.ptoim1r5
      ,''Sarakeryhma4_amas'' = ava4.amas
      ,''Sarakeryhma4_koulk'' = Case when ava4.tutkkoulk is not null then ava4.tutkkoulk
								when ava4.opiskkoulk is not null then ava4.opiskkoulk
								when ava4.opiskkoulk_2 is not null then ava4.opiskkoulk_2 else null end
      ,''Sarakeryhma4_jarj'' = Case when ava4.tutkjarj is not null then ava4.tutkjarj
								when ava4.opiskjarj is not null then ava4.opiskjarj
								when ava4.opiskjarj_2 is not null then ava4.opiskjarj_2 else null end
      ,''Sarakeryhma4_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID4],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID4],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID4],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID4],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID4],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID4],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID4],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID4],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID4],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID4],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID4] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma5_ID'' = alo.[Sarakeryhma_ID5]
      ,''Sarakeryhma5_tyyppi'' = ava5.tyyppi
      --,[Sarakeryhma_arvo5]
      ,''Sarakeryhma5_opp'' = ava5.opp
      ,''Sarakeryhma5_opmala'' = ava5.opmala
      ,''Sarakeryhma5_opmopa'' = ava5.opmopa
      ,''Sarakeryhma5_opmast'' = ava5.opmast
      ,''Sarakeryhma5_opm95opa'' = ava5.opm95opa
      ,''Sarakeryhma5_koulutussektori'' = ava5.koulutussektori
      ,''Sarakeryhma5_suorv'' = ava5.suorv
      ,''Sarakeryhma5_suorlk'' = ava5.suorlk
      ,''Sarakeryhma5_kmaak'' = Case when ava5.tutkmaak is not null then ava5.tutkmaak
								when ava5.kmaak is not null then ava5.kmaak
								when ava5.kmaak_2 is not null then ava5.kmaak_2 else null end
      ,''Sarakeryhma5_olotamm'' = ava5.olotamm_2
      ,''Sarakeryhma5_olosyys'' = ava5.olosyys_2
      ,''Sarakeryhma5_ptoim1r5'' = ava5.ptoim1r5
      ,''Sarakeryhma5_amas'' = ava5.amas
      ,''Sarakeryhma5_koulk'' = Case when ava5.tutkkoulk is not null then ava5.tutkkoulk
								when ava5.opiskkoulk is not null then ava5.opiskkoulk
								when ava5.opiskkoulk_2 is not null then ava5.opiskkoulk_2 else null end
      ,''Sarakeryhma5_jarj'' = Case when ava5.tutkjarj is not null then ava5.tutkjarj
								when ava5.opiskjarj is not null then ava5.opiskjarj
								when ava5.opiskjarj_2 is not null then ava5.opiskjarj_2 else null end
      ,''Sarakeryhma5_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID5],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID5],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID5],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID5],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID5],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID5],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID5],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID5],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID5],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID5],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID5] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma6_ID'' = alo.[Sarakeryhma_ID6]
      ,''Sarakeryhma6_tyyppi'' = ava6.tyyppi
      --,[Sarakeryhma_arvo6]
      ,''Sarakeryhma6_opp'' = ava6.opp
      ,''Sarakeryhma6_opmala'' = ava6.opmala
      ,''Sarakeryhma6_opmopa'' = ava6.opmopa
      ,''Sarakeryhma6_opmast'' = ava6.opmast
      ,''Sarakeryhma6_opm95opa'' = ava6.opm95opa
      ,''Sarakeryhma6_koulutussektori'' = ava6.koulutussektori
      ,''Sarakeryhma6_suorv'' = ava6.suorv
      ,''Sarakeryhma6_suorlk'' = ava6.suorlk
      ,''Sarakeryhma6_kmaak'' = Case when ava6.tutkmaak is not null then ava6.tutkmaak
								when ava6.kmaak is not null then ava6.kmaak
								when ava6.kmaak_2 is not null then ava6.kmaak_2 else null end
      ,''Sarakeryhma6_olotamm'' = ava6.olotamm_2
      ,''Sarakeryhma6_olosyys'' = ava6.olosyys_2
      ,''Sarakeryhma6_ptoim1r5'' = ava6.ptoim1r5
      ,''Sarakeryhma6_amas'' = ava6.amas
      ,''Sarakeryhma6_koulk'' = Case when ava6.tutkkoulk is not null then ava6.tutkkoulk
								when ava6.opiskkoulk is not null then ava6.opiskkoulk
								when ava6.opiskkoulk_2 is not null then ava6.opiskkoulk_2 else null end
      ,''Sarakeryhma6_jarj'' = Case when ava6.tutkjarj is not null then ava6.tutkjarj
								when ava6.opiskjarj is not null then ava6.opiskjarj
								when ava6.opiskjarj_2 is not null then ava6.opiskjarj_2 else null end
      ,''Sarakeryhma6_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID6],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID6],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID6],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID6],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID6],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID6],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID6],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID6],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID6],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID6],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID6] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma7_ID'' = alo.[Sarakeryhma_ID7]
      ,''Sarakeryhma7_tyyppi'' = ava7.tyyppi
      --,[Sarakeryhma_arvo7]
      ,''Sarakeryhma7_opp'' = ava7.opp
      ,''Sarakeryhma7_opmala'' = ava7.opmala
      ,''Sarakeryhma7_opmopa'' = ava7.opmopa
      ,''Sarakeryhma7_opmast'' = ava7.opmast
      ,''Sarakeryhma7_opm95opa'' = ava7.opm95opa
      ,''Sarakeryhma7_koulutussektori'' = ava7.koulutussektori
      ,''Sarakeryhma7_suorv'' = ava7.suorv
      ,''Sarakeryhma7_suorlk'' = ava7.suorlk
      ,''Sarakeryhma7_kmaak'' = Case when ava7.tutkmaak is not null then ava7.tutkmaak
								when ava7.kmaak is not null then ava7.kmaak
								when ava7.kmaak_2 is not null then ava7.kmaak_2 else null end
      ,''Sarakeryhma7_olotamm'' = ava7.olotamm_2
      ,''Sarakeryhma7_olosyys'' = ava7.olosyys_2
      ,''Sarakeryhma7_ptoim1r5'' = ava7.ptoim1r5
      ,''Sarakeryhma7_amas'' = ava7.amas
      ,''Sarakeryhma7_koulk'' = Case when ava7.tutkkoulk is not null then ava7.tutkkoulk
								when ava7.opiskkoulk is not null then ava7.opiskkoulk
								when ava7.opiskkoulk_2 is not null then ava7.opiskkoulk_2 else null end
      ,''Sarakeryhma7_jarj'' = Case when ava7.tutkjarj is not null then ava7.tutkjarj
								when ava7.opiskjarj is not null then ava7.opiskjarj
								when ava7.opiskjarj_2 is not null then ava7.opiskjarj_2 else null end
      ,''Sarakeryhma7_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID7],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID7],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID7],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID7],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID7],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID7],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID7],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID7],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID7],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID7],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID7] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma8_ID'' = alo.[Sarakeryhma_ID8]
      ,''Sarakeryhma8_tyyppi'' = ava8.tyyppi
      --,[Sarakeryhma_arvo8]
      ,''Sarakeryhma8_opp'' = ava8.opp
      ,''Sarakeryhma8_opmala'' = ava8.opmala
      ,''Sarakeryhma8_opmopa'' = ava8.opmopa
      ,''Sarakeryhma8_opmast'' = ava8.opmast
      ,''Sarakeryhma8_opm95opa'' = ava8.opm95opa
      ,''Sarakeryhma8_koulutussektori'' = ava8.koulutussektori
      ,''Sarakeryhma8_suorv'' = ava8.suorv
      ,''Sarakeryhma8_suorlk'' = ava8.suorlk
      ,''Sarakeryhma8_kmaak'' = Case when ava8.tutkmaak is not null then ava8.tutkmaak
								when ava8.kmaak is not null then ava8.kmaak
								when ava8.kmaak_2 is not null then ava8.kmaak_2 else null end
      ,''Sarakeryhma8_olotamm'' = ava8.olotamm_2
      ,''Sarakeryhma8_olosyys'' = ava8.olosyys_2
      ,''Sarakeryhma8_ptoim1r5'' = ava8.ptoim1r5
      ,''Sarakeryhma8_amas'' = ava8.amas
      ,''Sarakeryhma8_koulk'' = Case when ava8.tutkkoulk is not null then ava8.tutkkoulk
								when ava8.opiskkoulk is not null then ava8.opiskkoulk
								when ava8.opiskkoulk_2 is not null then ava8.opiskkoulk_2 else null end
      ,''Sarakeryhma8_jarj'' = Case when ava8.tutkjarj is not null then ava8.tutkjarj
								when ava8.opiskjarj is not null then ava8.opiskjarj
								when ava8.opiskjarj_2 is not null then ava8.opiskjarj_2 else null end
      ,''Sarakeryhma8_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID8],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID8],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID8],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID8],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID8],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID8],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID8],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID8],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID8],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID8],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID8] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma9_ID'' = alo.[Sarakeryhma_ID9]
      ,''Sarakeryhma9_tyyppi'' = ava9.tyyppi
      --,[Sarakeryhma_arvo9]
      ,''Sarakeryhma9_opp'' = ava9.opp
      ,''Sarakeryhma9_opmala'' = ava9.opmala
      ,''Sarakeryhma9_opmopa'' = ava9.opmopa
      ,''Sarakeryhma9_opmast'' = ava9.opmast
      ,''Sarakeryhma9_opm95opa'' = ava9.opm95opa
      ,''Sarakeryhma9_koulutussektori'' = ava9.koulutussektori
      ,''Sarakeryhma9_suorv'' = ava9.suorv
      ,''Sarakeryhma9_suorlk'' = ava9.suorlk
      ,''Sarakeryhma9_kmaak'' = Case when ava9.tutkmaak is not null then ava9.tutkmaak
								when ava9.kmaak is not null then ava9.kmaak
								when ava9.kmaak_2 is not null then ava9.kmaak_2 else null end
      ,''Sarakeryhma9_olotamm'' = ava9.olotamm_2
      ,''Sarakeryhma9_olosyys'' = ava9.olosyys_2
      ,''Sarakeryhma9_ptoim1r5'' = ava9.ptoim1r5
      ,''Sarakeryhma9_amas'' = ava9.amas
      ,''Sarakeryhma9_koulk'' = Case when ava9.tutkkoulk is not null then ava9.tutkkoulk
								when ava9.opiskkoulk is not null then ava9.opiskkoulk
								when ava9.opiskkoulk_2 is not null then ava9.opiskkoulk_2 else null end
      ,''Sarakeryhma9_jarj'' = Case when ava9.tutkjarj is not null then ava9.tutkjarj
								when ava9.opiskjarj is not null then ava9.opiskjarj
								when ava9.opiskjarj_2 is not null then ava9.opiskjarj_2 else null end
      ,''Sarakeryhma9_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID9],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID9],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID9],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID9],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID9],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID9],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID9],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID9],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID9],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID9],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID9] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma10_ID'' = alo.[Sarakeryhma_ID10]
      ,''Sarakeryhma10_tyyppi'' = ava10.tyyppi
      --,[Sarakeryhma_arvo10]
      ,''Sarakeryhma10_opp'' = ava10.opp
      ,''Sarakeryhma10_opmala'' = ava10.opmala
      ,''Sarakeryhma10_opmopa'' = ava10.opmopa
      ,''Sarakeryhma10_opmast'' = ava10.opmast
      ,''Sarakeryhma10_opm95opa'' = ava10.opm95opa
      ,''Sarakeryhma10_koulutussektori'' = ava10.koulutussektori
      ,''Sarakeryhma10_suorv'' = ava10.suorv
      ,''Sarakeryhma10_suorlk'' = ava10.suorlk
      ,''Sarakeryhma10_kmaak'' = Case when ava10.tutkmaak is not null then ava10.tutkmaak
								when ava10.kmaak is not null then ava10.kmaak
								when ava10.kmaak_2 is not null then ava10.kmaak_2 else null end
      ,''Sarakeryhma10_olotamm'' = ava10.olotamm_2
      ,''Sarakeryhma10_olosyys'' = ava10.olosyys_2
      ,''Sarakeryhma10_ptoim1r5'' = ava10.ptoim1r5
      ,''Sarakeryhma10_amas'' = ava10.amas
      ,''Sarakeryhma10_koulk'' = Case when ava10.tutkkoulk is not null then ava10.tutkkoulk
								when ava10.opiskkoulk is not null then ava10.opiskkoulk
								when ava10.opiskkoulk_2 is not null then ava10.opiskkoulk_2 else null end
      ,''Sarakeryhma10_jarj'' = Case when ava10.tutkjarj is not null then ava10.tutkjarj
								when ava10.opiskjarj is not null then ava10.opiskjarj
								when ava10.opiskjarj_2 is not null then ava10.opiskjarj_2 else null end
      ,''Sarakeryhma10_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID10],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID10],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID10],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID10],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID10],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID10],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID10],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID10],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID10],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID10],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID10] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma11_ID'' = alo.[Sarakeryhma_ID11]
      ,''Sarakeryhma11_tyyppi'' = ava11.tyyppi
      --,[Sarakeryhma_arvo11]
      ,''Sarakeryhma11_opp'' = ava11.opp
      ,''Sarakeryhma11_opmala'' = ava11.opmala
      ,''Sarakeryhma11_opmopa'' = ava11.opmopa
      ,''Sarakeryhma11_opmast'' = ava11.opmast
      ,''Sarakeryhma11_opm95opa'' = ava11.opm95opa
      ,''Sarakeryhma11_koulutussektori'' = ava11.koulutussektori
      ,''Sarakeryhma11_suorv'' = ava11.suorv
      ,''Sarakeryhma11_suorlk'' = ava11.suorlk
      ,''Sarakeryhma11_kmaak'' = Case when ava11.tutkmaak is not null then ava11.tutkmaak
								when ava11.kmaak is not null then ava11.kmaak
								when ava11.kmaak_2 is not null then ava11.kmaak_2 else null end
      ,''Sarakeryhma11_olotamm'' = ava11.olotamm_2
      ,''Sarakeryhma11_olosyys'' = ava11.olosyys_2
      ,''Sarakeryhma11_ptoim1r5'' = ava11.ptoim1r5
      ,''Sarakeryhma11_amas'' = ava11.amas
      ,''Sarakeryhma11_koulk'' = Case when ava11.tutkkoulk is not null then ava11.tutkkoulk
								when ava11.opiskkoulk is not null then ava11.opiskkoulk
								when ava11.opiskkoulk_2 is not null then ava11.opiskkoulk_2 else null end
      ,''Sarakeryhma11_jarj'' = Case when ava11.tutkjarj is not null then ava11.tutkjarj
								when ava11.opiskjarj is not null then ava11.opiskjarj
								when ava11.opiskjarj_2 is not null then ava11.opiskjarj_2 else null end
      ,''Sarakeryhma11_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID11],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID11],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID11],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID11],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID11],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID11],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID11],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID11],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID11],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID11],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID11] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma12_ID'' = alo.[Sarakeryhma_ID12]
      ,''Sarakeryhma12_tyyppi'' = ava12.tyyppi
      --,[Sarakeryhma_arvo12]
      ,''Sarakeryhma12_opp'' = ava12.opp
      ,''Sarakeryhma12_opmala'' = ava12.opmala
      ,''Sarakeryhma12_opmopa'' = ava12.opmopa
      ,''Sarakeryhma12_opmast'' = ava12.opmast
      ,''Sarakeryhma12_opm95opa'' = ava12.opm95opa
      ,''Sarakeryhma12_koulutussektori'' = ava12.koulutussektori
      ,''Sarakeryhma12_suorv'' = ava12.suorv
      ,''Sarakeryhma12_suorlk'' = ava12.suorlk
      ,''Sarakeryhma12_kmaak'' = Case when ava12.tutkmaak is not null then ava12.tutkmaak
								when ava12.kmaak is not null then ava12.kmaak
								when ava12.kmaak_2 is not null then ava12.kmaak_2 else null end
      ,''Sarakeryhma12_olotamm'' = ava12.olotamm_2
      ,''Sarakeryhma12_olosyys'' = ava12.olosyys_2
      ,''Sarakeryhma12_ptoim1r5'' = ava12.ptoim1r5
      ,''Sarakeryhma12_amas'' = ava12.amas
      ,''Sarakeryhma12_koulk'' = Case when ava12.tutkkoulk is not null then ava12.tutkkoulk
								when ava12.opiskkoulk is not null then ava12.opiskkoulk
								when ava12.opiskkoulk_2 is not null then ava12.opiskkoulk_2 else null end
      ,''Sarakeryhma12_jarj'' = Case when ava12.tutkjarj is not null then ava12.tutkjarj
								when ava12.opiskjarj is not null then ava12.opiskjarj
								when ava12.opiskjarj_2 is not null then ava12.opiskjarj_2 else null end
      ,''Sarakeryhma12_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID12],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID12],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID12],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID12],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID12],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID12],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID12],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID12],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID12],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID12],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID12] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma13_ID'' = alo.[Sarakeryhma_ID13]
      ,''Sarakeryhma13_tyyppi'' = ava13.tyyppi
      --,[Sarakeryhma_arvo13]
      ,''Sarakeryhma13_opp'' = ava13.opp
      ,''Sarakeryhma13_opmala'' = ava13.opmala
      ,''Sarakeryhma13_opmopa'' = ava13.opmopa
      ,''Sarakeryhma13_opmast'' = ava13.opmast
      ,''Sarakeryhma13_opm95opa'' = ava13.opm95opa
      ,''Sarakeryhma13_koulutussektori'' = ava13.koulutussektori
      ,''Sarakeryhma13_suorv'' = ava13.suorv
      ,''Sarakeryhma13_suorlk'' = ava13.suorlk
      ,''Sarakeryhma13_kmaak'' = Case when ava13.tutkmaak is not null then ava13.tutkmaak
								when ava13.kmaak is not null then ava13.kmaak
								when ava13.kmaak_2 is not null then ava13.kmaak_2 else null end
      ,''Sarakeryhma13_olotamm'' = ava13.olotamm_2
      ,''Sarakeryhma13_olosyys'' = ava13.olosyys_2
      ,''Sarakeryhma13_ptoim1r5'' = ava13.ptoim1r5
      ,''Sarakeryhma13_amas'' = ava13.amas
      ,''Sarakeryhma13_koulk'' = Case when ava13.tutkkoulk is not null then ava13.tutkkoulk
								when ava13.opiskkoulk is not null then ava13.opiskkoulk
								when ava13.opiskkoulk_2 is not null then ava13.opiskkoulk_2 else null end
      ,''Sarakeryhma13_jarj'' = Case when ava13.tutkjarj is not null then ava13.tutkjarj
								when ava13.opiskjarj is not null then ava13.opiskjarj
								when ava13.opiskjarj_2 is not null then ava13.opiskjarj_2 else null end
      ,''Sarakeryhma13_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID13],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID13],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID13],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID13],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID13],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID13],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID13],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID13],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID13],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID13],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID13] is null then null
								else ''muu'' end
     
      ,''Sarakeryhma14_ID'' = alo.[Sarakeryhma_ID14]
      ,''Sarakeryhma14_tyyppi'' = ava14.tyyppi
      --,[Sarakeryhma_arvo14]
      ,''Sarakeryhma14_opp'' = ava14.opp
      ,''Sarakeryhma14_opmala'' = ava14.opmala
      ,''Sarakeryhma14_opmopa'' = ava14.opmopa
      ,''Sarakeryhma14_opmast'' = ava14.opmast
      ,''Sarakeryhma14_opm95opa'' = ava14.opm95opa
      ,''Sarakeryhma14_koulutussektori'' = ava14.koulutussektori
      ,''Sarakeryhma14_suorv'' = ava14.suorv
      ,''Sarakeryhma14_suorlk'' = ava14.suorlk
      ,''Sarakeryhma14_kmaak'' = Case when ava14.tutkmaak is not null then ava14.tutkmaak
								when ava14.kmaak is not null then ava14.kmaak
								when ava14.kmaak_2 is not null then ava14.kmaak_2 else null end
      ,''Sarakeryhma14_olotamm'' = ava14.olotamm_2
      ,''Sarakeryhma14_olosyys'' = ava14.olosyys_2
      ,''Sarakeryhma14_ptoim1r5'' = ava14.ptoim1r5
      ,''Sarakeryhma14_amas'' = ava14.amas
      ,''Sarakeryhma14_koulk'' = Case when ava14.tutkkoulk is not null then ava14.tutkkoulk
								when ava14.opiskkoulk is not null then ava14.opiskkoulk
								when ava14.opiskkoulk_2 is not null then ava14.opiskkoulk_2 else null end
      ,''Sarakeryhma14_jarj'' = Case when ava14.tutkjarj is not null then ava14.tutkjarj
								when ava14.opiskjarj is not null then ava14.opiskjarj
								when ava14.opiskjarj_2 is not null then ava14.opiskjarj_2 else null end
      ,''Sarakeryhma14_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID14],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID14],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID14],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID14],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID14],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID14],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID14],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID14],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID14],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID14],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID14] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma15_ID'' = alo.[Sarakeryhma_ID15]
      ,''Sarakeryhma15_tyyppi'' = ava15.tyyppi
      --,[Sarakeryhma_arvo15]
      ,''Sarakeryhma15_opp'' = ava15.opp
      ,''Sarakeryhma15_opmala'' = ava15.opmala
      ,''Sarakeryhma15_opmopa'' = ava15.opmopa
      ,''Sarakeryhma15_opmast'' = ava15.opmast
      ,''Sarakeryhma15_opm95opa'' = ava15.opm95opa
      ,''Sarakeryhma15_koulutussektori'' = ava15.koulutussektori
      ,''Sarakeryhma15_suorv'' = ava15.suorv
      ,''Sarakeryhma15_suorlk'' = ava15.suorlk
      ,''Sarakeryhma15_kmaak'' = Case when ava15.tutkmaak is not null then ava15.tutkmaak
								when ava15.kmaak is not null then ava15.kmaak
								when ava15.kmaak_2 is not null then ava15.kmaak_2 else null end
      ,''Sarakeryhma15_olotamm'' = ava15.olotamm_2
      ,''Sarakeryhma15_olosyys'' = ava15.olosyys_2
      ,''Sarakeryhma15_ptoim1r5'' = ava15.ptoim1r5
      ,''Sarakeryhma15_amas'' = ava15.amas
      ,''Sarakeryhma15_koulk'' = Case when ava15.tutkkoulk is not null then ava15.tutkkoulk
								when ava15.opiskkoulk is not null then ava15.opiskkoulk
								when ava15.opiskkoulk_2 is not null then ava15.opiskkoulk_2 else null end
      ,''Sarakeryhma15_jarj'' = Case when ava15.tutkjarj is not null then ava15.tutkjarj
								when ava15.opiskjarj is not null then ava15.opiskjarj
								when ava15.opiskjarj_2 is not null then ava15.opiskjarj_2 else null end
      ,''Sarakeryhma15_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID15],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID15],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID15],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID15],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID15],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID15],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID15],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID15],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID15],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID15],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID15] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma16_ID'' = alo.[Sarakeryhma_ID16]
      ,''Sarakeryhma16_tyyppi'' = ava16.tyyppi
      --,[Sarakeryhma_arvo16]
      ,''Sarakeryhma16_opp'' = ava16.opp
      ,''Sarakeryhma16_opmala'' = ava16.opmala
      ,''Sarakeryhma16_opmopa'' = ava16.opmopa
      ,''Sarakeryhma16_opmast'' = ava16.opmast
      ,''Sarakeryhma16_opm95opa'' = ava16.opm95opa
      ,''Sarakeryhma16_koulutussektori'' = ava16.koulutussektori
      ,''Sarakeryhma16_suorv'' = ava16.suorv
      ,''Sarakeryhma16_suorlk'' = ava16.suorlk
      ,''Sarakeryhma16_kmaak'' = Case when ava16.tutkmaak is not null then ava16.tutkmaak
								when ava16.kmaak is not null then ava16.kmaak
								when ava16.kmaak_2 is not null then ava16.kmaak_2 else null end
      ,''Sarakeryhma16_olotamm'' = ava16.olotamm_2
      ,''Sarakeryhma16_olosyys'' = ava16.olosyys_2
      ,''Sarakeryhma16_ptoim1r5'' = ava16.ptoim1r5
      ,''Sarakeryhma16_amas'' = ava16.amas
      ,''Sarakeryhma16_koulk'' = Case when ava16.tutkkoulk is not null then ava16.tutkkoulk
								when ava16.opiskkoulk is not null then ava16.opiskkoulk
								when ava16.opiskkoulk_2 is not null then ava16.opiskkoulk_2 else null end
      ,''Sarakeryhma16_jarj'' = Case when ava16.tutkjarj is not null then ava16.tutkjarj
								when ava16.opiskjarj is not null then ava16.opiskjarj
								when ava16.opiskjarj_2 is not null then ava16.opiskjarj_2 else null end
      ,''Sarakeryhma16_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID16],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID16],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID16],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID16],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID16],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID16],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID16],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID16],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID16],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID16],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID16] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma17_ID'' = alo.[Sarakeryhma_ID17]
      ,''Sarakeryhma17_tyyppi'' = ava17.tyyppi
      --,[Sarakeryhma_arvo17]
      ,''Sarakeryhma17_opp'' = ava17.opp
      ,''Sarakeryhma17_opmala'' = ava17.opmala
      ,''Sarakeryhma17_opmopa'' = ava17.opmopa
      ,''Sarakeryhma17_opmast'' = ava17.opmast
      ,''Sarakeryhma17_opm95opa'' = ava17.opm95opa
      ,''Sarakeryhma17_koulutussektori'' = ava17.koulutussektori
      ,''Sarakeryhma17_suorv'' = ava17.suorv
      ,''Sarakeryhma17_suorlk'' = ava17.suorlk
      ,''Sarakeryhma17_kmaak'' = Case when ava17.tutkmaak is not null then ava17.tutkmaak
								when ava17.kmaak is not null then ava17.kmaak
								when ava17.kmaak_2 is not null then ava17.kmaak_2 else null end
      ,''Sarakeryhma17_olotamm'' = ava17.olotamm_2
      ,''Sarakeryhma17_olosyys'' = ava17.olosyys_2
      ,''Sarakeryhma17_ptoim1r5'' = ava17.ptoim1r5
      ,''Sarakeryhma17_amas'' = ava17.amas
      ,''Sarakeryhma17_koulk'' = Case when ava17.tutkkoulk is not null then ava17.tutkkoulk
								when ava17.opiskkoulk is not null then ava17.opiskkoulk
								when ava17.opiskkoulk_2 is not null then ava17.opiskkoulk_2 else null end
      ,''Sarakeryhma17_jarj'' = Case when ava17.tutkjarj is not null then ava17.tutkjarj
								when ava17.opiskjarj is not null then ava17.opiskjarj
								when ava17.opiskjarj_2 is not null then ava17.opiskjarj_2 else null end
      ,''Sarakeryhma17_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID17],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID17],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID17],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID17],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID17],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID17],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID17],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID17],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID17],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID17],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID17] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma18_ID'' = alo.[Sarakeryhma_ID18]
      ,''Sarakeryhma18_tyyppi'' = ava18.tyyppi
      --,[Sarakeryhma_arvo18]
      ,''Sarakeryhma18_opp'' = ava18.opp
      ,''Sarakeryhma18_opmala'' = ava18.opmala
      ,''Sarakeryhma18_opmopa'' = ava18.opmopa
      ,''Sarakeryhma18_opmast'' = ava18.opmast
      ,''Sarakeryhma18_opm95opa'' = ava18.opm95opa
      ,''Sarakeryhma18_koulutussektori'' = ava18.koulutussektori
      ,''Sarakeryhma18_suorv'' = ava18.suorv
      ,''Sarakeryhma18_suorlk'' = ava18.suorlk
      ,''Sarakeryhma18_kmaak'' = Case when ava18.tutkmaak is not null then ava18.tutkmaak
								when ava18.kmaak is not null then ava18.kmaak
								when ava18.kmaak_2 is not null then ava18.kmaak_2 else null end
      ,''Sarakeryhma18_olotamm'' = ava18.olotamm_2
      ,''Sarakeryhma18_olosyys'' = ava18.olosyys_2
      ,''Sarakeryhma18_ptoim1r5'' = ava18.ptoim1r5
      ,''Sarakeryhma18_amas'' = ava18.amas
      ,''Sarakeryhma18_koulk'' = Case when ava18.tutkkoulk is not null then ava18.tutkkoulk
								when ava18.opiskkoulk is not null then ava18.opiskkoulk
								when ava18.opiskkoulk_2 is not null then ava18.opiskkoulk_2 else null end
      ,''Sarakeryhma18_jarj'' = Case when ava18.tutkjarj is not null then ava18.tutkjarj
								when ava18.opiskjarj is not null then ava18.opiskjarj
								when ava18.opiskjarj_2 is not null then ava18.opiskjarj_2 else null end
      ,''Sarakeryhma18_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID18],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID18],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID18],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID18],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID18],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID18],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID18],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID18],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID18],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID18],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID18] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma19_ID'' = alo.[Sarakeryhma_ID19]
      ,''Sarakeryhma19_tyyppi'' = ava19.tyyppi
      --,[Sarakeryhma_arvo19]
      ,''Sarakeryhma19_opp'' = ava19.opp
      ,''Sarakeryhma19_opmala'' = ava19.opmala
      ,''Sarakeryhma19_opmopa'' = ava19.opmopa
      ,''Sarakeryhma19_opmast'' = ava19.opmast
      ,''Sarakeryhma19_opm95opa'' = ava19.opm95opa
      ,''Sarakeryhma19_koulutussektori'' = ava19.koulutussektori
      ,''Sarakeryhma19_suorv'' = ava19.suorv
      ,''Sarakeryhma19_suorlk'' = ava19.suorlk
      ,''Sarakeryhma19_kmaak'' = Case when ava19.tutkmaak is not null then ava19.tutkmaak
								when ava19.kmaak is not null then ava19.kmaak
								when ava19.kmaak_2 is not null then ava19.kmaak_2 else null end
      ,''Sarakeryhma19_olotamm'' = ava19.olotamm_2
      ,''Sarakeryhma19_olosyys'' = ava19.olosyys_2
      ,''Sarakeryhma19_ptoim1r5'' = ava19.ptoim1r5
      ,''Sarakeryhma19_amas'' = ava19.amas
      ,''Sarakeryhma19_koulk'' = Case when ava19.tutkkoulk is not null then ava19.tutkkoulk
								when ava19.opiskkoulk is not null then ava19.opiskkoulk
								when ava19.opiskkoulk_2 is not null then ava19.opiskkoulk_2 else null end
      ,''Sarakeryhma19_jarj'' = Case when ava19.tutkjarj is not null then ava19.tutkjarj
								when ava19.opiskjarj is not null then ava19.opiskjarj
								when ava19.opiskjarj_2 is not null then ava19.opiskjarj_2 else null end
      ,''Sarakeryhma19_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID19],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID19],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID19],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID19],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID19],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID19],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID19],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID19],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID19],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID19],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID19] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma20_ID'' = alo.[Sarakeryhma_ID20]
      ,''Sarakeryhma20_tyyppi'' = ava20.tyyppi
      --,[Sarakeryhma_arvo20]
      ,''Sarakeryhma20_opp'' = ava20.opp
      ,''Sarakeryhma20_opmala'' = ava20.opmala
      ,''Sarakeryhma20_opmopa'' = ava20.opmopa
      ,''Sarakeryhma20_opmast'' = ava20.opmast
      ,''Sarakeryhma20_opm95opa'' = ava20.opm95opa
      ,''Sarakeryhma20_koulutussektori'' = ava20.koulutussektori
      ,''Sarakeryhma20_suorv'' = ava20.suorv
      ,''Sarakeryhma20_suorlk'' = ava20.suorlk
      ,''Sarakeryhma20_kmaak'' = Case when ava20.tutkmaak is not null then ava20.tutkmaak
								when ava20.kmaak is not null then ava20.kmaak
								when ava20.kmaak_2 is not null then ava20.kmaak_2 else null end
      ,''Sarakeryhma20_olotamm'' = ava20.olotamm_2
      ,''Sarakeryhma20_olosyys'' = ava20.olosyys_2
      ,''Sarakeryhma20_ptoim1r5'' = ava20.ptoim1r5
      ,''Sarakeryhma20_amas'' = ava20.amas
      ,''Sarakeryhma20_koulk'' = Case when ava20.tutkkoulk is not null then ava20.tutkkoulk
								when ava20.opiskkoulk is not null then ava20.opiskkoulk
								when ava20.opiskkoulk_2 is not null then ava20.opiskkoulk_2 else null end
      ,''Sarakeryhma20_jarj'' = Case when ava20.tutkjarj is not null then ava20.tutkjarj
								when ava20.opiskjarj is not null then ava20.opiskjarj
								when ava20.opiskjarj_2 is not null then ava20.opiskjarj_2 else null end
      ,''Sarakeryhma20_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID20],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID20],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID20],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID20],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID20],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID20],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID20],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID20],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID20],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID20],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID20] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma21_ID'' = alo.[Sarakeryhma_ID21]
      ,''Sarakeryhma21_tyyppi'' = ava21.tyyppi
      --,[Sarakeryhma_arvo21]
      ,''Sarakeryhma21_opp'' = ava21.opp
      ,''Sarakeryhma21_opmala'' = ava21.opmala
      ,''Sarakeryhma21_opmopa'' = ava21.opmopa
      ,''Sarakeryhma21_opmast'' = ava21.opmast
      ,''Sarakeryhma21_opm95opa'' = ava21.opm95opa
      ,''Sarakeryhma21_koulutussektori'' = ava21.koulutussektori
      ,''Sarakeryhma21_suorv'' = ava21.suorv
      ,''Sarakeryhma21_suorlk'' = ava21.suorlk
      ,''Sarakeryhma21_kmaak'' = Case when ava21.tutkmaak is not null then ava21.tutkmaak
								when ava21.kmaak is not null then ava21.kmaak
								when ava21.kmaak_2 is not null then ava21.kmaak_2 else null end
      ,''Sarakeryhma21_olotamm'' = ava21.olotamm_2
      ,''Sarakeryhma21_olosyys'' = ava21.olosyys_2
      ,''Sarakeryhma21_ptoim1r5'' = ava21.ptoim1r5
      ,''Sarakeryhma21_amas'' = ava21.amas
      ,''Sarakeryhma21_koulk'' = Case when ava21.tutkkoulk is not null then ava21.tutkkoulk
								when ava21.opiskkoulk is not null then ava21.opiskkoulk
								when ava21.opiskkoulk_2 is not null then ava21.opiskkoulk_2 else null end
      ,''Sarakeryhma21_jarj'' = Case when ava21.tutkjarj is not null then ava21.tutkjarj
								when ava21.opiskjarj is not null then ava21.opiskjarj
								when ava21.opiskjarj_2 is not null then ava21.opiskjarj_2 else null end
      ,''Sarakeryhma21_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID21],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID21],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID21],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID21],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID21],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID21],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID21],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID21],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID21],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID21],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID21] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma22_ID'' = alo.[Sarakeryhma_ID22]
      ,''Sarakeryhma22_tyyppi'' = ava22.tyyppi
      --,[Sarakeryhma_arvo22]
      ,''Sarakeryhma22_opp'' = ava22.opp
      ,''Sarakeryhma22_opmala'' = ava22.opmala
      ,''Sarakeryhma22_opmopa'' = ava22.opmopa
      ,''Sarakeryhma22_opmast'' = ava22.opmast
      ,''Sarakeryhma22_opm95opa'' = ava22.opm95opa
      ,''Sarakeryhma22_koulutussektori'' = ava22.koulutussektori
      ,''Sarakeryhma22_suorv'' = ava22.suorv
      ,''Sarakeryhma22_suorlk'' = ava22.suorlk
      ,''Sarakeryhma22_kmaak'' = Case when ava22.tutkmaak is not null then ava22.tutkmaak
								when ava22.kmaak is not null then ava22.kmaak
								when ava22.kmaak_2 is not null then ava22.kmaak_2 else null end
      ,''Sarakeryhma22_olotamm'' = ava22.olotamm_2
      ,''Sarakeryhma22_olosyys'' = ava22.olosyys_2
      ,''Sarakeryhma22_ptoim1r5'' = ava22.ptoim1r5
      ,''Sarakeryhma22_amas'' = ava22.amas
      ,''Sarakeryhma22_koulk'' = Case when ava22.tutkkoulk is not null then ava22.tutkkoulk
								when ava22.opiskkoulk is not null then ava22.opiskkoulk
								when ava22.opiskkoulk_2 is not null then ava22.opiskkoulk_2 else null end
      ,''Sarakeryhma22_jarj'' = Case when ava22.tutkjarj is not null then ava22.tutkjarj
								when ava22.opiskjarj is not null then ava22.opiskjarj
								when ava22.opiskjarj_2 is not null then ava22.opiskjarj_2 else null end
      ,''Sarakeryhma22_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID22],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID22],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID22],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID22],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID22],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID22],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID22],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID22],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID22],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID22],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID22] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma23_ID'' = alo.[Sarakeryhma_ID23]
      ,''Sarakeryhma23_tyyppi'' = ava23.tyyppi
      --,[Sarakeryhma_arvo23]
      ,''Sarakeryhma23_opp'' = ava23.opp
      ,''Sarakeryhma23_opmala'' = ava23.opmala
      ,''Sarakeryhma23_opmopa'' = ava23.opmopa
      ,''Sarakeryhma23_opmast'' = ava23.opmast
      ,''Sarakeryhma23_opm95opa'' = ava23.opm95opa
      ,''Sarakeryhma23_koulutussektori'' = ava23.koulutussektori
      ,''Sarakeryhma23_suorv'' = ava23.suorv
      ,''Sarakeryhma23_suorlk'' = ava23.suorlk
      ,''Sarakeryhma23_kmaak'' = Case when ava23.tutkmaak is not null then ava23.tutkmaak
								when ava23.kmaak is not null then ava23.kmaak
								when ava23.kmaak_2 is not null then ava23.kmaak_2 else null end
      ,''Sarakeryhma23_olotamm'' = ava23.olotamm_2
      ,''Sarakeryhma23_olosyys'' = ava23.olosyys_2
      ,''Sarakeryhma23_ptoim1r5'' = ava23.ptoim1r5
      ,''Sarakeryhma23_amas'' = ava23.amas
      ,''Sarakeryhma23_koulk'' = Case when ava23.tutkkoulk is not null then ava23.tutkkoulk
								when ava23.opiskkoulk is not null then ava23.opiskkoulk
								when ava23.opiskkoulk_2 is not null then ava23.opiskkoulk_2 else null end
      ,''Sarakeryhma23_jarj'' = Case when ava23.tutkjarj is not null then ava23.tutkjarj
								when ava23.opiskjarj is not null then ava23.opiskjarj
								when ava23.opiskjarj_2 is not null then ava23.opiskjarj_2 else null end
      ,''Sarakeryhma23_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID23],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID23],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID23],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID23],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID23],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID23],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID23],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID23],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID23],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID23],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID23] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma24_ID'' = alo.[Sarakeryhma_ID24]
      ,''Sarakeryhma24_tyyppi'' = ava24.tyyppi
      --,[Sarakeryhma_arvo24]
      ,''Sarakeryhma24_opp'' = ava24.opp
      ,''Sarakeryhma24_opmala'' = ava24.opmala
      ,''Sarakeryhma24_opmopa'' = ava24.opmopa
      ,''Sarakeryhma24_opmast'' = ava24.opmast
      ,''Sarakeryhma24_opm95opa'' = ava24.opm95opa
      ,''Sarakeryhma24_koulutussektori'' = ava24.koulutussektori
      ,''Sarakeryhma24_suorv'' = ava24.suorv
      ,''Sarakeryhma24_suorlk'' = ava24.suorlk
      ,''Sarakeryhma24_kmaak'' = Case when ava24.tutkmaak is not null then ava24.tutkmaak
								when ava24.kmaak is not null then ava24.kmaak
								when ava24.kmaak_2 is not null then ava24.kmaak_2 else null end
      ,''Sarakeryhma24_olotamm'' = ava24.olotamm_2
      ,''Sarakeryhma24_olosyys'' = ava24.olosyys_2
      ,''Sarakeryhma24_ptoim1r5'' = ava24.ptoim1r5
      ,''Sarakeryhma24_amas'' = ava24.amas
      ,''Sarakeryhma24_koulk'' = Case when ava24.tutkkoulk is not null then ava24.tutkkoulk
								when ava24.opiskkoulk is not null then ava24.opiskkoulk
								when ava24.opiskkoulk_2 is not null then ava24.opiskkoulk_2 else null end
      ,''Sarakeryhma24_jarj'' = Case when ava24.tutkjarj is not null then ava24.tutkjarj
								when ava24.opiskjarj is not null then ava24.opiskjarj
								when ava24.opiskjarj_2 is not null then ava24.opiskjarj_2 else null end
      ,''Sarakeryhma24_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID24],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID24],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID24],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID24],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID24],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID24],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID24],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID24],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID24],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID24],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID24] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma25_ID'' = alo.[Sarakeryhma_ID25]
      ,''Sarakeryhma25_tyyppi'' = ava25.tyyppi
      --,[Sarakeryhma_arvo25]
      ,''Sarakeryhma25_opp'' = ava25.opp
      ,''Sarakeryhma25_opmala'' = ava25.opmala
      ,''Sarakeryhma25_opmopa'' = ava25.opmopa
      ,''Sarakeryhma25_opmast'' = ava25.opmast
      ,''Sarakeryhma25_opm95opa'' = ava25.opm95opa
      ,''Sarakeryhma25_koulutussektori'' = ava25.koulutussektori
      ,''Sarakeryhma25_suorv'' = ava25.suorv
      ,''Sarakeryhma25_suorlk'' = ava25.suorlk
      ,''Sarakeryhma25_kmaak'' = Case when ava25.tutkmaak is not null then ava25.tutkmaak
								when ava25.kmaak is not null then ava25.kmaak
								when ava25.kmaak_2 is not null then ava25.kmaak_2 else null end
      ,''Sarakeryhma25_olotamm'' = ava25.olotamm_2
      ,''Sarakeryhma25_olosyys'' = ava25.olosyys_2
      ,''Sarakeryhma25_ptoim1r5'' = ava25.ptoim1r5
      ,''Sarakeryhma25_amas'' = ava25.amas
      ,''Sarakeryhma25_koulk'' = Case when ava25.tutkkoulk is not null then ava25.tutkkoulk
								when ava25.opiskkoulk is not null then ava25.opiskkoulk
								when ava25.opiskkoulk_2 is not null then ava25.opiskkoulk_2 else null end
      ,''Sarakeryhma25_jarj'' = Case when ava25.tutkjarj is not null then ava25.tutkjarj
								when ava25.opiskjarj is not null then ava25.opiskjarj
								when ava25.opiskjarj_2 is not null then ava25.opiskjarj_2 else null end
      ,''Sarakeryhma25_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID25],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID25],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID25],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID25],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID25],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID25],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID25],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID25],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID25],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID25],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID25] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma26_ID'' = alo.[Sarakeryhma_ID26]
      ,''Sarakeryhma26_tyyppi'' = ava26.tyyppi
      --,[Sarakeryhma_arvo26]
      ,''Sarakeryhma26_opp'' = ava26.opp
      ,''Sarakeryhma26_opmala'' = ava26.opmala
      ,''Sarakeryhma26_opmopa'' = ava26.opmopa
      ,''Sarakeryhma26_opmast'' = ava26.opmast
      ,''Sarakeryhma26_opm95opa'' = ava26.opm95opa
      ,''Sarakeryhma26_koulutussektori'' = ava26.koulutussektori
      ,''Sarakeryhma26_suorv'' = ava26.suorv
      ,''Sarakeryhma26_suorlk'' = ava26.suorlk
      ,''Sarakeryhma26_kmaak'' = Case when ava26.tutkmaak is not null then ava26.tutkmaak
								when ava26.kmaak is not null then ava26.kmaak
								when ava26.kmaak_2 is not null then ava26.kmaak_2 else null end
      ,''Sarakeryhma26_olotamm'' = ava26.olotamm_2
      ,''Sarakeryhma26_olosyys'' = ava26.olosyys_2
      ,''Sarakeryhma26_ptoim1r5'' = ava26.ptoim1r5
      ,''Sarakeryhma26_amas'' = ava26.amas
      ,''Sarakeryhma26_koulk'' = Case when ava26.tutkkoulk is not null then ava26.tutkkoulk
								when ava26.opiskkoulk is not null then ava26.opiskkoulk
								when ava26.opiskkoulk_2 is not null then ava26.opiskkoulk_2 else null end
      ,''Sarakeryhma26_jarj'' = Case when ava26.tutkjarj is not null then ava26.tutkjarj
								when ava26.opiskjarj is not null then ava26.opiskjarj
								when ava26.opiskjarj_2 is not null then ava26.opiskjarj_2 else null end
      ,''Sarakeryhma26_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID26],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID26],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID26],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID26],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID26],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID26],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID26],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID26],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID26],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID26],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID26] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma27_ID'' = alo.[Sarakeryhma_ID27]
      ,''Sarakeryhma27_tyyppi'' = ava27.tyyppi
      --,[Sarakeryhma_arvo27]
      ,''Sarakeryhma27_opp'' = ava27.opp
      ,''Sarakeryhma27_opmala'' = ava27.opmala
      ,''Sarakeryhma27_opmopa'' = ava27.opmopa
      ,''Sarakeryhma27_opmast'' = ava27.opmast
      ,''Sarakeryhma27_opm95opa'' = ava27.opm95opa
      ,''Sarakeryhma27_koulutussektori'' = ava27.koulutussektori
      ,''Sarakeryhma27_suorv'' = ava27.suorv
      ,''Sarakeryhma27_suorlk'' = ava27.suorlk
      ,''Sarakeryhma27_kmaak'' = Case when ava27.tutkmaak is not null then ava27.tutkmaak
								when ava27.kmaak is not null then ava27.kmaak
								when ava27.kmaak_2 is not null then ava27.kmaak_2 else null end
      ,''Sarakeryhma27_olotamm'' = ava27.olotamm_2
      ,''Sarakeryhma27_olosyys'' = ava27.olosyys_2
      ,''Sarakeryhma27_ptoim1r5'' = ava27.ptoim1r5
      ,''Sarakeryhma27_amas'' = ava27.amas
      ,''Sarakeryhma27_koulk'' = Case when ava27.tutkkoulk is not null then ava27.tutkkoulk
								when ava27.opiskkoulk is not null then ava27.opiskkoulk
								when ava27.opiskkoulk_2 is not null then ava27.opiskkoulk_2 else null end
      ,''Sarakeryhma27_jarj'' = Case when ava27.tutkjarj is not null then ava27.tutkjarj
								when ava27.opiskjarj is not null then ava27.opiskjarj
								when ava27.opiskjarj_2 is not null then ava27.opiskjarj_2 else null end
      ,''Sarakeryhma27_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID27],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID27],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID27],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID27],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID27],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID27],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID27],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID27],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID27],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID27],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID27] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma28_ID'' = alo.[Sarakeryhma_ID28]
      ,''Sarakeryhma28_tyyppi'' = ava28.tyyppi
      --,[Sarakeryhma_arvo28]
      ,''Sarakeryhma28_opp'' = ava28.opp
      ,''Sarakeryhma28_opmala'' = ava28.opmala
      ,''Sarakeryhma28_opmopa'' = ava28.opmopa
      ,''Sarakeryhma28_opmast'' = ava28.opmast
      ,''Sarakeryhma28_opm95opa'' = ava28.opm95opa
      ,''Sarakeryhma28_koulutussektori'' = ava28.koulutussektori
      ,''Sarakeryhma28_suorv'' = ava28.suorv
      ,''Sarakeryhma28_suorlk'' = ava28.suorlk
      ,''Sarakeryhma28_kmaak'' = Case when ava28.tutkmaak is not null then ava28.tutkmaak
								when ava28.kmaak is not null then ava28.kmaak
								when ava28.kmaak_2 is not null then ava28.kmaak_2 else null end
      ,''Sarakeryhma28_olotamm'' = ava28.olotamm_2
      ,''Sarakeryhma28_olosyys'' = ava28.olosyys_2
      ,''Sarakeryhma28_ptoim1r5'' = ava28.ptoim1r5
      ,''Sarakeryhma28_amas'' = ava28.amas
      ,''Sarakeryhma28_koulk'' = Case when ava28.tutkkoulk is not null then ava28.tutkkoulk
								when ava28.opiskkoulk is not null then ava28.opiskkoulk
								when ava28.opiskkoulk_2 is not null then ava28.opiskkoulk_2 else null end
      ,''Sarakeryhma28_jarj'' = Case when ava28.tutkjarj is not null then ava28.tutkjarj
								when ava28.opiskjarj is not null then ava28.opiskjarj
								when ava28.opiskjarj_2 is not null then ava28.opiskjarj_2 else null end
      ,''Sarakeryhma28_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID28],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID28],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID28],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID28],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID28],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID28],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID28],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID28],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID28],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID28],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID28] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma29_ID'' = alo.[Sarakeryhma_ID29]
      ,''Sarakeryhma29_tyyppi'' = ava29.tyyppi
      --,[Sarakeryhma_arvo29]
      ,''Sarakeryhma29_opp'' = ava29.opp
      ,''Sarakeryhma29_opmala'' = ava29.opmala
      ,''Sarakeryhma29_opmopa'' = ava29.opmopa
      ,''Sarakeryhma29_opmast'' = ava29.opmast
      ,''Sarakeryhma29_opm95opa'' = ava29.opm95opa
      ,''Sarakeryhma29_koulutussektori'' = ava29.koulutussektori
      ,''Sarakeryhma29_suorv'' = ava29.suorv
      ,''Sarakeryhma29_suorlk'' = ava29.suorlk
      ,''Sarakeryhma29_kmaak'' = Case when ava29.tutkmaak is not null then ava29.tutkmaak
								when ava29.kmaak is not null then ava29.kmaak
								when ava29.kmaak_2 is not null then ava29.kmaak_2 else null end
      ,''Sarakeryhma29_olotamm'' = ava29.olotamm_2
      ,''Sarakeryhma29_olosyys'' = ava29.olosyys_2
      ,''Sarakeryhma29_ptoim1r5'' = ava29.ptoim1r5
      ,''Sarakeryhma29_amas'' = ava29.amas
      ,''Sarakeryhma29_koulk'' = Case when ava29.tutkkoulk is not null then ava29.tutkkoulk
								when ava29.opiskkoulk is not null then ava29.opiskkoulk
								when ava29.opiskkoulk_2 is not null then ava29.opiskkoulk_2 else null end
      ,''Sarakeryhma29_jarj'' = Case when ava29.tutkjarj is not null then ava29.tutkjarj
								when ava29.opiskjarj is not null then ava29.opiskjarj
								when ava29.opiskjarj_2 is not null then ava29.opiskjarj_2 else null end
      ,''Sarakeryhma29_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID29],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID29],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID29],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID29],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID29],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID29],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID29],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID29],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID29],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID29],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID29] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma30_ID'' = alo.[Sarakeryhma_ID30]
      ,''Sarakeryhma30_tyyppi'' = ava30.tyyppi
      --,[Sarakeryhma_arvo30]
      ,''Sarakeryhma30_opp'' = ava30.opp
      ,''Sarakeryhma30_opmala'' = ava30.opmala
      ,''Sarakeryhma30_opmopa'' = ava30.opmopa
      ,''Sarakeryhma30_opmast'' = ava30.opmast
      ,''Sarakeryhma30_opm95opa'' = ava30.opm95opa
      ,''Sarakeryhma30_koulutussektori'' = ava30.koulutussektori
      ,''Sarakeryhma30_suorv'' = ava30.suorv
      ,''Sarakeryhma30_suorlk'' = ava30.suorlk
      ,''Sarakeryhma30_kmaak'' = Case when ava30.tutkmaak is not null then ava30.tutkmaak
								when ava30.kmaak is not null then ava30.kmaak
								when ava30.kmaak_2 is not null then ava30.kmaak_2 else null end
      ,''Sarakeryhma30_olotamm'' = ava30.olotamm_2
      ,''Sarakeryhma30_olosyys'' = ava30.olosyys_2
      ,''Sarakeryhma30_ptoim1r5'' = ava30.ptoim1r5
      ,''Sarakeryhma30_amas'' = ava30.amas
      ,''Sarakeryhma30_koulk'' = Case when ava30.tutkkoulk is not null then ava30.tutkkoulk
								when ava30.opiskkoulk is not null then ava30.opiskkoulk
								when ava30.opiskkoulk_2 is not null then ava30.opiskkoulk_2 else null end
      ,''Sarakeryhma30_jarj'' = Case when ava30.tutkjarj is not null then ava30.tutkjarj
								when ava30.opiskjarj is not null then ava30.opiskjarj
								when ava30.opiskjarj_2 is not null then ava30.opiskjarj_2 else null end
      ,''Sarakeryhma30_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID30],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID30],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID30],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID30],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID30],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID30],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID30],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID30],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID30],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID30],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID30] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma31_ID'' = alo.[Sarakeryhma_ID31]
      ,''Sarakeryhma31_tyyppi'' = ava31.tyyppi
      --,[Sarakeryhma_arvo31]
      ,''Sarakeryhma31_opp'' = ava31.opp
      ,''Sarakeryhma31_opmala'' = ava31.opmala
      ,''Sarakeryhma31_opmopa'' = ava31.opmopa
      ,''Sarakeryhma31_opmast'' = ava31.opmast
      ,''Sarakeryhma31_opm95opa'' = ava31.opm95opa
      ,''Sarakeryhma31_koulutussektori'' = ava31.koulutussektori
      ,''Sarakeryhma31_suorv'' = ava31.suorv
      ,''Sarakeryhma31_suorlk'' = ava31.suorlk
      ,''Sarakeryhma31_kmaak'' = Case when ava31.tutkmaak is not null then ava31.tutkmaak
								when ava31.kmaak is not null then ava31.kmaak
								when ava31.kmaak_2 is not null then ava31.kmaak_2 else null end
      ,''Sarakeryhma31_olotamm'' = ava31.olotamm_2
      ,''Sarakeryhma31_olosyys'' = ava31.olosyys_2
      ,''Sarakeryhma31_ptoim1r5'' = ava31.ptoim1r5
      ,''Sarakeryhma31_amas'' = ava31.amas
      ,''Sarakeryhma31_koulk'' = Case when ava31.tutkkoulk is not null then ava31.tutkkoulk
								when ava31.opiskkoulk is not null then ava31.opiskkoulk
								when ava31.opiskkoulk_2 is not null then ava31.opiskkoulk_2 else null end
      ,''Sarakeryhma31_jarj'' = Case when ava31.tutkjarj is not null then ava31.tutkjarj
								when ava31.opiskjarj is not null then ava31.opiskjarj
								when ava31.opiskjarj_2 is not null then ava31.opiskjarj_2 else null end
      ,''Sarakeryhma31_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID31],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID31],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID31],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID31],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID31],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID31],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID31],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID31],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID31],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID31],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID31] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma32_ID'' = alo.[Sarakeryhma_ID32]
      ,''Sarakeryhma32_tyyppi'' = ava32.tyyppi
      --,[Sarakeryhma_arvo32]
      ,''Sarakeryhma32_opp'' = ava32.opp
      ,''Sarakeryhma32_opmala'' = ava32.opmala
      ,''Sarakeryhma32_opmopa'' = ava32.opmopa
      ,''Sarakeryhma32_opmast'' = ava32.opmast
      ,''Sarakeryhma32_opm95opa'' = ava32.opm95opa
      ,''Sarakeryhma32_koulutussektori'' = ava32.koulutussektori
      ,''Sarakeryhma32_suorv'' = ava32.suorv
      ,''Sarakeryhma32_suorlk'' = ava32.suorlk
      ,''Sarakeryhma32_kmaak'' = Case when ava32.tutkmaak is not null then ava32.tutkmaak
								when ava32.kmaak is not null then ava32.kmaak
								when ava32.kmaak_2 is not null then ava32.kmaak_2 else null end
      ,''Sarakeryhma32_olotamm'' = ava32.olotamm_2
      ,''Sarakeryhma32_olosyys'' = ava32.olosyys_2
      ,''Sarakeryhma32_ptoim1r5'' = ava32.ptoim1r5
      ,''Sarakeryhma32_amas'' = ava32.amas
      ,''Sarakeryhma32_koulk'' = Case when ava32.tutkkoulk is not null then ava32.tutkkoulk
								when ava32.opiskkoulk is not null then ava32.opiskkoulk
								when ava32.opiskkoulk_2 is not null then ava32.opiskkoulk_2 else null end
      ,''Sarakeryhma32_jarj'' = Case when ava32.tutkjarj is not null then ava32.tutkjarj
								when ava32.opiskjarj is not null then ava32.opiskjarj
								when ava32.opiskjarj_2 is not null then ava32.opiskjarj_2 else null end
      ,''Sarakeryhma32_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID32],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID32],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID32],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID32],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID32],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID32],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID32],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID32],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID32],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID32],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID32] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma33_ID'' = alo.[Sarakeryhma_ID33]
      ,''Sarakeryhma33_tyyppi'' = ava33.tyyppi
      --,[Sarakeryhma_arvo33]
      ,''Sarakeryhma33_opp'' = ava33.opp
      ,''Sarakeryhma33_opmala'' = ava33.opmala
      ,''Sarakeryhma33_opmopa'' = ava33.opmopa
      ,''Sarakeryhma33_opmast'' = ava33.opmast
      ,''Sarakeryhma33_opm95opa'' = ava33.opm95opa
      ,''Sarakeryhma33_koulutussektori'' = ava33.koulutussektori
      ,''Sarakeryhma33_suorv'' = ava33.suorv
      ,''Sarakeryhma33_suorlk'' = ava33.suorlk
      ,''Sarakeryhma33_kmaak'' = Case when ava33.tutkmaak is not null then ava33.tutkmaak
								when ava33.kmaak is not null then ava33.kmaak
								when ava33.kmaak_2 is not null then ava33.kmaak_2 else null end
      ,''Sarakeryhma33_olotamm'' = ava33.olotamm_2
      ,''Sarakeryhma33_olosyys'' = ava33.olosyys_2
      ,''Sarakeryhma33_ptoim1r5'' = ava33.ptoim1r5
      ,''Sarakeryhma33_amas'' = ava33.amas
      ,''Sarakeryhma33_koulk'' = Case when ava33.tutkkoulk is not null then ava33.tutkkoulk
								when ava33.opiskkoulk is not null then ava33.opiskkoulk
								when ava33.opiskkoulk_2 is not null then ava33.opiskkoulk_2 else null end
      ,''Sarakeryhma33_jarj'' = Case when ava33.tutkjarj is not null then ava33.tutkjarj
								when ava33.opiskjarj is not null then ava33.opiskjarj
								when ava33.opiskjarj_2 is not null then ava33.opiskjarj_2 else null end
      ,''Sarakeryhma33_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID33],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID33],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID33],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID33],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID33],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID33],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID33],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID33],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID33],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID33],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID33] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma34_ID'' = alo.[Sarakeryhma_ID34]
      ,''Sarakeryhma34_tyyppi'' = ava34.tyyppi
      --,[Sarakeryhma_arvo34]
      ,''Sarakeryhma34_opp'' = ava34.opp
      ,''Sarakeryhma34_opmala'' = ava34.opmala
      ,''Sarakeryhma34_opmopa'' = ava34.opmopa
      ,''Sarakeryhma34_opmast'' = ava34.opmast
      ,''Sarakeryhma34_opm95opa'' = ava34.opm95opa
      ,''Sarakeryhma34_koulutussektori'' = ava34.koulutussektori
      ,''Sarakeryhma34_suorv'' = ava34.suorv
      ,''Sarakeryhma34_suorlk'' = ava34.suorlk
      ,''Sarakeryhma34_kmaak'' = Case when ava34.tutkmaak is not null then ava34.tutkmaak
								when ava34.kmaak is not null then ava34.kmaak
								when ava34.kmaak_2 is not null then ava34.kmaak_2 else null end
      ,''Sarakeryhma34_olotamm'' = ava34.olotamm_2
      ,''Sarakeryhma34_olosyys'' = ava34.olosyys_2
      ,''Sarakeryhma34_ptoim1r5'' = ava34.ptoim1r5
      ,''Sarakeryhma34_amas'' = ava34.amas
      ,''Sarakeryhma34_koulk'' = Case when ava34.tutkkoulk is not null then ava34.tutkkoulk
								when ava34.opiskkoulk is not null then ava34.opiskkoulk
								when ava34.opiskkoulk_2 is not null then ava34.opiskkoulk_2 else null end
      ,''Sarakeryhma34_jarj'' = Case when ava34.tutkjarj is not null then ava34.tutkjarj
								when ava34.opiskjarj is not null then ava34.opiskjarj
								when ava34.opiskjarj_2 is not null then ava34.opiskjarj_2 else null end
      ,''Sarakeryhma34_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID34],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID34],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID34],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID34],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID34],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID34],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID34],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID34],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID34],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID34],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID34] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma35_ID'' = alo.[Sarakeryhma_ID35]
      ,''Sarakeryhma35_tyyppi'' = ava35.tyyppi
      --,[Sarakeryhma_arvo35]
      ,''Sarakeryhma35_opp'' = ava35.opp
      ,''Sarakeryhma35_opmala'' = ava35.opmala
      ,''Sarakeryhma35_opmopa'' = ava35.opmopa
      ,''Sarakeryhma35_opmast'' = ava35.opmast
      ,''Sarakeryhma35_opm95opa'' = ava35.opm95opa
      ,''Sarakeryhma35_koulutussektori'' = ava35.koulutussektori
      ,''Sarakeryhma35_suorv'' = ava35.suorv
      ,''Sarakeryhma35_suorlk'' = ava35.suorlk
      ,''Sarakeryhma35_kmaak'' = Case when ava35.tutkmaak is not null then ava35.tutkmaak
								when ava35.kmaak is not null then ava35.kmaak
								when ava35.kmaak_2 is not null then ava35.kmaak_2 else null end
      ,''Sarakeryhma35_olotamm'' = ava35.olotamm_2
      ,''Sarakeryhma35_olosyys'' = ava35.olosyys_2
      ,''Sarakeryhma35_ptoim1r5'' = ava35.ptoim1r5
      ,''Sarakeryhma35_amas'' = ava35.amas
      ,''Sarakeryhma35_koulk'' = Case when ava35.tutkkoulk is not null then ava35.tutkkoulk
								when ava35.opiskkoulk is not null then ava35.opiskkoulk
								when ava35.opiskkoulk_2 is not null then ava35.opiskkoulk_2 else null end
      ,''Sarakeryhma35_jarj'' = Case when ava35.tutkjarj is not null then ava35.tutkjarj
								when ava35.opiskjarj is not null then ava35.opiskjarj
								when ava35.opiskjarj_2 is not null then ava35.opiskjarj_2 else null end
      ,''Sarakeryhma35_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID35],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID35],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID35],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID35],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID35],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID35],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID35],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID35],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID35],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID35],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID35] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma36_ID'' = alo.[Sarakeryhma_ID36]
      ,''Sarakeryhma36_tyyppi'' = ava36.tyyppi
      --,[Sarakeryhma_arvo36]
      ,''Sarakeryhma36_opp'' = ava36.opp
      ,''Sarakeryhma36_opmala'' = ava36.opmala
      ,''Sarakeryhma36_opmopa'' = ava36.opmopa
      ,''Sarakeryhma36_opmast'' = ava36.opmast
      ,''Sarakeryhma36_opm95opa'' = ava36.opm95opa
      ,''Sarakeryhma36_koulutussektori'' = ava36.koulutussektori
      ,''Sarakeryhma36_suorv'' = ava36.suorv
      ,''Sarakeryhma36_suorlk'' = ava36.suorlk
      ,''Sarakeryhma36_kmaak'' = Case when ava36.tutkmaak is not null then ava36.tutkmaak
								when ava36.kmaak is not null then ava36.kmaak
								when ava36.kmaak_2 is not null then ava36.kmaak_2 else null end
      ,''Sarakeryhma36_olotamm'' = ava36.olotamm_2
      ,''Sarakeryhma36_olosyys'' = ava36.olosyys_2
      ,''Sarakeryhma36_ptoim1r5'' = ava36.ptoim1r5
      ,''Sarakeryhma36_amas'' = ava36.amas
      ,''Sarakeryhma36_koulk'' = Case when ava36.tutkkoulk is not null then ava36.tutkkoulk
								when ava36.opiskkoulk is not null then ava36.opiskkoulk
								when ava36.opiskkoulk_2 is not null then ava36.opiskkoulk_2 else null end
      ,''Sarakeryhma36_jarj'' = Case when ava36.tutkjarj is not null then ava36.tutkjarj
								when ava36.opiskjarj is not null then ava36.opiskjarj
								when ava36.opiskjarj_2 is not null then ava36.opiskjarj_2 else null end
      ,''Sarakeryhma36_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID36],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID36],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID36],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID36],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID36],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID36],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID36],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID36],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID36],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID36],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID36] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma37_ID'' = alo.[Sarakeryhma_ID37]
      ,''Sarakeryhma37_tyyppi'' = ava37.tyyppi
      --,[Sarakeryhma_arvo37]
      ,''Sarakeryhma37_opp'' = ava37.opp
      ,''Sarakeryhma37_opmala'' = ava37.opmala
      ,''Sarakeryhma37_opmopa'' = ava37.opmopa
      ,''Sarakeryhma37_opmast'' = ava37.opmast
      ,''Sarakeryhma37_opm95opa'' = ava37.opm95opa
      ,''Sarakeryhma37_koulutussektori'' = ava37.koulutussektori
      ,''Sarakeryhma37_suorv'' = ava37.suorv
      ,''Sarakeryhma37_suorlk'' = ava37.suorlk
      ,''Sarakeryhma37_kmaak'' = Case when ava37.tutkmaak is not null then ava37.tutkmaak
								when ava37.kmaak is not null then ava37.kmaak
								when ava37.kmaak_2 is not null then ava37.kmaak_2 else null end
      ,''Sarakeryhma37_olotamm'' = ava37.olotamm_2
      ,''Sarakeryhma37_olosyys'' = ava37.olosyys_2
      ,''Sarakeryhma37_ptoim1r5'' = ava37.ptoim1r5
      ,''Sarakeryhma37_amas'' = ava37.amas
      ,''Sarakeryhma37_koulk'' = Case when ava37.tutkkoulk is not null then ava37.tutkkoulk
								when ava37.opiskkoulk is not null then ava37.opiskkoulk
								when ava37.opiskkoulk_2 is not null then ava37.opiskkoulk_2 else null end
      ,''Sarakeryhma37_jarj'' = Case when ava37.tutkjarj is not null then ava37.tutkjarj
								when ava37.opiskjarj is not null then ava37.opiskjarj
								when ava37.opiskjarj_2 is not null then ava37.opiskjarj_2 else null end
      ,''Sarakeryhma37_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID37],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID37],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID37],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID37],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID37],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID37],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID37],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID37],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID37],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID37],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID37] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma38_ID'' = alo.[Sarakeryhma_ID38]
      ,''Sarakeryhma38_tyyppi'' = ava38.tyyppi
      --,[Sarakeryhma_arvo38]
      ,''Sarakeryhma38_opp'' = ava38.opp
      ,''Sarakeryhma38_opmala'' = ava38.opmala
      ,''Sarakeryhma38_opmopa'' = ava38.opmopa
      ,''Sarakeryhma38_opmast'' = ava38.opmast
      ,''Sarakeryhma38_opm95opa'' = ava38.opm95opa
      ,''Sarakeryhma38_koulutussektori'' = ava38.koulutussektori
      ,''Sarakeryhma38_suorv'' = ava38.suorv
      ,''Sarakeryhma38_suorlk'' = ava38.suorlk
      ,''Sarakeryhma38_kmaak'' = Case when ava38.tutkmaak is not null then ava38.tutkmaak
								when ava38.kmaak is not null then ava38.kmaak
								when ava38.kmaak_2 is not null then ava38.kmaak_2 else null end
      ,''Sarakeryhma38_olotamm'' = ava38.olotamm_2
      ,''Sarakeryhma38_olosyys'' = ava38.olosyys_2
      ,''Sarakeryhma38_ptoim1r5'' = ava38.ptoim1r5
      ,''Sarakeryhma38_amas'' = ava38.amas
      ,''Sarakeryhma38_koulk'' = Case when ava38.tutkkoulk is not null then ava38.tutkkoulk
								when ava38.opiskkoulk is not null then ava38.opiskkoulk
								when ava38.opiskkoulk_2 is not null then ava38.opiskkoulk_2 else null end
      ,''Sarakeryhma38_jarj'' = Case when ava38.tutkjarj is not null then ava38.tutkjarj
								when ava38.opiskjarj is not null then ava38.opiskjarj
								when ava38.opiskjarj_2 is not null then ava38.opiskjarj_2 else null end
      ,''Sarakeryhma38_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID38],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID38],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID38],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID38],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID38],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID38],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID38],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID38],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID38],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID38],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID38] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma39_ID'' = alo.[Sarakeryhma_ID39]
      ,''Sarakeryhma39_tyyppi'' = ava39.tyyppi
      --,[Sarakeryhma_arvo39]
      ,''Sarakeryhma39_opp'' = ava39.opp
      ,''Sarakeryhma39_opmala'' = ava39.opmala
      ,''Sarakeryhma39_opmopa'' = ava39.opmopa
      ,''Sarakeryhma39_opmast'' = ava39.opmast
      ,''Sarakeryhma39_opm95opa'' = ava39.opm95opa
      ,''Sarakeryhma39_koulutussektori'' = ava39.koulutussektori
      ,''Sarakeryhma39_suorv'' = ava39.suorv
      ,''Sarakeryhma39_suorlk'' = ava39.suorlk
      ,''Sarakeryhma39_kmaak'' = Case when ava39.tutkmaak is not null then ava39.tutkmaak
								when ava39.kmaak is not null then ava39.kmaak
								when ava39.kmaak_2 is not null then ava39.kmaak_2 else null end
      ,''Sarakeryhma39_olotamm'' = ava39.olotamm_2
      ,''Sarakeryhma39_olosyys'' = ava39.olosyys_2
      ,''Sarakeryhma39_ptoim1r5'' = ava39.ptoim1r5
      ,''Sarakeryhma39_amas'' = ava39.amas
      ,''Sarakeryhma39_koulk'' = Case when ava39.tutkkoulk is not null then ava39.tutkkoulk
								when ava39.opiskkoulk is not null then ava39.opiskkoulk
								when ava39.opiskkoulk_2 is not null then ava39.opiskkoulk_2 else null end
      ,''Sarakeryhma39_jarj'' = Case when ava39.tutkjarj is not null then ava39.tutkjarj
								when ava39.opiskjarj is not null then ava39.opiskjarj
								when ava39.opiskjarj_2 is not null then ava39.opiskjarj_2 else null end
      ,''Sarakeryhma39_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID39],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID39],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID39],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID39],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID39],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID39],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID39],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID39],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID39],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID39],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID39] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma40_ID'' = alo.[Sarakeryhma_ID40]
      ,''Sarakeryhma40_tyyppi'' = ava40.tyyppi
      --,[Sarakeryhma_arvo40]
      ,''Sarakeryhma40_opp'' = ava40.opp
      ,''Sarakeryhma40_opmala'' = ava40.opmala
      ,''Sarakeryhma40_opmopa'' = ava40.opmopa
      ,''Sarakeryhma40_opmast'' = ava40.opmast
      ,''Sarakeryhma40_opm95opa'' = ava40.opm95opa
      ,''Sarakeryhma40_koulutussektori'' = ava40.koulutussektori
      ,''Sarakeryhma40_suorv'' = ava40.suorv
      ,''Sarakeryhma40_suorlk'' = ava40.suorlk
      ,''Sarakeryhma40_kmaak'' = Case when ava40.tutkmaak is not null then ava40.tutkmaak
								when ava40.kmaak is not null then ava40.kmaak
								when ava40.kmaak_2 is not null then ava40.kmaak_2 else null end
      ,''Sarakeryhma40_olotamm'' = ava40.olotamm_2
      ,''Sarakeryhma40_olosyys'' = ava40.olosyys_2
      ,''Sarakeryhma40_ptoim1r5'' = ava40.ptoim1r5
      ,''Sarakeryhma40_amas'' = ava40.amas
      ,''Sarakeryhma40_koulk'' = Case when ava40.tutkkoulk is not null then ava40.tutkkoulk
								when ava40.opiskkoulk is not null then ava40.opiskkoulk
								when ava40.opiskkoulk_2 is not null then ava40.opiskkoulk_2 else null end
      ,''Sarakeryhma40_jarj'' = Case when ava40.tutkjarj is not null then ava40.tutkjarj
								when ava40.opiskjarj is not null then ava40.opiskjarj
								when ava40.opiskjarj_2 is not null then ava40.opiskjarj_2 else null end
      ,''Sarakeryhma40_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID40],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID40],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID40],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID40],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID40],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID40],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID40],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID40],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID40],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID40],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID40] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma41_ID'' = alo.[Sarakeryhma_ID41]
      ,''Sarakeryhma41_tyyppi'' = ava41.tyyppi
      --,[Sarakeryhma_arvo41]
      ,''Sarakeryhma41_opp'' = ava41.opp
      ,''Sarakeryhma41_opmala'' = ava41.opmala
      ,''Sarakeryhma41_opmopa'' = ava41.opmopa
      ,''Sarakeryhma41_opmast'' = ava41.opmast
      ,''Sarakeryhma41_opm95opa'' = ava41.opm95opa
      ,''Sarakeryhma41_koulutussektori'' = ava41.koulutussektori
      ,''Sarakeryhma41_suorv'' = ava41.suorv
      ,''Sarakeryhma41_suorlk'' = ava41.suorlk
      ,''Sarakeryhma41_kmaak'' = Case when ava41.tutkmaak is not null then ava41.tutkmaak
								when ava41.kmaak is not null then ava41.kmaak
								when ava41.kmaak_2 is not null then ava41.kmaak_2 else null end
      ,''Sarakeryhma41_olotamm'' = ava41.olotamm_2
      ,''Sarakeryhma41_olosyys'' = ava41.olosyys_2
      ,''Sarakeryhma41_ptoim1r5'' = ava41.ptoim1r5
      ,''Sarakeryhma41_amas'' = ava41.amas
      ,''Sarakeryhma41_koulk'' = Case when ava41.tutkkoulk is not null then ava41.tutkkoulk
								when ava41.opiskkoulk is not null then ava41.opiskkoulk
								when ava41.opiskkoulk_2 is not null then ava41.opiskkoulk_2 else null end
      ,''Sarakeryhma41_jarj'' = Case when ava41.tutkjarj is not null then ava41.tutkjarj
								when ava41.opiskjarj is not null then ava41.opiskjarj
								when ava41.opiskjarj_2 is not null then ava41.opiskjarj_2 else null end
      ,''Sarakeryhma41_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID41],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID41],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID41],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID41],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID41],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID41],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID41],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID41],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID41],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID41],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID41] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma42_ID'' = alo.[Sarakeryhma_ID42]
      ,''Sarakeryhma42_tyyppi'' = ava42.tyyppi
      --,[Sarakeryhma_arvo42]
      ,''Sarakeryhma42_opp'' = ava42.opp
      ,''Sarakeryhma42_opmala'' = ava42.opmala
      ,''Sarakeryhma42_opmopa'' = ava42.opmopa
      ,''Sarakeryhma42_opmast'' = ava42.opmast
      ,''Sarakeryhma42_opm95opa'' = ava42.opm95opa
      ,''Sarakeryhma42_koulutussektori'' = ava42.koulutussektori
      ,''Sarakeryhma42_suorv'' = ava42.suorv
      ,''Sarakeryhma42_suorlk'' = ava42.suorlk
      ,''Sarakeryhma42_kmaak'' = Case when ava42.tutkmaak is not null then ava42.tutkmaak
								when ava42.kmaak is not null then ava42.kmaak
								when ava42.kmaak_2 is not null then ava42.kmaak_2 else null end
      ,''Sarakeryhma42_olotamm'' = ava42.olotamm_2
      ,''Sarakeryhma42_olosyys'' = ava42.olosyys_2
      ,''Sarakeryhma42_ptoim1r5'' = ava42.ptoim1r5
      ,''Sarakeryhma42_amas'' = ava42.amas
      ,''Sarakeryhma42_koulk'' = Case when ava42.tutkkoulk is not null then ava42.tutkkoulk
								when ava42.opiskkoulk is not null then ava42.opiskkoulk
								when ava42.opiskkoulk_2 is not null then ava42.opiskkoulk_2 else null end
      ,''Sarakeryhma42_jarj'' = Case when ava42.tutkjarj is not null then ava42.tutkjarj
								when ava42.opiskjarj is not null then ava42.opiskjarj
								when ava42.opiskjarj_2 is not null then ava42.opiskjarj_2 else null end
      ,''Sarakeryhma42_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID42],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID42],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID42],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID42],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID42],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID42],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID42],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID42],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID42],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID42],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID42] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma43_ID'' = alo.[Sarakeryhma_ID43]
      ,''Sarakeryhma43_tyyppi'' = ava43.tyyppi
      --,[Sarakeryhma_arvo43]
      ,''Sarakeryhma43_opp'' = ava43.opp
      ,''Sarakeryhma43_opmala'' = ava43.opmala
      ,''Sarakeryhma43_opmopa'' = ava43.opmopa
      ,''Sarakeryhma43_opmast'' = ava43.opmast
      ,''Sarakeryhma43_opm95opa'' = ava43.opm95opa
      ,''Sarakeryhma43_koulutussektori'' = ava43.koulutussektori
      ,''Sarakeryhma43_suorv'' = ava43.suorv
      ,''Sarakeryhma43_suorlk'' = ava43.suorlk
      ,''Sarakeryhma43_kmaak'' = Case when ava43.tutkmaak is not null then ava43.tutkmaak
								when ava43.kmaak is not null then ava43.kmaak
								when ava43.kmaak_2 is not null then ava43.kmaak_2 else null end
      ,''Sarakeryhma43_olotamm'' = ava43.olotamm_2
      ,''Sarakeryhma43_olosyys'' = ava43.olosyys_2
      ,''Sarakeryhma43_ptoim1r5'' = ava43.ptoim1r5
      ,''Sarakeryhma43_amas'' = ava43.amas
      ,''Sarakeryhma43_koulk'' = Case when ava43.tutkkoulk is not null then ava43.tutkkoulk
								when ava43.opiskkoulk is not null then ava43.opiskkoulk
								when ava43.opiskkoulk_2 is not null then ava43.opiskkoulk_2 else null end
      ,''Sarakeryhma43_jarj'' = Case when ava43.tutkjarj is not null then ava43.tutkjarj
								when ava43.opiskjarj is not null then ava43.opiskjarj
								when ava43.opiskjarj_2 is not null then ava43.opiskjarj_2 else null end
      ,''Sarakeryhma43_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID43],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID43],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID43],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID43],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID43],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID43],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID43],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID43],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID43],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID43],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID43] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma44_ID'' = alo.[Sarakeryhma_ID44]
      ,''Sarakeryhma44_tyyppi'' = ava44.tyyppi
      --,[Sarakeryhma_arvo44]
      ,''Sarakeryhma44_opp'' = ava44.opp
      ,''Sarakeryhma44_opmala'' = ava44.opmala
      ,''Sarakeryhma44_opmopa'' = ava44.opmopa
      ,''Sarakeryhma44_opmast'' = ava44.opmast
      ,''Sarakeryhma44_opm95opa'' = ava44.opm95opa
      ,''Sarakeryhma44_koulutussektori'' = ava44.koulutussektori
      ,''Sarakeryhma44_suorv'' = ava44.suorv
      ,''Sarakeryhma44_suorlk'' = ava44.suorlk
      ,''Sarakeryhma44_kmaak'' = Case when ava44.tutkmaak is not null then ava44.tutkmaak
								when ava44.kmaak is not null then ava44.kmaak
								when ava44.kmaak_2 is not null then ava44.kmaak_2 else null end
      ,''Sarakeryhma44_olotamm'' = ava44.olotamm_2
      ,''Sarakeryhma44_olosyys'' = ava44.olosyys_2
      ,''Sarakeryhma44_ptoim1r5'' = ava44.ptoim1r5
      ,''Sarakeryhma44_amas'' = ava44.amas
      ,''Sarakeryhma44_koulk'' = Case when ava44.tutkkoulk is not null then ava44.tutkkoulk
								when ava44.opiskkoulk is not null then ava44.opiskkoulk
								when ava44.opiskkoulk_2 is not null then ava44.opiskkoulk_2 else null end
      ,''Sarakeryhma44_jarj'' = Case when ava44.tutkjarj is not null then ava44.tutkjarj
								when ava44.opiskjarj is not null then ava44.opiskjarj
								when ava44.opiskjarj_2 is not null then ava44.opiskjarj_2 else null end
      ,''Sarakeryhma44_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID44],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID44],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID44],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID44],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID44],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID44],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID44],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID44],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID44],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID44],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID44] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma45_ID'' = alo.[Sarakeryhma_ID45]
      ,''Sarakeryhma45_tyyppi'' = ava45.tyyppi
      --,[Sarakeryhma_arvo45]
      ,''Sarakeryhma45_opp'' = ava45.opp
      ,''Sarakeryhma45_opmala'' = ava45.opmala
      ,''Sarakeryhma45_opmopa'' = ava45.opmopa
      ,''Sarakeryhma45_opmast'' = ava45.opmast
      ,''Sarakeryhma45_opm95opa'' = ava45.opm95opa
      ,''Sarakeryhma45_koulutussektori'' = ava45.koulutussektori
      ,''Sarakeryhma45_suorv'' = ava45.suorv
      ,''Sarakeryhma45_suorlk'' = ava45.suorlk
      ,''Sarakeryhma45_kmaak'' = Case when ava45.tutkmaak is not null then ava45.tutkmaak
								when ava45.kmaak is not null then ava45.kmaak
								when ava45.kmaak_2 is not null then ava45.kmaak_2 else null end
      ,''Sarakeryhma45_olotamm'' = ava45.olotamm_2
      ,''Sarakeryhma45_olosyys'' = ava45.olosyys_2
      ,''Sarakeryhma45_ptoim1r5'' = ava45.ptoim1r5
      ,''Sarakeryhma45_amas'' = ava45.amas
      ,''Sarakeryhma45_koulk'' = Case when ava45.tutkkoulk is not null then ava45.tutkkoulk
								when ava45.opiskkoulk is not null then ava45.opiskkoulk
								when ava45.opiskkoulk_2 is not null then ava45.opiskkoulk_2 else null end
      ,''Sarakeryhma45_jarj'' = Case when ava45.tutkjarj is not null then ava45.tutkjarj
								when ava45.opiskjarj is not null then ava45.opiskjarj
								when ava45.opiskjarj_2 is not null then ava45.opiskjarj_2 else null end
      ,''Sarakeryhma45_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID45],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID45],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID45],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID45],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID45],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID45],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID45],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID45],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID45],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID45],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID45] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma46_ID'' = alo.[Sarakeryhma_ID46]
      ,''Sarakeryhma46_tyyppi'' = ava46.tyyppi
      --,[Sarakeryhma_arvo46]
      ,''Sarakeryhma46_opp'' = ava46.opp
      ,''Sarakeryhma46_opmala'' = ava46.opmala
      ,''Sarakeryhma46_opmopa'' = ava46.opmopa
      ,''Sarakeryhma46_opmast'' = ava46.opmast
      ,''Sarakeryhma46_opm95opa'' = ava46.opm95opa
      ,''Sarakeryhma46_koulutussektori'' = ava46.koulutussektori
      ,''Sarakeryhma46_suorv'' = ava46.suorv
      ,''Sarakeryhma46_suorlk'' = ava46.suorlk
      ,''Sarakeryhma46_kmaak'' = Case when ava46.tutkmaak is not null then ava46.tutkmaak
								when ava46.kmaak is not null then ava46.kmaak
								when ava46.kmaak_2 is not null then ava46.kmaak_2 else null end
      ,''Sarakeryhma46_olotamm'' = ava46.olotamm_2
      ,''Sarakeryhma46_olosyys'' = ava46.olosyys_2
      ,''Sarakeryhma46_ptoim1r5'' = ava46.ptoim1r5
      ,''Sarakeryhma46_amas'' = ava46.amas
      ,''Sarakeryhma46_koulk'' = Case when ava46.tutkkoulk is not null then ava46.tutkkoulk
								when ava46.opiskkoulk is not null then ava46.opiskkoulk
								when ava46.opiskkoulk_2 is not null then ava46.opiskkoulk_2 else null end
      ,''Sarakeryhma46_jarj'' = Case when ava46.tutkjarj is not null then ava46.tutkjarj
								when ava46.opiskjarj is not null then ava46.opiskjarj
								when ava46.opiskjarj_2 is not null then ava46.opiskjarj_2 else null end
      ,''Sarakeryhma46_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID46],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID46],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID46],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID46],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID46],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID46],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID46],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID46],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID46],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID46],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID46] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma47_ID'' = alo.[Sarakeryhma_ID47]
      ,''Sarakeryhma47_tyyppi'' = ava47.tyyppi
      --,[Sarakeryhma_arvo47]
      ,''Sarakeryhma47_opp'' = ava47.opp
      ,''Sarakeryhma47_opmala'' = ava47.opmala
      ,''Sarakeryhma47_opmopa'' = ava47.opmopa
      ,''Sarakeryhma47_opmast'' = ava47.opmast
      ,''Sarakeryhma47_opm95opa'' = ava47.opm95opa
      ,''Sarakeryhma47_koulutussektori'' = ava47.koulutussektori
      ,''Sarakeryhma47_suorv'' = ava47.suorv
      ,''Sarakeryhma47_suorlk'' = ava47.suorlk
      ,''Sarakeryhma47_kmaak'' = Case when ava47.tutkmaak is not null then ava47.tutkmaak
								when ava47.kmaak is not null then ava47.kmaak
								when ava47.kmaak_2 is not null then ava47.kmaak_2 else null end
      ,''Sarakeryhma47_olotamm'' = ava47.olotamm_2
      ,''Sarakeryhma47_olosyys'' = ava47.olosyys_2
      ,''Sarakeryhma47_ptoim1r5'' = ava47.ptoim1r5
      ,''Sarakeryhma47_amas'' = ava47.amas
      ,''Sarakeryhma47_koulk'' = Case when ava47.tutkkoulk is not null then ava47.tutkkoulk
								when ava47.opiskkoulk is not null then ava47.opiskkoulk
								when ava47.opiskkoulk_2 is not null then ava47.opiskkoulk_2 else null end
      ,''Sarakeryhma47_jarj'' = Case when ava47.tutkjarj is not null then ava47.tutkjarj
								when ava47.opiskjarj is not null then ava47.opiskjarj
								when ava47.opiskjarj_2 is not null then ava47.opiskjarj_2 else null end
      ,''Sarakeryhma47_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID47],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID47],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID47],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID47],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID47],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID47],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID47],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID47],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID47],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID47],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID47] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma48_ID'' = alo.[Sarakeryhma_ID48]
      ,''Sarakeryhma48_tyyppi'' = ava48.tyyppi
      --,[Sarakeryhma_arvo48]
      ,''Sarakeryhma48_opp'' = ava48.opp
      ,''Sarakeryhma48_opmala'' = ava48.opmala
      ,''Sarakeryhma48_opmopa'' = ava48.opmopa
      ,''Sarakeryhma48_opmast'' = ava48.opmast
      ,''Sarakeryhma48_opm95opa'' = ava48.opm95opa
      ,''Sarakeryhma48_koulutussektori'' = ava48.koulutussektori
      ,''Sarakeryhma48_suorv'' = ava48.suorv
      ,''Sarakeryhma48_suorlk'' = ava48.suorlk
      ,''Sarakeryhma48_kmaak'' = Case when ava48.tutkmaak is not null then ava48.tutkmaak
								when ava48.kmaak is not null then ava48.kmaak
								when ava48.kmaak_2 is not null then ava48.kmaak_2 else null end
      ,''Sarakeryhma48_olotamm'' = ava48.olotamm_2
      ,''Sarakeryhma48_olosyys'' = ava48.olosyys_2
      ,''Sarakeryhma48_ptoim1r5'' = ava48.ptoim1r5
      ,''Sarakeryhma48_amas'' = ava48.amas
      ,''Sarakeryhma48_koulk'' = Case when ava48.tutkkoulk is not null then ava48.tutkkoulk
								when ava48.opiskkoulk is not null then ava48.opiskkoulk
								when ava48.opiskkoulk_2 is not null then ava48.opiskkoulk_2 else null end
      ,''Sarakeryhma48_jarj'' = Case when ava48.tutkjarj is not null then ava48.tutkjarj
								when ava48.opiskjarj is not null then ava48.opiskjarj
								when ava48.opiskjarj_2 is not null then ava48.opiskjarj_2 else null end
      ,''Sarakeryhma48_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID48],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID48],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID48],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID48],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID48],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID48],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID48],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID48],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID48],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID48],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID48] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma49_ID'' = alo.[Sarakeryhma_ID49]
      ,''Sarakeryhma49_tyyppi'' = ava49.tyyppi
      --,[Sarakeryhma_arvo49]
      ,''Sarakeryhma49_opp'' = ava49.opp
      ,''Sarakeryhma49_opmala'' = ava49.opmala
      ,''Sarakeryhma49_opmopa'' = ava49.opmopa
      ,''Sarakeryhma49_opmast'' = ava49.opmast
      ,''Sarakeryhma49_opm95opa'' = ava49.opm95opa
      ,''Sarakeryhma49_koulutussektori'' = ava49.koulutussektori
      ,''Sarakeryhma49_suorv'' = ava49.suorv
      ,''Sarakeryhma49_suorlk'' = ava49.suorlk
      ,''Sarakeryhma49_kmaak'' = Case when ava49.tutkmaak is not null then ava49.tutkmaak
								when ava49.kmaak is not null then ava49.kmaak
								when ava49.kmaak_2 is not null then ava49.kmaak_2 else null end
      ,''Sarakeryhma49_olotamm'' = ava49.olotamm_2
      ,''Sarakeryhma49_olosyys'' = ava49.olosyys_2
      ,''Sarakeryhma49_ptoim1r5'' = ava49.ptoim1r5
      ,''Sarakeryhma49_amas'' = ava49.amas
      ,''Sarakeryhma49_koulk'' = Case when ava49.tutkkoulk is not null then ava49.tutkkoulk
								when ava49.opiskkoulk is not null then ava49.opiskkoulk
								when ava49.opiskkoulk_2 is not null then ava49.opiskkoulk_2 else null end
      ,''Sarakeryhma49_jarj'' = Case when ava49.tutkjarj is not null then ava49.tutkjarj
								when ava49.opiskjarj is not null then ava49.opiskjarj
								when ava49.opiskjarj_2 is not null then ava49.opiskjarj_2 else null end
      ,''Sarakeryhma49_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID49],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID49],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID49],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID49],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID49],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID49],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID49],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID49],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID49],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID49],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID49] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma50_ID'' = alo.[Sarakeryhma_ID50]
      ,''Sarakeryhma50_tyyppi'' = ava50.tyyppi
      --,[Sarakeryhma_arvo50]
      ,''Sarakeryhma50_opp'' = ava50.opp
      ,''Sarakeryhma50_opmala'' = ava50.opmala
      ,''Sarakeryhma50_opmopa'' = ava50.opmopa
      ,''Sarakeryhma50_opmast'' = ava50.opmast
      ,''Sarakeryhma50_opm95opa'' = ava50.opm95opa
      ,''Sarakeryhma50_koulutussektori'' = ava50.koulutussektori
      ,''Sarakeryhma50_suorv'' = ava50.suorv
      ,''Sarakeryhma50_suorlk'' = ava50.suorlk
      ,''Sarakeryhma50_kmaak'' = Case when ava50.tutkmaak is not null then ava50.tutkmaak
								when ava50.kmaak is not null then ava50.kmaak
								when ava50.kmaak_2 is not null then ava50.kmaak_2 else null end
      ,''Sarakeryhma50_olotamm'' = ava50.olotamm_2
      ,''Sarakeryhma50_olosyys'' = ava50.olosyys_2
      ,''Sarakeryhma50_ptoim1r5'' = ava50.ptoim1r5
      ,''Sarakeryhma50_amas'' = ava50.amas
      ,''Sarakeryhma50_koulk'' = Case when ava50.tutkkoulk is not null then ava50.tutkkoulk
								when ava50.opiskkoulk is not null then ava50.opiskkoulk
								when ava50.opiskkoulk_2 is not null then ava50.opiskkoulk_2 else null end
      ,''Sarakeryhma50_jarj'' = Case when ava50.tutkjarj is not null then ava50.tutkjarj
								when ava50.opiskjarj is not null then ava50.opiskjarj
								when ava50.opiskjarj_2 is not null then ava50.opiskjarj_2 else null end
      ,''Sarakeryhma50_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID50],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID50],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID50],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID50],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID50],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID50],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID50],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID50],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID50],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID50],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID50] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma51_ID'' = alo.[Sarakeryhma_ID51]
      ,''Sarakeryhma51_tyyppi'' = ava51.tyyppi
      --,[Sarakeryhma_arvo51]
      ,''Sarakeryhma51_opp'' = ava51.opp
      ,''Sarakeryhma51_opmala'' = ava51.opmala
      ,''Sarakeryhma51_opmopa'' = ava51.opmopa
      ,''Sarakeryhma51_opmast'' = ava51.opmast
      ,''Sarakeryhma51_opm95opa'' = ava51.opm95opa
      ,''Sarakeryhma51_koulutussektori'' = ava51.koulutussektori
      ,''Sarakeryhma51_suorv'' = ava51.suorv
      ,''Sarakeryhma51_suorlk'' = ava51.suorlk
      ,''Sarakeryhma51_kmaak'' = Case when ava51.tutkmaak is not null then ava51.tutkmaak
								when ava51.kmaak is not null then ava51.kmaak
								when ava51.kmaak_2 is not null then ava51.kmaak_2 else null end
      ,''Sarakeryhma51_olotamm'' = ava51.olotamm_2
      ,''Sarakeryhma51_olosyys'' = ava51.olosyys_2
      ,''Sarakeryhma51_ptoim1r5'' = ava51.ptoim1r5
      ,''Sarakeryhma51_amas'' = ava51.amas
      ,''Sarakeryhma51_koulk'' = Case when ava51.tutkkoulk is not null then ava51.tutkkoulk
								when ava51.opiskkoulk is not null then ava51.opiskkoulk
								when ava51.opiskkoulk_2 is not null then ava51.opiskkoulk_2 else null end
      ,''Sarakeryhma51_jarj'' = Case when ava51.tutkjarj is not null then ava51.tutkjarj
								when ava51.opiskjarj is not null then ava51.opiskjarj
								when ava51.opiskjarj_2 is not null then ava51.opiskjarj_2 else null end
      ,''Sarakeryhma51_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID51],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID51],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID51],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID51],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID51],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID51],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID51],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID51],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID51],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID51],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID51] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma52_ID'' = alo.[Sarakeryhma_ID52]
      ,''Sarakeryhma52_tyyppi'' = ava52.tyyppi
      --,[Sarakeryhma_arvo52]
      ,''Sarakeryhma52_opp'' = ava52.opp
      ,''Sarakeryhma52_opmala'' = ava52.opmala
      ,''Sarakeryhma52_opmopa'' = ava52.opmopa
      ,''Sarakeryhma52_opmast'' = ava52.opmast
      ,''Sarakeryhma52_opm95opa'' = ava52.opm95opa
      ,''Sarakeryhma52_koulutussektori'' = ava52.koulutussektori
      ,''Sarakeryhma52_suorv'' = ava52.suorv
      ,''Sarakeryhma52_suorlk'' = ava52.suorlk
      ,''Sarakeryhma52_kmaak'' = Case when ava52.tutkmaak is not null then ava52.tutkmaak
								when ava52.kmaak is not null then ava52.kmaak
								when ava52.kmaak_2 is not null then ava52.kmaak_2 else null end
      ,''Sarakeryhma52_olotamm'' = ava52.olotamm_2
      ,''Sarakeryhma52_olosyys'' = ava52.olosyys_2
      ,''Sarakeryhma52_ptoim1r5'' = ava52.ptoim1r5
      ,''Sarakeryhma52_amas'' = ava52.amas
      ,''Sarakeryhma52_koulk'' = Case when ava52.tutkkoulk is not null then ava52.tutkkoulk
								when ava52.opiskkoulk is not null then ava52.opiskkoulk
								when ava52.opiskkoulk_2 is not null then ava52.opiskkoulk_2 else null end
      ,''Sarakeryhma52_jarj'' = Case when ava52.tutkjarj is not null then ava52.tutkjarj
								when ava52.opiskjarj is not null then ava52.opiskjarj
								when ava52.opiskjarj_2 is not null then ava52.opiskjarj_2 else null end
      ,''Sarakeryhma52_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID52],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID52],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID52],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID52],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID52],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID52],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID52],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID52],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID52],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID52],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID52] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma53_ID'' = alo.[Sarakeryhma_ID53]
      ,''Sarakeryhma53_tyyppi'' = ava53.tyyppi
      --,[Sarakeryhma_arvo53]
      ,''Sarakeryhma53_opp'' = ava53.opp
      ,''Sarakeryhma53_opmala'' = ava53.opmala
      ,''Sarakeryhma53_opmopa'' = ava53.opmopa
      ,''Sarakeryhma53_opmast'' = ava53.opmast
      ,''Sarakeryhma53_opm95opa'' = ava53.opm95opa
      ,''Sarakeryhma53_koulutussektori'' = ava53.koulutussektori
      ,''Sarakeryhma53_suorv'' = ava53.suorv
      ,''Sarakeryhma53_suorlk'' = ava53.suorlk
      ,''Sarakeryhma53_kmaak'' = Case when ava53.tutkmaak is not null then ava53.tutkmaak
								when ava53.kmaak is not null then ava53.kmaak
								when ava53.kmaak_2 is not null then ava53.kmaak_2 else null end
      ,''Sarakeryhma53_olotamm'' = ava53.olotamm_2
      ,''Sarakeryhma53_olosyys'' = ava53.olosyys_2
      ,''Sarakeryhma53_ptoim1r5'' = ava53.ptoim1r5
      ,''Sarakeryhma53_amas'' = ava53.amas
      ,''Sarakeryhma53_koulk'' = Case when ava53.tutkkoulk is not null then ava53.tutkkoulk
								when ava53.opiskkoulk is not null then ava53.opiskkoulk
								when ava53.opiskkoulk_2 is not null then ava53.opiskkoulk_2 else null end
      ,''Sarakeryhma53_jarj'' = Case when ava53.tutkjarj is not null then ava53.tutkjarj
								when ava53.opiskjarj is not null then ava53.opiskjarj
								when ava53.opiskjarj_2 is not null then ava53.opiskjarj_2 else null end
      ,''Sarakeryhma53_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID53],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID53],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID53],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID53],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID53],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID53],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID53],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID53],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID53],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID53],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID53] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma54_ID'' = alo.[Sarakeryhma_ID54]
      ,''Sarakeryhma54_tyyppi'' = ava54.tyyppi
      --,[Sarakeryhma_arvo54]
      ,''Sarakeryhma54_opp'' = ava54.opp
      ,''Sarakeryhma54_opmala'' = ava54.opmala
      ,''Sarakeryhma54_opmopa'' = ava54.opmopa
      ,''Sarakeryhma54_opmast'' = ava54.opmast
      ,''Sarakeryhma54_opm95opa'' = ava54.opm95opa
      ,''Sarakeryhma54_koulutussektori'' = ava54.koulutussektori
      ,''Sarakeryhma54_suorv'' = ava54.suorv
      ,''Sarakeryhma54_suorlk'' = ava54.suorlk
      ,''Sarakeryhma54_kmaak'' = Case when ava54.tutkmaak is not null then ava54.tutkmaak
								when ava54.kmaak is not null then ava54.kmaak
								when ava54.kmaak_2 is not null then ava54.kmaak_2 else null end
      ,''Sarakeryhma54_olotamm'' = ava54.olotamm_2
      ,''Sarakeryhma54_olosyys'' = ava54.olosyys_2
      ,''Sarakeryhma54_ptoim1r5'' = ava54.ptoim1r5
      ,''Sarakeryhma54_amas'' = ava54.amas
      ,''Sarakeryhma54_koulk'' = Case when ava54.tutkkoulk is not null then ava54.tutkkoulk
								when ava54.opiskkoulk is not null then ava54.opiskkoulk
								when ava54.opiskkoulk_2 is not null then ava54.opiskkoulk_2 else null end
      ,''Sarakeryhma54_jarj'' = Case when ava54.tutkjarj is not null then ava54.tutkjarj
								when ava54.opiskjarj is not null then ava54.opiskjarj
								when ava54.opiskjarj_2 is not null then ava54.opiskjarj_2 else null end
      ,''Sarakeryhma54_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID54],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID54],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID54],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID54],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID54],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID54],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID54],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID54],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID54],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID54],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID54] is null then null
								else ''muu'' end
      
      ,''Sarakeryhma55_ID'' = alo.[Sarakeryhma_ID55]
      ,''Sarakeryhma55_tyyppi'' = ava55.tyyppi
      --,[Sarakeryhma_arvo55]
      ,''Sarakeryhma55_opp'' = ava55.opp
      ,''Sarakeryhma55_opmala'' = ava55.opmala
      ,''Sarakeryhma55_opmopa'' = ava55.opmopa
      ,''Sarakeryhma55_opmast'' = ava55.opmast
      ,''Sarakeryhma55_opm95opa'' = ava55.opm95opa
      ,''Sarakeryhma55_koulutussektori'' = ava55.koulutussektori
      ,''Sarakeryhma55_suorv'' = ava55.suorv
      ,''Sarakeryhma55_suorlk'' = ava55.suorlk
      ,''Sarakeryhma55_kmaak'' = Case when ava55.tutkmaak is not null then ava55.tutkmaak
								when ava55.kmaak is not null then ava55.kmaak
								when ava55.kmaak_2 is not null then ava55.kmaak_2 else null end
      ,''Sarakeryhma55_olotamm'' = ava55.olotamm_2
      ,''Sarakeryhma55_olosyys'' = ava55.olosyys_2
      ,''Sarakeryhma55_ptoim1r5'' = ava55.ptoim1r5
      ,''Sarakeryhma55_amas'' = ava55.amas
      ,''Sarakeryhma55_koulk'' = Case when ava55.tutkkoulk is not null then ava55.tutkkoulk
								when ava55.opiskkoulk is not null then ava55.opiskkoulk
								when ava55.opiskkoulk_2 is not null then ava55.opiskkoulk_2 else null end
      ,''Sarakeryhma55_jarj'' = Case when ava55.tutkjarj is not null then ava55.tutkjarj
								when ava55.opiskjarj is not null then ava55.opiskjarj
								when ava55.opiskjarj_2 is not null then ava55.opiskjarj_2 else null end
      ,''Sarakeryhma55_tutkintolaji'' = Case when LEFT(alo.[Sarakeryhma_ID55],2)=''lu'' then ''lu''
								when LEFT(alo.[Sarakeryhma_ID55],4)=''ampt'' then ''ampt''
								when LEFT(alo.[Sarakeryhma_ID55],4)=''amlk'' then ''amlk''
								when LEFT(alo.[Sarakeryhma_ID55],3)=''amk'' then ''amk''
								when LEFT(alo.[Sarakeryhma_ID55],5)=''ylamk'' then ''ylamk''
								when LEFT(alo.[Sarakeryhma_ID55],4)=''alkk'' then ''alkk''
								when LEFT(alo.[Sarakeryhma_ID55],4)=''ylkk'' then ''ylkk''
								when LEFT(alo.[Sarakeryhma_ID55],2)=''tk'' then ''tk''
								when LEFT(alo.[Sarakeryhma_ID55],5)=''muuta'' then ''muuta''
								when LEFT(alo.[Sarakeryhma_ID55],5)=''muukk'' then ''muukk''
								when alo.[Sarakeryhma_ID55] is null then null
								else ''muu'' end
      
      --,''SarakeryhmaXX_ID'' = alo.[Sarakeryhma_IDXX]
      ----,[Sarakeryhma_arvoXX]
      --,''SarakeryhmaXX_opp'' = avaXX.opp
      --,''SarakeryhmaXX_opmala'' = avaXX.opmala
      --,''SarakeryhmaXX_opmopa'' = avaXX.opmopa
      --,''SarakeryhmaXX_opmast'' = avaXX.opmast
      --,''SarakeryhmaXX_opm95opa'' = avaXX.opm95opa
      --,''SarakeryhmaXX_koulutussektori'' = avaXX.koulutussektori
  --INTO vipunen_ETL.aloittaneiden_lapaisy_tiivistetty
  FROM _sa_K3_9_ja_K3_10_surrogaattiavaimet_PIVOT alo
  --LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot dop ON koulutuksen_jarjestajakoodi=alo.jarj and oppilaitostyyppikoodi in (41,42) --and alo.tilv between YEAR(dop.alkaa) and YEAR(dop.paattyy)
  LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d1
	ON d1.oppilaitos_avain=alo.jarj --AND f.tilv_date between d1.alkaa and d1.paattyy
  LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d17
	ON d17.oppilaitos_avain=d1.koulutuksen_jarjestajan_ainoa_oppilaitos --AND d1.alkaa between d17.alkaa and d17.paattyy

  LEFT JOIN d_koulutusluokitus dko ON koulutus_koodi=alo.koulk and alo.tilv between YEAR(dko.alkaa) and YEAR(dko.paattyy)
  LEFT JOIN VipunenTK.dbo.d_alueluokitus dal ON kunta_koodi=alo.kkun --and alo.tilv between YEAR(dal.alkaa) and YEAR(dal.paattyy)
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava1 ON ava1.id = alo.Sarakeryhma_arvo1
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava2 ON ava2.id = alo.Sarakeryhma_arvo2
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava3 ON ava3.id = alo.Sarakeryhma_arvo3
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava4 ON ava4.id = alo.Sarakeryhma_arvo4
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava5 ON ava5.id = alo.Sarakeryhma_arvo5
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava6 ON ava6.id = alo.Sarakeryhma_arvo6
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava7 ON ava7.id = alo.Sarakeryhma_arvo7
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava8 ON ava8.id = alo.Sarakeryhma_arvo8
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava9 ON ava9.id = alo.Sarakeryhma_arvo9
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava10 ON ava10.id = alo.Sarakeryhma_arvo10
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava11 ON ava11.id = alo.Sarakeryhma_arvo11
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava12 ON ava12.id = alo.Sarakeryhma_arvo12
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava13 ON ava13.id = alo.Sarakeryhma_arvo13
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava14 ON ava14.id = alo.Sarakeryhma_arvo14
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava15 ON ava15.id = alo.Sarakeryhma_arvo15
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava16 ON ava16.id = alo.Sarakeryhma_arvo16
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava17 ON ava17.id = alo.Sarakeryhma_arvo17
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava18 ON ava18.id = alo.Sarakeryhma_arvo18
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava19 ON ava19.id = alo.Sarakeryhma_arvo19
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava20 ON ava20.id = alo.Sarakeryhma_arvo20
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava21 ON ava21.id = alo.Sarakeryhma_arvo21
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava22 ON ava22.id = alo.Sarakeryhma_arvo22
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava23 ON ava23.id = alo.Sarakeryhma_arvo23
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava24 ON ava24.id = alo.Sarakeryhma_arvo24
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava25 ON ava25.id = alo.Sarakeryhma_arvo25
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava26 ON ava26.id = alo.Sarakeryhma_arvo26
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava27 ON ava27.id = alo.Sarakeryhma_arvo27
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava28 ON ava28.id = alo.Sarakeryhma_arvo28
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava29 ON ava29.id = alo.Sarakeryhma_arvo29
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava30 ON ava30.id = alo.Sarakeryhma_arvo30
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava31 ON ava31.id = alo.Sarakeryhma_arvo31
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava32 ON ava32.id = alo.Sarakeryhma_arvo32
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava33 ON ava33.id = alo.Sarakeryhma_arvo33
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava34 ON ava34.id = alo.Sarakeryhma_arvo34
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava35 ON ava35.id = alo.Sarakeryhma_arvo35
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava36 ON ava36.id = alo.Sarakeryhma_arvo36
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava37 ON ava37.id = alo.Sarakeryhma_arvo37
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava38 ON ava38.id = alo.Sarakeryhma_arvo38
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava39 ON ava39.id = alo.Sarakeryhma_arvo39
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava40 ON ava40.id = alo.Sarakeryhma_arvo40
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava41 ON ava41.id = alo.Sarakeryhma_arvo41
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava42 ON ava42.id = alo.Sarakeryhma_arvo42
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava43 ON ava43.id = alo.Sarakeryhma_arvo43
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava44 ON ava44.id = alo.Sarakeryhma_arvo44
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava45 ON ava45.id = alo.Sarakeryhma_arvo45
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava46 ON ava46.id = alo.Sarakeryhma_arvo46
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava47 ON ava47.id = alo.Sarakeryhma_arvo47
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava48 ON ava48.id = alo.Sarakeryhma_arvo48
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava49 ON ava49.id = alo.Sarakeryhma_arvo49
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava50 ON ava50.id = alo.Sarakeryhma_arvo50
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava51 ON ava51.id = alo.Sarakeryhma_arvo51
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava52 ON ava52.id = alo.Sarakeryhma_arvo52
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava53 ON ava53.id = alo.Sarakeryhma_arvo53
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava54 ON ava54.id = alo.Sarakeryhma_arvo54
  LEFT JOIN _aloittaneiden_lapaisy_avaimet ava55 ON ava55.id = alo.Sarakeryhma_arvo55
) sarakeryhmat
' 
GO
/****** Object:  View [dbo].[_v_sa_K3_10_Tutk_suor_osuus_aloittaneista_korkeakoulut_surrogaattiavaimet_nykytila_taulusta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[_v_sa_K3_10_Tutk_suor_osuus_aloittaneista_korkeakoulut_surrogaattiavaimet_nykytila_taulusta]'))
EXEC dbo.sp_executesql @statement = N'



CREATE View [dbo].[_v_sa_K3_10_Tutk_suor_osuus_aloittaneista_korkeakoulut_surrogaattiavaimet_nykytila_taulusta] as

/****** Script for SelectTopNRows command from SSMS  ******/
--Select * from [okm].[okm_ktpo_tiedontuotanto_in].f --> 6588 rows
--Select * from [vipunen_ETL].[v_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_surrogaattiavaimet] --> 6588 rows

SELECT [tilv]
      ,[lahde]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[alvv_kk]
      ,[allk_kk]
      ,[ololk]
      ,[klaji]
      --,[ophal]
      ,[jarj]
      ,[kkun]
      ,[koulk]
      ,[pohjkoulk]
      ,[rahlahde]
      ,[tietolahde]
      ,[rivinumero]
      ,[aineistorivinumero]

      ,[lkm]

      ,''amk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2000] AND
      suorlk = [amksuorlk_2000] AND
      tutkmaak = [amktutkkmaak_2000] AND
      tutkjarj = [amktutkjarj_2000] AND
      tutkkoulk = [amktutkkoulk_2000]  )
      ,''ylamk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2000] AND
      suorlk = [ylamksuorlk_2000] AND
      tutkmaak = [ylamktutkkmaak_2000] AND
      tutkjarj = [ylamktutkjarj_2000] AND
      tutkkoulk = [ylamktutkkoulk_2000]  )
      ,''alkk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2000] AND
      suorlk = [alkksuorlk_2000] AND
      tutkmaak = [alkktutkkmaak_2000] AND
      tutkjarj = [alkktutkjarj_2000] AND
      tutkkoulk = [alkktutkkoulk_2000]  )
      ,''ylkk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2000] AND
      suorlk = [ylkksuorlk_2000] AND
      tutkmaak = [ylkktutkkmaak_2000] AND
      tutkjarj = [ylkktutkjarj_2000] AND
      tutkkoulk = [ylkktutkkoulk_2000]  )
      ,''tk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2000] AND
      suorlk = [tksuorlk_2000] AND
      tutkmaak = [tktutkkmaak_2000] AND
      tutkjarj = [tktutkjarj_2000] AND
      tutkkoulk = [tktutkkoulk_2000]  )
      ,''muuta_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2000] AND
      suorlk = [muutasuorlk_2000] AND
      tutkmaak = [muutatutkkmaak_2000] AND
      tutkjarj = [muutatutkjarj_2000] AND
      tutkkoulk = [muutatutkkoulk_2000]  )
      ,''amk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2001] AND
      suorlk = [amksuorlk_2001] AND
      tutkmaak = [amktutkkmaak_2001] AND
      tutkjarj = [amktutkjarj_2001] AND
      tutkkoulk = [amktutkkoulk_2001]  )
      ,''ylamk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2001] AND
      suorlk = [ylamksuorlk_2001] AND
      tutkmaak = [ylamktutkkmaak_2001] AND
      tutkjarj = [ylamktutkjarj_2001] AND
      tutkkoulk = [ylamktutkkoulk_2001]  )
      ,''alkk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2001] AND
      suorlk = [alkksuorlk_2001] AND
      tutkmaak = [alkktutkkmaak_2001] AND
      tutkjarj = [alkktutkjarj_2001] AND
      tutkkoulk = [alkktutkkoulk_2001]  )
      ,''ylkk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2001] AND
      suorlk = [ylkksuorlk_2001] AND
      tutkmaak = [ylkktutkkmaak_2001] AND
      tutkjarj = [ylkktutkjarj_2001] AND
      tutkkoulk = [ylkktutkkoulk_2001]  )
      ,''tk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2001] AND
      suorlk = [tksuorlk_2001] AND
      tutkmaak = [tktutkkmaak_2001] AND
      tutkjarj = [tktutkjarj_2001] AND
      tutkkoulk = [tktutkkoulk_2001]  )
      ,''muuta_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2001] AND
      suorlk = [muutasuorlk_2001] AND
      tutkmaak = [muutatutkkmaak_2001] AND
      tutkjarj = [muutatutkjarj_2001] AND
      tutkkoulk = [muutatutkkoulk_2001]  )
      ,''amk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2002] AND
      suorlk = [amksuorlk_2002] AND
      tutkmaak = [amktutkkmaak_2002] AND
      tutkjarj = [amktutkjarj_2002] AND
      tutkkoulk = [amktutkkoulk_2002]  )
      ,''ylamk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2002] AND
      suorlk = [ylamksuorlk_2002] AND
      tutkmaak = [ylamktutkkmaak_2002] AND
      tutkjarj = [ylamktutkjarj_2002] AND
      tutkkoulk = [ylamktutkkoulk_2002]  )
      ,''alkk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2002] AND
      suorlk = [alkksuorlk_2002] AND
      tutkmaak = [alkktutkkmaak_2002] AND
      tutkjarj = [alkktutkjarj_2002] AND
      tutkkoulk = [alkktutkkoulk_2002]  )
      ,''ylkk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2002] AND
      suorlk = [ylkksuorlk_2002] AND
      tutkmaak = [ylkktutkkmaak_2002] AND
      tutkjarj = [ylkktutkjarj_2002] AND
      tutkkoulk = [ylkktutkkoulk_2002]  )
      ,''tk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2002] AND
      suorlk = [tksuorlk_2002] AND
      tutkmaak = [tktutkkmaak_2002] AND
      tutkjarj = [tktutkjarj_2002] AND
      tutkkoulk = [tktutkkoulk_2002]  )
      ,''muuta_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2002] AND
      suorlk = [muutasuorlk_2002] AND
      tutkmaak = [muutatutkkmaak_2002] AND
      tutkjarj = [muutatutkjarj_2002] AND
      tutkkoulk = [muutatutkkoulk_2002]  )
      ,''amk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2003] AND
      suorlk = [amksuorlk_2003] AND
      tutkmaak = [amktutkkmaak_2003] AND
      tutkjarj = [amktutkjarj_2003] AND
      tutkkoulk = [amktutkkoulk_2003]  )
      ,''ylamk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2003] AND
      suorlk = [ylamksuorlk_2003] AND
      tutkmaak = [ylamktutkkmaak_2003] AND
      tutkjarj = [ylamktutkjarj_2003] AND
      tutkkoulk = [ylamktutkkoulk_2003]  )
      ,''alkk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2003] AND
      suorlk = [alkksuorlk_2003] AND
      tutkmaak = [alkktutkkmaak_2003] AND
      tutkjarj = [alkktutkjarj_2003] AND
      tutkkoulk = [alkktutkkoulk_2003]  )
      ,''ylkk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2003] AND
      suorlk = [ylkksuorlk_2003] AND
      tutkmaak = [ylkktutkkmaak_2003] AND
      tutkjarj = [ylkktutkjarj_2003] AND
      tutkkoulk = [ylkktutkkoulk_2003]  )
      ,''tk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2003] AND
      suorlk = [tksuorlk_2003] AND
      tutkmaak = [tktutkkmaak_2003] AND
      tutkjarj = [tktutkjarj_2003] AND
      tutkkoulk = [tktutkkoulk_2003]  )
      ,''muuta_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2003] AND
      suorlk = [muutasuorlk_2003] AND
      tutkmaak = [muutatutkkmaak_2003] AND
      tutkjarj = [muutatutkjarj_2003] AND
      tutkkoulk = [muutatutkkoulk_2003]  )
      ,''amk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2004] AND
      suorlk = [amksuorlk_2004] AND
      tutkmaak = [amktutkkmaak_2004] AND
      tutkjarj = [amktutkjarj_2004] AND
      tutkkoulk = [amktutkkoulk_2004]  )
      ,''ylamk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2004] AND
      suorlk = [ylamksuorlk_2004] AND
      tutkmaak = [ylamktutkkmaak_2004] AND
      tutkjarj = [ylamktutkjarj_2004] AND
      tutkkoulk = [ylamktutkkoulk_2004]  )
      ,''alkk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2004] AND
      suorlk = [alkksuorlk_2004] AND
      tutkmaak = [alkktutkkmaak_2004] AND
      tutkjarj = [alkktutkjarj_2004] AND
      tutkkoulk = [alkktutkkoulk_2004]  )
      ,''ylkk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2004] AND
      suorlk = [ylkksuorlk_2004] AND
      tutkmaak = [ylkktutkkmaak_2004] AND
      tutkjarj = [ylkktutkjarj_2004] AND
      tutkkoulk = [ylkktutkkoulk_2004]  )
      ,''tk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2004] AND
      suorlk = [tksuorlk_2004] AND
      tutkmaak = [tktutkkmaak_2004] AND
      tutkjarj = [tktutkjarj_2004] AND
      tutkkoulk = [tktutkkoulk_2004]  )
      ,''muuta_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2004] AND
      suorlk = [muutasuorlk_2004] AND
      tutkmaak = [muutatutkkmaak_2004] AND
      tutkjarj = [muutatutkjarj_2004] AND
      tutkkoulk = [muutatutkkoulk_2004]  )
      ,''amk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2005] AND
      suorlk = [amksuorlk_2005] AND
      tutkmaak = [amktutkkmaak_2005] AND
      tutkjarj = [amktutkjarj_2005] AND
      tutkkoulk = [amktutkkoulk_2005]  )
      ,''ylamk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2005] AND
      suorlk = [ylamksuorlk_2005] AND
      tutkmaak = [ylamktutkkmaak_2005] AND
      tutkjarj = [ylamktutkjarj_2005] AND
      tutkkoulk = [ylamktutkkoulk_2005]  )
      ,''alkk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2005] AND
      suorlk = [alkksuorlk_2005] AND
      tutkmaak = [alkktutkkmaak_2005] AND
      tutkjarj = [alkktutkjarj_2005] AND
      tutkkoulk = [alkktutkkoulk_2005]  )
      ,''ylkk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2005] AND
      suorlk = [ylkksuorlk_2005] AND
      tutkmaak = [ylkktutkkmaak_2005] AND
      tutkjarj = [ylkktutkjarj_2005] AND
      tutkkoulk = [ylkktutkkoulk_2005]  )
      ,''tk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2005] AND
      suorlk = [tksuorlk_2005] AND
      tutkmaak = [tktutkkmaak_2005] AND
      tutkjarj = [tktutkjarj_2005] AND
      tutkkoulk = [tktutkkoulk_2005]  )
      ,''muuta_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2005] AND
      suorlk = [muutasuorlk_2005] AND
      tutkmaak = [muutatutkkmaak_2005] AND
      tutkjarj = [muutatutkjarj_2005] AND
      tutkkoulk = [muutatutkkoulk_2005]  )
      ,''amk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2006] AND
      suorlk = [amksuorlk_2006] AND
      tutkmaak = [amktutkkmaak_2006] AND
      tutkjarj = [amktutkjarj_2006] AND
      tutkkoulk = [amktutkkoulk_2006]  )
      ,''ylamk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2006] AND
      suorlk = [ylamksuorlk_2006] AND
      tutkmaak = [ylamktutkkmaak_2006] AND
      tutkjarj = [ylamktutkjarj_2006] AND
      tutkkoulk = [ylamktutkkoulk_2006]  )
      ,''alkk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2006] AND
      suorlk = [alkksuorlk_2006] AND
      tutkmaak = [alkktutkkmaak_2006] AND
      tutkjarj = [alkktutkjarj_2006] AND
      tutkkoulk = [alkktutkkoulk_2006]  )
      ,''ylkk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2006] AND
      suorlk = [ylkksuorlk_2006] AND
      tutkmaak = [ylkktutkkmaak_2006] AND
      tutkjarj = [ylkktutkjarj_2006] AND
      tutkkoulk = [ylkktutkkoulk_2006]  )
      ,''tk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2006] AND
      suorlk = [tksuorlk_2006] AND
      tutkmaak = [tktutkkmaak_2006] AND
      tutkjarj = [tktutkjarj_2006] AND
      tutkkoulk = [tktutkkoulk_2006]  )
      ,''muuta_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2006] AND
      suorlk = [muutasuorlk_2006] AND
      tutkmaak = [muutatutkkmaak_2006] AND
      tutkjarj = [muutatutkjarj_2006] AND
      tutkkoulk = [muutatutkkoulk_2006]  )
      ,''amk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2007] AND
      suorlk = [amksuorlk_2007] AND
      tutkmaak = [amktutkkmaak_2007] AND
      tutkjarj = [amktutkjarj_2007] AND
      tutkkoulk = [amktutkkoulk_2007]  )
      ,''ylamk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2007] AND
      suorlk = [ylamksuorlk_2007] AND
      tutkmaak = [ylamktutkkmaak_2007] AND
      tutkjarj = [ylamktutkjarj_2007] AND
      tutkkoulk = [ylamktutkkoulk_2007]  )
      ,''alkk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2007] AND
      suorlk = [alkksuorlk_2007] AND
      tutkmaak = [alkktutkkmaak_2007] AND
      tutkjarj = [alkktutkjarj_2007] AND
      tutkkoulk = [alkktutkkoulk_2007]  )
      ,''ylkk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2007] AND
      suorlk = [ylkksuorlk_2007] AND
      tutkmaak = [ylkktutkkmaak_2007] AND
      tutkjarj = [ylkktutkjarj_2007] AND
      tutkkoulk = [ylkktutkkoulk_2007]  )
      ,''tk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2007] AND
      suorlk = [tksuorlk_2007] AND
      tutkmaak = [tktutkkmaak_2007] AND
      tutkjarj = [tktutkjarj_2007] AND
      tutkkoulk = [tktutkkoulk_2007]  )
      ,''muuta_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2007] AND
      suorlk = [muutasuorlk_2007] AND
      tutkmaak = [muutatutkkmaak_2007] AND
      tutkjarj = [muutatutkjarj_2007] AND
      tutkkoulk = [muutatutkkoulk_2007]  )
      ,''amk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2008] AND
      suorlk = [amksuorlk_2008] AND
      tutkmaak = [amktutkkmaak_2008] AND
      tutkjarj = [amktutkjarj_2008] AND
      tutkkoulk = [amktutkkoulk_2008]  )
      ,''ylamk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2008] AND
      suorlk = [ylamksuorlk_2008] AND
      tutkmaak = [ylamktutkkmaak_2008] AND
      tutkjarj = [ylamktutkjarj_2008] AND
      tutkkoulk = [ylamktutkkoulk_2008]  )
      ,''alkk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2008] AND
      suorlk = [alkksuorlk_2008] AND
      tutkmaak = [alkktutkkmaak_2008] AND
      tutkjarj = [alkktutkjarj_2008] AND
      tutkkoulk = [alkktutkkoulk_2008]  )
      ,''ylkk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2008] AND
      suorlk = [ylkksuorlk_2008] AND
      tutkmaak = [ylkktutkkmaak_2008] AND
      tutkjarj = [ylkktutkjarj_2008] AND
      tutkkoulk = [ylkktutkkoulk_2008]  )
      ,''tk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2008] AND
      suorlk = [tksuorlk_2008] AND
      tutkmaak = [tktutkkmaak_2008] AND
      tutkjarj = [tktutkjarj_2008] AND
      tutkkoulk = [tktutkkoulk_2008]  )
      ,''muuta_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2008] AND
      suorlk = [muutasuorlk_2008] AND
      tutkmaak = [muutatutkkmaak_2008] AND
      tutkjarj = [muutatutkjarj_2008] AND
      tutkkoulk = [muutatutkkoulk_2008]  )
      
      ,''amkopisk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2000] AND
      opiskjarj_2 = [amkopiskjarj_2000] AND
      kmaak_2 = [amkkmaak_2000] AND
      olotamm_2 = [amkolotamm_2000] AND
      olosyys_2 = [amkolosyys_2000]  )
      ,''ylamkopisk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2000] AND
      opiskjarj_2 = [ylamkopiskjarj_2000] AND
      kmaak_2 = [ylamkkmaak_2000] AND
      olotamm_2 = [ylamkolotamm_2000] AND
      olosyys_2 = [ylamkolosyys_2000]  )
      ,''alkkopisk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2000] AND
      opiskjarj_2 = [alkkopiskjarj_2000] AND
      kmaak_2 = [alkkkmaak_2000] AND
      olotamm_2 = [alkkolotamm_2000] AND
      olosyys_2 = [alkkolosyys_2000]  )
      ,''ylkkopisk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2000] AND
      opiskjarj_2 = [ylkkopiskjarj_2000] AND
      kmaak_2 = [ylkkkmaak_2000] AND
      olotamm_2 = [ylkkolotamm_2000] AND
      olosyys_2 = [ylkkolosyys_2000]  )
      ,''tkopisk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2000] AND
      opiskjarj_2 = [tkopiskjarj_2000] AND
      kmaak_2 = [tkkmaak_2000] AND
      olotamm_2 = [tkolotamm_2000] AND
      olosyys_2 = [tkolosyys_2000]  )
      ,''muutaopisk_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2000] AND
      opiskjarj_2 = [muutaopiskjarj_2000] AND
      kmaak_2 = [muutakmaak_2000] AND
      olotamm_2 = [muutaolotamm_2000] AND
      olosyys_2 = [muutaolosyys_2000]  )
      ,''amkopisk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2001] AND
      opiskjarj_2 = [amkopiskjarj_2001] AND
      kmaak_2 = [amkkmaak_2001] AND
      olotamm_2 = [amkolotamm_2001] AND
      olosyys_2 = [amkolosyys_2001]  )
      ,''ylamkopisk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2001] AND
      opiskjarj_2 = [ylamkopiskjarj_2001] AND
      kmaak_2 = [ylamkkmaak_2001] AND
      olotamm_2 = [ylamkolotamm_2001] AND
      olosyys_2 = [ylamkolosyys_2001]  )
      ,''alkkopisk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2001] AND
      opiskjarj_2 = [alkkopiskjarj_2001] AND
      kmaak_2 = [alkkkmaak_2001] AND
      olotamm_2 = [alkkolotamm_2001] AND
      olosyys_2 = [alkkolosyys_2001]  )
      ,''ylkkopisk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2001] AND
      opiskjarj_2 = [ylkkopiskjarj_2001] AND
      kmaak_2 = [ylkkkmaak_2001] AND
      olotamm_2 = [ylkkolotamm_2001] AND
      olosyys_2 = [ylkkolosyys_2001]  )
      ,''tkopisk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2001] AND
      opiskjarj_2 = [tkopiskjarj_2001] AND
      kmaak_2 = [tkkmaak_2001] AND
      olotamm_2 = [tkolotamm_2001] AND
      olosyys_2 = [tkolosyys_2001]  )
      ,''muutaopisk_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2001] AND
      opiskjarj_2 = [muutaopiskjarj_2001] AND
      kmaak_2 = [muutakmaak_2001] AND
      olotamm_2 = [muutaolotamm_2001] AND
      olosyys_2 = [muutaolosyys_2001]  )
      ,''amkopisk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2002] AND
      opiskjarj_2 = [amkopiskjarj_2002] AND
      kmaak_2 = [amkkmaak_2002] AND
      olotamm_2 = [amkolotamm_2002] AND
      olosyys_2 = [amkolosyys_2002]  )
      ,''ylamkopisk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2002] AND
      opiskjarj_2 = [ylamkopiskjarj_2002] AND
      kmaak_2 = [ylamkkmaak_2002] AND
      olotamm_2 = [ylamkolotamm_2002] AND
      olosyys_2 = [ylamkolosyys_2002]  )
      ,''alkkopisk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2002] AND
      opiskjarj_2 = [alkkopiskjarj_2002] AND
      kmaak_2 = [alkkkmaak_2002] AND
      olotamm_2 = [alkkolotamm_2002] AND
      olosyys_2 = [alkkolosyys_2002]  )
      ,''ylkkopisk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2002] AND
      opiskjarj_2 = [ylkkopiskjarj_2002] AND
      kmaak_2 = [ylkkkmaak_2002] AND
      olotamm_2 = [ylkkolotamm_2002] AND
      olosyys_2 = [ylkkolosyys_2002]  )
      ,''tkopisk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2002] AND
      opiskjarj_2 = [tkopiskjarj_2002] AND
      kmaak_2 = [tkkmaak_2002] AND
      olotamm_2 = [tkolotamm_2002] AND
      olosyys_2 = [tkolosyys_2002]  )
      ,''muutaopisk_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2002] AND
      opiskjarj_2 = [muutaopiskjarj_2002] AND
      kmaak_2 = [muutakmaak_2002] AND
      olotamm_2 = [muutaolotamm_2002] AND
      olosyys_2 = [muutaolosyys_2002]  )
      ,''amkopisk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2003] AND
      opiskjarj_2 = [amkopiskjarj_2003] AND
      kmaak_2 = [amkkmaak_2003] AND
      olotamm_2 = [amkolotamm_2003] AND
      olosyys_2 = [amkolosyys_2003]  )
      ,''ylamkopisk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2003] AND
      opiskjarj_2 = [ylamkopiskjarj_2003] AND
      kmaak_2 = [ylamkkmaak_2003] AND
      olotamm_2 = [ylamkolotamm_2003] AND
      olosyys_2 = [ylamkolosyys_2003]  )
      ,''alkkopisk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2003] AND
      opiskjarj_2 = [alkkopiskjarj_2003] AND
      kmaak_2 = [alkkkmaak_2003] AND
      olotamm_2 = [alkkolotamm_2003] AND
      olosyys_2 = [alkkolosyys_2003]  )
      ,''ylkkopisk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2003] AND
      opiskjarj_2 = [ylkkopiskjarj_2003] AND
      kmaak_2 = [ylkkkmaak_2003] AND
      olotamm_2 = [ylkkolotamm_2003] AND
      olosyys_2 = [ylkkolosyys_2003]  )
      ,''tkopisk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2003] AND
      opiskjarj_2 = [tkopiskjarj_2003] AND
      kmaak_2 = [tkkmaak_2003] AND
      olotamm_2 = [tkolotamm_2003] AND
      olosyys_2 = [tkolosyys_2003]  )
      ,''muutaopisk_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2003] AND
      opiskjarj_2 = [muutaopiskjarj_2003] AND
      kmaak_2 = [muutakmaak_2003] AND
      olotamm_2 = [muutaolotamm_2003] AND
      olosyys_2 = [muutaolosyys_2003]  )
      ,''amkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2004] AND
      opiskjarj_2 = [amkopiskjarj_2004] AND
      kmaak_2 = [amkkmaak_2004] AND
      olotamm_2 = [amkolotamm_2004] AND
      olosyys_2 = [amkolosyys_2004]  )
      ,''ylamkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2004] AND
      opiskjarj_2 = [ylamkopiskjarj_2004] AND
      kmaak_2 = [ylamkkmaak_2004] AND
      olotamm_2 = [ylamkolotamm_2004] AND
      olosyys_2 = [ylamkolosyys_2004]  )
      ,''alkkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2004] AND
      opiskjarj_2 = [alkkopiskjarj_2004] AND
      kmaak_2 = [alkkkmaak_2004] AND
      olotamm_2 = [alkkolotamm_2004] AND
      olosyys_2 = [alkkolosyys_2004]  )
      ,''ylkkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2004] AND
      opiskjarj_2 = [ylkkopiskjarj_2004] AND
      kmaak_2 = [ylkkkmaak_2004] AND
      olotamm_2 = [ylkkolotamm_2004] AND
      olosyys_2 = [ylkkolosyys_2004]  )
      ,''tkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2004] AND
      opiskjarj_2 = [tkopiskjarj_2004] AND
      kmaak_2 = [tkkmaak_2004] AND
      olotamm_2 = [tkolotamm_2004] AND
      olosyys_2 = [tkolosyys_2004]  )
      ,''muutaopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2004] AND
      opiskjarj_2 = [muutaopiskjarj_2004] AND
      kmaak_2 = [muutakmaak_2004] AND
      olotamm_2 = [muutaolotamm_2004] AND
      olosyys_2 = [muutaolosyys_2004]  )
      ,''amkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2005] AND
      opiskjarj_2 = [amkopiskjarj_2005] AND
      kmaak_2 = [amkkmaak_2005] AND
      olotamm_2 = [amkolotamm_2005] AND
      olosyys_2 = [amkolosyys_2005]  )
      ,''ylamkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2005] AND
      opiskjarj_2 = [ylamkopiskjarj_2005] AND
      kmaak_2 = [ylamkkmaak_2005] AND
      olotamm_2 = [ylamkolotamm_2005] AND
      olosyys_2 = [ylamkolosyys_2005]  )
      ,''alkkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2005] AND
      opiskjarj_2 = [alkkopiskjarj_2005] AND
      kmaak_2 = [alkkkmaak_2005] AND
      olotamm_2 = [alkkolotamm_2005] AND
      olosyys_2 = [alkkolosyys_2005]  )
      ,''ylkkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2005] AND
      opiskjarj_2 = [ylkkopiskjarj_2005] AND
      kmaak_2 = [ylkkkmaak_2005] AND
      olotamm_2 = [ylkkolotamm_2005] AND
      olosyys_2 = [ylkkolosyys_2005]  )
      ,''tkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2005] AND
      opiskjarj_2 = [tkopiskjarj_2005] AND
      kmaak_2 = [tkkmaak_2005] AND
      olotamm_2 = [tkolotamm_2005] AND
      olosyys_2 = [tkolosyys_2005]  )
      ,''muutaopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2005] AND
      opiskjarj_2 = [muutaopiskjarj_2005] AND
      kmaak_2 = [muutakmaak_2005] AND
      olotamm_2 = [muutaolotamm_2005] AND
      olosyys_2 = [muutaolosyys_2005]  )
      ,''amkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2006] AND
      opiskjarj_2 = [amkopiskjarj_2006] AND
      kmaak_2 = [amkkmaak_2006] AND
      olotamm_2 = [amkolotamm_2006] AND
      olosyys_2 = [amkolosyys_2006]  )
      ,''ylamkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2006] AND
      opiskjarj_2 = [ylamkopiskjarj_2006] AND
      kmaak_2 = [ylamkkmaak_2006] AND
      olotamm_2 = [ylamkolotamm_2006] AND
      olosyys_2 = [ylamkolosyys_2006]  )
      ,''alkkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2006] AND
      opiskjarj_2 = [alkkopiskjarj_2006] AND
      kmaak_2 = [alkkkmaak_2006] AND
      olotamm_2 = [alkkolotamm_2006] AND
      olosyys_2 = [alkkolosyys_2006]  )
      ,''ylkkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2006] AND
      opiskjarj_2 = [ylkkopiskjarj_2006] AND
      kmaak_2 = [ylkkkmaak_2006] AND
      olotamm_2 = [ylkkolotamm_2006] AND
      olosyys_2 = [ylkkolosyys_2006]  )
      ,''tkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2006] AND
      opiskjarj_2 = [tkopiskjarj_2006] AND
      kmaak_2 = [tkkmaak_2006] AND
      olotamm_2 = [tkolotamm_2006] AND
      olosyys_2 = [tkolosyys_2006]  )
      ,''muutaopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2006] AND
      opiskjarj_2 = [muutaopiskjarj_2006] AND
      kmaak_2 = [muutakmaak_2006] AND
      olotamm_2 = [muutaolotamm_2006] AND
      olosyys_2 = [muutaolosyys_2006]  )
      ,''amkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2007] AND
      opiskjarj_2 = [amkopiskjarj_2007] AND
      kmaak_2 = [amkkmaak_2007] AND
      olotamm_2 = [amkolotamm_2007] AND
      olosyys_2 = [amkolosyys_2007]  )
      ,''ylamkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2007] AND
      opiskjarj_2 = [ylamkopiskjarj_2007] AND
      kmaak_2 = [ylamkkmaak_2007] AND
      olotamm_2 = [ylamkolotamm_2007] AND
      olosyys_2 = [ylamkolosyys_2007]  )
      ,''alkkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2007] AND
      opiskjarj_2 = [alkkopiskjarj_2007] AND
      kmaak_2 = [alkkkmaak_2007] AND
      olotamm_2 = [alkkolotamm_2007] AND
      olosyys_2 = [alkkolosyys_2007]  )
      ,''ylkkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2007] AND
      opiskjarj_2 = [ylkkopiskjarj_2007] AND
      kmaak_2 = [ylkkkmaak_2007] AND
      olotamm_2 = [ylkkolotamm_2007] AND
      olosyys_2 = [ylkkolosyys_2007]  )
      ,''tkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2007] AND
      opiskjarj_2 = [tkopiskjarj_2007] AND
      kmaak_2 = [tkkmaak_2007] AND
      olotamm_2 = [tkolotamm_2007] AND
      olosyys_2 = [tkolosyys_2007]  )
      ,''muutaopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2007] AND
      opiskjarj_2 = [muutaopiskjarj_2007] AND
      kmaak_2 = [muutakmaak_2007] AND
      olotamm_2 = [muutaolotamm_2007] AND
      olosyys_2 = [muutaolosyys_2007]  )
      ,''amkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2008] AND
      opiskjarj_2 = [amkopiskjarj_2008] AND
      kmaak_2 = [amkkmaak_2008] AND
      olotamm_2 = [amkolotamm_2008] AND
      olosyys_2 = [amkolosyys_2008]  )
      ,''ylamkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2008] AND
      opiskjarj_2 = [ylamkopiskjarj_2008] AND
      kmaak_2 = [ylamkkmaak_2008] AND
      olotamm_2 = [ylamkolotamm_2008] AND
      olosyys_2 = [ylamkolosyys_2008]  )
      ,''alkkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2008] AND
      opiskjarj_2 = [alkkopiskjarj_2008] AND
      kmaak_2 = [alkkkmaak_2008] AND
      olotamm_2 = [alkkolotamm_2008] AND
      olosyys_2 = [alkkolosyys_2008]  )
      ,''ylkkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2008] AND
      opiskjarj_2 = [ylkkopiskjarj_2008] AND
      kmaak_2 = [ylkkkmaak_2008] AND
      olotamm_2 = [ylkkolotamm_2008] AND
      olosyys_2 = [ylkkolosyys_2008]  )
      ,''tkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2008] AND
      opiskjarj_2 = [tkopiskjarj_2008] AND
      kmaak_2 = [tkkmaak_2008] AND
      olotamm_2 = [tkolotamm_2008] AND
      olosyys_2 = [tkolosyys_2008]  )
      ,''muutaopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2008] AND
      opiskjarj_2 = [muutaopiskjarj_2008] AND
      kmaak_2 = [muutakmaak_2008] AND
      olotamm_2 = [muutaolotamm_2008] AND
      olosyys_2 = [muutaolosyys_2008]  )

      ,''ptoim1r5_2000'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2000] AND
      amas = [amas_2000]  )
      ,''ptoim1r5_2001'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2001] AND
      amas = [amas_2001]  )
      ,''ptoim1r5_2002'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2002] AND
      amas = [amas_2002]  )
      ,''ptoim1r5_2003'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2003] AND
      amas = [amas_2003]  )
      ,''ptoim1r5_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2004] AND
      amas = [amas_2004]  )
      ,''ptoim1r5_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2005] AND
      amas = [amas_2005]  )
      ,''ptoim1r5_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2006] AND
      amas = [amas_2006]  )
      ,''ptoim1r5_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2007] AND
      amas = [amas_2007]  )
      ,''ptoim1r5_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2008] AND
      amas = [amas_2008]  )
--2009
      ,''amk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2009] AND
      suorlk = [amksuorlk_2009] AND
      tutkmaak = [amktutkkmaak_2009] AND
      tutkjarj = [amktutkjarj_2009] AND
      tutkkoulk = [amktutkkoulk_2009]  )
      ,''ylamk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2009] AND
      suorlk = [ylamksuorlk_2009] AND
      tutkmaak = [ylamktutkkmaak_2009] AND
      tutkjarj = [ylamktutkjarj_2009] AND
      tutkkoulk = [ylamktutkkoulk_2009]  )
      ,''alkk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2009] AND
      suorlk = [alkksuorlk_2009] AND
      tutkmaak = [alkktutkkmaak_2009] AND
      tutkjarj = [alkktutkjarj_2009] AND
      tutkkoulk = [alkktutkkoulk_2009]  )
      ,''ylkk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2009] AND
      suorlk = [ylkksuorlk_2009] AND
      tutkmaak = [ylkktutkkmaak_2009] AND
      tutkjarj = [ylkktutkjarj_2009] AND
      tutkkoulk = [ylkktutkkoulk_2009]  )
      ,''tk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2009] AND
      suorlk = [tksuorlk_2009] AND
      tutkmaak = [tktutkkmaak_2009] AND
      tutkjarj = [tktutkjarj_2009] AND
      tutkkoulk = [tktutkkoulk_2009]  )
      ,''muuta_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2009] AND
      suorlk = [muutasuorlk_2009] AND
      tutkmaak = [muutatutkkmaak_2009] AND
      tutkjarj = [muutatutkjarj_2009] AND
      tutkkoulk = [muutatutkkoulk_2009]  )
      ,''amkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2009] AND
      opiskjarj_2 = [amkopiskjarj_2009] AND
      kmaak_2 = [amkkmaak_2009] AND
      olotamm_2 = [amkolotamm_2009] AND
      olosyys_2 = [amkolosyys_2009]  )
      ,''ylamkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2009] AND
      opiskjarj_2 = [ylamkopiskjarj_2009] AND
      kmaak_2 = [ylamkkmaak_2009] AND
      olotamm_2 = [ylamkolotamm_2009] AND
      olosyys_2 = [ylamkolosyys_2009]  )
      ,''alkkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2009] AND
      opiskjarj_2 = [alkkopiskjarj_2009] AND
      kmaak_2 = [alkkkmaak_2009] AND
      olotamm_2 = [alkkolotamm_2009] AND
      olosyys_2 = [alkkolosyys_2009]  )
      ,''ylkkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2009] AND
      opiskjarj_2 = [ylkkopiskjarj_2009] AND
      kmaak_2 = [ylkkkmaak_2009] AND
      olotamm_2 = [ylkkolotamm_2009] AND
      olosyys_2 = [ylkkolosyys_2009]  )
      ,''tkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2009] AND
      opiskjarj_2 = [tkopiskjarj_2009] AND
      kmaak_2 = [tkkmaak_2009] AND
      olotamm_2 = [tkolotamm_2009] AND
      olosyys_2 = [tkolosyys_2009]  )
      ,''muutaopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2009] AND
      opiskjarj_2 = [muutaopiskjarj_2009] AND
      kmaak_2 = [muutakmaak_2009] AND
      olotamm_2 = [muutaolotamm_2009] AND
      olosyys_2 = [muutaolosyys_2009]  )
      ,''ptoim1r5_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2009] AND
      amas = [amas_2009]  )
--2010
      ,''amk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2010] AND
      suorlk = [amksuorlk_2010] AND
      tutkmaak = [amktutkkmaak_2010] AND
      tutkjarj = [amktutkjarj_2010] AND
      tutkkoulk = [amktutkkoulk_2010]  )
      ,''ylamk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2010] AND
      suorlk = [ylamksuorlk_2010] AND
      tutkmaak = [ylamktutkkmaak_2010] AND
      tutkjarj = [ylamktutkjarj_2010] AND
      tutkkoulk = [ylamktutkkoulk_2010]  )
      ,''alkk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2010] AND
      suorlk = [alkksuorlk_2010] AND
      tutkmaak = [alkktutkkmaak_2010] AND
      tutkjarj = [alkktutkjarj_2010] AND
      tutkkoulk = [alkktutkkoulk_2010]  )
      ,''ylkk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2010] AND
      suorlk = [ylkksuorlk_2010] AND
      tutkmaak = [ylkktutkkmaak_2010] AND
      tutkjarj = [ylkktutkjarj_2010] AND
      tutkkoulk = [ylkktutkkoulk_2010]  )
      ,''tk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2010] AND
      suorlk = [tksuorlk_2010] AND
      tutkmaak = [tktutkkmaak_2010] AND
      tutkjarj = [tktutkjarj_2010] AND
      tutkkoulk = [tktutkkoulk_2010]  )
      ,''muuta_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2010] AND
      suorlk = [muutasuorlk_2010] AND
      tutkmaak = [muutatutkkmaak_2010] AND
      tutkjarj = [muutatutkjarj_2010] AND
      tutkkoulk = [muutatutkkoulk_2010]  )
      ,''amkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2010] AND
      opiskjarj_2 = [amkopiskjarj_2010] AND
      kmaak_2 = [amkkmaak_2010] AND
      olotamm_2 = [amkolotamm_2010] AND
      olosyys_2 = [amkolosyys_2010]  )
      ,''ylamkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2010] AND
      opiskjarj_2 = [ylamkopiskjarj_2010] AND
      kmaak_2 = [ylamkkmaak_2010] AND
      olotamm_2 = [ylamkolotamm_2010] AND
      olosyys_2 = [ylamkolosyys_2010]  )
      ,''alkkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2010] AND
      opiskjarj_2 = [alkkopiskjarj_2010] AND
      kmaak_2 = [alkkkmaak_2010] AND
      olotamm_2 = [alkkolotamm_2010] AND
      olosyys_2 = [alkkolosyys_2010]  )
      ,''ylkkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2010] AND
      opiskjarj_2 = [ylkkopiskjarj_2010] AND
      kmaak_2 = [ylkkkmaak_2010] AND
      olotamm_2 = [ylkkolotamm_2010] AND
      olosyys_2 = [ylkkolosyys_2010]  )
      ,''tkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2010] AND
      opiskjarj_2 = [tkopiskjarj_2010] AND
      kmaak_2 = [tkkmaak_2010] AND
      olotamm_2 = [tkolotamm_2010] AND
      olosyys_2 = [tkolosyys_2010]  )
      ,''muutaopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2010] AND
      opiskjarj_2 = [muutaopiskjarj_2010] AND
      kmaak_2 = [muutakmaak_2010] AND
      olotamm_2 = [muutaolotamm_2010] AND
      olosyys_2 = [muutaolosyys_2010]  )
      ,''ptoim1r5_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2010] AND
      amas = [amas_2010]  )
--2011
      ,''amk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2011] AND
      suorlk = [amksuorlk_2011] AND
      tutkmaak = [amktutkkmaak_2011] AND
      tutkjarj = [amktutkjarj_2011] AND
      tutkkoulk = [amktutkkoulk_2011]  )
      ,''ylamk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2011] AND
      suorlk = [ylamksuorlk_2011] AND
      tutkmaak = [ylamktutkkmaak_2011] AND
      tutkjarj = [ylamktutkjarj_2011] AND
      tutkkoulk = [ylamktutkkoulk_2011]  )
      ,''alkk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2011] AND
      suorlk = [alkksuorlk_2011] AND
      tutkmaak = [alkktutkkmaak_2011] AND
      tutkjarj = [alkktutkjarj_2011] AND
      tutkkoulk = [alkktutkkoulk_2011]  )
      ,''ylkk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2011] AND
      suorlk = [ylkksuorlk_2011] AND
      tutkmaak = [ylkktutkkmaak_2011] AND
      tutkjarj = [ylkktutkjarj_2011] AND
      tutkkoulk = [ylkktutkkoulk_2011]  )
      ,''tk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2011] AND
      suorlk = [tksuorlk_2011] AND
      tutkmaak = [tktutkkmaak_2011] AND
      tutkjarj = [tktutkjarj_2011] AND
      tutkkoulk = [tktutkkoulk_2011]  )
      ,''muuta_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2011] AND
      suorlk = [muutasuorlk_2011] AND
      tutkmaak = [muutatutkkmaak_2011] AND
      tutkjarj = [muutatutkjarj_2011] AND
      tutkkoulk = [muutatutkkoulk_2011]  )
      ,''amkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2011] AND
      opiskjarj_2 = [amkopiskjarj_2011] AND
      kmaak_2 = [amkkmaak_2011] AND
      olotamm_2 = [amkolotamm_2011] AND
      olosyys_2 = [amkolosyys_2011]  )
      ,''ylamkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2011] AND
      opiskjarj_2 = [ylamkopiskjarj_2011] AND
      kmaak_2 = [ylamkkmaak_2011] AND
      olotamm_2 = [ylamkolotamm_2011] AND
      olosyys_2 = [ylamkolosyys_2011]  )
      ,''alkkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2011] AND
      opiskjarj_2 = [alkkopiskjarj_2011] AND
      kmaak_2 = [alkkkmaak_2011] AND
      olotamm_2 = [alkkolotamm_2011] AND
      olosyys_2 = [alkkolosyys_2011]  )
      ,''ylkkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2011] AND
      opiskjarj_2 = [ylkkopiskjarj_2011] AND
      kmaak_2 = [ylkkkmaak_2011] AND
      olotamm_2 = [ylkkolotamm_2011] AND
      olosyys_2 = [ylkkolosyys_2011]  )
      ,''tkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2011] AND
      opiskjarj_2 = [tkopiskjarj_2011] AND
      kmaak_2 = [tkkmaak_2011] AND
      olotamm_2 = [tkolotamm_2011] AND
      olosyys_2 = [tkolosyys_2011]  )
      ,''muutaopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2011] AND
      opiskjarj_2 = [muutaopiskjarj_2011] AND
      kmaak_2 = [muutakmaak_2011] AND
      olotamm_2 = [muutaolotamm_2011] AND
      olosyys_2 = [muutaolosyys_2011]  )
      ,''ptoim1r5_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2011] AND
      amas = [amas_2011]  )
--2012
      ,''amk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2012] AND
      suorlk = [amksuorlk_2012] AND
      tutkmaak = [amktutkkmaak_2012] AND
      tutkjarj = [amktutkjarj_2012] AND
      tutkkoulk = [amktutkkoulk_2012]  )
      ,''ylamk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2012] AND
      suorlk = [ylamksuorlk_2012] AND
      tutkmaak = [ylamktutkkmaak_2012] AND
      tutkjarj = [ylamktutkjarj_2012] AND
      tutkkoulk = [ylamktutkkoulk_2012]  )
      ,''alkk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2012] AND
      suorlk = [alkksuorlk_2012] AND
      tutkmaak = [alkktutkkmaak_2012] AND
      tutkjarj = [alkktutkjarj_2012] AND
      tutkkoulk = [alkktutkkoulk_2012]  )
      ,''ylkk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2012] AND
      suorlk = [ylkksuorlk_2012] AND
      tutkmaak = [ylkktutkkmaak_2012] AND
      tutkjarj = [ylkktutkjarj_2012] AND
      tutkkoulk = [ylkktutkkoulk_2012]  )
      ,''tk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2012] AND
      suorlk = [tksuorlk_2012] AND
      tutkmaak = [tktutkkmaak_2012] AND
      tutkjarj = [tktutkjarj_2012] AND
      tutkkoulk = [tktutkkoulk_2012]  )
      ,''muuta_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2012] AND
      suorlk = [muutasuorlk_2012] AND
      tutkmaak = [muutatutkkmaak_2012] AND
      tutkjarj = [muutatutkjarj_2012] AND
      tutkkoulk = [muutatutkkoulk_2012]  )
      ,''amkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2012] AND
      opiskjarj_2 = [amkopiskjarj_2012] AND
      kmaak_2 = [amkkmaak_2012] AND
      olotamm_2 = [amkolotamm_2012] AND
      olosyys_2 = [amkolosyys_2012]  )
      ,''ylamkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2012] AND
      opiskjarj_2 = [ylamkopiskjarj_2012] AND
      kmaak_2 = [ylamkkmaak_2012] AND
      olotamm_2 = [ylamkolotamm_2012] AND
      olosyys_2 = [ylamkolosyys_2012]  )
      ,''alkkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2012] AND
      opiskjarj_2 = [alkkopiskjarj_2012] AND
      kmaak_2 = [alkkkmaak_2012] AND
      olotamm_2 = [alkkolotamm_2012] AND
      olosyys_2 = [alkkolosyys_2012]  )
      ,''ylkkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2012] AND
      opiskjarj_2 = [ylkkopiskjarj_2012] AND
      kmaak_2 = [ylkkkmaak_2012] AND
      olotamm_2 = [ylkkolotamm_2012] AND
      olosyys_2 = [ylkkolosyys_2012]  )
      ,''tkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2012] AND
      opiskjarj_2 = [tkopiskjarj_2012] AND
      kmaak_2 = [tkkmaak_2012] AND
      olotamm_2 = [tkolotamm_2012] AND
      olosyys_2 = [tkolosyys_2012]  )
      ,''muutaopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2012] AND
      opiskjarj_2 = [muutaopiskjarj_2012] AND
      kmaak_2 = [muutakmaak_2012] AND
      olotamm_2 = [muutaolotamm_2012] AND
      olosyys_2 = [muutaolosyys_2012]  )
      ,''ptoim1r5_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2012] AND
      amas = [amas_2012]  )
--2013
      ,''amk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2013] AND
      suorlk = [amksuorlk_2013] AND
      tutkmaak = [amktutkkmaak_2013] AND
      tutkjarj = [amktutkjarj_2013] AND
      tutkkoulk = [amktutkkoulk_2013]  )
      ,''ylamk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2013] AND
      suorlk = [ylamksuorlk_2013] AND
      tutkmaak = [ylamktutkkmaak_2013] AND
      tutkjarj = [ylamktutkjarj_2013] AND
      tutkkoulk = [ylamktutkkoulk_2013]  )
      ,''alkk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2013] AND
      suorlk = [alkksuorlk_2013] AND
      tutkmaak = [alkktutkkmaak_2013] AND
      tutkjarj = [alkktutkjarj_2013] AND
      tutkkoulk = [alkktutkkoulk_2013]  )
      ,''ylkk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2013] AND
      suorlk = [ylkksuorlk_2013] AND
      tutkmaak = [ylkktutkkmaak_2013] AND
      tutkjarj = [ylkktutkjarj_2013] AND
      tutkkoulk = [ylkktutkkoulk_2013]  )
      ,''tk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2013] AND
      suorlk = [tksuorlk_2013] AND
      tutkmaak = [tktutkkmaak_2013] AND
      tutkjarj = [tktutkjarj_2013] AND
      tutkkoulk = [tktutkkoulk_2013]  )
      ,''muuta_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2013] AND
      suorlk = [muutasuorlk_2013] AND
      tutkmaak = [muutatutkkmaak_2013] AND
      tutkjarj = [muutatutkjarj_2013] AND
      tutkkoulk = [muutatutkkoulk_2013]  )
      ,''amkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2013] AND
      opiskjarj_2 = [amkopiskjarj_2013] AND
      kmaak_2 = [amkkmaak_2013] AND
      olotamm_2 = [amkolotamm_2013] AND
      olosyys_2 = [amkolosyys_2013]  )
      ,''ylamkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2013] AND
      opiskjarj_2 = [ylamkopiskjarj_2013] AND
      kmaak_2 = [ylamkkmaak_2013] AND
      olotamm_2 = [ylamkolotamm_2013] AND
      olosyys_2 = [ylamkolosyys_2013]  )
      ,''alkkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2013] AND
      opiskjarj_2 = [alkkopiskjarj_2013] AND
      kmaak_2 = [alkkkmaak_2013] AND
      olotamm_2 = [alkkolotamm_2013] AND
      olosyys_2 = [alkkolosyys_2013]  )
      ,''ylkkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2013] AND
      opiskjarj_2 = [ylkkopiskjarj_2013] AND
      kmaak_2 = [ylkkkmaak_2013] AND
      olotamm_2 = [ylkkolotamm_2013] AND
      olosyys_2 = [ylkkolosyys_2013]  )
      ,''tkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2013] AND
      opiskjarj_2 = [tkopiskjarj_2013] AND
      kmaak_2 = [tkkmaak_2013] AND
      olotamm_2 = [tkolotamm_2013] AND
      olosyys_2 = [tkolosyys_2013]  )
      ,''muutaopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2013] AND
      opiskjarj_2 = [muutaopiskjarj_2013] AND
      kmaak_2 = [muutakmaak_2013] AND
      olotamm_2 = [muutaolotamm_2013] AND
      olosyys_2 = [muutaolosyys_2013]  )
      ,''ptoim1r5_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2013] AND
      amas = [amas_2013]  )

-- 2014

      ,''amk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amksuorv_2014] AND
      suorlk = [amksuorlk_2014] AND
      tutkmaak = [amktutkkmaak_2014] AND
      tutkjarj = [amktutkjarj_2014] AND
      tutkkoulk = [amktutkkoulk_2014]  )
      ,''ylamk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylamksuorv_2014] AND
      suorlk = [ylamksuorlk_2014] AND
      tutkmaak = [ylamktutkkmaak_2014] AND
      tutkjarj = [ylamktutkjarj_2014] AND
      tutkkoulk = [ylamktutkkoulk_2014]  )
      ,''alkk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [alkksuorv_2014] AND
      suorlk = [alkksuorlk_2014] AND
      tutkmaak = [alkktutkkmaak_2014] AND
      tutkjarj = [alkktutkjarj_2014] AND
      tutkkoulk = [alkktutkkoulk_2014]  )
      ,''ylkk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [ylkksuorv_2014] AND
      suorlk = [ylkksuorlk_2014] AND
      tutkmaak = [ylkktutkkmaak_2014] AND
      tutkjarj = [ylkktutkjarj_2014] AND
      tutkkoulk = [ylkktutkkoulk_2014]  )
      ,''tk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [tksuorv_2014] AND
      suorlk = [tksuorlk_2014] AND
      tutkmaak = [tktutkkmaak_2014] AND
      tutkjarj = [tktutkjarj_2014] AND
      tutkkoulk = [tktutkkoulk_2014]  )
      ,''muuta_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muutasuorv_2014] AND
      suorlk = [muutasuorlk_2014] AND
      tutkmaak = [muutatutkkmaak_2014] AND
      tutkjarj = [muutatutkjarj_2014] AND
      tutkkoulk = [muutatutkkoulk_2014]  )
      ,''amkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [amkopiskkoulk_2014] AND
      opiskjarj_2 = [amkopiskjarj_2014] AND
      kmaak_2 = [amkkmaak_2014] AND
      olotamm_2 = [amkolotamm_2014] AND
      olosyys_2 = [amkolosyys_2014]  )
      ,''ylamkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylamkopiskkoulk_2014] AND
      opiskjarj_2 = [ylamkopiskjarj_2014] AND
      kmaak_2 = [ylamkkmaak_2014] AND
      olotamm_2 = [ylamkolotamm_2014] AND
      olosyys_2 = [ylamkolosyys_2014]  )
      ,''alkkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [alkkopiskkoulk_2014] AND
      opiskjarj_2 = [alkkopiskjarj_2014] AND
      kmaak_2 = [alkkkmaak_2014] AND
      olotamm_2 = [alkkolotamm_2014] AND
      olosyys_2 = [alkkolosyys_2014]  )
      ,''ylkkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [ylkkopiskkoulk_2014] AND
      opiskjarj_2 = [ylkkopiskjarj_2014] AND
      kmaak_2 = [ylkkkmaak_2014] AND
      olotamm_2 = [ylkkolotamm_2014] AND
      olosyys_2 = [ylkkolosyys_2014]  )
      ,''tkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [tkopiskkoulk_2014] AND
      opiskjarj_2 = [tkopiskjarj_2014] AND
      kmaak_2 = [tkkmaak_2014] AND
      olotamm_2 = [tkolotamm_2014] AND
      olosyys_2 = [tkolosyys_2014]  )
      ,''muutaopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk_2 = [muutaopiskkoulk_2014] AND
      opiskjarj_2 = [muutaopiskjarj_2014] AND
      kmaak_2 = [muutakmaak_2014] AND
      olotamm_2 = [muutaolotamm_2014] AND
      olosyys_2 = [muutaolosyys_2014]  )
      ,''ptoim1r5_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2014] AND
      amas = [amas_2014]  )



--UUSI VUOSI
--Lisää uuden vuoden kentät tähän yläpuolelle. Käytä pohjana edellisen vuoden kenttiä.
  FROM VipunenTK_DW.dbo.[_sa_K3_10_Tutk_suor_osuus_aloittaneista_korkeakoulut_nykytila] f




' 
GO
/****** Object:  View [dbo].[_v_sa_K3_9_ja_K3_10_surrogaattiavaimet_UNPIVOT]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[_v_sa_K3_9_ja_K3_10_surrogaattiavaimet_UNPIVOT]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[_v_sa_K3_9_ja_K3_10_surrogaattiavaimet_UNPIVOT] AS
SELECT [aineisto] = ''K3.9''
	  ,[tilv]
      ,[lahde]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[alvv_kk] = ''''
      ,[allk_kk] = ''''
      ,[ololk] = ''''
      ,[klaji]
      ,[ophal]
      ,[jarj]
      ,[kkun]
      ,[koulk]
      ,[pohjkoulk]
      ,[rahlahde] = ''''
      ,[tietolahde]
      ,[rivinumero]
      ,[aineistorivinumero]
      ,[sarakeryhma_id]
      ,[sarakeryhma_arvo]
      ,[lkm]
  FROM [_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_surrogaattiavaimet_UNPIVOT]
UNION ALL
SELECT [aineisto] = ''K3.10''
	  ,[tilv]
      ,[lahde]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[alvv_kk]
      ,[allk_kk]
      ,[ololk]
      ,[klaji]
      ,[ophal] = ''1''
      ,[jarj]
      ,[kkun]
      ,[koulk]
      ,[pohjkoulk]
      ,[rahlahde]
      ,[tietolahde]
      ,[rivinumero]
      ,[aineistorivinumero]
      ,[sarakeryhma_id]
      ,[sarakeryhma_arvo]
      ,[lkm]
  FROM [_sa_K3_10_Tutk_suor_osuus_aloittaneista_korkeakoulut_surrogaattiavaimet_UNPIVOT]
' 
GO
/****** Object:  View [dbo].[_v_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_surrogaattiavaimet_nykytila_taulusta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[_v_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_surrogaattiavaimet_nykytila_taulusta]'))
EXEC dbo.sp_executesql @statement = N'


CREATE View [dbo].[_v_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_surrogaattiavaimet_nykytila_taulusta] as

/****** Script for SelectTopNRows command from SSMS  ******/
--Select * from [okm].[okm_ktpo_tiedontuotanto_in].f --> 6588 rows
--Select * from [vipunen_ETL].[v_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_surrogaattiavaimet] --> 6588 rows

SELECT [tilv]
      ,[lahde]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[alvv]
      ,[allk]
      ,[klaji]
      ,[ophal]
      ,[jarj]
      ,[kkun]
      ,[koulk]
      ,[pohjkoulk]
      ,[tietolahde]
      ,[rivinumero]
      ,[aineistorivinumero]

      ,[lkm]

      ,''lu_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where  
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2004] AND
      suorlk = [lusuorlk_2004] AND
      tutkmaak = [lututkmaak_2004] AND
      tutkjarj = [lututkjarj_2004] AND
      tutkkoulk = [lututkkoulk_2004]  )
      ,''ampt_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2004] AND
      suorlk = [amptsuorlk_2004] AND
      tutkmaak = [ampttutkmaak_2004] AND
      tutkjarj = [ampttutkjarj_2004] AND
      tutkkoulk = [ampttutkkoulk_2004]  )
      ,''amlk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2004] AND
      suorlk = [amlksuorlk_2004] AND
      tutkmaak = [amlktutkmaak_2004] AND
      tutkjarj = [amlktutkjarj_2004] AND
      tutkkoulk = [amlktutkkoulk_2004]  )
      ,''muukk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2004] AND
      suorlk = [muukksuorlk_2004] AND
      tutkmaak = [muukktutkmaak_2004] AND
      tutkjarj = [muukktutkjarj_2004] AND
      tutkkoulk = [muukktutkkoulk_2004]  )
      ,''lu_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2005] AND
      suorlk = [lusuorlk_2005] AND
      tutkmaak = [lututkmaak_2005] AND
      tutkjarj = [lututkjarj_2005] AND
      tutkkoulk = [lututkkoulk_2005]  )
      ,''ampt_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2005] AND
      suorlk  = [amptsuorlk_2005] AND
      tutkmaak = [ampttutkmaak_2005] AND
      tutkjarj = [ampttutkjarj_2005] AND
      tutkkoulk = [ampttutkkoulk_2005]  )
      ,''amlk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2005] AND
      suorlk = [amlksuorlk_2005] AND
      tutkmaak = [amlktutkmaak_2005] AND
      tutkjarj = [amlktutkjarj_2005] AND
      tutkkoulk = [amlktutkkoulk_2005]  )
      ,''muukk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2005] AND
      suorlk = [muukksuorlk_2005] AND
      tutkmaak = [muukktutkmaak_2005] AND
      tutkjarj = [muukktutkjarj_2005] AND
      tutkkoulk = [muukktutkkoulk_2005]  )
      ,''lu_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2006] AND
      suorlk = [lusuorlk_2006] AND
      tutkmaak = [lututkmaak_2006] AND
      tutkjarj = [lututkjarj_2006] AND
      tutkkoulk = [lututkkoulk_2006]  )
      ,''ampt_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2006] AND
      suorlk = [amptsuorlk_2006] AND
      tutkmaak = [ampttutkmaak_2006] AND
      tutkjarj = [ampttutkjarj_2006] AND
      tutkkoulk = [ampttutkkoulk_2006]  )
      ,''amlk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2006] AND
      suorlk = [amlksuorlk_2006] AND
      tutkmaak = [amlktutkmaak_2006] AND
      tutkjarj = [amlktutkjarj_2006] AND
      tutkkoulk = [amlktutkkoulk_2006]  )
      ,''muukk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2006] AND
      suorlk = [muukksuorlk_2006] AND
      tutkmaak = [muukktutkmaak_2006] AND
      tutkjarj = [muukktutkjarj_2006] AND
      tutkkoulk = [muukktutkkoulk_2006]  )
      ,''lu_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2007] AND
      suorlk = [lusuorlk_2007] AND
      tutkmaak = [lututkmaak_2007] AND
      tutkjarj = [lututkjarj_2007] AND
      tutkkoulk = [lututkkoulk_2007]  )
      ,''ampt_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2007] AND
      suorlk = [amptsuorlk_2007] AND
      tutkmaak = [ampttutkmaak_2007] AND
      tutkjarj = [ampttutkjarj_2007] AND
      tutkkoulk = [ampttutkkoulk_2007]  )
      ,''amlk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2007] AND
      suorlk = [amlksuorlk_2007] AND
      tutkmaak = [amlktutkmaak_2007] AND
      tutkjarj = [amlktutkjarj_2007] AND
      tutkkoulk = [amlktutkkoulk_2007]  )
      ,''muukk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2007] AND
      suorlk = [muukksuorlk_2007] AND
      tutkmaak = [muukktutkmaak_2007] AND
      tutkjarj = [muukktutkjarj_2007] AND
      tutkkoulk = [muukktutkkoulk_2007]  )
      ,''lu_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2008] AND
      suorlk = [lusuorlk_2008] AND
      tutkmaak = [lututkmaak_2008] AND
      tutkjarj = [lututkjarj_2008] AND
      tutkkoulk = [lututkkoulk_2008]  )
      ,''ampt_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where   
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv =  [amptsuorv_2008] AND
      suorlk = [amptsuorlk_2008] AND
      tutkmaak = [ampttutkmaak_2008] AND
      tutkjarj = [ampttutkjarj_2008] AND
      tutkkoulk = [ampttutkkoulk_2008]  )
      ,''amlk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2008] AND
      suorlk = [amlksuorlk_2008] AND
      tutkmaak = [amlktutkmaak_2008] AND
      tutkjarj = [amlktutkjarj_2008] AND
      tutkkoulk = [amlktutkkoulk_2008]  )
      ,''muukk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2008] AND
      suorlk = [muukksuorlk_2008] AND
      tutkmaak = [muukktutkmaak_2008] AND
      tutkjarj = [muukktutkjarj_2008] AND
      tutkkoulk = [muukktutkkoulk_2008]  )
      ,''luopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2004] AND
      opiskjarj = [luopiskjarj_2004] AND
      kmaak = [lukmaak_2004]  )
      ,''amptopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2004] AND
      opiskjarj = [amptopiskjarj_2004] AND
      kmaak = [amptkmaak_2004]  )
      ,''amlkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2004] AND
      opiskjarj = [amlkopiskjarj_2004] AND
      kmaak = [amlkkmaak_2004]  )
      ,''muukkopisk_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2004] AND
      opiskjarj = [muukkopiskjarj_2004] AND
      kmaak = [muukkkmaak_2004]  )
      ,''luopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2005] AND
      opiskjarj = [luopiskjarj_2005] AND
      kmaak = [lukmaak_2005]  )
      ,''amptopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2005] AND
      opiskjarj = [amptopiskjarj_2005] AND
      kmaak = [amptkmaak_2005]  )
      ,''amlkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2005] AND
      opiskjarj = [amlkopiskjarj_2005] AND
      kmaak = [amlkkmaak_2005]  )
      ,''muukkopisk_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2005] AND
      opiskjarj = [muukkopiskjarj_2005] AND
      kmaak = [muukkkmaak_2005]  )
      ,''luopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2006] AND
      opiskjarj = [luopiskjarj_2006] AND
      kmaak = [lukmaak_2006]  )
      ,''amptopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2006] AND
      opiskjarj = [amptopiskjarj_2006] AND
      kmaak = [amptkmaak_2006]  )
      ,''amlkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2006] AND
      opiskjarj = [amlkopiskjarj_2006] AND
      kmaak = [amlkkmaak_2006]  )
      ,''muukkopisk_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2006] AND
      opiskjarj = [muukkopiskjarj_2006] AND
      kmaak = [muukkkmaak_2006]  )
      ,''luopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2007] AND
      opiskjarj = [luopiskjarj_2007] AND
      kmaak = [lukmaak_2007]  )
      ,''amptopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2007] AND
      opiskjarj = [amptopiskjarj_2007] AND
      kmaak = [amptkmaak_2007]  )
      ,''amlkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2007] AND
      opiskjarj = [amlkopiskjarj_2007] AND
      kmaak = [amlkkmaak_2007]  )
      ,''muukkopisk_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2007] AND
      opiskjarj = [muukkopiskjarj_2007] AND
      kmaak = [muukkkmaak_2007]  )
      ,''luopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2008] AND
      opiskjarj = [luopiskjarj_2008] AND
      kmaak = [lukmaak_2008]  )
      ,''amptopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2008] AND
      opiskjarj = [amptopiskjarj_2008] AND
      kmaak = [amptkmaak_2008]  )
      ,''amlkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2008] AND
      opiskjarj = [amlkopiskjarj_2008] AND
      kmaak = [amlkkmaak_2008]  )
      ,''muukkopisk_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2008] AND
      opiskjarj = [muukkopiskjarj_2008] AND
      kmaak = [muukkkmaak_2008]  )
      ,''ptoim1r5_2004'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2004] AND
      amas = [amas_2004]  )
      ,''ptoim1r5_2005'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2005] AND
      amas = [amas_2005]  )
      ,''ptoim1r5_2006'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2006] AND
      amas = [amas_2006]  )
      ,''ptoim1r5_2007'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2007] AND
      amas = [amas_2007]  )
      ,''ptoim1r5_2008'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2008] AND
      amas = [amas_2008]  )
--2009
      ,''lu_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2009] AND
      suorlk = [lusuorlk_2009] AND
      tutkmaak = [lututkmaak_2009] AND
      tutkjarj = [lututkjarj_2009] AND
      tutkkoulk = [lututkkoulk_2009]  )
      ,''ampt_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2009] AND
      suorlk = [amptsuorlk_2009] AND
      tutkmaak = [ampttutkmaak_2009] AND
      tutkjarj = [ampttutkjarj_2009] AND
      tutkkoulk = [ampttutkkoulk_2009]  )
      ,''amlk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2009] AND
      suorlk = [amlksuorlk_2009] AND
      tutkmaak = [amlktutkmaak_2009] AND
      tutkjarj = [amlktutkjarj_2009] AND
      tutkkoulk = [amlktutkkoulk_2009]  )
      ,''muukk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2009] AND
      suorlk = [muukksuorlk_2009] AND
      tutkmaak = [muukktutkmaak_2009] AND
      tutkjarj = [muukktutkjarj_2009] AND
      tutkkoulk = [muukktutkkoulk_2009]  )
      ,''luopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2009] AND
      opiskjarj = [luopiskjarj_2009] AND
      kmaak = [lukmaak_2009]  )
      ,''amptopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2009] AND
      opiskjarj = [amptopiskjarj_2009] AND
      kmaak = [amptkmaak_2009]  )
      ,''amlkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2009] AND
      opiskjarj = [amlkopiskjarj_2009] AND
      kmaak = [amlkkmaak_2009]  )
      ,''muukkopisk_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2009] AND
      opiskjarj = [muukkopiskjarj_2009] AND
      kmaak = [muukkkmaak_2009]  )
      ,''ptoim1r5_2009'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2009] AND
      amas = [amas_2009]  )
--2010
      ,''lu_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2010] AND
      suorlk = [lusuorlk_2010] AND
      tutkmaak = [lututkmaak_2010] AND
      tutkjarj = [lututkjarj_2010] AND
      tutkkoulk = [lututkkoulk_2010]  )
      ,''ampt_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2010] AND
      suorlk = [amptsuorlk_2010] AND
      tutkmaak = [ampttutkmaak_2010] AND
      tutkjarj = [ampttutkjarj_2010] AND
      tutkkoulk = [ampttutkkoulk_2010]  )
      ,''amlk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2010] AND
      suorlk = [amlksuorlk_2010] AND
      tutkmaak = [amlktutkmaak_2010] AND
      tutkjarj = [amlktutkjarj_2010] AND
      tutkkoulk = [amlktutkkoulk_2010]  )
      ,''muukk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2010] AND
      suorlk = [muukksuorlk_2010] AND
      tutkmaak = [muukktutkmaak_2010] AND
      tutkjarj = [muukktutkjarj_2010] AND
      tutkkoulk = [muukktutkkoulk_2010]  )
      ,''luopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2010] AND
      opiskjarj = [luopiskjarj_2010] AND
      kmaak = [lukmaak_2010]  )
      ,''amptopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2010] AND
      opiskjarj = [amptopiskjarj_2010] AND
      kmaak = [amptkmaak_2010]  )
      ,''amlkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2010] AND
      opiskjarj = [amlkopiskjarj_2010] AND
      kmaak = [amlkkmaak_2010]  )
      ,''muukkopisk_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2010] AND
      opiskjarj = [muukkopiskjarj_2010] AND
      kmaak = [muukkkmaak_2010]  )
      ,''ptoim1r5_2010'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2010] AND
      amas = [amas_2010]  )
--2011
      ,''lu_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2011] AND
      suorlk = [lusuorlk_2011] AND
      tutkmaak = [lututkmaak_2011] AND
      tutkjarj = [lututkjarj_2011] AND
      tutkkoulk = [lututkkoulk_2011]  )
      ,''ampt_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2011] AND
      suorlk = [amptsuorlk_2011] AND
      tutkmaak = [ampttutkmaak_2011] AND
      tutkjarj = [ampttutkjarj_2011] AND
      tutkkoulk = [ampttutkkoulk_2011]  )
      ,''amlk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2011] AND
      suorlk = [amlksuorlk_2011] AND
      tutkmaak = [amlktutkmaak_2011] AND
      tutkjarj = [amlktutkjarj_2011] AND
      tutkkoulk = [amlktutkkoulk_2011]  )
      ,''muukk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2011] AND
      suorlk = [muukksuorlk_2011] AND
      tutkmaak = [muukktutkmaak_2011] AND
      tutkjarj = [muukktutkjarj_2011] AND
      tutkkoulk = [muukktutkkoulk_2011]  )
      ,''luopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2011] AND
      opiskjarj = [luopiskjarj_2011] AND
      kmaak = [lukmaak_2011]  )
      ,''amptopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2011] AND
      opiskjarj = [amptopiskjarj_2011] AND
      kmaak = [amptkmaak_2011]  )
      ,''amlkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2011] AND
      opiskjarj = [amlkopiskjarj_2011] AND
      kmaak = [amlkkmaak_2011]  )
      ,''muukkopisk_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2011] AND
      opiskjarj = [muukkopiskjarj_2011] AND
      kmaak = [muukkkmaak_2011]  )
      ,''ptoim1r5_2011'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2011] AND
      amas = [amas_2011]  )
--2012
      ,''lu_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2012] AND
      suorlk = [lusuorlk_2012] AND
      tutkmaak = [lututkmaak_2012] AND
      tutkjarj = [lututkjarj_2012] AND
      tutkkoulk = [lututkkoulk_2012]  )
      ,''ampt_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2012] AND
      suorlk = [amptsuorlk_2012] AND
      tutkmaak = [ampttutkmaak_2012] AND
      tutkjarj = [ampttutkjarj_2012] AND
      tutkkoulk = [ampttutkkoulk_2012]  )
      ,''amlk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2012] AND
      suorlk = [amlksuorlk_2012] AND
      tutkmaak = [amlktutkmaak_2012] AND
      tutkjarj = [amlktutkjarj_2012] AND
      tutkkoulk = [amlktutkkoulk_2012]  )
      ,''muukk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2012] AND
      suorlk = [muukksuorlk_2012] AND
      tutkmaak = [muukktutkmaak_2012] AND
      tutkjarj = [muukktutkjarj_2012] AND
      tutkkoulk = [muukktutkkoulk_2012]  )
      ,''luopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2012] AND
      opiskjarj = [luopiskjarj_2012] AND
      kmaak = [lukmaak_2012]  )
      ,''amptopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2012] AND
      opiskjarj = [amptopiskjarj_2012] AND
      kmaak = [amptkmaak_2012]  )
      ,''amlkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2012] AND
      opiskjarj = [amlkopiskjarj_2012] AND
      kmaak = [amlkkmaak_2012]  )
      ,''muukkopisk_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2012] AND
      opiskjarj = [muukkopiskjarj_2012] AND
      kmaak = [muukkkmaak_2012]  )
      ,''ptoim1r5_2012'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2012] AND
      amas = [amas_2012]  )
--2013
      ,''lu_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2013] AND
      suorlk = [lusuorlk_2013] AND
      tutkmaak = [lututkmaak_2013] AND
      tutkjarj = [lututkjarj_2013] AND
      tutkkoulk = [lututkkoulk_2013]  )
      ,''ampt_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2013] AND
      suorlk = [amptsuorlk_2013] AND
      tutkmaak = [ampttutkmaak_2013] AND
      tutkjarj = [ampttutkjarj_2013] AND
      tutkkoulk = [ampttutkkoulk_2013]  )
      ,''amlk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2013] AND
      suorlk = [amlksuorlk_2013] AND
      tutkmaak = [amlktutkmaak_2013] AND
      tutkjarj = [amlktutkjarj_2013] AND
      tutkkoulk = [amlktutkkoulk_2013]  )
      ,''muukk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2013] AND
      suorlk = [muukksuorlk_2013] AND
      tutkmaak = [muukktutkmaak_2013] AND
      tutkjarj = [muukktutkjarj_2013] AND
      tutkkoulk = [muukktutkkoulk_2013]  )
      ,''luopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2013] AND
      opiskjarj = [luopiskjarj_2013] AND
      kmaak = [lukmaak_2013]  )
      ,''amptopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2013] AND
      opiskjarj = [amptopiskjarj_2013] AND
      kmaak = [amptkmaak_2013]  )
      ,''amlkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2013] AND
      opiskjarj = [amlkopiskjarj_2013] AND
      kmaak = [amlkkmaak_2013]  )
      ,''muukkopisk_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2013] AND
      opiskjarj = [muukkopiskjarj_2013] AND
      kmaak = [muukkkmaak_2013]  )
      ,''ptoim1r5_2013'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2013] AND
      amas = [amas_2013]  )

--2014
      ,''lu_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [lusuorv_2014] AND
      suorlk = [lusuorlk_2014] AND
      tutkmaak = [lututkmaak_2014] AND
      tutkjarj = [lututkjarj_2014] AND
      tutkkoulk = [lututkkoulk_2014]  )
      ,''ampt_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amptsuorv_2014] AND
      suorlk = [amptsuorlk_2014] AND
      tutkmaak = [ampttutkmaak_2014] AND
      tutkjarj = [ampttutkjarj_2014] AND
      tutkkoulk = [ampttutkkoulk_2014]  )
      ,''amlk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [amlksuorv_2014] AND
      suorlk = [amlksuorlk_2014] AND
      tutkmaak = [amlktutkmaak_2014] AND
      tutkjarj = [amlktutkjarj_2014] AND
      tutkkoulk = [amlktutkkoulk_2014]  )
      ,''muukk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      suorv = [muukksuorv_2014] AND
      suorlk = [muukksuorlk_2014] AND
      tutkmaak = [muukktutkmaak_2014] AND
      tutkjarj = [muukktutkjarj_2014] AND
      tutkkoulk = [muukktutkkoulk_2014]  )
      ,''luopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [luopiskkoulk_2014] AND
      opiskjarj = [luopiskjarj_2014] AND
      kmaak = [lukmaak_2014]  )
      ,''amptopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amptopiskkoulk_2014] AND
      opiskjarj = [amptopiskjarj_2014] AND
      kmaak = [amptkmaak_2014]  )
      ,''amlkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [amlkopiskkoulk_2014] AND
      opiskjarj = [amlkopiskjarj_2014] AND
      kmaak = [amlkkmaak_2014]  )
      ,''muukkopisk_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
	  [_aloittaneiden_lapaisy_avaimet].tilv = f.tilv AND
	  [_aloittaneiden_lapaisy_avaimet].lahde = f.lahde AND
      opiskkoulk = [muukkopiskkoulk_2014] AND
      opiskjarj = [muukkopiskjarj_2014] AND
      kmaak = [muukkkmaak_2014]  )
      ,''ptoim1r5_2014'' = (select id from [_aloittaneiden_lapaisy_avaimet] where    
      ptoim1r5 = [ptoim1r5_2014] AND
      amas = [amas_2014]  )

--UUSI VUOSI
--Lisää uuden vuoden kentät tähän yläpuolelle. Käytä pohjana edellisen vuoden kenttiä.
  FROM VipunenTK_DW.dbo.[_sa_K3_9_Tutk_suor_osuus_aloittaneista_toinen_aste_nykytila] f



' 
GO
/****** Object:  View [dbo].[Koulutukseen_sijoittuneet_2v_tarkastelu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[Koulutukseen_sijoittuneet_2v_tarkastelu]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[Koulutukseen_sijoittuneet_2v_tarkastelu] AS
SELECT [rivinumero]
      ,[tarkastelujakso]
      ,[tilv]
      ,[tutkryh]
      ,[suorv]
      ,[suorlk]
      ,[sp]
      ,[syntv]
      ,[aikielir1]
      ,[tutkkaskun]
      ,[kansalr1]
      ,[pohjmaa]
      ,[eumaa]
      ,[etamaa]
      ,[tunn]
      ,[jarj]
      ,[kkielir1]
      ,[tutklaja]
      ,[tutktav]
      ,[aikoul]
      ,[tutkmaak]
      ,[pohjkoulk]
      ,[koulutus_1]
      ,[oppilaitos_1]
      ,[koulutuksen_jarjestaja_1]
      ,[koulutuksen_maakunta_1]
      ,[koulutus_2]
      ,[oppilaitos_2]
      ,[koulutuksen_jarjestaja_2]
      ,[koulutuksen_maakunta_2]
      ,[monihaku]
      ,[paaasiallinen_toiminta]
      ,[ammattiasema]
      ,[lkm]
      ,[tietolahde]
      ,[aineisto]
      ,[lukiokoulutuksessa]
      ,[ammatillisessa_koulutuksessa]
      ,[ammattikorkeakoulutuksessa]
      ,[yliopistokoulutuksessa]
      ,[lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa]
      ,[toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa]
      ,[ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa]
      ,[koulutuksen_paattaneiden_toiminta]
  FROM [VipunenTK_DW].[dbo].[_koulutukseen_sijoittuneet_2v_tarkastelu]
' 
GO
/****** Object:  View [dbo].[v_aidinkieli_versio1]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aidinkieli_versio1]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_aidinkieli_versio1] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	aidinkieli_versio1_koodi,
	aidinkieli_versio1,
	aidinkieli_versio1_SV,
	aidinkieli_versio1_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_aidinkieli_versio1
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	aidinkieli_versio1_koodi,
	aidinkieli_versio1,
	aidinkieli_versio1_SV,
	aidinkieli_versio1_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_aidinkieli_versio1
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_aidinkieli_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aidinkieli_versio2]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_aidinkieli_versio2] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	aidinkieli_versio2_koodi,
	aidinkieli_versio2,
	aidinkieli_versio2_SV,
	aidinkieli_versio2_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_aidinkieli_versio2
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	aidinkieli_versio2_koodi,
	aidinkieli_versio2,
	aidinkieli_versio2_SV,
	aidinkieli_versio2_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_aidinkieli_versio2
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_aidinkieli_versio3]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aidinkieli_versio3]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_aidinkieli_versio3] AS
/*
truncate table VipunenTK.dbo.d_aidinkieli_versio3
insert into VipunenTK.dbo.d_aidinkieli_versio3
select * from [VipunenTK_DW].dbo.[v_aidinkieli_versio3]

drop table VipunenTK.dbo.d_aidinkieli_versio3
select * into VipunenTK.dbo.d_aidinkieli_versio3 from [VipunenTK_DW].dbo.[v_aidinkieli_versio3]
*/

SELECT
	id,
	luotu,
	aidinkieli_versio3_koodi,
	aidinkieli_versio3,
	aidinkieli_versio3_SV,
	aidinkieli_versio3_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_aidinkieli_versio3
UNION ALL
SELECT
	id,
	luotu,
	aidinkieli_versio3_koodi,
	aidinkieli_versio3,
	aidinkieli_versio3_SV,
	aidinkieli_versio3_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_aidinkieli_versio3
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_aikaisemmat_tutkinnot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aikaisemmat_tutkinnot]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_aikaisemmat_tutkinnot] AS
SELECT
	id,
	alkaa,
	paattyy,
	aikaisemmat_tutkinnot_koodi,
	aikaisemmat_tutkinnot,
	aikaisemmat_tutkinnot_SV,
	aikaisemmat_tutkinnot_EN,
	jarjestys,
	tietolahde
FROM dbo.d_aikaisemmat_tutkinnot
UNION ALL
SELECT
	id,
	alkaa,
	paattyy,
	aikaisemmat_tutkinnot_koodi,
	aikaisemmat_tutkinnot,
	aikaisemmat_tutkinnot_SV,
	aikaisemmat_tutkinnot_EN,
	jarjestys,
	tietolahde
FROM VipunenTK_lisatiedot..v_aikaisemmat_tutkinnot
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_aikaisempi_korkein_tutkinto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aikaisempi_korkein_tutkinto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_aikaisempi_korkein_tutkinto] AS
SELECT
	id,
	alkaa,
	paattyy,
	aikaisempi_korkein_tutkinto_koodi,
	aikaisempi_korkein_tutkinto,
	aikaisempi_korkein_tutkinto_SV,
	aikaisempi_korkein_tutkinto_EN,
	jarjestys,
	tietolahde
FROM dbo.d_aikaisempi_korkein_tutkinto
UNION ALL
SELECT
	id,
	alkaa,
	paattyy,
	aikaisempi_korkein_tutkinto_koodi,
	aikaisempi_korkein_tutkinto,
	aikaisempi_korkein_tutkinto_SV,
	aikaisempi_korkein_tutkinto_EN,
	jarjestys,
	tietolahde
FROM VipunenTK_lisatiedot..v_aikaisempi_korkein_tutkinto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_aikalkk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aikalkk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_aikalkk] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[aikalkk_koodi]
      ,[koodinselite]
      ,[koodinselite_SV]
      ,[koodinselite_EN]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
      ,[jarjestys]
      ,[virhetilanne]
  FROM [VipunenTK_DW].[dbo].[d_aikalkk]

UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[aikalkk_koodi]
      ,[koodinselite]
      ,[koodinselite_SV]
      ,[koodinselite_EN]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
      ,[jarjestys]
      ,[virhetilanne]
  FROM [VipunenTK_lisatiedot].[dbo].[aikalkk]

WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_aikuisopiskelija]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aikuisopiskelija]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_aikuisopiskelija] AS 

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[aikuisopiskelija_koodi]
      ,[aikuisopiskelija]
      ,[aikuisopiskelija_SV]
      ,[aikuisopiskelija_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_aikuisopiskelija]

UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[aikuisopiskelija_koodi]
      ,[aikuisopiskelija]
      ,[aikuisopiskelija_SV]
      ,[aikuisopiskelija_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[aikuisopiskelija]

WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_aineisto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aineisto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_aineisto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	aineisto_koodi,
	aineisto,
	aineisto_SV,
	aineisto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_aineisto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	aineisto_koodi,
	aineisto,
	aineisto_SV,
	aineisto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_aineisto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_aineisto_OTV]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_aineisto_OTV]'))
EXEC dbo.sp_executesql @statement = N'--use [VipunenTK_DW]

/****** Script for SelectTopNRows command from SSMS  ******/
create view [dbo].[v_aineisto_OTV] as

SELECT [id]
      ,[aineisto_koodi]
      ,[tilastointivuosi]
      ,[alkaa]
      ,[paattyy]
      ,[aineisto]
      ,[aineisto_SV]
      ,[aineisto_EN]
      ,[jarjestys]
      ,[toisen_asteen_koulutus]
      ,[kaikkien_asteiden_koulutus]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_aineisto_OTV]
  
UNION ALL

SELECT [id]
      ,[aineisto_koodi]
      ,[tilastointivuosi]
      ,[alkaa]
      ,[paattyy]
      ,[aineisto]
      ,[aineisto_SV]
      ,[aineisto_EN]
      ,[jarjestys]
      ,[toisen_asteen_koulutus]
      ,[kaikkien_asteiden_koulutus]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_aineisto_OTV]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_alueluokitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_alueluokitus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_alueluokitus] AS 
/*
Truncate table 
Truncate table VipunenTK.dbo.d_alueluokitus
Insert into VipunenTK.dbo.d_alueluokitus
Select * from VipunenTK_DW.[dbo].[v_alueluokitus]
Insert into VipunenTK.dbo.d_alueluokitus
Select * from VipunenTK_DW.[dbo].[v_alueluokitus] WHERE virhetilanne=''K''
*/
SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[alueluokitus_avain]
      ,[kunta_koodi]
      ,[viimeisin_tilv]
      ,[liitoskunta_koodi]
      ,[kunta]
      ,[kunta_SV]
      ,[kunta_EN]
      ,[maakunta_koodi]
      ,[maakunta]
      ,[maakunta_SV]
      ,[maakunta_EN]
      ,[avi_koodi]
      ,[avi]
      ,[avi_SV]
      ,[avi_EN]
      ,[ely_koodi]
      ,[ely]
      ,[ely_SV]
      ,[ely_EN]
      ,[seutukunta_koodi]
      ,[seutukunta]
      ,[seutukunta_SV]
      ,[seutukunta_EN]
      ,[suuralue_koodi]
      ,[suuralue]
      ,[suuralue_SV]
      ,[suuralue_EN]
      ,[kuntaryhma_koodi]
      ,[kuntaryhma]
      ,[kuntaryhma_SV]
      ,[kuntaryhma_EN]
      ,[laani_koodi]
      ,[laani]
      ,[laani_SV]
      ,[laani_EN]
      ,[tyovoima_elinkeinokeskus_koodi]
      ,[tyovoima_elinkeinokeskus]
      ,[tyovoima_elinkeinokeskus_SV]
      ,[tyovoima_elinkeinokeskus_EN]
      ,[kielisuhde_koodi]
      ,[kielisuhde]
      ,[kielisuhde_SV]
      ,[kielisuhde_EN]
      ,[mannersuomi_ahvenanmaa_koodi]
      ,[mannersuomi_ahvenanmaa]
      ,[mannersuomi_ahvenanmaa_SV]
      ,[mannersuomi_ahvenanmaa_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[jarjestys]
      ,[jarjestys_maakunta]
      ,[jarjestys_avi]
      ,[jarjestys_ely]
      ,[jarjestys_seutukunta]
      ,[jarjestys_suuralue]
      ,[jarjestys_kuntaryhma]
      ,[jarjestys_laani]
      ,[jarjestys_tyovoima_elinkeinokeskus]
      ,[jarjestys_kielisuhde]
      ,[jarjestys_mannersuomi_ahvenanmaa]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_alueluokitus]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[alueluokitus_avain]
      ,[kunta_koodi]
      ,[viimeisin_tilv]
      ,[liitoskunta_koodi]
      ,[kunta]
      ,[kunta_SV]
      ,[kunta_EN]
      ,[maakunta_koodi]
      ,[maakunta]
      ,[maakunta_SV]
      ,[maakunta_EN]
      ,[avi_koodi]
      ,[avi]
      ,[avi_SV]
      ,[avi_EN]
      ,[ely_koodi]
      ,[ely]
      ,[ely_SV]
      ,[ely_EN]
      ,[seutukunta_koodi]
      ,[seutukunta]
      ,[seutukunta_SV]
      ,[seutukunta_EN]
      ,[suuralue_koodi]
      ,[suuralue]
      ,[suuralue_SV]
      ,[suuralue_EN]
      ,[kuntaryhma_koodi]
      ,[kuntaryhma]
      ,[kuntaryhma_SV]
      ,[kuntaryhma_EN]
      ,[laani_koodi]
      ,[laani]
      ,[laani_SV]
      ,[laani_EN]
      ,[tyovoima_elinkeinokeskus_koodi]
      ,[tyovoima_elinkeinokeskus]
      ,[tyovoima_elinkeinokeskus_SV]
      ,[tyovoima_elinkeinokeskus_EN]
      ,[kielisuhde_koodi]
      ,[kielisuhde]
      ,[kielisuhde_SV]
      ,[kielisuhde_EN]
      ,[mannersuomi_ahvenanmaa_koodi]
      ,[mannersuomi_ahvenanmaa]
      ,[mannersuomi_ahvenanmaa_SV]
      ,[mannersuomi_ahvenanmaa_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[jarjestys]
      ,[jarjestys_maakunta]
      ,[jarjestys_avi]
      ,[jarjestys_ely]
      ,[jarjestys_seutukunta]
      ,[jarjestys_suuralue]
      ,[jarjestys_kuntaryhma]
      ,[jarjestys_laani]
      ,[jarjestys_tyovoima_elinkeinokeskus]
      ,[jarjestys_kielisuhde]
      ,[jarjestys_mannersuomi_ahvenanmaa]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[alueluokitus]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_alueluokitus_historia]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_alueluokitus_historia]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_alueluokitus_historia] AS 
/*
CSC Jarmo 24.3.2014

Drop table VipunenTK.dbo.d_alueluokitus_historia
Select * into VipunenTK.dbo.d_alueluokitus_historia from VipunenTK_DW.[dbo].[v_alueluokitus_historia]

Truncate table VipunenTK.dbo.d_alueluokitus_historia
Insert into VipunenTK.dbo.d_alueluokitus_historia
Select * from VipunenTK_DW.[dbo].[v_alueluokitus_historia]

--Insert into VipunenTK.dbo.d_alueluokitus
--Select * from VipunenTK_DW.[dbo].[v_alueluokitus] WHERE virhetilanne=''K''
*/
SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[alueluokitus_avain]
      ,[kunta_koodi]
      ,[viimeisin_tilv]
      ,[liitoskunta_koodi]
      ,[kunta]
      ,[kunta_SV]
      ,[kunta_EN]
      ,[maakunta_koodi]
      ,[maakunta]
      ,[maakunta_SV]
      ,[maakunta_EN]
      ,[avi_koodi]
      ,[avi]
      ,[avi_SV]
      ,[avi_EN]
      ,[ely_koodi]
      ,[ely]
      ,[ely_SV]
      ,[ely_EN]
      ,[seutukunta_koodi]
      ,[seutukunta]
      ,[seutukunta_SV]
      ,[seutukunta_EN]
      ,[suuralue_koodi]
      ,[suuralue]
      ,[suuralue_SV]
      ,[suuralue_EN]
      ,[kuntaryhma_koodi]
      ,[kuntaryhma]
      ,[kuntaryhma_SV]
      ,[kuntaryhma_EN]
      ,[laani_koodi]
      ,[laani]
      ,[laani_SV]
      ,[laani_EN]
      ,[tyovoima_elinkeinokeskus_koodi]
      ,[tyovoima_elinkeinokeskus]
      ,[tyovoima_elinkeinokeskus_SV]
      ,[tyovoima_elinkeinokeskus_EN]
      ,[kielisuhde_koodi]
      ,[kielisuhde]
      ,[kielisuhde_SV]
      ,[kielisuhde_EN]
      ,[mannersuomi_ahvenanmaa_koodi]
      ,[mannersuomi_ahvenanmaa]
      ,[mannersuomi_ahvenanmaa_SV]
      ,[mannersuomi_ahvenanmaa_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[jarjestys]
      ,[jarjestys_maakunta]
      ,[jarjestys_avi]
      ,[jarjestys_ely]
      ,[jarjestys_seutukunta]
      ,[jarjestys_suuralue]
      ,[jarjestys_kuntaryhma]
      ,[jarjestys_laani]
      ,[jarjestys_tyovoima_elinkeinokeskus]
      ,[jarjestys_kielisuhde]
      ,[jarjestys_mannersuomi_ahvenanmaa]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_alueluokitus]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[alueluokitus_avain]
      ,[kunta_koodi]
      ,[viimeisin_tilv]
      ,[liitoskunta_koodi]
      ,[kunta]
      ,[kunta_SV]
      ,[kunta_EN]
      ,[maakunta_koodi]
      ,[maakunta]
      ,[maakunta_SV]
      ,[maakunta_EN]
      ,[avi_koodi]
      ,[avi]
      ,[avi_SV]
      ,[avi_EN]
      ,[ely_koodi]
      ,[ely]
      ,[ely_SV]
      ,[ely_EN]
      ,[seutukunta_koodi]
      ,[seutukunta]
      ,[seutukunta_SV]
      ,[seutukunta_EN]
      ,[suuralue_koodi]
      ,[suuralue]
      ,[suuralue_SV]
      ,[suuralue_EN]
      ,[kuntaryhma_koodi]
      ,[kuntaryhma]
      ,[kuntaryhma_SV]
      ,[kuntaryhma_EN]
      ,[laani_koodi]
      ,[laani]
      ,[laani_SV]
      ,[laani_EN]
      ,[tyovoima_elinkeinokeskus_koodi]
      ,[tyovoima_elinkeinokeskus]
      ,[tyovoima_elinkeinokeskus_SV]
      ,[tyovoima_elinkeinokeskus_EN]
      ,[kielisuhde_koodi]
      ,[kielisuhde]
      ,[kielisuhde_SV]
      ,[kielisuhde_EN]
      ,[mannersuomi_ahvenanmaa_koodi]
      ,[mannersuomi_ahvenanmaa]
      ,[mannersuomi_ahvenanmaa_SV]
      ,[mannersuomi_ahvenanmaa_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[jarjestys]
      ,[jarjestys_maakunta]
      ,[jarjestys_avi]
      ,[jarjestys_ely]
      ,[jarjestys_seutukunta]
      ,[jarjestys_suuralue]
      ,[jarjestys_kuntaryhma]
      ,[jarjestys_laani]
      ,[jarjestys_tyovoima_elinkeinokeskus]
      ,[jarjestys_kielisuhde]
      ,[jarjestys_mannersuomi_ahvenanmaa]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[alueluokitus]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_ammatillinen_koulutus_luokittelu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammatillinen_koulutus_luokittelu]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_ammatillinen_koulutus_luokittelu] AS
/*
Drop table VipunenTK.dbo.d_ammatillinen_koulutus_luokittelu
Select * into VipunenTK.dbo.d_ammatillinen_koulutus_luokittelu from VipunenTK_DW.dbo.v_ammatillinen_koulutus_luokittelu
Truncate table  VipunenTK.dbo.d_ammatillinen_koulutus_luokittelu
Insert into VipunenTK.dbo.d_ammatillinen_koulutus_luokittelu
Select * from VipunenTK_DW.dbo.v_ammatillinen_koulutus_luokittelu
*/

SELECT [id]
      --,[luotu]
      ,[ammatillisen_koulutuksen_luokittelu_avain]
	  ,[oppisopimuskoulutus_koodi]
	  ,[ammatillisen_koulutuksen_koulutuslaji_koodi]
	  ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8_avain]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8_SV]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_ammatillinen_koulutus_luokittelu]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[ammatillisen_koulutuksen_luokittelu_avain]
	  ,[oppisopimuskoulutus_koodi]
	  ,[ammatillisen_koulutuksen_koulutuslaji_koodi]
	  ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8_avain]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8_SV]
	  ,[ammatillisen_koulutuksen_luokittelu_4_7_4_8_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_ammatillinen_koulutus_luokittelu]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_ammatillinen_peruskoulutus_lisakoulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammatillinen_peruskoulutus_lisakoulutus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_ammatillinen_peruskoulutus_lisakoulutus] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[ammatillinen_peruskoulutus_lisakoulutus_koodi]
,[ammatillinen_peruskoulutus_lisakoulutus]
,[ammatillinen_peruskoulutus_lisakoulutus_SV]
,[ammatillinen_peruskoulutus_lisakoulutus_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_ammatillinen_peruskoulutus_lisakoulutus]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[ammatillinen_peruskoulutus_lisakoulutus_koodi]
,[ammatillinen_peruskoulutus_lisakoulutus]
,[ammatillinen_peruskoulutus_lisakoulutus_SV]
,[ammatillinen_peruskoulutus_lisakoulutus_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_ammatillinen_peruskoulutus_lisakoulutus]
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_ammatillisen_koulutuksen_koulutuslaji]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammatillisen_koulutuksen_koulutuslaji]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_ammatillisen_koulutuksen_koulutuslaji] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammatillisen_koulutuksen_koulutuslaji_koodi,
	ammatillisen_koulutuksen_koulutuslaji,
	ammatillisen_koulutuksen_koulutuslaji_SV,
	ammatillisen_koulutuksen_koulutuslaji_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_ammatillisen_koulutuksen_koulutuslaji
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammatillisen_koulutuksen_koulutuslaji_koodi,
	ammatillisen_koulutuksen_koulutuslaji,
	ammatillisen_koulutuksen_koulutuslaji_SV,
	ammatillisen_koulutuksen_koulutuslaji_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_ammatillisen_koulutuksen_koulutuslaji
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa_koodi,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa_SV,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa_koodi,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa_SV,
	ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_ammattiasema]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammattiasema]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_ammattiasema] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammattiasema_koodi,
	ammattiasema,
	ammattiasema_SV,
	ammattiasema_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_ammattiasema
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammattiasema_koodi,
	ammattiasema,
	ammattiasema_SV,
	ammattiasema_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_ammattiasema
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_ammattiluokitus_2001]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammattiluokitus_2001]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[v_ammattiluokitus_2001] as
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammattiluokitus_2001_avain,
	ammattiluokitus_2001_koodi,
	ammattiluokitus_2001,
	ammattiluokitus_2001_SV,
	ammattiluokitus_2001_EN,
	taso,
	jarjestys,
	jarjestys_taso,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_ammattiluokitus_2001
UNION
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ammattiluokitus_2001_avain,
	ammattiluokitus_2001_koodi,
	ammattiluokitus_2001,
	ammattiluokitus_2001_SV,
	ammattiluokitus_2001_EN,
	taso,
	jarjestys,
	jarjestys_taso,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..ammattiluokitus_2001
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_ammattiluokitus_2010]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ammattiluokitus_2010]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_ammattiluokitus_2010] AS 
/*
Drop table VipunenTK.dbo.d_ammattiluokitus_2010
Select * into VipunenTK.dbo.d_ammattiluokitus_2010 from VipunenTK_DW.[dbo].[v_ammattiluokitus_2010]
Alter table VipunenTK.dbo.d_ammattiluokitus_2010 add primary key (Id)
Insert into VipunenTK.dbo.d_ammattiluokitus_2010
  Select * from VipunenTK_DW.[dbo].[v_ammattiluokitus_2010]
*/

SELECT id
	  ,luotu --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
	  ,alkaa = Cast(''1900-01-01'' as date) --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
	  ,paattyy = Cast(''2999-01-01'' as date) --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
      ,[ammattiluokitus_2010_avain]
	  ,ammattiluokitus_2010 = Case --otetaan tähän tarkin tarjolla oleva kuvaus
		when ammattiluokitus_2010_5_taso_koodi <> ''-1'' then [ammattiluokitus_2010_5_taso]
		when ammattiluokitus_2010_4_taso_koodi <> ''-1'' then [ammattiluokitus_2010_4_taso]
		when ammattiluokitus_2010_3_taso_koodi <> ''-1'' then [ammattiluokitus_2010_3_taso]
		when ammattiluokitus_2010_2_taso_koodi <> ''-1'' then [ammattiluokitus_2010_2_taso]
		else [ammattiluokitus_2010_1_taso] end
	  --,ammattiluokitus_2010_SV = Case... --otetaan tähän tarkin tarjolla oleva kuvaus, jos ammattiluokitus_2010 halutaan ja taulua saa muuttaa VipunenTK-kannassa
	  --,ammattiluokitus_2010_EN = Case... --otetaan tähän tarkin tarjolla oleva kuvaus, jos ammattiluokitus_2010 halutaan ja taulua saa muuttaa VipunenTK-kannassa
      ,[ammattiluokitus_2010_5_taso_koodi]
      ,[ammattiluokitus_2010_5_taso]
      ,[ammattiluokitus_2010_5_taso_SV]
      ,[ammattiluokitus_2010_5_taso_EN]
      ,[ammattiluokitus_2010_4_taso_koodi]
      ,[ammattiluokitus_2010_4_taso]
      ,[ammattiluokitus_2010_4_taso_SV]
      ,[ammattiluokitus_2010_4_taso_EN]
      ,[ammattiluokitus_2010_3_taso_koodi]
      ,[ammattiluokitus_2010_3_taso]
      ,[ammattiluokitus_2010_3_taso_SV]
      ,[ammattiluokitus_2010_3_taso_EN]
      ,[ammattiluokitus_2010_2_taso_koodi]
      ,[ammattiluokitus_2010_2_taso]
      ,[ammattiluokitus_2010_2_taso_SV]
      ,[ammattiluokitus_2010_2_taso_EN]
      ,[ammattiluokitus_2010_1_taso_koodi]
      ,[ammattiluokitus_2010_1_taso]
      ,[ammattiluokitus_2010_1_taso_SV]
      ,[ammattiluokitus_2010_1_taso_EN]
      ,[taso]
	  ,jarjestys_ammattiluokitus_2010_avain = Case --otetaan tähän tarkin tarjolla oleva jarjestystieto
		when ammattiluokitus_2010_5_taso_koodi <> ''-1'' then [jarjestys_ammattiluokitus_2010_taso5]
		when ammattiluokitus_2010_4_taso_koodi <> ''-1'' then [jarjestys_ammattiluokitus_2010_taso4]
		when ammattiluokitus_2010_3_taso_koodi <> ''-1'' then [jarjestys_ammattiluokitus_2010_taso3]
		when ammattiluokitus_2010_2_taso_koodi <> ''-1'' then [jarjestys_ammattiluokitus_2010_taso2]
		else [jarjestys_ammattiluokitus_2010_taso1] end
      ,[jarjestys_ammattiluokitus_2010_taso5]
      ,[jarjestys_ammattiluokitus_2010_taso4]
      ,[jarjestys_ammattiluokitus_2010_taso3]
      ,[jarjestys_ammattiluokitus_2010_taso2]
      ,[jarjestys_ammattiluokitus_2010_taso1]
      ,[virhetilanne] --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
      ,[poistettu] --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
      ,[tietolahde] --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
      ,[kommentti] --otetaan pois, jos taulua saa muuttaa VipunenTK-kannassa
FROM (--vaintasot
SELECT [id]
      ,[luotu]
      ,[ammattiluokitus_2010_avain]
      ,[ammattiluokitus_2010_5_taso_koodi]
      ,[ammattiluokitus_2010_5_taso]
      ,[ammattiluokitus_2010_5_taso_SV]
      ,[ammattiluokitus_2010_5_taso_EN]
      ,[ammattiluokitus_2010_4_taso_koodi]
      ,[ammattiluokitus_2010_4_taso]
      ,[ammattiluokitus_2010_4_taso_SV]
      ,[ammattiluokitus_2010_4_taso_EN]
      ,[ammattiluokitus_2010_3_taso_koodi]
      ,[ammattiluokitus_2010_3_taso]
      ,[ammattiluokitus_2010_3_taso_SV]
      ,[ammattiluokitus_2010_3_taso_EN]
      ,[ammattiluokitus_2010_2_taso_koodi]
      ,[ammattiluokitus_2010_2_taso]
      ,[ammattiluokitus_2010_2_taso_SV]
      ,[ammattiluokitus_2010_2_taso_EN]
      ,[ammattiluokitus_2010_1_taso_koodi]
      ,[ammattiluokitus_2010_1_taso]
      ,[ammattiluokitus_2010_1_taso_SV]
      ,[ammattiluokitus_2010_1_taso_EN]
      ,[taso]
      ,[jarjestys_ammattiluokitus_2010_taso5]
      ,[jarjestys_ammattiluokitus_2010_taso4]
      ,[jarjestys_ammattiluokitus_2010_taso3]
      ,[jarjestys_ammattiluokitus_2010_taso2]
      ,[jarjestys_ammattiluokitus_2010_taso1]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_ammattiluokitus_2010]
UNION ALL
SELECT [id]
      ,[luotu]
      ,[ammattiluokitus_2010_avain]
      ,[ammattiluokitus_2010_5_taso_koodi]
      ,[ammattiluokitus_2010_5_taso]
      ,[ammattiluokitus_2010_5_taso_SV]
      ,[ammattiluokitus_2010_5_taso_EN]
      ,[ammattiluokitus_2010_4_taso_koodi]
      ,[ammattiluokitus_2010_4_taso]
      ,[ammattiluokitus_2010_4_taso_SV]
      ,[ammattiluokitus_2010_4_taso_EN]
      ,[ammattiluokitus_2010_3_taso_koodi]
      ,[ammattiluokitus_2010_3_taso]
      ,[ammattiluokitus_2010_3_taso_SV]
      ,[ammattiluokitus_2010_3_taso_EN]
      ,[ammattiluokitus_2010_2_taso_koodi]
      ,[ammattiluokitus_2010_2_taso]
      ,[ammattiluokitus_2010_2_taso_SV]
      ,[ammattiluokitus_2010_2_taso_EN]
      ,[ammattiluokitus_2010_1_taso_koodi]
      ,[ammattiluokitus_2010_1_taso]
      ,[ammattiluokitus_2010_1_taso_SV]
      ,[ammattiluokitus_2010_1_taso_EN]
      ,[taso]
      ,[jarjestys_ammattiluokitus_2010_taso5]
      ,[jarjestys_ammattiluokitus_2010_taso4]
      ,[jarjestys_ammattiluokitus_2010_taso3]
      ,[jarjestys_ammattiluokitus_2010_taso2]
      ,[jarjestys_ammattiluokitus_2010_taso1]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[ammattiluokitus_2010]
  WHERE virhetilanne=''K''
) vaintasot



' 
GO
/****** Object:  View [dbo].[v_asuinkunta_sama_vai_eri_kuin_aiemmin]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_asuinkunta_sama_vai_eri_kuin_aiemmin]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_asuinkunta_sama_vai_eri_kuin_aiemmin] AS

SELECT [id]

      ,[asuinkunta_sama_vai_eri_kuin_aiemmin_koodi]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin_SV]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_asuinkunta_sama_vai_eri_kuin_aiemmin]

UNION ALL

SELECT [id]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin_koodi]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin_SV]
      ,[asuinkunta_sama_vai_eri_kuin_aiemmin_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[asuinkunta_sama_vai_eri_kuin_aiemmin]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_asuinmaakunta_sama_kuin_tyopaikan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_asuinmaakunta_sama_kuin_tyopaikan]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_asuinmaakunta_sama_kuin_tyopaikan] AS 
/*
Drop table VipunenTK.dbo.d_asuinmaakunta_sama_kuin_tyopaikan
Select * into VipunenTK.dbo.d_asuinmaakunta_sama_kuin_tyopaikan from VipunenTK_DW.[dbo].[v_asuinmaakunta_sama_kuin_tyopaikan]
Alter table VipunenTK.dbo.d_asuinmaakunta_sama_kuin_tyopaikan add primary key (Id)
Truncate table VipunenTK.dbo.d_asuinmaakunta_sama_kuin_tyopaikan
Insert into VipunenTK.dbo.d_asuinmaakunta_sama_kuin_tyopaikan
  Select * from VipunenTK_DW.[dbo].[v_asuinmaakunta_sama_kuin_tyopaikan]
*/
SELECT [id]
     -- ,[luotu]
      ,[asuinmaakunta_sama_kuin_tyopaikan_avain]
      ,[asuinmaakunta_sama_kuin_tyopaikan]
      ,[asuinmaakunta_sama_kuin_tyopaikan_SV]
      ,[asuinmaakunta_sama_kuin_tyopaikan_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_asuinmaakunta_sama_kuin_tyopaikan]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[asuinmaakunta_sama_kuin_tyopaikan_avain]
      ,[asuinmaakunta_sama_kuin_tyopaikan]
      ,[asuinmaakunta_sama_kuin_tyopaikan_SV]
      ,[asuinmaakunta_sama_kuin_tyopaikan_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[asuinmaakunta_sama_kuin_tyopaikan]
  WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_avoinvayla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_avoinvayla]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_avoinvayla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	avoinvayla_koodi,
	avoinvayla,
	avoinvayla_SV,
	avoinvayla_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_avoinvayla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	avoinvayla_koodi,
	avoinvayla,
	avoinvayla_SV,
	avoinvayla_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_avoinvayla
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_d_aloittaneiden_lapaisy_henkilomuuttujat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_d_aloittaneiden_lapaisy_henkilomuuttujat]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_d_aloittaneiden_lapaisy_henkilomuuttujat]
AS
SELECT        ROW_NUMBER() OVER (ORDER BY sukupuoli_id, aidinkieli_id, ika_id) AS id, *
FROM            (SELECT DISTINCT 
                                                    sp.id AS sukupuoli_id, ak.id AS aidinkieli_id, ika.id AS ika_id, ika.ika, ika.ika5v, ika.jarjestys_ika, ika.jarjestys_ika5v, sp.sukupuoli, sp.jarjestys AS sukupuoli_jarjestys, ak.aidinkieli_versio1, 
                                                    ak.jarjestys AS aidinkieli_jarjestys
                          FROM            dbo.d_sukupuoli AS sp CROSS JOIN
                                                    dbo.d_aidinkieli_versio1 AS ak CROSS JOIN
                                                    dbo.d_ika AS ika) x

' 
GO
/****** Object:  View [dbo].[v_edellisen_vuoden_opiskelu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_edellisen_vuoden_opiskelu]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_edellisen_vuoden_opiskelu] AS
/*
Drop table VipunenTK.dbo.d_edellisen_vuoden_opiskelu
Select * into VipunenTK.dbo.d_edellisen_vuoden_opiskelu from VipunenTK_DW.dbo.v_edellisen_vuoden_opiskelu
Truncate table  VipunenTK.dbo.d_edellisen_vuoden_opiskelu
Insert into VipunenTK.dbo.d_edellisen_vuoden_opiskelu
Select * from VipunenTK_DW.dbo.v_edellisen_vuoden_opiskelu
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,edellisen_vuoden_opiskelu_avain
      ,edellisen_vuoden_opiskelu_koulutus
      ,edellisen_vuoden_opiskelu_koulutus_SV
      ,edellisen_vuoden_opiskelu_koulutus_EN
      ,edellisen_vuoden_opiskelu_tarkennus
      ,edellisen_vuoden_opiskelu_tarkennus_SV
      ,edellisen_vuoden_opiskelu_tarkennus_EN
      ,jarjestys_koulutus
      ,jarjestys_tarkennus
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_edellisen_vuoden_opiskelu]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,edellisen_vuoden_opiskelu_avain
      ,edellisen_vuoden_opiskelu_koulutus
      ,edellisen_vuoden_opiskelu_koulutus_SV
      ,edellisen_vuoden_opiskelu_koulutus_EN
      ,edellisen_vuoden_opiskelu_tarkennus
      ,edellisen_vuoden_opiskelu_tarkennus_SV
      ,edellisen_vuoden_opiskelu_tarkennus_EN
      ,jarjestys_koulutus
      ,jarjestys_tarkennus
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_edellisen_vuoden_opiskelu]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_edeltavan_vuoden_asuinpaikka]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_edeltavan_vuoden_asuinpaikka]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_edeltavan_vuoden_asuinpaikka] as


SELECT [id]
      ,[edeltavan_vuoden_asuinpaikka_koodi]
      ,[edeltavan_vuoden_asuinpaikka]
      ,[edeltavan_vuoden_asuinpaikka_SV]
      ,[edeltavan_vuoden_asuinpaikka_EN]
      ,[jarjestys]
  FROM [VipunenTK_dw].[dbo].[d_edeltavan_vuoden_asuinpaikka]

union all

SELECT [id]
      ,[edeltavan_vuoden_asuinpaikka_koodi]
      ,[edeltavan_vuoden_asuinpaikka]
      ,[edeltavan_vuoden_asuinpaikka_SV]
      ,[edeltavan_vuoden_asuinpaikka_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[edeltavan_vuoden_asuinpaikka]

WHERE virhetilanne = ''K''' 
GO
/****** Object:  View [dbo].[v_elakkeelle_siirtynyt_tai_kuollut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_elakkeelle_siirtynyt_tai_kuollut]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_elakkeelle_siirtynyt_tai_kuollut] AS
(
SELECT [id]
      ,[alkaa]
      ,[paattyy]
   	  ,[elakkeelle_siirtynyt_tai_kuollut_koodi]
      ,[elakkeelle_siirtynyt_tai_kuollut_ryhma]
      ,[elakkeelle_siirtynyt_tai_kuollut_ryhma_SV]
      ,[elakkeelle_siirtynyt_tai_kuollut_ryhma_EN]
	  ,[elakkeelle_siirtynyt_tai_kuollut]
	  ,[elakkeelle_siirtynyt_tai_kuollut_SV]
	  ,[elakkeelle_siirtynyt_tai_kuollut_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_elakkeelle_siirtynyt_tai_kuollut]

UNION ALL

SELECT [id]
      ,[alkaa]
      ,[paattyy]
   	  ,[elakkeelle_siirtynyt_tai_kuollut_koodi]
      ,[elakkeelle_siirtynyt_tai_kuollut_ryhma]
      ,[elakkeelle_siirtynyt_tai_kuollut_ryhma_SV]
      ,[elakkeelle_siirtynyt_tai_kuollut_ryhma_EN]
	  ,[elakkeelle_siirtynyt_tai_kuollut]
	  ,[elakkeelle_siirtynyt_tai_kuollut_SV]
	  ,[elakkeelle_siirtynyt_tai_kuollut_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_elakkeelle_siirtynyt_tai_kuollut]
  WHERE virhetilanne = ''K''
)
' 
GO
/****** Object:  View [dbo].[v_ensisijainen_opintooikeus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ensisijainen_opintooikeus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_ensisijainen_opintooikeus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ensisijainen_opintooikeus_koodi,
	ensisijainen_opintooikeus,
	ensisijainen_opintooikeus_SV,
	ensisijainen_opintooikeus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_ensisijainen_opintooikeus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	ensisijainen_opintooikeus_koodi,
	ensisijainen_opintooikeus,
	ensisijainen_opintooikeus_SV,
	ensisijainen_opintooikeus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_ensisijainen_opintooikeus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_erityisopetuksen_peruste]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_erityisopetuksen_peruste]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_erityisopetuksen_peruste] AS

SELECT [id]
      --,[luotu]
      ,[erityisopetuksen_peruste_avain]
      ,[erityisopetuksen_peruste]
      ,[erityisopetuksen_peruste_SV]
      ,[erityisopetuksen_peruste_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_erityisopetuksen_peruste]
  
UNION ALL

SELECT TOP 1000 [id]
      --,[luotu]
      ,[erityisopetuksen_peruste_avain]
      ,[erityisopetuksen_peruste]
      ,[erityisopetuksen_peruste_SV]
      ,[erityisopetuksen_peruste_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_erityisopetuksen_peruste]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_erityisoppilaan_opetusryhma]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_erityisoppilaan_opetusryhma]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_erityisoppilaan_opetusryhma] AS

SELECT [id]
      --,[luotu]
      ,[erityisoppilaan_opetusryhma_avain]
      ,[erityisoppilaan_opetusryhma]
      ,[erityisoppilaan_opetusryhma_SV]
      ,[erityisoppilaan_opetusryhma_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_erityisoppilaan_opetusryhma]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[erityisoppilaan_opetusryhma_avain]
      ,[erityisoppilaan_opetusryhma]
      ,[erityisoppilaan_opetusryhma_SV]
      ,[erityisoppilaan_opetusryhma_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_erityisoppilaan_opetusryhma]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_eu_etamaat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_eu_etamaat]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_eu_etamaat] AS

SELECT [id]
      ,[eu_etamaat_avain]
      ,[eu_etamaat]
      ,[eu_etamaat_SV]
      ,[eu_etamaat_EN]
      ,[jarjestys]

  FROM [VipunenTK_DW].[dbo].[d_eu_etamaat]

UNION ALL

SELECT [id]
      ,[eu_etamaat_avain]
      ,[eu_etamaat]
      ,[eu_etamaat_SV]
      ,[eu_etamaat_EN]
      ,[jarjestys]

  FROM [VipunenTK_lisatiedot].[dbo].[eu_etamaat]

WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_f_2_10_Korkeakouluopiskelijoiden_aikaisempi_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_10_Korkeakouluopiskelijoiden_aikaisempi_koulutus]'))
EXEC dbo.sp_executesql @statement = N'













































CREATE VIEW [dbo].[v_f_2_10_Korkeakouluopiskelijoiden_aikaisempi_koulutus] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
      ,lahde = [lahde]
      ,oppilaitoksen_taustatiedot = [tunn]
      ,koulutusluokitus = [koulk]
	  ,koulutuksen_kunta = [kkun]
	  ,sukupuoli = [sp]
	  ,aidinkieli_versio1 = [aikielir1]
	  ,ika_1v = cast (
      (
         case 
         when [syntv] = ''XXXX'' then ''-1'' 
         when [syntv] = '''' then ''-1''
         when ((cast(tilv as int) - cast(syntv as int)) <= 14 ) then ''1141''
         else ((cast(tilv as int) - cast(syntv as int)))
         end) as nvarchar (10))
      ,ika_5v =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 19) then ''19655v19''
		when ((cast(tilv as int) - cast(syntv as int)) >= 20 and (cast(tilv as int) - cast(syntv as int)) <= 24) then ''19655v20''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		
		end
	   ) as nvarchar (10))
      ,ika_14_65 =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 14)  then ''1141''
		when ((cast(tilv as int) - cast(syntv as int)) = 15 )  then ''15''
		when ((cast(tilv as int) - cast(syntv as int)) = 16) then ''16''
		when ((cast(tilv as int) - cast(syntv as int)) = 17) then ''17''
		when ((cast(tilv as int) - cast(syntv as int)) = 18) then ''18''
		when ((cast(tilv as int) - cast(syntv as int)) = 19) then ''19''
		when ((cast(tilv as int) - cast(syntv as int)) = 20) then ''20''
		when ((cast(tilv as int) - cast(syntv as int)) = 21) then ''21''
		when ((cast(tilv as int) - cast(syntv as int)) = 22) then ''22''
		when ((cast(tilv as int) - cast(syntv as int)) = 23) then ''23''
		when ((cast(tilv as int) - cast(syntv as int)) = 24) then ''24''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		end
	   ) as nvarchar (10))
	   ,kotikunta = [tilvaskun]
	   ,kansalaisuus_versio2 = [kansal]
	   ,opiskelijan_olo_tamm = [olotamm]
	   ,opiskelijan_olo_syys = [olosyys]
	   ,rahoituslahde = rahlahde
	   ,opiskelijan_fte_tieto = [fte]
	   ,vahintaan_45_op_suorittanut = [op45]
	   ,vahintaan_55_op_suorittanut = [op55]
	   ,kirjoihintulovuosi = [alvv]
	   ,kirjoihintulolukukausi = [allk]
	   ,kirjoihintulovuosi_korkeakoulusektori = [alvv_kksek]
	   ,kirjoihintulovuosi_korkeakoulusektori_lasnaoleva = [alvv_kksek_lasna]
	   ,kirjoihintulovuosi_sektori= [alvv_sek]
	   ,kirjoihintulovuosi_sektori_lasnaoleva = [alvv_sek_lasna]
	   ,kirjoihintulovuosi_korkeakoulu = [alvv_kk]  
	   ,kirjoihintulovuosi_korkeakoulu_lasnaoleva = [alvv_kk_lasna]
	   ,kirjoihintulovuosi_opintoala = [alvv_opa]
	   ,kirjoihintulovuosi_opintoala_lasnaoleva = [alvv_opa_lasna]
	   ,koulutustyyppi = [koulutyp]
	   ,opiskelumuoto = [om]
	   ,avoinvayla = [avo]
	   ,aikaisemmin_suoritettu_yotutk = [aikyotutk]
	   ,aikaisemmin_suoritettu_yotutk_tarkempi= CAST(
      (
		case
		when [aikyotutk] = ''1'' then ''Aikaisemmin suoritettu ylioppilastutkinto''
		else ''Ei suoritettu ylioppilastutkintoa''
		end
	   )as nvarchar(100))
	   ,yotutk_pohjakoulutuksen_tila = cast(
		(
		case
        when (aikyotutk = ''1'' and ((cast(alvv as int) - cast(suvuosiyotutk as int) >= 0))) then ''Ylioppilastutkinto suoritettu ennen koulutuksen aloittamista''
        when (aikyotutk = ''1'' and ((cast(alvv as int) - cast(suvuosiyotutk as int) < 0))) then ''Ylioppilastutkinto suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei suoritettu ylioppilastutkintoa''
    end
       )
    as nvarchar(150))
	   ,aikaisemmin_suoritetun_yotutk_koulutustiedot = [aikyotutkkoulk]
	   ,aikaisemmin_suoritetun_yotutk_suoritusvuosi = [suvuosiyotutk]
	   ,aikaisemmin_suoritetun_yotutk_oppilaitostiedot = [tunnyotutk]
	   ,aikaisemmin_suoritettu_ammtutk = [aikamm]
	   ,aikaisemmin_suoritettu_ammtutk_tarkempi= CAST(
      (
		case
		when [aikamm] = ''1'' then ''Aikaisemmin suoritettu alempi ammatillinen tutkinto''
		else ''Ei suoritettu alempaa ammatillista tutkintoa ''
		end
	   )as nvarchar(100))
	   ,ammtutk_pohjakoulutuksen_tila = cast(
		(
		case
        when (aikamm= ''1'' and ((cast(alvv as int) - cast(suvuosiamm as int) >= 0))) then ''Alempi ammatillinen tutkinto suoritettu ennen koulutuksen aloittamista''
        when (aikamm = ''1'' and ((cast(alvv as int) - cast(suvuosiamm as int) < 0))) then ''Alempi ammatillinen tutkinto suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei suoritettu alempaa ammatillista tutkintoa''
    end
       )
    as nvarchar(150))
	   ,aikaisemmin_suoritetun_ammtutk_koulutustiedot = [aikammkoulk]
	   ,aikaisemmin_suoritetun_ammtutk_suoritusvuosi = [suvuosiamm]
	   ,aikaisemmin_suoritetun_ammtutk_oppilaitostiedot = [tunnamm]
	   ,aikaisemmin_suoritettu_amktutk = [aikamk]
	   ,aikaisemmin_suoritettu_amktutk_tarkempi= CAST(
      (
		case
		when [aikamk] = ''1'' then ''Aikaisemmin suoritettu amk-tutkinto''
		else ''Ei suoritettu amk-tutkintoa ''
		end
	   )as nvarchar(100))
	    ,amktutk_pohjakoulutuksen_tila = cast(
		(
		case
        when (aikamk= ''1'' and ((cast(alvv as int) - cast(suvuosiamk as int) >= 0))) then ''Amk-tutkinto suoritettu ennen koulutuksen aloittamista''
        when (aikamk = ''1'' and ((cast(alvv as int) - cast(suvuosiamk as int) < 0))) then ''Amk-tutkinto suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei suoritettu amk-tutkintoa''
    end
       )
    as nvarchar(150))
	   ,aikaisemmin_suoritetun_amktutk_koulutustiedot = [aikamkkoulk]
	   ,aikaisemmin_suoritetun_amktutk_suoritusvuosi = [suvuosiamk]
	   ,aikaisemmin_suoritetun_amktutk_oppilaitostiedot = [tunnamk]
	   ,aikaisemmin_suoritettu_ylempiamktutk = [aikylamk]
	   ,aikaisemmin_suoritettu_ylempiamktutk_tarkempi= CAST(
      (
		case
		when [aikylamk] = ''1'' then ''Aikaisemmin suoritettu ylempi amk-tutkinto''
		else ''Ei suoritettu ylempää amk-tutkintoa ''
		end
	   )as nvarchar(100))
	   ,ylempiamktutk_pohjakoulutuksen_tila = cast(
		(
		case
        when (aikylamk= ''1'' and ((cast(alvv as int) - cast(suvuosiylamk as int) >= 0))) then ''Ylempi amk-tutkinto suoritettu ennen koulutuksen aloittamista''
        when (aikylamk = ''1'' and ((cast(alvv as int) - cast(suvuosiylamk as int) < 0))) then ''Ylempi amk-tutkinto suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei suoritettu ylempää amk-tutkintoa''
    end
       )
    as nvarchar(150))
	   ,aikaisemmin_suoritetun_ylempiamktutk_koulutustiedot = [aikylamkkoulk]
	   ,aikaisemmin_suoritetun_ylempiamktutk_suoritusvuosi = [suvuosiylamk]
	   ,aikaisemmin_suoritetun_ylempiamktutk_oppilaitostiedot = [tunnylamk]
	   ,aikaisemmin_suoritettu_alempikktutk = [aikalkk]
	   ,aikaisemmin_suoritettu_alempikktutk_tarkempi= CAST(
      (
		case
		when [aikalkk] = ''1'' then ''Aikaisemmin suoritettu alempi korkeakoulututkinto''
		else ''Ei suoritettu alempaa korkeakoulututkintoa ''
		end
	   )as nvarchar(100))
	    ,alempikktutk_pohjakoulutuksen_tila = cast(
		(
		case
        when (aikalkk= ''1'' and ((cast(alvv as int) - cast(suvuosialkk as int) >= 0))) then ''Alempi korkeakoulututkinto suoritettu ennen koulutuksen aloittamista''
        when (aikalkk = ''1'' and ((cast(alvv as int) - cast(suvuosialkk as int) < 0))) then ''Alempi korkeakoulututkinto suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei suoritettu alempaa korkeakoulututkintoa''
    end
       )
    as nvarchar(150))
	   ,aikaisemmin_suoritetun_alempikktutk_koulutustiedot = [aikalkkkoulk]
	   ,aikaisemmin_suoritetun_alempikktutk_suoritusvuosi = [suvuosialkk]
	   ,aikaisemmin_suoritetun_alempikktutk_oppilaitostiedot = [tunnalkk]
	   ,aikaisemmin_suoritettu_ylempikktutk = [aikylkk]
	      ,aikaisemmin_suoritettu_ylempikktutk_tarkempi= CAST(
      (
		case
		when [aikylkk] = ''1'' then ''Aikaisemmin suoritettu ylempi korkeakoulututkinto''
		else ''Ei suoritettu ylempää korkeakoulututkintoa ''
		end
	   )as nvarchar(100))
	     ,ylempikktutk_pohjakoulutuksen_tila = cast(
		(
		case
        when (aikylkk= ''1'' and ((cast(alvv as int) - cast(suvuosiylkk as int) >= 0))) then ''Ylempi korkeakoulututkinto suoritettu ennen koulutuksen aloittamista''
        when (aikylkk = ''1'' and ((cast(alvv as int) - cast(suvuosiylkk as int) < 0))) then ''Ylempi korkeakoulututkinto suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei suoritettu ylempää korkeakoulututkintoa''
    end
       )
    as nvarchar(150))
	   ,aikaisemmin_suoritetun_ylempikktutk_koulutustiedot = [aikylkkkoulk]
	   ,aikaisemmin_suoritetun_ylempikktutk_suoritusvuosi = [suvuosiylkk]
	   ,aikaisemmin_suoritetun_ylempikktutk_oppilaitostiedot = [tunnylkk]
	   ,opiskelijan_koulutus_edellisvuonna = [koulked]
	   ,opiskelijan_opintoala2002_edellisvuonna= CAST(
      (
		case
		when [opm02opaed] = '' '' then ''-1''
		else [opm02opaed]
		end
	   )as nvarchar(3))

	   ,opiskelijan_opintoala1995_edellisvuonna= CAST(
      (
		case
		when [opm95opaed] = '' '' then ''-1''
		else [opm95opaed]
		end
	   )as nvarchar(2))


      ,aikaisemmasta_koulutuksesta_yotutk_kulunut_aika =  cast ((case when [suvuosiyotutk] = '''' then ''-1''
        when alvv = '''' then ''-1''
	    when ((cast(alvv as int) - cast(suvuosiyotutk as int) <= 0)) then ''0'' 
	    else ((cast(alvv as int) - cast(suvuosiyotutk as int)) )end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_ammtutk_kulunut_aika =  cast ((case when [suvuosiamm] = '''' then ''-1''
      when alvv = '''' then ''-1''
	  when ((cast(alvv as int) - cast(suvuosiamm as int) <= 0)) then ''0'' 
	  else ((cast(alvv as int) - cast(suvuosiamm as int)))end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_amktutk_kulunut_aika =  cast ((case when [suvuosiamk] = '''' then ''-1''
      when alvv = '''' then ''-1'' 
	  when ((cast(alvv as int) - cast(suvuosiamk as int) <= 0)) then ''0'' 
	  else ((cast(alvv as int) - cast(suvuosiamk as int)))end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_ylamktutk_kulunut_aika =  cast ((case when [suvuosiylamk] = '''' then ''-1''
      when alvv = '''' then ''-1'' 
	  when ((cast(alvv as int) - cast(suvuosiylamk as int) <= 0)) then ''0'' 
	  else ((cast(alvv as int) - cast(suvuosiylamk as int)))end) as nvarchar (10))    
	  ,aikaisemmasta_koulutuksesta_alkktutk_kulunut_aika =  cast ((case when [suvuosialkk] = '''' then ''-1''
      when alvv = '''' then ''-1'' 
	  when ((cast(alvv as int) - cast(suvuosialkk as int) <= 0)) then ''0'' 
	  else ((cast(alvv as int) - cast(suvuosialkk as int)))end) as nvarchar (10))   
	  ,aikaisemmasta_koulutuksesta_ylkktutk_kulunut_aika =  cast ((case when [suvuosiylkk] = '''' then ''-1''
      when alvv = '''' then ''-1'' 
	  when ((cast(alvv as int) - cast(suvuosiylkk as int) <= 0)) then ''0'' 
	  else ((cast(alvv as int) - cast(suvuosiylkk as int)))end) as nvarchar (10))  
	  ,aiemman_tutkinnon_yotutk_opintoala1995_sama  = CAST(
      (
		case
		when koulk_opintoala1995 = aikyotutkkoulk_opintoala1995
		
		then ''Aiemman tutkinnon (yotutk) opintoala1995 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	  
	  ,aiemman_tutkinnon_yotutk_opintoala2002_sama  = CAST(
      (
		case
		when koulk_opintoala2002 = aikyotutkkoulk_opintoala2002
		
		then ''Aiemman tutkinnon (yotutk) opintoala2002 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	  
	  ,aiemman_tutkinnon_yotutk_koulutusala2002_sama  = CAST(
      (
		case
		when koulk_koulutusala2002 = aikyotutkkoulk_koulutusala2002
		
		then ''Aiemman tutkinnon (yotutk) koulutusala2002 sama''
		else ''Ei sama koulutusala''
		end
	   )
	   as nvarchar(100))	   
	  ,aiemman_tutkinnon_yotutk_koulutusaste2002_sama  = CAST(
      (
		case
		when koulk_koulutusaste2002 = aikyotutkkoulk_koulutusaste2002
		
		then ''Aiemman tutkinnon (yotutk) koulutusaste2002 sama''
		else ''Ei sama koulutusaste''
		end
	   )
	   as nvarchar(100))	   
	  ,aiemman_tutkinnon_ammtutk_opintoala1995_sama  = CAST(
      (
		case
		when koulk_opintoala1995 = aikammkoulk_opintoala1995
		
		then ''Aiemman tutkinnon (ammtutk) opintoala1995 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	  
	  ,aiemman_tutkinnon_ammtutk_opintoala2002_sama  = CAST(
      (
		case
		when koulk_opintoala2002 = aikammkoulk_opintoala2002
		
		then ''Aiemman tutkinnon (ammtutk) opintoala2002 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_ammtutk_koulutusala2002_sama  = CAST(
      (
		case
		when koulk_koulutusala2002 = aikammkoulk_koulutusala2002
		
		then ''Aiemman tutkinnon (ammtutk) koulutusala2002 sama''
		else ''Ei sama koulutusala''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_ammtutk_koulutusaste2002_sama  = CAST(
      (
		case
		when koulk_koulutusaste2002 = aikammkoulk_koulutusaste2002
		
		then ''Aiemman tutkinnon (ammtutk) koulutusaste2002 sama''
		else ''Ei sama koulutusaste''
		end
	   )
	   as nvarchar(100))	
	    ,aiemman_tutkinnon_amktutk_opintoala1995_sama  = CAST(
      (
		case
		when koulk_opintoala1995 = aikamkkoulk_opintoala1995
		
		then ''Aiemman tutkinnon (amktutk) opintoala1995 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	  
	  ,aiemman_tutkinnon_amktutk_opintoala2002_sama  = CAST(
      (
		case
		when koulk_opintoala2002 = aikamkkoulk_opintoala2002
		
		then ''Aiemman tutkinnon (amktutk) opintoala2002 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_amktutk_koulutusala2002_sama  = CAST(
      (
		case
		when koulk_koulutusala2002 = aikamkkoulk_koulutusala2002
		
		then ''Aiemman tutkinnon (amktutk) koulutusala2002 sama''
		else ''Ei sama koulutusala''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_amktutk_koulutusaste2002_sama  = CAST(
      (
		case
		when koulk_koulutusaste2002 = aikamkkoulk_koulutusaste2002
		
		then ''Aiemman tutkinnon (amktutk) koulutusaste2002 sama''
		else ''Ei sama koulutusaste''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_ylempiamktutk_opintoala1995_sama  = CAST(
      (
		case
		when koulk_opintoala1995 = aikamkkoulk_opintoala1995
		
		then ''Aiemman tutkinnon (ylempiamktutk) opintoala1995 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_ylempiamktutk_opintoala2002_sama  = CAST(
      (
		case
		when koulk_opintoala2002 = aikamkkoulk_opintoala2002
		
		then ''Aiemman tutkinnon (ylempiamktutk) opintoala2002 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))	
	  ,aiemman_tutkinnon_ylempiamktutk_koulutusala2002_sama  = CAST(
      (
		case
		when koulk_koulutusala2002 = aikamkkoulk_koulutusala2002
		
		then ''Aiemman tutkinnon (ylempiamktutk) koulutusala2002 sama''
		else ''Ei sama koulutusala''
		end
	   )
	   as nvarchar(100))
	  ,aiemman_tutkinnon_ylempiamktutk_koulutusaste2002_sama  = CAST(
      (
		case
		when koulk_koulutusaste2002 = aikamkkoulk_koulutusaste2002
		
		then ''Aiemman tutkinnon (ylempiamktutk) koulutusaste2002 sama''
		else ''Ei sama koulutusaste''
		end
	   )
	   as nvarchar(100))
	  ,aiemman_tutkinnon_alempikktutk_opintoala1995_sama  = CAST(
      (
		case
		when koulk_opintoala1995 = aikylamkkoulk_opintoala1995
		
		then ''Aiemman tutkinnon (alempikktutk) opintoala1995 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))
	   ,aiemman_tutkinnon_alempikktutk_opintoala2002_sama  = CAST(
      (
		case
		when koulk_opintoala2002 = aikylamkkoulk_opintoala2002
		
		then ''Aiemman tutkinnon (alempikktutk) opintoala2002 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))
	   ,aiemman_tutkinnon_alempikktutk_koulutusala2002_sama  = CAST(
      (
		case
		when koulk_koulutusala2002 = aikylamkkoulk_koulutusala2002
		
		then ''Aiemman tutkinnon (alempikktutk) koulutusala2002 sama''
		else ''Ei sama koulutusala''
		end
	   )
	   as nvarchar(100))		
	  ,aiemman_tutkinnon_alempikktutk_koulutusaste2002_sama  = CAST(
      (
		case
		when koulk_koulutusaste2002 = aikylamkkoulk_koulutusaste2002
		
		then ''Aiemman tutkinnon (alempikktutk) koulutusaste2002 sama''
		else ''Ei sama koulutusaste''
		end
	   )
	   as nvarchar(100))			
	  ,aiemman_tutkinnon_ylempikktutk_opintoala1995_sama  = CAST(
      (
		case
		when koulk_opintoala1995 = aikylkkkoulk_opintoala1995
		
		then ''Aiemman tutkinnon (ylempikktutk) opintoala1995 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))
	  ,aiemman_tutkinnon_ylempikktutk_opintoala2002_sama  = CAST(
      (
		case
		when koulk_opintoala2002 = aikylkkkoulk_opintoala2002
		
		then ''Aiemman tutkinnon (ylempikktutk) opintoala2002 sama''
		else ''Ei sama opintoala''
		end
	   )
	   as nvarchar(100))
	  ,aiemman_tutkinnon_ylempikktutk_koulutusala2002_sama  = CAST(
      (
		case
		when koulk_koulutusala2002 = aikylkkkoulk_koulutusala2002
		
		then ''Aiemman tutkinnon (ylempikktutk) koultusala2002 sama''
		else ''Ei sama koulutusala''
		end
	   )
	   as nvarchar(100))
	 ,aiemman_tutkinnon_ylempikktutk_koulutusaste2002_sama  = CAST(
      (
		case
		when koulk_koulutusaste2002 = aikylkkkoulk_koulutusaste2002
		
		then ''Aiemman tutkinnon (ylempikktutk) koultusaste2002 sama''
		else ''Ei sama koulutusaste''
		end
	   )
	   as nvarchar(100))
       ,aiemman_tutkinnon_opintoala1995_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala1995 = [aikyotutkkoulk_opintoala1995] then ''Aiemman tutkinnon opintoala1995 sama''
		when koulk_opintoala1995 = [aikammkoulk_opintoala1995] then ''Aiemman tutkinnon opintoala1995 sama''
		when koulk_opintoala1995 = [aikamkkoulk_opintoala1995] then ''Aiemman tutkinnon opintoala1995 sama''
		when koulk_opintoala1995 = [aikylamkkoulk_opintoala1995] then ''Aiemman tutkinnon opintoala1995 sama''
		when koulk_opintoala1995 = [aikylkkkoulk_opintoala1995] then ''Aiemman tutkinnon opintoala1995 sama''
		else ''Ei sama opintoala''

		end
	   )
	as nvarchar(100))
	 ,aiemman_tutkinnon_opintoala2002_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala2002 = [aikyotutkkoulk_opintoala2002] then ''Aiemman tutkinnon opintoala2002 sama''
		when koulk_opintoala2002 = [aikammkoulk_opintoala2002] then ''Aiemman tutkinnon opintoala2002 sama''
		when koulk_opintoala2002 = [aikamkkoulk_opintoala2002] then ''Aiemman tutkinnon opintoala2002 sama''
		when koulk_opintoala2002 = [aikylamkkoulk_opintoala2002] then ''Aiemman tutkinnon opintoala2002 sama''
		when koulk_opintoala2002 = [aikylkkkoulk_opintoala2002] then ''Aiemman tutkinnon opintoala2002 sama''
		else ''Ei sama opintoala''

		end
	   )
	as nvarchar(100))
     ,aiemman_tutkinnon_koulutusala2002_sama  = 
	 CAST(
      (
		case
		when koulk_koulutusala2002 = [aikyotutkkoulk_koulutusala2002] then ''Aiemman tutkinnon koulutusala2002 sama''
		when koulk_koulutusala2002 = [aikammkoulk_koulutusala2002] then ''Aiemman tutkinnon koulutusala2002 sama''
		when koulk_koulutusala2002 = [aikamkkoulk_koulutusala2002] then ''Aiemman tutkinnon koulutusala2002 sama''
		when koulk_koulutusala2002 = [aikylamkkoulk_koulutusala2002] then ''Aiemman tutkinnon koulutusala2002 sama''
		when koulk_koulutusala2002 = [aikylkkkoulk_koulutusala2002] then ''Aiemman tutkinnon koulutusala2002 sama''
		else ''Ei sama koulutusala''

		end
	   )
	as nvarchar(100))
	,aiemman_tutkinnon_koulutusaste2002_sama  = 
	 CAST(
      (
		case
		when koulk_koulutusaste2002 = [aikyotutkkoulk_koulutusaste2002] then ''Aiemman tutkinnon koulutusaste2002 sama''
		when koulk_koulutusaste2002 = [aikammkoulk_koulutusaste2002] then ''Aiemman tutkinnon koulutusaste2002 sama''
		when koulk_koulutusaste2002 = [aikamkkoulk_koulutusaste2002] then ''Aiemman tutkinnon koulutusaste2002 sama''
		when koulk_koulutusaste2002 = [aikylamkkoulk_koulutusaste2002] then ''Aiemman tutkinnon koulutusaste2002 sama''
		when koulk_koulutusaste2002 = [aikylkkkoulk_koulutusaste2002] then ''Aiemman tutkinnon koulutusaste2002 sama''
		else ''Ei sama koulutusaste''

		end
	   )
	as nvarchar(100)),
	 pohjakoulutuksen_tila =  
	    cast ((case 
		when [suvuosiyotutk] = '''' then ''''
		when [suvuosiamm] = '''' then ''''
		when [suvuosiamk] = '''' then ''''
		when [suvuosialkk] = '''' then ''''
		when [suvuosiylkk] = '''' then ''''
		when [suvuosiyotutk] = '''' then ''''
		when [suvuosiamm] = '''' then ''''
		when [suvuosiamk] = '''' then ''''
		when [suvuosialkk] = '''' then ''''
		when [suvuosiylkk] = '''' then ''''
        when alvv = '''' then ''''
	    when ((cast(alvv as int) - cast(suvuosiyotutk as int) < 0)) then ''1'' 
		when ((cast(alvv as int) - cast(suvuosiamm as int) < 0)) then ''1'' 
		when ((cast(alvv as int) - cast(suvuosiamk as int) < 0)) then ''1'' 
		when ((cast(alvv as int) - cast(suvuosialkk as int) < 0)) then ''1'' 
		when ((cast(alvv as int) - cast(suvuosiylkk as int) < 0)) then ''1'' 
	    when ((cast(alvv as int) - cast(suvuosiyotutk as int) >= 0)) then ''2'' 
		when ((cast(alvv as int) - cast(suvuosiamm as int) >= 0)) then ''2'' 
		when ((cast(alvv as int) - cast(suvuosiamk as int) >= 0)) then ''2'' 
		when ((cast(alvv as int) - cast(suvuosialkk as int) >= 0)) then ''2'' 
		when ((cast(alvv as int) - cast(suvuosiylkk as int) >= 0)) then ''2'' 
	    else ''''
	end
	   )
	as nvarchar(1)),
	lukumaara = [lkm]
	---- aloittaneet muutettu Pekan pyynnöstä kts. jira tiketti CSCTKTIIMI-64
	--,aloittaneet = CAST(
	--(
	--	case when (koulk_koulutusaste2002 = ''63'' or koulk_koulutusaste2002= ''71'' or koulk_koulutusaste2002=''73'' or koulk_koulutusaste2002=''81'' or koulk_koulutusaste2002=''82'') then alvv 
	--	     when  koulk_koulutusaste2002=(''62'') then alvv_kk_lasna  end
	--)
	--as int)
	,aloittaneet = CAST(
	(
		case when tilv < ''2012'' and (koulk_koulutusaste2002 IN ( ''63'',''71'',''72'') and koulk_koulutusaste2002 NOT IN (''73'',''81'',''82'') ) and alvv /*kirjoihintulovuosi*/ = tilv /*tilastointivuosi*/ 
		          and olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/ 
				  when tilv >= ''2012'' and (koulk_koulutusaste2002 IN ( ''71'') and koulk_koulutusaste2002 NOT IN (''73'',''81'',''82'') ) and alvv /*kirjoihintulovuosi*/ = tilv /*tilastointivuosi*/ 
		          and olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/ 
				  when tilv >= ''2012'' and (koulk_koulutusaste2002 IN ( ''63'',''72'') and koulk_koulutusaste2002 NOT IN (''73'',''81'',''82'') ) and alvv_kk /*kirjoihintulovuosi*/ = tilv /*tilastointivuosi*/ 
		          and olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/ 
			 when koulk_koulutusaste2002=(''62'') and alvv_kk_lasna = tilv and olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/   end
	)
	as int)

	,aikaisempi_korkein_tutkinto =  cast (
      (
         case 
		 --Ylempi korkeakoulututkinto 12
         when (aikylkk = ''1'')  then ''12''

		 -- Ylempi amk-tutkinto 11 
         when (aikalkk = ''1'')  then ''10''
		 
		 --Alempi korkeakoulututkinto 10
         when (aikylamk =''1'') then ''11''
		 
		 -- Amk-tutkinto 9
         when(aikamk=''1'')   then ''9''
		 
		 -- Ammatillinen perustutkinto 3
		 when(aikamm =''1'') then ''3''
		 -- Ylioppilastutkinto 2
		 when aikyotutk  = ''1'' then ''2''
		 -- Ei perusasteen jälkeistä koulutusta 1
		else ''1''
         end) as nvarchar (2))
	 ,ika_18_65 =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 18)  then ''18655v18''
		when ((cast(tilv as int) - cast(syntv as int)) = 19 )  then ''19''
		when ((cast(tilv as int) - cast(syntv as int)) = 20) then ''20''
		when ((cast(tilv as int) - cast(syntv as int)) = 21) then ''21''
		when ((cast(tilv as int) - cast(syntv as int)) = 22) then ''22''
		when ((cast(tilv as int) - cast(syntv as int)) = 23) then ''23''
		when ((cast(tilv as int) - cast(syntv as int)) = 24) then ''24''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		end
	   ) as nvarchar (10))
	   ,ylempi_korkeakoulututkinto= case 
	   when (aikylkk = ''1'') then  cast(lkm as int) else '''' end 
	   ,ylempi_amk_tutkinto = case
	   when (aikylamk = ''1'') then  cast(lkm as int) else '''' end
	   ,alempi_korkeakoulututkinto = case 
	   when (aikalkk =''1'') then cast(lkm as int) else '''' end
	   ,amk_tutkinto = case 
	   when (aikamk=''1'') then cast(lkm as int) else '''' end
	   ,ammatillinen_perustutkinto = case
	   when (aikamm =''1'')then cast(lkm as int) else '''' end
	   ,ylioppilastutkinto = case
	    when aikyotutk  = ''1'' then cast(lkm as int) else '''' end
	   ,ei_perusasteen_jalkeista_koulutusta = case
	   when ( aikylkk = ''0'' and aikalkk = ''0'' and aikylamk = ''0'' and aikamk=''0'' and aikamm =''0'' and aikyotutk  = ''0'') then cast(lkm as int) else '''' end
	   ,opiskelijat = cast(
	(
		case
		when olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/
		end
	)
	as int)

	     FROM [VipunenTK_DW].[dbo].[sa_2_10_Korkeakouluopiskelijoiden_aikaisempi_koulutus]














































' 
GO
/****** Object:  View [dbo].[v_f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot]'))
EXEC dbo.sp_executesql @statement = N'Create view [dbo].[v_f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot] as

-- CSC JN 9.5.2014

-- Palauta aineisto 2.11 hajotettuna riveille (unpivotoituna)
-- Rivillä on dimensioavainten lisäksi
--  mittari_nimi = aineiston 2.11 kentän nimi
--  mittari_arvo = aineiston 2.11 kentän arvo
-- Näkymä palauttaa vain arvoltaan tyhjästä ja nollasta eroavat rivit
-- Kenttien nimet ovat pitkässä muodossa.

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot
-- Select * into VipunenTK_DW.dbo.f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot from VipunenTK_DW.dbo.v_f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot
-- Insert into VipunenTK_DW.dbo.f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot Select * from VipunenTK_DW.dbo.v_f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot 

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_2_11_Oppilaitosten_tutkintoon_johtamaton_unpivot 


Select 
	 tilastointivuosi = tilv
	,tilv_date
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
		
	,[tietolahde]
    ,[rivinumero]
    
    ,mittari_nimi
    ,mittari_arvo = CAST(mittari_arvo as int)
from --p
(Select 
	   [tilv]
	  ,tilv_date
      ,[tunn]
      ,[jarj]
      ,[osa1]
      ,[suo1]
      ,[osa2]
      ,[suo2]
      ,[osa3]
      ,[suo3]
      ,[kur4]
      ,[osa4]
      ,[nai4]
      ,[tun4]
      ,[kur5]
      ,[osa5]
      ,[nai5]
      ,[tun5]
      ,[kur6]
      ,[osa6]
      ,[nai6]
      ,[tun6]
      ,[kur7]
      ,[osa7]
      ,[nai7]
      ,[kur8]
      ,[osa8]
      ,[nai8]
      ,[kur9]
      ,[osa9]
      ,[nai9]
      ,[kur10]
      ,[osa10]
      ,[nai10]
      ,[kur11]
      ,[osa11]
      ,[nai11]
      ,[kur12]
      ,[osa12]
      ,[nai12]
      ,[kur13]
      ,[osa13]
      ,[nai13]
      ,[kur14]
      ,[osa14]
      ,[nai14]
      ,[kurd]
      ,[osad]
      ,[naid]
      ,[E11]
      ,[E12]
      ,[E13]
      ,[E14]
      ,[E15]
      ,[E16]
      ,[E17]
      ,[E18]
      ,[E19]
      ,[E21]
      ,[E22]
      ,[E23]
      ,[E24]
      ,[E25]
      ,[E26]
      ,[E27]
      ,[E28]
      ,[E29]
      ,[E31]
      ,[E32]
      ,[E33]
      ,[E34]
      ,[E35]
      ,[E36]
      ,[E37]
      ,[E38]
      ,[E39]
      ,[E41]
      ,[E42]
      ,[E43]
      ,[E44]
      ,[E45]
      ,[E46]
      ,[E47]
      ,[E48]
      ,[E49]
      ,[E51]
      ,[E52]
      ,[E53]
      ,[E54]
      ,[E55]
      ,[E56]
      ,[E57]
      ,[E58]
      ,[E59]
      ,[E61]
      ,[E62]
      ,[E63]
      ,[E64]
      ,[E65]
      ,[E66]
      ,[E67]
      ,[E68]
      ,[E69]
      ,[E71]
      ,[E72]
      ,[E73]
      ,[E74]
      ,[E75]
      ,[E76]
      ,[E77]
      ,[E78]
      ,[E79]
      ,[E81]
      ,[E82]
      ,[E83]
      ,[E84]
      ,[E85]
      ,[E86]
      ,[E87]
      ,[E88]
      ,[E89]
      ,[E91]
      ,[E92]
      ,[E93]
      ,[E94]
      ,[E95]
      ,[E96]
      ,[E97]
      ,[E98]
      ,[E99]
      ,[E101]
      ,[E102]
      ,[E103]
      ,[E104]
      ,[E105]
      ,[E106]
      ,[E107]
      ,[E108]
      ,[E109]
      ,[E111]
      ,[E112]
      ,[E113]
      ,[E114]
      ,[E115]
      ,[E116]
      ,[E117]
      ,[E118]
      ,[E119]
      ,[E121]
      ,[E122]
      ,[E123]
      ,[E124]
      ,[E125]
      ,[E126]
      ,[E127]
      ,[E128]
      ,[E129]
      ,[E131]
      ,[E132]
      ,[E133]
      ,[E134]
      ,[E135]
      ,[E136]
      ,[E137]
      ,[E138]
      ,[E139]
      ,[E141]
      ,[E142]
      ,[E143]
      ,[E144]
      ,[E145]
      ,[E146]
      ,[E147]
      ,[E148]
      ,[E149]
      ,[E151]
      ,[E152]
      ,[E153]
      ,[E154]
      ,[E155]
      ,[E156]
      ,[E157]
      ,[E158]
      ,[E159]
      ,[E161]
      ,[E162]
      ,[E163]
      ,[E164]
      ,[E165]
      ,[E166]
      ,[E167]
      ,[E168]
      ,[E169]
      ,[E171]
      ,[E172]
      ,[E173]
      ,[E174]
      ,[E175]
      ,[E176]
      ,[E177]
      ,[E178]
      ,[E179]
      ,[E181]
      ,[E182]
      ,[E183]
      ,[E184]
      ,[E185]
      ,[E186]
      ,[E187]
      ,[E188]
      ,[E189]
      ,[E191]
      ,[E192]
      ,[E193]
      ,[E194]
      ,[E195]
      ,[E196]
      ,[E197]
      ,[E198]
      ,[E199]
      ,[E201]
      ,[E202]
      ,[E203]
      ,[E204]
      ,[E205]
      ,[E206]
      ,[E207]
      ,[E208]
      ,[E209]
      ,[E211]
      ,[E212]
      ,[E213]
      ,[E214]
      ,[E215]
      ,[E216]
      ,[E217]
      ,[E218]
      ,[E219]
      ,[E221]
      ,[E222]
      ,[E223]
      ,[E224]
      ,[E225]
      ,[E226]
      ,[E227]
      ,[E228]
      ,[E229]
      ,[E231]
      ,[E232]
      ,[E233]
      ,[E234]
      ,[E235]
      ,[E236]
      ,[E237]
      ,[E238]
      ,[E239]
      ,[E241]
      ,[E242]
      ,[E243]
      ,[E244]
      ,[E245]
      ,[E246]
      ,[E247]
      ,[E248]
      ,[E249]
      ,[E251]
      ,[E252]
      ,[E253]
      ,[E254]
      ,[E255]
      ,[E256]
      ,[E257]
      ,[E258]
      ,[E259]
      ,[E261]
      ,[E262]
      ,[E263]
      ,[E264]
      ,[E265]
      ,[E266]
      ,[E267]
      ,[E268]
      ,[E269]
      ,[E271]
      ,[E272]
      ,[E273]
      ,[E274]
      ,[E275]
      ,[E276]
      ,[E277]
      ,[E278]
      ,[E279]
      ,[E281]
      ,[E282]
      ,[E283]
      ,[E284]
      ,[E285]
      ,[E286]
      ,[E287]
      ,[E288]
      ,[E289]
      ,[E291]
      ,[E292]
      ,[E293]
      ,[E294]
      ,[E295]
      ,[E296]
      ,[E297]
      ,[E298]
      ,[E299]
      ,[E301]
      ,[E302]
      ,[E303]
      ,[E304]
      ,[E305]
      ,[E306]
      ,[E307]
      ,[E308]
      ,[E309]
      ,[E311]
      ,[E312]
      ,[E313]
      ,[E314]
      ,[E315]
      ,[E316]
      ,[E317]
      ,[E318]
      ,[E319]
      ,[E321]
      ,[E322]
      ,[E323]
      ,[E324]
      ,[E325]
      ,[E326]
      ,[E327]
      ,[E328]
      ,[E329]
      ,[E331]
      ,[E332]
      ,[E333]
      ,[E334]
      ,[E335]
      ,[E336]
      ,[E337]
      ,[E338]
      ,[E339]
      ,[E341]
      ,[E342]
      ,[E343]
      ,[E344]
      ,[E345]
      ,[E346]
      ,[E347]
      ,[E348]
      ,[E349]
      ,[E351]
      ,[E352]
      ,[E353]
      ,[E354]
      ,[E355]
      ,[E356]
      ,[E357]
      ,[E358]
      ,[E359]
      ,[E361]
      ,[E362]
      ,[E363]
      ,[E364]
      ,[E365]
      ,[E366]
      ,[E367]
      ,[E368]
      ,[E369]
      ,[E371]
      ,[E372]
      ,[E373]
      ,[E374]
      ,[E375]
      ,[E376]
      ,[E377]
      ,[E378]
      ,[E379]
      ,[E381]
      ,[E382]
      ,[E383]
      ,[E384]
      ,[E385]
      ,[E386]
      ,[E387]
      ,[E388]
      ,[E389]
      ,[E391]
      ,[E392]
      ,[E393]
      ,[E394]
      ,[E395]
      ,[E396]
      ,[E397]
      ,[E398]
      ,[E399]
      ,[E401]
      ,[E402]
      ,[E403]
      ,[E404]
      ,[E405]
      ,[E406]
      ,[E407]
      ,[E408]
      ,[E409]
      ,[E411]
      ,[E412]
      ,[E413]
      ,[E414]
      ,[E415]
      ,[E416]
      ,[E417]
      ,[E418]
      ,[E419]
      ,[E421]
      ,[E422]
      ,[E423]
      ,[E424]
      ,[E425]
      ,[E426]
      ,[E427]
      ,[E428]
      ,[E429]
      ,[E431]
      ,[E432]
      ,[E433]
      ,[E434]
      ,[E435]
      ,[E436]
      ,[E437]
      ,[E438]
      ,[E439]
      ,[E441]
      ,[E442]
      ,[E443]
      ,[E444]
      ,[E445]
      ,[E446]
      ,[E447]
      ,[E448]
      ,[E449]
      ,[E451]
      ,[E452]
      ,[E453]
      ,[E454]
      ,[E455]
      ,[E456]
      ,[E457]
      ,[E458]
      ,[E459]
      ,[E461]
      ,[E462]
      ,[E463]
      ,[E464]
      ,[E465]
      ,[E466]
      ,[E467]
      ,[E468]
      ,[E469]
      ,[E471]
      ,[E472]
      ,[E473]
      ,[E474]
      ,[E475]
      ,[E476]
      ,[E477]
      ,[E478]
      ,[E479]
      ,[E481]
      ,[E482]
      ,[E483]
      ,[E484]
      ,[E485]
      ,[E486]
      ,[E487]
      ,[E488]
      ,[E489]
      ,[E491]
      ,[E492]
      ,[E493]
      ,[E494]
      ,[E495]
      ,[E496]
      ,[E497]
      ,[E498]
      ,[E499]
      ,[E501]
      ,[E502]
      ,[E503]
      ,[E504]
      ,[E505]
      ,[E506]
      ,[E507]
      ,[E508]
      ,[E509]
      ,[E511]
      ,[E512]
      ,[E513]
      ,[E514]
      ,[E515]
      ,[E516]
      ,[E517]
      ,[E518]
      ,[E519]
      ,[E521]
      ,[E522]
      ,[E523]
      ,[E524]
      ,[E525]
      ,[E526]
      ,[E527]
      ,[E528]
      ,[E529]
      ,[E531]
      ,[E532]
      ,[E533]
      ,[E534]
      ,[E535]
      ,[E536]
      ,[E537]
      ,[E538]
      ,[E539]
      ,[E541]
      ,[E542]
      ,[E543]
      ,[E544]
      ,[E545]
      ,[E546]
      ,[E547]
      ,[E548]
      ,[E549]
      ,[E551]
      ,[E552]
      ,[E553]
      ,[E554]
      ,[E555]
      ,[E556]
      ,[E557]
      ,[E558]
      ,[E559]
      ,[E561]
      ,[E562]
      ,[E563]
      ,[E564]
      ,[E565]
      ,[E566]
      ,[E567]
      ,[E568]
      ,[E569]
      ,[E571]
      ,[E572]
      ,[E573]
      ,[E574]
      ,[E575]
      ,[E576]
      ,[E577]
      ,[E578]
      ,[E579]
      ,[E581]
      ,[E582]
      ,[E583]
      ,[E584]
      ,[E585]
      ,[E586]
      ,[E587]
      ,[E588]
      ,[E589]
      ,[E591]
      ,[E592]
      ,[E593]
      ,[E594]
      ,[E595]
      ,[E596]
      ,[E597]
      ,[E598]
      ,[E599]
      ,[E601]
      ,[E602]
      ,[E603]
      ,[E604]
      ,[E605]
      ,[E606]
      ,[E607]
      ,[E608]
      ,[E609]
      ,[E611]
      ,[E612]
      ,[E613]
      ,[E614]
      ,[E615]
      ,[E616]
      ,[E617]
      ,[E618]
      ,[E619]
      ,[E621]
      ,[E622]
      ,[E623]
      ,[E624]
      ,[E625]
      ,[E626]
      ,[E627]
      ,[E628]
      ,[E629]
      ,[E631]
      ,[E632]
      ,[E633]
      ,[E634]
      ,[E635]
      ,[E636]
      ,[E637]
      ,[E638]
      ,[E639]
      ,[E641]
      ,[E642]
      ,[E643]
      ,[E644]
      ,[E645]
      ,[E646]
      ,[E647]
      ,[E648]
      ,[E649]
      ,[E651]
      ,[E652]
      ,[E653]
      ,[E654]
      ,[E655]
      ,[E656]
      ,[E657]
      ,[E658]
      ,[E659]
      ,[E661]
      ,[E662]
      ,[E663]
      ,[E664]
      ,[E665]
      ,[E666]
      ,[E667]
      ,[E668]
      ,[E669]
      ,[E671]
      ,[E672]
      ,[E673]
      ,[E674]
      ,[E675]
      ,[E676]
      ,[E677]
      ,[E678]
      ,[E679]
      ,[E681]
      ,[E682]
      ,[E683]
      ,[E684]
      ,[E685]
      ,[E686]
      ,[E687]
      ,[E688]
      ,[E689]
      ,[E691]
      ,[E692]
      ,[E693]
      ,[E694]
      ,[E695]
      ,[E696]
      ,[E697]
      ,[E698]
      ,[E699]
      ,[E701]
      ,[E702]
      ,[E703]
      ,[E704]
      ,[E705]
      ,[E706]
      ,[E707]
      ,[E708]
      ,[E709]
      ,[E711]
      ,[E712]
      ,[E713]
      ,[E714]
      ,[E715]
      ,[E716]
      ,[E717]
      ,[E718]
      ,[E719]
      ,[E721]
      ,[E722]
      ,[E723]
      ,[E724]
      ,[E725]
      ,[E726]
      ,[E727]
      ,[E728]
      ,[E729]
      ,[E731]
      ,[E732]
      ,[E733]
      ,[E734]
      ,[E735]
      ,[E736]
      ,[E737]
      ,[E738]
      ,[E739]
      ,[E741]
      ,[E742]
      ,[E743]
      ,[E744]
      ,[E745]
      ,[E746]
      ,[E747]
      ,[E748]
      ,[E749]
      ,[E751]
      ,[E752]
      ,[E753]
      ,[E754]
      ,[E755]
      ,[E756]
      ,[E757]
      ,[E758]
      ,[E759]
      ,[E1]
      ,[E2]
      ,[E3]
      ,[E4]
      ,[E5]
      ,[E6]
      ,[E7]
      ,[E8]
      ,[E9]
      ,[osa15]
      ,[nai15]
      ,[osa16]
      ,[nai16]
      ,[tietolahde]
      ,[rivinumero]
from VipunenTK_SA.dbo.v_sa_2_11_Oppilaitosten_tutkintoon_johtamaton
) p
unpivot (mittari_arvo for mittari_nimi in (
	   [osa1]
      ,[suo1]
      ,[osa2]
      ,[suo2]
      ,[osa3]
      ,[suo3]
      ,[kur4]
      ,[osa4]
      ,[nai4]
      ,[tun4]
      ,[kur5]
      ,[osa5]
      ,[nai5]
      ,[tun5]
      ,[kur6]
      ,[osa6]
      ,[nai6]
      ,[tun6]
      ,[kur7]
      ,[osa7]
      ,[nai7]
      ,[kur8]
      ,[osa8]
      ,[nai8]
      ,[kur9]
      ,[osa9]
      ,[nai9]
      ,[kur10]
      ,[osa10]
      ,[nai10]
      ,[kur11]
      ,[osa11]
      ,[nai11]
      ,[kur12]
      ,[osa12]
      ,[nai12]
      ,[kur13]
      ,[osa13]
      ,[nai13]
      ,[kur14]
      ,[osa14]
      ,[nai14]
      ,[kurd]
      ,[osad]
      ,[naid]
      ,[E11]
      ,[E12]
      ,[E13]
      ,[E14]
      ,[E15]
      ,[E16]
      ,[E17]
      ,[E18]
      ,[E19]
      ,[E21]
      ,[E22]
      ,[E23]
      ,[E24]
      ,[E25]
      ,[E26]
      ,[E27]
      ,[E28]
      ,[E29]
      ,[E31]
      ,[E32]
      ,[E33]
      ,[E34]
      ,[E35]
      ,[E36]
      ,[E37]
      ,[E38]
      ,[E39]
      ,[E41]
      ,[E42]
      ,[E43]
      ,[E44]
      ,[E45]
      ,[E46]
      ,[E47]
      ,[E48]
      ,[E49]
      ,[E51]
      ,[E52]
      ,[E53]
      ,[E54]
      ,[E55]
      ,[E56]
      ,[E57]
      ,[E58]
      ,[E59]
      ,[E61]
      ,[E62]
      ,[E63]
      ,[E64]
      ,[E65]
      ,[E66]
      ,[E67]
      ,[E68]
      ,[E69]
      ,[E71]
      ,[E72]
      ,[E73]
      ,[E74]
      ,[E75]
      ,[E76]
      ,[E77]
      ,[E78]
      ,[E79]
      ,[E81]
      ,[E82]
      ,[E83]
      ,[E84]
      ,[E85]
      ,[E86]
      ,[E87]
      ,[E88]
      ,[E89]
      ,[E91]
      ,[E92]
      ,[E93]
      ,[E94]
      ,[E95]
      ,[E96]
      ,[E97]
      ,[E98]
      ,[E99]
      ,[E101]
      ,[E102]
      ,[E103]
      ,[E104]
      ,[E105]
      ,[E106]
      ,[E107]
      ,[E108]
      ,[E109]
      ,[E111]
      ,[E112]
      ,[E113]
      ,[E114]
      ,[E115]
      ,[E116]
      ,[E117]
      ,[E118]
      ,[E119]
      ,[E121]
      ,[E122]
      ,[E123]
      ,[E124]
      ,[E125]
      ,[E126]
      ,[E127]
      ,[E128]
      ,[E129]
      ,[E131]
      ,[E132]
      ,[E133]
      ,[E134]
      ,[E135]
      ,[E136]
      ,[E137]
      ,[E138]
      ,[E139]
      ,[E141]
      ,[E142]
      ,[E143]
      ,[E144]
      ,[E145]
      ,[E146]
      ,[E147]
      ,[E148]
      ,[E149]
      ,[E151]
      ,[E152]
      ,[E153]
      ,[E154]
      ,[E155]
      ,[E156]
      ,[E157]
      ,[E158]
      ,[E159]
      ,[E161]
      ,[E162]
      ,[E163]
      ,[E164]
      ,[E165]
      ,[E166]
      ,[E167]
      ,[E168]
      ,[E169]
      ,[E171]
      ,[E172]
      ,[E173]
      ,[E174]
      ,[E175]
      ,[E176]
      ,[E177]
      ,[E178]
      ,[E179]
      ,[E181]
      ,[E182]
      ,[E183]
      ,[E184]
      ,[E185]
      ,[E186]
      ,[E187]
      ,[E188]
      ,[E189]
      ,[E191]
      ,[E192]
      ,[E193]
      ,[E194]
      ,[E195]
      ,[E196]
      ,[E197]
      ,[E198]
      ,[E199]
      ,[E201]
      ,[E202]
      ,[E203]
      ,[E204]
      ,[E205]
      ,[E206]
      ,[E207]
      ,[E208]
      ,[E209]
      ,[E211]
      ,[E212]
      ,[E213]
      ,[E214]
      ,[E215]
      ,[E216]
      ,[E217]
      ,[E218]
      ,[E219]
      ,[E221]
      ,[E222]
      ,[E223]
      ,[E224]
      ,[E225]
      ,[E226]
      ,[E227]
      ,[E228]
      ,[E229]
      ,[E231]
      ,[E232]
      ,[E233]
      ,[E234]
      ,[E235]
      ,[E236]
      ,[E237]
      ,[E238]
      ,[E239]
      ,[E241]
      ,[E242]
      ,[E243]
      ,[E244]
      ,[E245]
      ,[E246]
      ,[E247]
      ,[E248]
      ,[E249]
      ,[E251]
      ,[E252]
      ,[E253]
      ,[E254]
      ,[E255]
      ,[E256]
      ,[E257]
      ,[E258]
      ,[E259]
      ,[E261]
      ,[E262]
      ,[E263]
      ,[E264]
      ,[E265]
      ,[E266]
      ,[E267]
      ,[E268]
      ,[E269]
      ,[E271]
      ,[E272]
      ,[E273]
      ,[E274]
      ,[E275]
      ,[E276]
      ,[E277]
      ,[E278]
      ,[E279]
      ,[E281]
      ,[E282]
      ,[E283]
      ,[E284]
      ,[E285]
      ,[E286]
      ,[E287]
      ,[E288]
      ,[E289]
      ,[E291]
      ,[E292]
      ,[E293]
      ,[E294]
      ,[E295]
      ,[E296]
      ,[E297]
      ,[E298]
      ,[E299]
      ,[E301]
      ,[E302]
      ,[E303]
      ,[E304]
      ,[E305]
      ,[E306]
      ,[E307]
      ,[E308]
      ,[E309]
      ,[E311]
      ,[E312]
      ,[E313]
      ,[E314]
      ,[E315]
      ,[E316]
      ,[E317]
      ,[E318]
      ,[E319]
      ,[E321]
      ,[E322]
      ,[E323]
      ,[E324]
      ,[E325]
      ,[E326]
      ,[E327]
      ,[E328]
      ,[E329]
      ,[E331]
      ,[E332]
      ,[E333]
      ,[E334]
      ,[E335]
      ,[E336]
      ,[E337]
      ,[E338]
      ,[E339]
      ,[E341]
      ,[E342]
      ,[E343]
      ,[E344]
      ,[E345]
      ,[E346]
      ,[E347]
      ,[E348]
      ,[E349]
      ,[E351]
      ,[E352]
      ,[E353]
      ,[E354]
      ,[E355]
      ,[E356]
      ,[E357]
      ,[E358]
      ,[E359]
      ,[E361]
      ,[E362]
      ,[E363]
      ,[E364]
      ,[E365]
      ,[E366]
      ,[E367]
      ,[E368]
      ,[E369]
      ,[E371]
      ,[E372]
      ,[E373]
      ,[E374]
      ,[E375]
      ,[E376]
      ,[E377]
      ,[E378]
      ,[E379]
      ,[E381]
      ,[E382]
      ,[E383]
      ,[E384]
      ,[E385]
      ,[E386]
      ,[E387]
      ,[E388]
      ,[E389]
      ,[E391]
      ,[E392]
      ,[E393]
      ,[E394]
      ,[E395]
      ,[E396]
      ,[E397]
      ,[E398]
      ,[E399]
      ,[E401]
      ,[E402]
      ,[E403]
      ,[E404]
      ,[E405]
      ,[E406]
      ,[E407]
      ,[E408]
      ,[E409]
      ,[E411]
      ,[E412]
      ,[E413]
      ,[E414]
      ,[E415]
      ,[E416]
      ,[E417]
      ,[E418]
      ,[E419]
      ,[E421]
      ,[E422]
      ,[E423]
      ,[E424]
      ,[E425]
      ,[E426]
      ,[E427]
      ,[E428]
      ,[E429]
      ,[E431]
      ,[E432]
      ,[E433]
      ,[E434]
      ,[E435]
      ,[E436]
      ,[E437]
      ,[E438]
      ,[E439]
      ,[E441]
      ,[E442]
      ,[E443]
      ,[E444]
      ,[E445]
      ,[E446]
      ,[E447]
      ,[E448]
      ,[E449]
      ,[E451]
      ,[E452]
      ,[E453]
      ,[E454]
      ,[E455]
      ,[E456]
      ,[E457]
      ,[E458]
      ,[E459]
      ,[E461]
      ,[E462]
      ,[E463]
      ,[E464]
      ,[E465]
      ,[E466]
      ,[E467]
      ,[E468]
      ,[E469]
      ,[E471]
      ,[E472]
      ,[E473]
      ,[E474]
      ,[E475]
      ,[E476]
      ,[E477]
      ,[E478]
      ,[E479]
      ,[E481]
      ,[E482]
      ,[E483]
      ,[E484]
      ,[E485]
      ,[E486]
      ,[E487]
      ,[E488]
      ,[E489]
      ,[E491]
      ,[E492]
      ,[E493]
      ,[E494]
      ,[E495]
      ,[E496]
      ,[E497]
      ,[E498]
      ,[E499]
      ,[E501]
      ,[E502]
      ,[E503]
      ,[E504]
      ,[E505]
      ,[E506]
      ,[E507]
      ,[E508]
      ,[E509]
      ,[E511]
      ,[E512]
      ,[E513]
      ,[E514]
      ,[E515]
      ,[E516]
      ,[E517]
      ,[E518]
      ,[E519]
      ,[E521]
      ,[E522]
      ,[E523]
      ,[E524]
      ,[E525]
      ,[E526]
      ,[E527]
      ,[E528]
      ,[E529]
      ,[E531]
      ,[E532]
      ,[E533]
      ,[E534]
      ,[E535]
      ,[E536]
      ,[E537]
      ,[E538]
      ,[E539]
      ,[E541]
      ,[E542]
      ,[E543]
      ,[E544]
      ,[E545]
      ,[E546]
      ,[E547]
      ,[E548]
      ,[E549]
      ,[E551]
      ,[E552]
      ,[E553]
      ,[E554]
      ,[E555]
      ,[E556]
      ,[E557]
      ,[E558]
      ,[E559]
      ,[E561]
      ,[E562]
      ,[E563]
      ,[E564]
      ,[E565]
      ,[E566]
      ,[E567]
      ,[E568]
      ,[E569]
      ,[E571]
      ,[E572]
      ,[E573]
      ,[E574]
      ,[E575]
      ,[E576]
      ,[E577]
      ,[E578]
      ,[E579]
      ,[E581]
      ,[E582]
      ,[E583]
      ,[E584]
      ,[E585]
      ,[E586]
      ,[E587]
      ,[E588]
      ,[E589]
      ,[E591]
      ,[E592]
      ,[E593]
      ,[E594]
      ,[E595]
      ,[E596]
      ,[E597]
      ,[E598]
      ,[E599]
      ,[E601]
      ,[E602]
      ,[E603]
      ,[E604]
      ,[E605]
      ,[E606]
      ,[E607]
      ,[E608]
      ,[E609]
      ,[E611]
      ,[E612]
      ,[E613]
      ,[E614]
      ,[E615]
      ,[E616]
      ,[E617]
      ,[E618]
      ,[E619]
      ,[E621]
      ,[E622]
      ,[E623]
      ,[E624]
      ,[E625]
      ,[E626]
      ,[E627]
      ,[E628]
      ,[E629]
      ,[E631]
      ,[E632]
      ,[E633]
      ,[E634]
      ,[E635]
      ,[E636]
      ,[E637]
      ,[E638]
      ,[E639]
      ,[E641]
      ,[E642]
      ,[E643]
      ,[E644]
      ,[E645]
      ,[E646]
      ,[E647]
      ,[E648]
      ,[E649]
      ,[E651]
      ,[E652]
      ,[E653]
      ,[E654]
      ,[E655]
      ,[E656]
      ,[E657]
      ,[E658]
      ,[E659]
      ,[E661]
      ,[E662]
      ,[E663]
      ,[E664]
      ,[E665]
      ,[E666]
      ,[E667]
      ,[E668]
      ,[E669]
      ,[E671]
      ,[E672]
      ,[E673]
      ,[E674]
      ,[E675]
      ,[E676]
      ,[E677]
      ,[E678]
      ,[E679]
      ,[E681]
      ,[E682]
      ,[E683]
      ,[E684]
      ,[E685]
      ,[E686]
      ,[E687]
      ,[E688]
      ,[E689]
      ,[E691]
      ,[E692]
      ,[E693]
      ,[E694]
      ,[E695]
      ,[E696]
      ,[E697]
      ,[E698]
      ,[E699]
      ,[E701]
      ,[E702]
      ,[E703]
      ,[E704]
      ,[E705]
      ,[E706]
      ,[E707]
      ,[E708]
      ,[E709]
      ,[E711]
      ,[E712]
      ,[E713]
      ,[E714]
      ,[E715]
      ,[E716]
      ,[E717]
      ,[E718]
      ,[E719]
      ,[E721]
      ,[E722]
      ,[E723]
      ,[E724]
      ,[E725]
      ,[E726]
      ,[E727]
      ,[E728]
      ,[E729]
      ,[E731]
      ,[E732]
      ,[E733]
      ,[E734]
      ,[E735]
      ,[E736]
      ,[E737]
      ,[E738]
      ,[E739]
      ,[E741]
      ,[E742]
      ,[E743]
      ,[E744]
      ,[E745]
      ,[E746]
      ,[E747]
      ,[E748]
      ,[E749]
      ,[E751]
      ,[E752]
      ,[E753]
      ,[E754]
      ,[E755]
      ,[E756]
      ,[E757]
      ,[E758]
      ,[E759]
      ,[E1]
      ,[E2]
      ,[E3]
      ,[E4]
      ,[E5]
      ,[E6]
      ,[E7]
      ,[E8]
      ,[E9]
      ,[osa15]
      ,[nai15]
      ,[osa16]
      ,[nai16]
) ) unpvt
where mittari_arvo <> '''' and cast(mittari_arvo as int) <> 0
' 
GO
/****** Object:  View [dbo].[v_f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan] AS

-- drop table f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan
-- select * into dbo.f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan from v_f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan

-- truncate table f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan
-- insert into f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan select * from v_f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan

SELECT
	 tilastointivuosi = tilv
	,tilv_date = CAST(tilv+''0101'' as date)
    ,lahde = Cast([lahde] as nvarchar(10))
    ,koulutusluokitus = Cast([koulk] as nvarchar(6))
    ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = Cast(Case when [tutktav]=''9'' then ''-1'' when ltrim([tutktav])='''' then ''-1'' else [tutktav] end as nvarchar(2))
    ,ammatillisen_koulutuksen_koulutuslaji = Cast(Case when [tutklaja]=''9'' then ''-1'' when ltrim([tutklaja])='''' then ''-1'' else [tutklaja] end as nvarchar(2))
    ,opetushallinnon_koulutus = Cast(Case when [ophal]=''9'' then ''-1'' when ltrim([ophal])='''' then ''-1'' else [ophal] end as nvarchar(2))
    ,koulutuksen_opetuskieli = Cast(Case when ltrim([kkieli])='''' then ''-1'' else [kkieli] end as nvarchar(10))
    ,nuorten_aikuisten_koulutus_amm = Cast(Case when [aikoul]=''9'' then ''-1'' when ltrim([aikoul])='''' then ''-1'' else [aikoul] end as nvarchar(2))
    ,koulutuksen_sijaintimaakunta = Cast(Case when left([kmaak],1)=''9'' then ''-1'' when ltrim([kmaak])='''' then ''-1'' else [kmaak] end as nvarchar(2))
    ,sukupuoli = Cast(Case when [sp]=''9'' then ''-1'' when ltrim([sp])='''' then ''-1'' else [sp] end as nvarchar(2))
    ,aikuisopiskelija = Cast(Case when [aiopis]=''9'' then ''-1'' when ltrim([aiopis])='''' then ''-1'' else Cast(Cast([aiopis] as int) as nvarchar(2)) end as nvarchar(2))
    ,koulutuksen_aloittamislukuvuosi = Cast([alvv] as nvarchar(4))
    ,koulutuksen_aloittamislukukausi = Cast([allk] as nvarchar(1))
    ,kirjoillaolo_tammikuu = Cast(Case when [olotamm]=''9'' then ''-1'' when ltrim([olotamm])='''' then ''-1'' else [olotamm] end as nvarchar(10))
    ,kirjoillaolo_syyskuu = Cast(Case when [olosyys]=''9'' then ''-1'' when ltrim([olosyys])='''' then ''-1'' else [olosyys] end as nvarchar(10))
    ,kotikunnan_kuntaryhma = Cast(Case when [tilvaskunryh]=''9'' then ''-1'' when ltrim([tilvaskunryh])='''' then ''-1'' else [tilvaskunryh] end as nvarchar(2))
    ,koulutusryhma_koulutuslaji3 = Cast(Case when [klajir2]=''9'' then ''-1'' when ltrim([klajir2])='''' then ''-1'' else [klajir2] end as nvarchar(2))
    ,kansalaisuus_maa = Cast(Case when left([kansal],1)=''9'' then ''-1'' when ltrim([kansal])='''' then ''-1'' else [kansal] end as nvarchar(3))
--Johdetut muuttujat
	--,kansalaisuus_versio1 = Cast(Case when left([kansal],1)=''9'' then ''-1'' when ltrim([kansal])='''' then ''-1'' when [kansal] in (''246'', ''248'') then ''1'' else ''2'' end as nvarchar(2))
	-- Listataan tuntemattomat muiksi / CSC Jarmo 31.7.2015
	,kansalaisuus_versio1 = Cast(Case when [kansal] in (''246'', ''248'') then ''1'' else ''2'' end as nvarchar(2))
	,koulutussektori = Cast(Case when left([lahde],1)=''9'' then ''-1'' when ltrim([lahde])='''' then ''-1''
		 when [lahde] = ''21'' then ''2'' 
		 when [lahde] in (''31'', ''33'', ''34'', ''35'') then ''3'' 
		 when [lahde] = ''41'' then ''4'' 
		 when [lahde] = ''51'' then ''5'' 
		 else ''-2'' end as nvarchar(2))
	/*,hallinnonala2 = Cast(
	case
		when ophal=1 then ''1''
		when ophal=2 and not (kmaak=21 or kl.koulutusala2002=''Muu koulutus'') then ''2''
		when ophal=2 then ''3''
		else ''-1'' 
	end 
	as nvarchar(2))*/
--Mittarit
    ,opiskelijoiden_lkm = [lkm]
--  ,[luontipvm]
-- aineistotiedot
	,tietolahde = tietolahde
	,rivinumero = rivinumero
FROM VipunenTK_DW.dbo.sa_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan dw
--left join VipunenTK.dbo.d_koulutusluokitus kl  on kl.koulutus_koodi=dw.koulk






' 
GO
/****** Object:  View [dbo].[v_f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan] AS

-- drop table f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan
-- select * into dbo.f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan from v_f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan

-- truncate table f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan
-- insert into f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan select * from v_f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan

SELECT
	 tilastointivuosi = tilv
	,tilv_date = CAST(tilv+''0101'' as date)
    ,lahde = Cast([lahde] as nvarchar(10))
    ,koulutusluokitus = Cast([koulk] as nvarchar(6))
    ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = Cast(Case when [tutktav]=''9'' then ''-1'' when ltrim([tutktav])='''' then ''-1'' else [tutktav] end as nvarchar(2))
    ,ammatillisen_koulutuksen_koulutuslaji = Cast(Case when [tutklaja]=''9'' then ''-1'' when ltrim([tutklaja])='''' then ''-1'' else [tutklaja] end as nvarchar(2))
    ,opetushallinnon_koulutus = Cast(Case when [ophal]=''9'' then ''-1'' when ltrim([ophal])='''' then ''-1'' else [ophal] end as nvarchar(2))
    ,koulutuksen_opetuskieli = Cast(Case when ltrim([kkieli])='''' then ''-1'' else [kkieli] end as nvarchar(10))
    ,nuorten_aikuisten_koulutus_amm = Cast(Case when [aikoul]=''9'' then ''-1'' when ltrim([aikoul])='''' then ''-1'' else [aikoul] end as nvarchar(2))
    ,koulutuksen_sijaintimaakunta = Cast(Case when left([kmaak],1)=''9'' then ''-1'' when ltrim([kmaak])='''' then ''-1'' else [kmaak] end as nvarchar(2))
    ,sukupuoli = Cast(Case when [sp]=''9'' then ''-1'' when ltrim([sp])='''' then ''-1'' else [sp] end as nvarchar(2))
    ,aikuisopiskelija = Cast(Case when [aiopis]=''9'' then ''-1'' when ltrim([aiopis])='''' then ''-1'' else Cast(Cast([aiopis] as int) as nvarchar(2)) end as nvarchar(2))
    ,koulutuksen_aloittamislukuvuosi = Cast([alvv] as nvarchar(4))
    ,koulutuksen_aloittamislukukausi = Cast([allk] as nvarchar(1))
    ,kirjoillaolo_tammikuu = Cast(Case when [olotamm]=''9'' then ''-1'' when ltrim([olotamm])='''' then ''-1'' else [olotamm] end as nvarchar(10))
    ,kirjoillaolo_syyskuu = Cast(Case when [olosyys]=''9'' then ''-1'' when ltrim([olosyys])='''' then ''-1'' else [olosyys] end as nvarchar(10))
    ,kotikunnan_kuntaryhma = Cast(Case when [tilvaskunryh]=''9'' then ''-1'' when ltrim([tilvaskunryh])='''' then ''-1'' else [tilvaskunryh] end as nvarchar(2))
    ,koulutusryhma_koulutuslaji3 = Cast(Case when [klajir2]=''9'' then ''-1'' when ltrim([klajir2])='''' then ''-1'' else [klajir2] end as nvarchar(2))
    ,syntymavaltio_maa = Cast(Case when left([svalt],1)=''9'' then ''-1'' when ltrim([svalt])='''' then ''-1'' else [svalt] end as nvarchar(3))
--Johdetut muuttujat
	--,syntymavaltio_kansalaisuus_versio1 = Cast(Case when left([svalt],1)=''9'' then ''-1'' when ltrim([svalt])='''' then ''-1'' when svalt in (''246'', ''248'') then ''1'' else ''2'' end as nvarchar(2))
	-- Listataan tuntemattomat muiksi / CSC Jarmo 31.7.2015
	,syntymavaltio_kansalaisuus_versio1 = Cast(Case when svalt in (''246'', ''248'') then ''1'' else ''2'' end as nvarchar(2))
	,koulutussektori = Cast(Case when left([lahde],1)=''9'' then ''-1'' when ltrim([lahde])='''' then ''-1''
		 when [lahde] = ''21'' then ''2'' 
		 when [lahde] in (''31'', ''33'', ''34'', ''35'') then ''3'' 
		 when [lahde] = ''41'' then ''4'' 
		 when [lahde] = ''51'' then ''5'' 
		 else ''-2'' end as nvarchar(2))
--Mittarit
    ,opiskelijoiden_lkm = [lkm]
--  ,[luontipvm]
-- aineistotiedot
	,tietolahde = tietolahde
	,rivinumero = rivinumero
FROM VipunenTK_DW.dbo.sa_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan




' 
GO
/****** Object:  View [dbo].[v_f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan] AS

-- drop table f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan
-- select * into dbo.f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan from v_f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan

-- truncate table f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan
-- insert into f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan select * from v_f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan

SELECT
	 tilastointivuosi = tilv
	,tilv_date = CAST(tilv+''0101'' as date)
    ,lahde = Cast([lahde] as nvarchar(10))
    ,koulutusluokitus = Cast([koulk] as nvarchar(6))
    ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = Cast(Case when [tutktav]=''9'' then ''-1'' when ltrim([tutktav])='''' then ''-1'' else [tutktav] end as nvarchar(2))
    ,ammatillisen_koulutuksen_koulutuslaji = Cast(Case when [tutklaja]=''9'' then ''-1'' when ltrim([tutklaja])='''' then ''-1'' else [tutklaja] end as nvarchar(2))
    ,opetushallinnon_koulutus = Cast(Case when [ophal]=''9'' then ''-1'' when ltrim([ophal])='''' then ''-1'' else [ophal] end as nvarchar(2))
    ,koulutuksen_opetuskieli = Cast(Case when ltrim([kkieli])='''' then ''-1'' else [kkieli] end as nvarchar(10))
    ,nuorten_aikuisten_koulutus_amm = Cast(Case when [aikoul]=''9'' then ''-1'' when ltrim([aikoul])='''' then ''-1'' else [aikoul] end as nvarchar(2))
    ,koulutuksen_sijaintimaakunta = Cast(Case when left([kmaak],1)=''9'' then ''-1'' when ltrim([kmaak])='''' then ''-1'' else [kmaak] end as nvarchar(2))
    ,sukupuoli = Cast(Case when [sp]=''9'' then ''-1'' when ltrim([sp])='''' then ''-1'' else [sp] end as nvarchar(2))
    ,aikuisopiskelija = Cast(Case when [aiopis]=''9'' then ''-1'' when ltrim([aiopis])='''' then ''-1'' else Cast(Cast([aiopis] as int) as nvarchar(2)) end as nvarchar(2))
    ,koulutuksen_aloittamislukuvuosi = Cast([alvv] as nvarchar(4))
    ,koulutuksen_aloittamislukukausi = Cast([allk] as nvarchar(1))
    ,kirjoillaolo_tammikuu = Cast(Case when [olotamm]=''9'' then ''-1'' when ltrim([olotamm])='''' then ''-1'' else [olotamm] end as nvarchar(10))
    ,kirjoillaolo_syyskuu = Cast(Case when [olosyys]=''9'' then ''-1'' when ltrim([olosyys])='''' then ''-1'' else [olosyys] end as nvarchar(10))
    ,kotikunnan_kuntaryhma = Cast(Case when [tilvaskunryh]=''9'' then ''-1'' when ltrim([tilvaskunryh])='''' then ''-1'' else [tilvaskunryh] end as nvarchar(2))
    ,koulutusryhma_koulutuslaji3 = Cast(Case when [klajir2]=''9'' then ''-1'' when ltrim([klajir2])='''' then ''-1'' else [klajir2] end as nvarchar(2))
    ,aidinkieli_kieli = Cast(Case when left([aikieli],1)=''9'' then ''-1'' when ltrim([aikieli])='''' then ''-1'' else [aikieli] end as nvarchar(10))
--Johdetut muuttujat
	--,aidinkieli_versio3 = Cast(Case when left([aikieli],1)=''9'' then ''-1'' when ltrim([aikieli])='''' then ''-1'' when [aikieli] in (''fi'', ''se'') then ''fs'' when [aikieli]=''sv'' then ''sv'' else ''99'' end as nvarchar(2))
	-- Listataan tuntemattomat muiksi / CSC Jarmo 31.7.2015
	,aidinkieli_versio3 = Cast(Case when [aikieli] in (''fi'', ''se'') then ''fs'' when [aikieli]=''sv'' then ''sv'' else ''99'' end as nvarchar(2))
	,koulutussektori = Cast(Case when left([lahde],1)=''9'' then ''-1'' when ltrim([lahde])='''' then ''-1''
		 when [lahde] = ''21'' then ''2'' 
		 when [lahde] in (''31'', ''33'', ''34'', ''35'') then ''3'' 
		 when [lahde] = ''41'' then ''4'' 
		 when [lahde] = ''51'' then ''5'' 
		 else ''-2'' end as nvarchar(2))
--Mittarit
    ,opiskelijoiden_lkm = [lkm]
--  ,[luontipvm]
-- aineistotiedot
	,tietolahde = tietolahde
	,rivinumero = rivinumero
FROM VipunenTK_DW.dbo.sa_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan




' 
GO
/****** Object:  View [dbo].[v_f_2_20_Lukio_amm_oppis_opisk_ian_ja_koul_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_20_Lukio_amm_oppis_opisk_ian_ja_koul_mukaan]'))
EXEC dbo.sp_executesql @statement = N'


























CREATE VIEW [dbo].[v_f_2_20_Lukio_amm_oppis_opisk_ian_ja_koul_mukaan] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
      ,lahde = [lahde]
      ,oppilaitoksen_oppilaitostyyppi = CAST(
      (
		case
		when [oltyp] = ''XX'' then ''-1''
		else [oltyp]
		end
	   )
	as nvarchar(10))	
      ,koulutusluokitus = [koulk]
      ,nuorten_aikuisten_koulutus = [aikoul]
      ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = [tutktav]
      ,ammatillisen_koulutuksen_koulutuslaji = [tutklaja]
      ,opetushallinnon_koulutus = [ophal]
      ,koulutuksen_kunta = [kkun]
      ,rahoituslahde = [rahoitus]
      ,sukupuoli = [sp]
      ,aidinkieli_versio1 = [aikielir1]
      ,kirjoihintulovuosi = [alvv]
      ,kirjoihintulokausi = [allk]
      ,opiskelijan_olo_syys = [olosyys]
      ,aikaisempi_yleissivistava_koulutus = [ylsivx]
      ,aikaiksempi_ammpk = [peruskx]
      ,aikaisempi_ammpk_tarkempi= CAST(
      (
		case
		when [peruskx] = ''1'' then ''Aikaisempi ammatillinen peruskoulutus''
		else ''Ei aikaisempaa ammatillista peruskoulutusta''
		end
	   )as nvarchar(100))
	  ,ammpk_pohjakoulutuksen_tila = cast(
		(
		case
        when (peruskx = ''1'' and ((cast(alvv as int) - cast(ammvupe as int) >= 0))) then ''Ammatillinen peruskoulutus suoritettu ennen koulutuksen aloittamista''
        when (peruskx = ''1'' and ((cast(alvv as int) - cast(ammvupe as int) < 0))) then ''Ammatillinen peruskoulutus suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei ammatillista peruskoulutusta''
    end
       )
    as nvarchar(150))
      ,aikaisemman_ammpk_opintoala1995 = [oalapex]
      ,aikaisemman_ammpk_koulutusala1995 = left([oalapex],1)
      ,aikaisemman_ammpk_koulutusaste1995 = [oastepex]
      ,aikaisemman_ammpk_opintoala2002 = [oalapeux]
      ,aikaisemman_ammpk_koulutusala2002 = [oalapeux_koulutusala]
      ,aikaisemman_ammpk_koulutusaste2002 = [oastpeux]
      ,aikaisemman_ammpk_suoritusvuosi = [ammvupe]
      ,aikaisempi_ammpk_nayttotutkintona = [nayttox]
      ,aikaisempi_ammpk_nayttotutkintona_tarkempi= CAST(
      (
		case
		when [nayttox] = ''1'' then ''Aikaisempi ammatillinen peruskoulutus näyttötutkintona''
		else ''Ei aikaisempaa ammatillista peruskoulutusta näyttötutkintona''
		end
	   )as nvarchar(100))
      ,aikaisempi_ammpk_oppisopimuskoulutuksena = [oppispex]
      ,aikaisempi_ammpk_oppisopimuskoulutuksena_tarkempi= CAST(
      (
		case
		when [oppispex] = ''1'' then ''Aikaisempi ammatillinen peruskoulutus oppisopimuskoulutuksena''
		else ''Ei aikaisempaa ammatillista peruskoulutusta oppisopimuskoulutuksena''
		end
	   )as nvarchar(100))
      ,aikaisempi_ammlisa = [lisakx]
      ,aikaisempi_ammlisa_tarkempi= CAST(
      (
		case
		when [lisakx] = ''1'' then ''Aikaisempi ammatillinen lisäkoulutus''
		else ''Ei aikaisempaa ammatillista lisäkoulutusta''
		end
	   )as nvarchar(100))
	  ,ammlisa_pohjakoulutuksen_tila = cast(
		(
		case
        when (lisakx = ''1'' and ((cast(alvv as int) - cast(ammvuli as int) >= 0))) then ''Ammatillinen ammatilline lisäkoulutus suoritettu ennen koulutuksen aloittamista''
        when (lisakx = ''1'' and ((cast(alvv as int) - cast(ammvuli as int) < 0))) then ''Ammatillinen ammattillinen lisäkoulutus suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei ammatillista lisäkoulutusta''
    end
       )
    as nvarchar(150)) 
      ,aikaisemman_ammlisa_opintoala1995 = [oalalix]
      ,aikaisemman_ammlisa_koulutusala1995 = left([oalalix],1)
      ,aikaisemman_ammlisa_koulutusaste1995 = [oastelix]
      ,aikaisemman_ammlisa_opintoala2002 = [oalaliux]
      ,aikaisemman_ammlisa_koulutusala2002 = [oalaliux_koulutusala]
      ,aikaisemman_ammlsia_koulutusaste2002 = [oastliux]
      ,aikaisemman_ammlisa_suoritusvuosi = [ammvuli]
      ,aikaisempi_ammlisa_oppisopimuskoulutuksena = [oppislix]
      ,aikaisempi_ammlisa_oppisopimuskoulutuksena_tarkempi= CAST(
      (
		case
		when [oppislix] = ''1'' then ''Aikaisempi ammatillinen lisäkoulutus oppisopimuskoulutuksena''
		else ''Ei aikaisempaa ammatillista lisäkoulutusta oppisopimuskoulutuksena''
		end
	   )as nvarchar(100))
      ,aikaisempi_alempi_kk = [alempikax]
      ,aikaisempi_alempi_kk_tarkempi= CAST(
      (
		case
		when [alempikax] = ''1'' then ''Aikaisempi alemman korkeakouluasteen tai ammatillisen korkea-asteen koulutus''
		else ''Ei aikaisempaa alemman korkeakouluasteen tai ammatillisen korkea-asteen koulutusta''
		end
	   )as nvarchar(100))
	  ,alempi_kk_pohjakoulutuksen_tila = cast(
		(
		case
        when (alempikax = ''1'' and ((cast(alvv as int) - cast(svuosiak as int) >= 0))) then ''Alempi korkeakouluaste tai ammatillisen korkea-aste suoritettu ennen koulutuksen aloittamista''
        when (alempikax = ''1'' and ((cast(alvv as int) - cast(svuosiak as int) < 0))) then ''Alempi korkeakouluaste tai ammatillisen korkea-aste suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei alempaa korkeakouluastetta tai ammatillista korkea-astetta''
    end
       )
    as nvarchar(150)) 
      ,aikaisemman_alemman_kk_opintoala1995 = [oalaakx]
      ,aikaisemman_alemman_kk_koulutusala1995 = LEFT([oalaakx],1)
      ,aikaisemman_alemman_kk_koulutusaste1995 = [oasteakx]
      ,aikaisemman_alemman_kk_opintoala2002 = [oalauakx]
      ,aikaisemman_alemman_kk_koulutusala2002 = [oalauakx_koulutusala]
      ,aikaisemman_alemman_kk_koulutusaste2002 = [oasteuakx]
      ,aikaisemman_alemman_kk_suoritusvuosi = [svuosiak]
      ,aikaisempi_ylempi_kk = [ylempikax]
      ,aikaisempi_ylempi_kk_tarkempi= CAST(
      (
		case
		when [ylempikax] = ''1'' then ''Aikaisempi ylemmän korkeakouluasteen koulutus tai tutkijakoulutus''
		else ''Ei aikaisempaa ylemmän korkeakouluasteen koulutusta tai tutkijakoulutusta''
		end
	   )as nvarchar(100))
	  ,ylempi_kk_pohjakoulutuksen_tila = cast(
		(
		case
        when (ylempikax = ''1'' and ((cast(alvv as int) - cast(svuosiyk as int) >= 0))) then ''Ylempi korkeakouluaste tai tutkijakoulutus suoritettu ennen koulutuksen aloittamista''
        when (ylempikax = ''1'' and ((cast(alvv as int) - cast(svuosiyk as int) < 0))) then ''Ylempi korkeakouluaste tai tutkijakoulutus suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei ylempää korkeakouluastetta tai tutkijakoulutusta''
    end
       )
    as nvarchar(150)) 
      ,aikasemman_ylemman_kk_opintoala1995= [oalaykx]
      ,aikaisemman_ylemman_kk_koulutuasala1995 = left([oalaykx],1)
      ,aikaisemman_ylemman_kk_koulutusaste1995 = [oasteykx]
      ,aikaisemman_ylemman_kk_opintoala2002 = [oalauykx]
      ,aikaisemman_ylemman_kk_koulutusala2002 = [oalauykx_koulutusala]
      ,aikaisemman_ylemman_kk_koulutusaste2002 = [oasteuykx]
      ,aikaisemman_ylemman_kk_suoritusvuosi = [svuosiyk]
      ,opiskelijan_asuinkunta = [askun]
      ,syntymavuosi = CAST(
      (
		case
		when [syntv] = ''XXXX'' then ''-1''
		else [syntv]
		end
	   )
	as nvarchar(10))	
         ,lukumaara = CAST(
	(
		case 
		when  olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/
	 end
	)
	as int)

      ,tietolahde = [tietolahde]
      ,rivinumero = [rivinumero]
      ,ika_1v = cast (
      (
         case 
         when [syntv] = ''XXXX'' then ''-1'' 
         when [syntv] = '''' then ''-1''
         when ((cast(tilv as int) - cast(syntv as int)) <= 14 ) then ''1141''
         else ((cast(tilv as int) - cast(syntv as int)))
         end) as nvarchar (10))
      ,ika_5v =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 19) then ''19655v19''
		when ((cast(tilv as int) - cast(syntv as int)) >= 20 and (cast(tilv as int) - cast(syntv as int)) <= 24) then ''19655v20''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		
		end
	   ) as nvarchar (10))
      ,ika_14_65 =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 14)  then ''1141''
		when ((cast(tilv as int) - cast(syntv as int)) = 15 )  then ''15''
		when ((cast(tilv as int) - cast(syntv as int)) = 16) then ''16''
		when ((cast(tilv as int) - cast(syntv as int)) = 17) then ''17''
		when ((cast(tilv as int) - cast(syntv as int)) = 18) then ''18''
		when ((cast(tilv as int) - cast(syntv as int)) = 19) then ''19''
		when ((cast(tilv as int) - cast(syntv as int)) = 20) then ''20''
		when ((cast(tilv as int) - cast(syntv as int)) = 21) then ''21''
		when ((cast(tilv as int) - cast(syntv as int)) = 22) then ''22''
		when ((cast(tilv as int) - cast(syntv as int)) = 23) then ''23''
		when ((cast(tilv as int) - cast(syntv as int)) = 24) then ''24''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		end
	   ) as nvarchar (10))
      ,aikaisemmasta_koulutuksesta_ammpk_kulunut_aika =  cast ((case when [ammvupe] = '''' then '' ''
      when alvv = '''' then '' ''
	  when ((cast(alvv as int) - cast(ammvupe as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(ammvupe as int)) )end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_ammlisa_kulunut_aika =  cast ((case when [ammvuli] = '''' then '' ''
      when alvv = '''' then '' ''
	  when ((cast(alvv as int) - cast(ammvuli as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(ammvuli as int)))end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_alempi_kk_kulunut_aika =  cast ((case when [svuosiak] = '''' then '' ''
      when alvv = '''' then '' '' 
	  when ((cast(alvv as int) - cast(svuosiak as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(svuosiak as int)))end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_ylempi_kk_kulunut_aika =  cast ((case when [svuosiyk] = '''' then '' ''
      when alvv = '''' then '' '' 
	  when ((cast(alvv as int) - cast(svuosiyk as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(svuosiyk as int)))end) as nvarchar (10))      
      ,aiemman_tutkinnon_ammpk_opintoala_sama  =  
       CAST(
      (
		case
		when koulk_opintoala = oalapeux then ''Aiemman tutkinnon (ammpk) opintoala sama''
		else ''Ei sama opintoala''
		end
	  )
	 	
	 as nvarchar(100))	
	  ,aiemman_tutkinnon_ammpk_koulutusala_sama  = CAST(
      (
		case
		when koulk_koulutusala = oalapeux_koulutusala
		
		then ''Aiemman tutkinnon (ammpk) koulutusala sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ammpk_koulutusaste_sama  = CAST(
      (
		case
        when koulk_koulutusaste = oastpeux then ''Aiemman tutkinnon (ammpk) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	,aiemman_tutkinnon_ammlisa_opintoala_sama  =
	 CAST(
      (
		case
		when oalaliux = '''' then ''Ei sama opintoala''
		when koulk_opintoala = [oalaliux] then ''Aiemman tutkinnon (ammlisa) opintoala sama''
		else ''Ei sama opintoala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ammlisa_koulutusala_sama  = CAST(
      (
		case
		when koulk_koulutusala = oalaliux_koulutusala then ''Aiemman tutkinnon (ammlisa) koulutusala sama''
		else ''Ei sama koulutusala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ammlisa_koulutusaste_sama  = CAST(
      (
		case
		when koulk_koulutusaste = [oastliux] then ''Aiemman tutkinnon (ammlisa) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_alempi_kk_opintoala_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala = [oalauakx] then ''Aiemman tutkinnon (alempi_kk) opintoala sama''
		else ''Ei sama opintoala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_alempi_kk_koulutusala_sama  = CAST(
      (
		case
	    when koulk_koulutusala = [oalauakx_koulutusala]  then ''Aiemman tutkinnon (alempi_kk) koulutusala sama''
		else ''Ei sama koulutusala''
		end
	   )
	   	as nvarchar(100))
	 ,aiemman_tutkinnon_alempi_kk_koulutusaste_sama  = CAST(
      (
		case
		when koulk_koulutusaste = [oasteuakx] then ''Aiemman tutkinnon (alempi_kk) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ylempi_kk_opintoala_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala = [oalauykx] then ''Aiemman tutkinnon (ylempi_kk) opintoala sama''
		else ''Ei sama opintoala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ylempi_kk_koulutusala_sama  = CAST(
      (
		case
		when koulk_koulutusala = oalauykx_koulutusala    then ''Aiemman tutkinnon (ylempi_kk) koulutusala sama''
		else ''Ei sama koulutusala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ylempi_kk_koulutusaste_sama  = CAST(
      (
		case
		when koulk_koulutusaste = [oasteuykx] then ''Aiemman tutkinnon (ylempi_kk) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	
	 ,aikaisempi_korkein_tutkinto =  cast (
      (
         case 
		 --Ylempi korkeakouluasteen koulutus tai tutkijakoulutus
         when ylempikax = ''1''  then ''7''
		 --Alempi korkeakouluasteen tai ammatillisen korkea-asteen koulutus
         when alempikax = ''1''  then ''6''
		 --Opistoaste
         when (peruskx=''1''  and oastpeux = ''50'') then ''5''
		 -- Ammatti- ja erikoisammattitutkinto
         when(lisakx=''1'')   then ''4''
		 -- Ammatillinen perustutkinto
		 when(peruskx=''1'') and oastpeux <> ''50'' then ''3''
		 -- Ylioppilastutkinto
		 when ylsivx = ''2'' then ''2''
		 -- Ei perusasteen jälkeistä koulutusta
		 when ylsivx = ''1'' then ''1''
		 -- Muu tai tuntematon
         else ''8''
         end) as nvarchar (1))
		 
	 ,aiemman_tutkinnon_opintoala2002_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala = [oalapeux] then ''Aiemman tutkinnon opintoala sama''
		when koulk_opintoala = [oalaliux] then ''Aiemman tutkinnon opintoala sama''
		when koulk_opintoala = [oalauakx] then ''Aiemman tutkinnon opintoala sama''
		when koulk_opintoala = [oalauykx] then ''Aiemman tutkinnon opintoala sama''
		else ''Ei sama opintoala''

		end
	   )
	as nvarchar(100))
	
	,aiemman_tutkinnon_koulutusaste2002_sama  = 
	 CAST(
      (
		case
		when koulk_koulutusaste = [oastpeux] then ''Aiemman tutkinnon koulutusaste sama''
		when koulk_koulutusaste = [oastliux] then ''Aiemman tutkinnon koulutusaste sama''
		when koulk_koulutusaste = [oasteuakx] then ''Aiemman tutkinnon koulutusaste sama''
		when koulk_koulutusaste = [oasteuykx] then ''Aiemman tutkinnon koulutusaste sama''
		else ''Ei sama koulutusaste''

		end
	   )
	as nvarchar(100))
	
	,aiemman_tutkinnon_koulutusala2002_sama  = 
	 CAST(
      (
		case
		when koulk_koulutusala = [oalapeux_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		when koulk_koulutusala = [oalaliux_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		when koulk_koulutusala = [oalauakx_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		when koulk_koulutusala = [oalauykx_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		else ''Ei sama koulutusala''

		end
	   )
	as nvarchar(100))
	,nuorten_aikuisten_koulutus_amm = cast(
    (
        case
        when tutktav /*ops_näyttö*/ = ''1'' and lahde in (''31'',''32'',''33'',''35'') then 1
        when (tutktav /*ops_näyttö*/ in (''1'',''2'') and lahde = ''34'' )
        or (tutktav /*ops_näyttö*/ = ''2'' and lahde in (''31'',''32'',''33'',''35'')) then 2
        else ''-1''
        end
    )
    as nvarchar(2))	
	,koulutuksen_jarjestamismuoto=cast(
    (
        case
        when (lahde = ''31'' or lahde = ''32'' or lahde = ''33'' or lahde=''35'')  then 1
        when (lahde = ''34'') then 2
        else ''-1''
        end
    )
    as nvarchar(2))	
	,aloittaneet = CAST(
	(
		case 
		when  alvv /*kirjoihintulovuosi*/ = tilv /*tilastointivuosi*/ 
		          and olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/
	 end
	)
	as int)
	,viimeisimman_koulutuksen_suorituvuosi=cast(
    (
        case
        when ammvupe is not null and (ammvupe >= coalesce(ammvuli,0)) and (ammvupe >= coalesce(svuosiak,0)) and (ammvupe >= coalesce(svuosiyk,0))  then ammvupe
        when ammvuli is not null and (ammvuli >= coalesce(ammvupe,0)) and (ammvuli >= coalesce(svuosiak,0)) and (ammvuli >= coalesce(svuosiyk,0))  then ammvuli
		when svuosiak is not null and (svuosiak >= coalesce(ammvupe,0)) and (svuosiak >= coalesce(ammvuli,0)) and (svuosiak >= coalesce(svuosiyk,0))  then svuosiak
		when svuosiyk is not null and (svuosiyk >= coalesce(ammvupe,0)) and (svuosiyk >= coalesce(ammvuli,0)) and (svuosiyk >= coalesce(svuosiak,0))  then svuosiyk
        else ''-1''
        end
    )
    as nvarchar(4))	
	,viimeisimmästä_koulutuksesta_kulunut_aika=cast(
    (
        case
        when ammvupe is not null and (ammvupe >= coalesce(ammvuli,0)) and (ammvupe >= coalesce(svuosiak,0)) and (ammvupe >= coalesce(svuosiyk,0)) and alvv <> ''''  then ((cast(alvv as int) - cast(ammvupe as int)))
        when ammvuli is not null and (ammvuli >= coalesce(ammvupe,0)) and (ammvuli >= coalesce(svuosiak,0)) and (ammvuli >= coalesce(svuosiyk,0))  and alvv <> '''' then ((cast(alvv as int) - cast(ammvuli as int)))
		when svuosiak is not null and (svuosiak >= coalesce(ammvupe,0)) and (svuosiak >= coalesce(ammvuli,0)) and (svuosiak >= coalesce(svuosiyk,0)) and alvv <> '''' then ((cast(alvv as int) - cast(svuosiak as int)))
		when svuosiyk is not null and (svuosiyk >= coalesce(ammvupe,0)) and (svuosiyk >= coalesce(ammvuli,0)) and (svuosiyk >= coalesce(svuosiak,0)) and alvv <>'''' then ((cast(alvv as int) - cast(svuosiyk as int)))
        else ''-1''
        end
    )    as nvarchar(10))	
  FROM [VipunenTK_DW].[dbo].[sa_2_20_Lukio_amm_oppis_opisk_ian_ja_aik_koul_mukaan]



























' 
GO
/****** Object:  View [dbo].[v_f_2_20_Lukio_amm_oppis_opisk_ian_ja_koul_mukaan_talteen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_20_Lukio_amm_oppis_opisk_ian_ja_koul_mukaan_talteen]'))
EXEC dbo.sp_executesql @statement = N'























CREATE VIEW [dbo].[v_f_2_20_Lukio_amm_oppis_opisk_ian_ja_koul_mukaan_talteen] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
      ,lahde = [lahde]
      ,oppilaitoksen_oppilaitostyyppi = CAST(
      (
		case
		when [oltyp] = ''XX'' then ''-1''
		else [oltyp]
		end
	   )
	as nvarchar(10))	
      ,koulutusluokitus = [koulk]
      ,nuorten_aikuisten_koulutus = [aikoul]
      ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = [tutktav]
      ,ammatillisen_koulutuksen_koulutuslaji = [tutklaja]
      ,opetushallinnon_koulutus = [ophal]
      ,koulutuksen_kunta = [kkun]
      ,rahoituslahde = [rahoitus]
      ,sukupuoli = [sp]
      ,aidinkieli_versio1 = [aikielir1]
      ,kirjoihintulovuosi = [alvv]
      ,kirjoihintulokausi = [allk]
      ,opiskelijan_olo_syys = [olosyys]
      ,aikaisempi_yleissivistava_koulutus = [ylsivx]
      ,aikaiksempi_ammpk = [peruskx]
      ,aikaisempi_ammpk_tarkempi= CAST(
      (
		case
		when [peruskx] = ''1'' then ''Aikaisempi ammatillinen peruskoulutus''
		else ''Ei aikaisempaa ammatillista peruskoulutusta''
		end
	   )as nvarchar(100))
	  ,ammpk_pohjakoulutuksen_tila = cast(
		(
		case
        when (peruskx = ''1'' and ((cast(alvv as int) - cast(ammvupe as int) >= 0))) then ''Ammatillinen peruskoulutus suoritettu ennen koulutuksen aloittamista''
        when (peruskx = ''1'' and ((cast(alvv as int) - cast(ammvupe as int) < 0))) then ''Ammatillinen peruskoulutus suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei ammatillista peruskoulutusta''
    end
       )
    as nvarchar(150))
      ,aikaisemman_ammpk_opintoala1995 = [oalapex]
      ,aikaisemman_ammpk_koulutusala1995 = left([oalapex],1)
      ,aikaisemman_ammpk_koulutusaste1995 = [oastepex]
      ,aikaisemman_ammpk_opintoala2002 = [oalapeux]
      ,aikaisemman_ammpk_koulutusala2002 = [oalapeux_koulutusala]
      ,aikaisemman_ammpk_koulutusaste2002 = [oastpeux]
      ,aikaisemman_ammpk_suoritusvuosi = [ammvupe]
      ,aikaisempi_ammpk_nayttotutkintona = [nayttox]
      ,aikaisempi_ammpk_nayttotutkintona_tarkempi= CAST(
      (
		case
		when [nayttox] = ''1'' then ''Aikaisempi ammatillinen peruskoulutus näyttötutkintona''
		else ''Ei aikaisempaa ammatillista peruskoulutusta näyttötutkintona''
		end
	   )as nvarchar(100))
      ,aikaisempi_ammpk_oppisopimuskoulutuksena = [oppispex]
      ,aikaisempi_ammpk_oppisopimuskoulutuksena_tarkempi= CAST(
      (
		case
		when [oppispex] = ''1'' then ''Aikaisempi ammatillinen peruskoulutus oppisopimuskoulutuksena''
		else ''Ei aikaisempaa ammatillista peruskoulutusta oppisopimuskoulutuksena''
		end
	   )as nvarchar(100))
      ,aikaisempi_ammlisa = [lisakx]
      ,aikaisempi_ammlisa_tarkempi= CAST(
      (
		case
		when [lisakx] = ''1'' then ''Aikaisempi ammatillinen lisäkoulutus''
		else ''Ei aikaisempaa ammatillista lisäkoulutusta''
		end
	   )as nvarchar(100))
	  ,ammlisa_pohjakoulutuksen_tila = cast(
		(
		case
        when (lisakx = ''1'' and ((cast(alvv as int) - cast(ammvuli as int) >= 0))) then ''Ammatillinen ammatilline lisäkoulutus suoritettu ennen koulutuksen aloittamista''
        when (lisakx = ''1'' and ((cast(alvv as int) - cast(ammvuli as int) < 0))) then ''Ammatillinen ammattillinen lisäkoulutus suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei ammatillista lisäkoulutusta''
    end
       )
    as nvarchar(150)) 
      ,aikaisemman_ammlisa_opintoala1995 = [oalalix]
      ,aikaisemman_ammlisa_koulutusala1995 = left([oalalix],1)
      ,aikaisemman_ammlisa_koulutusaste1995 = [oastelix]
      ,aikaisemman_ammlisa_opintoala2002 = [oalaliux]
      ,aikaisemman_ammlisa_koulutusala2002 = [oalaliux_koulutusala]
      ,aikaisemman_ammlsia_koulutusaste2002 = [oastliux]
      ,aikaisemman_ammlisa_suoritusvuosi = [ammvuli]
      ,aikaisempi_ammlisa_oppisopimuskoulutuksena = [oppislix]
      ,aikaisempi_ammlisa_oppisopimuskoulutuksena_tarkempi= CAST(
      (
		case
		when [oppislix] = ''1'' then ''Aikaisempi ammatillinen lisäkoulutus oppisopimuskoulutuksena''
		else ''Ei aikaisempaa ammatillista lisäkoulutusta oppisopimuskoulutuksena''
		end
	   )as nvarchar(100))
      ,aikaisempi_alempi_kk = [alempikax]
      ,aikaisempi_alempi_kk_tarkempi= CAST(
      (
		case
		when [alempikax] = ''1'' then ''Aikaisempi alemman korkeakouluasteen tai ammatillisen korkea-asteen koulutus''
		else ''Ei aikaisempaa alemman korkeakouluasteen tai ammatillisen korkea-asteen koulutusta''
		end
	   )as nvarchar(100))
	  ,alempi_kk_pohjakoulutuksen_tila = cast(
		(
		case
        when (alempikax = ''1'' and ((cast(alvv as int) - cast(svuosiak as int) >= 0))) then ''Alempi korkeakouluaste tai ammatillisen korkea-aste suoritettu ennen koulutuksen aloittamista''
        when (alempikax = ''1'' and ((cast(alvv as int) - cast(svuosiak as int) < 0))) then ''Alempi korkeakouluaste tai ammatillisen korkea-aste suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei alempaa korkeakouluastetta tai ammatillista korkea-astetta''
    end
       )
    as nvarchar(150)) 
      ,aikaisemman_alemman_kk_opintoala1995 = [oalaakx]
      ,aikaisemman_alemman_kk_koulutusala1995 = LEFT([oalaakx],1)
      ,aikaisemman_alemman_kk_koulutusaste1995 = [oasteakx]
      ,aikaisemman_alemman_kk_opintoala2002 = [oalauakx]
      ,aikaisemman_alemman_kk_koulutusala2002 = [oalauakx_koulutusala]
      ,aikaisemman_alemman_kk_koulutusaste2002 = [oasteuakx]
      ,aikaisemman_alemman_kk_suoritusvuosi = [svuosiak]
      ,aikaisempi_ylempi_kk = [ylempikax]
      ,aikaisempi_ylempi_kk_tarkempi= CAST(
      (
		case
		when [ylempikax] = ''1'' then ''Aikaisempi ylemmän korkeakouluasteen koulutus tai tutkijakoulutus''
		else ''Ei aikaisempaa ylemmän korkeakouluasteen koulutusta tai tutkijakoulutusta''
		end
	   )as nvarchar(100))
	  ,ylempi_kk_pohjakoulutuksen_tila = cast(
		(
		case
        when (ylempikax = ''1'' and ((cast(alvv as int) - cast(svuosiyk as int) >= 0))) then ''Ylempi korkeakouluaste tai tutkijakoulutus suoritettu ennen koulutuksen aloittamista''
        when (ylempikax = ''1'' and ((cast(alvv as int) - cast(svuosiyk as int) < 0))) then ''Ylempi korkeakouluaste tai tutkijakoulutus suoritettu koulutuksen aloittamisen jälkeen''
        else  ''Ei ylempää korkeakouluastetta tai tutkijakoulutusta''
    end
       )
    as nvarchar(150)) 
      ,aikasemman_ylemman_kk_opintoala1995= [oalaykx]
      ,aikaisemman_ylemman_kk_koulutuasala1995 = left([oalaykx],1)
      ,aikaisemman_ylemman_kk_koulutusaste1995 = [oasteykx]
      ,aikaisemman_ylemman_kk_opintoala2002 = [oalauykx]
      ,aikaisemman_ylemman_kk_koulutusala2002 = [oalauykx_koulutusala]
      ,aikaisemman_ylemman_kk_koulutusaste2002 = [oasteuykx]
      ,aikaisemman_ylemman_kk_suoritusvuosi = [svuosiyk]
      ,opiskelijan_asuinkunta = [askun]
      ,syntymavuosi = CAST(
      (
		case
		when [syntv] = ''XXXX'' then ''-1''
		else [syntv]
		end
	   )
	as nvarchar(10))	
         ,lukumaara = CAST(
	(
		case 
		when  olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/
	 end
	)
	as int)

      ,tietolahde = [tietolahde]
      ,rivinumero = [rivinumero]
      ,ika_1v = cast (
      (
         case 
         when [syntv] = ''XXXX'' then ''-1'' 
         when [syntv] = '''' then ''-1''
         when ((cast(tilv as int) - cast(syntv as int)) <= 14 ) then ''1141''
         else ((cast(tilv as int) - cast(syntv as int)))
         end) as nvarchar (10))
      ,ika_5v =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 19) then ''19655v19''
		when ((cast(tilv as int) - cast(syntv as int)) >= 20 and (cast(tilv as int) - cast(syntv as int)) <= 24) then ''19655v20''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		
		end
	   ) as nvarchar (10))
      ,ika_14_65 =cast(
       (
		case
		when [syntv] = ''XXXX'' then ''-1''
		when [syntv] = '''' then ''-1''
		when ((cast(tilv as int) - cast(syntv as int)) <= 14)  then ''1141''
		when ((cast(tilv as int) - cast(syntv as int)) = 15 )  then ''15''
		when ((cast(tilv as int) - cast(syntv as int)) = 16) then ''16''
		when ((cast(tilv as int) - cast(syntv as int)) = 17) then ''17''
		when ((cast(tilv as int) - cast(syntv as int)) = 18) then ''18''
		when ((cast(tilv as int) - cast(syntv as int)) = 19) then ''19''
		when ((cast(tilv as int) - cast(syntv as int)) = 20) then ''20''
		when ((cast(tilv as int) - cast(syntv as int)) = 21) then ''21''
		when ((cast(tilv as int) - cast(syntv as int)) = 22) then ''22''
		when ((cast(tilv as int) - cast(syntv as int)) = 23) then ''23''
		when ((cast(tilv as int) - cast(syntv as int)) = 24) then ''24''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''19655v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''19655v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''19655v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''19655v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''19655v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''19655v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''19655v55''
        when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''19655v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65) then ''19655v65''
		end
	   ) as nvarchar (10))
      ,aikaisemmasta_koulutuksesta_ammpk_kulunut_aika =  cast ((case when [ammvupe] = '''' then '' ''
      when alvv = '''' then '' ''
	  when ((cast(alvv as int) - cast(ammvupe as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(ammvupe as int)) )end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_ammlisa_kulunut_aika =  cast ((case when [ammvuli] = '''' then '' ''
      when alvv = '''' then '' ''
	  when ((cast(alvv as int) - cast(ammvuli as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(ammvuli as int)))end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_alempi_kk_kulunut_aika =  cast ((case when [svuosiak] = '''' then '' ''
      when alvv = '''' then '' '' 
	  when ((cast(alvv as int) - cast(svuosiak as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(svuosiak as int)))end) as nvarchar (10))

      ,aikaisemmasta_koulutuksesta_ylempi_kk_kulunut_aika =  cast ((case when [svuosiyk] = '''' then '' ''
      when alvv = '''' then '' '' 
	  when ((cast(alvv as int) - cast(svuosiyk as int) < 0)) then ''888'' 
	  else ((cast(alvv as int) - cast(svuosiyk as int)))end) as nvarchar (10))      
      ,aiemman_tutkinnon_ammpk_opintoala_sama  =  
       CAST(
      (
		case
		when koulk_opintoala = oalapeux then ''Aiemman tutkinnon (ammpk) opintoala sama''
		else ''Ei sama opintoala''
		end
	  )
	 	
	 as nvarchar(100))	
	  ,aiemman_tutkinnon_ammpk_koulutusala_sama  = CAST(
      (
		case
		when koulk_koulutusala = oalapeux_koulutusala
		
		then ''Aiemman tutkinnon (ammpk) koulutusala sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ammpk_koulutusaste_sama  = CAST(
      (
		case
        when koulk_koulutusaste = oastpeux then ''Aiemman tutkinnon (ammpk) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	,aiemman_tutkinnon_ammlisa_opintoala_sama  =
	 CAST(
      (
		case
		when oalaliux = '''' then ''Ei sama opintoala''
		when koulk_opintoala = [oalaliux] then ''Aiemman tutkinnon (ammlisa) opintoala sama''
		else ''Ei sama opintoala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ammlisa_koulutusala_sama  = CAST(
      (
		case
		when koulk_koulutusala = oalaliux_koulutusala then ''Aiemman tutkinnon (ammlisa) koulutusala sama''
		else ''Ei sama koulutusala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ammlisa_koulutusaste_sama  = CAST(
      (
		case
		when koulk_koulutusaste = [oastliux] then ''Aiemman tutkinnon (ammlisa) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_alempi_kk_opintoala_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala = [oalauakx] then ''Aiemman tutkinnon (alempi_kk) opintoala sama''
		else ''Ei sama opintoala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_alempi_kk_koulutusala_sama  = CAST(
      (
		case
	    when koulk_koulutusala = [oalauakx_koulutusala]  then ''Aiemman tutkinnon (alempi_kk) koulutusala sama''
		else ''Ei sama koulutusala''
		end
	   )
	   	as nvarchar(100))
	 ,aiemman_tutkinnon_alempi_kk_koulutusaste_sama  = CAST(
      (
		case
		when koulk_koulutusaste = [oasteuakx] then ''Aiemman tutkinnon (alempi_kk) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ylempi_kk_opintoala_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala = [oalauykx] then ''Aiemman tutkinnon (ylempi_kk) opintoala sama''
		else ''Ei sama opintoala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ylempi_kk_koulutusala_sama  = CAST(
      (
		case
		when koulk_koulutusala = oalauykx_koulutusala    then ''Aiemman tutkinnon (ylempi_kk) koulutusala sama''
		else ''Ei sama koulutusala''
		end
	   )
	as nvarchar(100))	
	 ,aiemman_tutkinnon_ylempi_kk_koulutusaste_sama  = CAST(
      (
		case
		when koulk_koulutusaste = [oasteuykx] then ''Aiemman tutkinnon (ylempi_kk) koulutusaste sama''
		else ''Ei sama koulutusaste''
		end
	   )
	as nvarchar(100))	
	
	 ,aikaisempi_korkein_tutkinto =  cast (
      (
         case 
		 --Ylempi korkeakouluasteen koulutus tai tutkijakoulutus
         when ylempikax = ''1''  then ''7''
		 --Alempi korkeakouluasteen tai ammatillisen korkea-asteen koulutus
         when alempikax = ''1''  then ''6''
		 --Opistoaste
         when (peruskx=''1''  and oastpeux = ''50'') then ''5''
		 -- Ammatti- ja erikoisammattitutkinto
         when(lisakx=''1'')   then ''4''
		 -- Ammatillinen perustutkinto
		 when(peruskx=''1'') and oastpeux <> ''50'' then ''3''
		 -- Ylioppilastutkinto
		 when ylsivx = ''2'' then ''2''
		 -- Ei perusasteen jälkeistä koulutusta
		 when ylsivx = ''1'' then ''1''
		 -- Muu tai tuntematon
         else ''8''
         end) as nvarchar (1))
		 
	 ,aiemman_tutkinnon_opintoala2002_sama  = 
	 CAST(
      (
		case
		when koulk_opintoala = [oalapeux] then ''Aiemman tutkinnon opintoala sama''
		when koulk_opintoala = [oalaliux] then ''Aiemman tutkinnon opintoala sama''
		when koulk_opintoala = [oalauakx] then ''Aiemman tutkinnon opintoala sama''
		when koulk_opintoala = [oalauykx] then ''Aiemman tutkinnon opintoala sama''
		else ''Ei sama opintoala''

		end
	   )
	as nvarchar(100))
	
	,aiemman_tutkinnon_koulutusaste2002_sama  = 
	 CAST(
      (
		case
		when koulk_koulutusaste = [oastpeux] then ''Aiemman tutkinnon koulutusaste sama''
		when koulk_koulutusaste = [oastliux] then ''Aiemman tutkinnon koulutusaste sama''
		when koulk_koulutusaste = [oasteuakx] then ''Aiemman tutkinnon koulutusaste sama''
		when koulk_koulutusaste = [oasteuykx] then ''Aiemman tutkinnon koulutusaste sama''
		else ''Ei sama koulutusaste''

		end
	   )
	as nvarchar(100))
	
	,aiemman_tutkinnon_koulutusala2002_sama  = 
	 CAST(
      (
		case
		when koulk_koulutusala = [oalapeux_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		when koulk_koulutusala = [oalaliux_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		when koulk_koulutusala = [oalauakx_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		when koulk_koulutusala = [oalauykx_koulutusala] then ''Aiemman tutkinnon koulutusala sama''
		else ''Ei sama koulutusala''

		end
	   )
	as nvarchar(100))
	,nuorten_aikuisten_koulutus_amm = cast(
    (
        case
        when tutktav /*ops_näyttö*/ = ''1'' and lahde in (''31'',''32'',''33'',''35'') then 1
        when (tutktav /*ops_näyttö*/ in (''1'',''2'') and lahde = ''34'' )
        or (tutktav /*ops_näyttö*/ = ''2'' and lahde in (''31'',''32'',''33'',''35'')) then 2
        else ''-1''
        end
    )
    as nvarchar(2))	
	,koulutuksen_jarjestamismuoto=cast(
    (
        case
        when (lahde = ''31'' or lahde = ''32'' or lahde = ''33'' or lahde=''35'')  then 1
        when (lahde = ''34'') then 2
        else ''-1''
        end
    )
    as nvarchar(2))	
	,aloittaneet = CAST(
	(
		case 
		when  alvv /*kirjoihintulovuosi*/ = tilv /*tilastointivuosi*/ 
		          and olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/
	 end
	)
	as int)
	,viimeisimman_koulutuksen_suorituvuosi=cast(
    (
        case
        when ammvupe is not null and (ammvupe >= coalesce(ammvuli,0)) and (ammvupe >= coalesce(svuosiak,0)) and (ammvupe >= coalesce(svuosiyk,0))  then ammvupe
        when ammvuli is not null and (ammvuli >= coalesce(ammvupe,0)) and (ammvuli >= coalesce(svuosiak,0)) and (ammvuli >= coalesce(svuosiyk,0))  then ammvuli
		when svuosiak is not null and (svuosiak >= coalesce(ammvupe,0)) and (svuosiak >= coalesce(ammvuli,0)) and (svuosiak >= coalesce(svuosiyk,0))  then svuosiak
		when svuosiyk is not null and (svuosiyk >= coalesce(ammvupe,0)) and (svuosiyk >= coalesce(ammvuli,0)) and (svuosiyk >= coalesce(svuosiak,0))  then svuosiyk
        else ''-1''
        end
    )
    as nvarchar(4))	
	,viimeisimmästä_koulutuksesta_kulunut_aika=cast(
    (
        case
        when ammvupe is not null and (ammvupe >= coalesce(ammvuli,0)) and (ammvupe >= coalesce(svuosiak,0)) and (ammvupe >= coalesce(svuosiyk,0)) and alvv <> ''''  then ((cast(alvv as int) - cast(ammvupe as int)))
        when ammvuli is not null and (ammvuli >= coalesce(ammvupe,0)) and (ammvuli >= coalesce(svuosiak,0)) and (ammvuli >= coalesce(svuosiyk,0))  and alvv <> '''' then ((cast(alvv as int) - cast(ammvuli as int)))
		when svuosiak is not null and (svuosiak >= coalesce(ammvupe,0)) and (svuosiak >= coalesce(ammvuli,0)) and (svuosiak >= coalesce(svuosiyk,0)) and alvv <> '''' then ((cast(alvv as int) - cast(svuosiak as int)))
		when svuosiyk is not null and (svuosiyk >= coalesce(ammvupe,0)) and (svuosiyk >= coalesce(ammvuli,0)) and (svuosiyk >= coalesce(svuosiak,0)) and alvv <>'''' then ((cast(alvv as int) - cast(svuosiyk as int)))
        else ''-1''
        end
    )
    as nvarchar(10))	
	
     
	
  FROM [VipunenTK_DW].[dbo].[sa_2_20_Lukio_amm_oppis_opisk_ian_ja_aik_koul_mukaan]
























' 
GO
/****** Object:  View [dbo].[v_f_2_23_Opisk_ja_tutksuor_vanh_aseman_muk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_23_Opisk_ja_tutksuor_vanh_aseman_muk]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_2_23_Opisk_ja_tutksuor_vanh_aseman_muk] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
      ,sukupuoli = [sp] 
      ,syntymavuosi = [syntv]
      ,aidinkieli_versio1x = [aikielir1x]
      ,kotikunta = [tilvaskun]
      ,kotikunta1x = [tilvaskunx]
      ,sosioekonominen_asema_1_isa = [sose_isa1]
      ,sosioekonominen_asema_1_aiti = [sose_aiti1]
      ,sosioekonominen_asema_2_isa = [sose_isa2]
      ,sosioekonominen_asema_2_aiti = [sose_aiti2]
      ,koulutusluokitus_isa = CAST(
      (
		case
		when [koulk_isa] = ''999999'' then ''SA9999''
		else koulk_isa
		end
	 	   )
	as nvarchar(6))
      ,koulutusluokitus_aiti = CAST(
      (
		case
		when [koulk_aiti] = ''999999'' then ''SA9999''
		else koulk_aiti
		end
		   )
	as nvarchar(6))
      ,tulodesiili_isa = [tulo_isa]
      ,tulodesiili_aiti = [tulo_aiti]
      ,koulutuslaji = [klaji]
      ,opetushallinnon_koulutus = CAST(
      (
		case
		when [ophal] IS NULL then ''''
		else [ophal]
		end
		   )
	as nvarchar(6))
      ,koulutusluokitus = [koulk]
      ,koulutuksen_kieli = [kkieli]
      ,koulutuksen_maakunta= [kmaak]
      ,kirjoihintulovuosi = [alvv]
      ,kirjoillaolo_olosyys =[olosyys]
       ,opetushallinnon_koulutus2 = CAST(
      (
		case
		when [ophal] = '''' then ''1''
		when [ophal] IS NULL then ''1''
		else ophal
		end
	   )
	as nvarchar(2))	
      ,uudet_opiskelijat = [uusi]
      ,opiskelijat = [opisk]
      ,tutkinnot = [tutk]
      ,tietolahde = [tietolahde]
      ,rivinumero = [rivinumero]
      ,ika_1v = cast ((cast(tilv as int) - cast(syntv as int)) as nvarchar (10))
      ,ika_5v =cast(
       (
		case
		when (cast(tilv as int) - cast(syntv as int)) < 15 then ''5v10''
		when ((cast(tilv as int) - cast(syntv as int)) >= 15 and (cast(tilv as int) - cast(syntv as int)) <= 19) then ''5v15''
		when ((cast(tilv as int) - cast(syntv as int)) >= 20 and (cast(tilv as int) - cast(syntv as int)) <= 24) then ''5v20''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''5v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''5v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''5v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''5v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''5v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''5v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''5v55''
		when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''5v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65 and (cast(tilv as int) - cast(syntv as int)) <= 69) then ''5v65''
		when ((cast(tilv as int) - cast(syntv as int)) >= 70 and (cast(tilv as int) - cast(syntv as int)) <= 74) then ''5v70''
		when ((cast(tilv as int) - cast(syntv as int)) >= 75 and (cast(tilv as int) - cast(syntv as int)) <= 79) then ''5v75''
		when ((cast(tilv as int) - cast(syntv as int)) >= 80 and (cast(tilv as int) - cast(syntv as int)) <= 84) then ''5v80''
		when ((cast(tilv as int) - cast(syntv as int)) >= 85 and (cast(tilv as int) - cast(syntv as int)) <= 89) then ''5v85''
		when ((cast(tilv as int) - cast(syntv as int)) >= 90 and (cast(tilv as int) - cast(syntv as int)) <= 94) then ''5v90''
		when ((cast(tilv as int) - cast(syntv as int)) >= 95) then ''5v95''
		
		end
	   ) as nvarchar (10))
     

		
FROM [VipunenTK_DW].[dbo].[sa_2_23_Opisk_ja_tutksuor_vanh_aseman_muk]

' 
GO
/****** Object:  View [dbo].[v_f_2_3_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_3_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat]'))
EXEC dbo.sp_executesql @statement = N'























CREATE VIEW [dbo].[v_f_2_3_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat] AS

-- truncate table [VipunenTK_DW]..f_2_3_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat
-- insert into [VipunenTK_DW]..f_2_3_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat select * from v_f_2_3_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat
--sel
SELECT
	 tilastointivuosi = tilv
	,tilv_date
	,lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusluokitus = koulk
	,koulutuksen_kieli = kkieli
	,koulutuksen_kunta = kkun
	,opetushallinnon_koulutus = ophal
	,sukupuoli = sp
	,aidinkieli_versio1 = aikielir1
	,kirjoihintulovuosi =			CASE
										WHEN alvv IS NULL or alvv = '''' THEN ''Tuntematon''
										else cast(alvv AS varchar(10))
									end
	,jarjestys_kirjoihintulovuosi = CASE
										WHEN alvv IS NULL or alvv = '''' THEN 9999
										else cast(alvv AS int)
									end
	,kirjoihintulokausi = allk
	,opiskelijan_olo_tamm = olotamm
	,opiskelijan_olo_syys = olosyys
	,aikuisopiskelija = aiopis
	,ika_5v = kirikar1
	,lukumaara = lkm
	,lukiokoulutuksen_koulutuslaji = tutklajl
	,nuorten_aikuisten_koulutus = aikoul
	,koulutuksen_tutkinnon_aloitusvuosi = tutalv
	,koulutuksen_tutkinnon_aloituskausi = tutalk
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,tutkintonimike_ammpk = tunim
	
	,koulutusohjelma_ammpk = koohj
	
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,tyovoimapoliittinen_koulutus = tyov
	,rahoituslahde_amm = rahoitus
	,alkamispaivamaara = alaika
	,paattymispaivamaara = loaika
	,tutkinnon_tavoite = tavoite
	,yrittajan_oppisopimuskoulutus = yrit
	,oppisopimus_purkautunut = purku
	,todistus_oppisopimuskoulutuksen_suorittamisesta = todis
	,toimiala_2008 = tol2008
	,oppisopimus_yrityksen_koko = koko
	,tyonantajasektori = tyansek
	,asuinmaakunta = tilvasmaak
	,tietolahde
	,rivinumero
-- johdetut
	,aineistotunnus = ''2.3a-d''
	,koulutussektori = cast(
	(
		case
		when f.lahde = ''*1'' then ''1''
		when f.lahde in (''21'',''22'',''23'') then ''2''
		when f.lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when f.lahde in (''41'',''42'') then ''4''
		when f.lahde in (''51'',''52'') then ''5''
		else ''-1''
		end
	)
	as nvarchar(2))
	,hallinnonala = cast(
	(
		case
		when f.ophal /*opetushallinnon_koulutus*/ = ''1'' then ''1''
		when f.tyov  /*tyovoimapoliittinen_koulutus*/ = ''1'' then ''2''
		when f.ophal /*opetushallinnon_koulutus*/<>''1'' and f.tyov /*tyovoimapoliittinen_koulutus*/<>''1'' then ''3''
		else ''-1''
		end
	)
	as nvarchar(2))
	,hallinnonala2 = cast(
	(
		case
		when f.ophal = ''1'' then ''1'' --Opetushallinto, työvoimakoulutus
		when f.ophal = ''2'' and coalesce(coalesce(d1.koulutuksen_jarjestajan_korvaavakoodi,d1.koulutuksen_jarjestajakoodi),'''') not in (''0145076-7'',''2153105-4'',''150622-3'',''0909306-3'') /*''Ålands Landskapsregering'',''Poliisiammattikorkeakoulu'',''Rikosseuraamusalan Koulutuskeskus'',''Pelastusopisto''*/ then ''2'' --Opetushallinto, pl. työvoimakoulutus
		when f.ophal = ''2'' then ''3'' --Muiden hallinnonalojen alainen koulutus
		else ''-1''
		end
	)
	as nvarchar(2))
	,koulutuksen_jarjestamismuoto = cast(
	(
		case
		when f.lahde in (''31'',''32'',''33'',''35'') then ''1''
		when f.lahde in (''34'') then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
		when f.tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
		when f.tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,koulutuksen_tavoite_toteuma = cast(
	(
		case
		when f.tavoite /*tutkinnon_tavoite*/ = ''1'' or coalesce(f.tavoite /*tutkinnon_tavoite*/,'''')='''' then ''1''
		when f.tavoite /*tutkinnon_tavoite*/ = ''2'' then ''2''
		when f.tavoite /*tutkinnon_tavoite*/ = ''9'' then ''3''
		else ''-1''
		end
	)
	as nvarchar(2))
	,tyovoimapoliittinen = cast(
	(
		case
		when f.tyov /*tyovoimapoliittinen_koulutus*/ = ''1'' then ''1''
		when f.tyov /*tyovoimapoliittinen_koulutus*/ = ''2'' or coalesce(f.tyov /*tyovoimapoliittinen_koulutus*/,'''')='''' then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,aloittaneet = CAST(
	(
		case when f.alvv /*kirjoihintulovuosi*/=f.tilv /*tilastointivuosi*/ 
		          and f.olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then f.lkm /*lukumaara*/ end
	)
	as int)
	,opiskelijat = cast(
	(
		case
		when f.olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then f.lkm /*lukumaara*/
		end
	)
	as int)
	,opiskelijat_lasna = cast(
	(
		case
		when f.olosyys /*opiskelijan_olo_syys*/ in (''1'') then f.lkm /*lukumaara*/
		end
	)
	as int)
	,nuorten_aikuisten_koulutus_amm = cast(
	(
		case
		when f.tutktav /*ops_näyttö*/ = ''1'' and f.lahde in (''31'',''32'',''33'',''35'') then 1
		when (f.tutktav /*ops_näyttö*/ in (''1'',''2'') and f.lahde = ''34'' )
		or (f.tutktav /*ops_näyttö*/ = ''2'' and f.lahde in (''31'',''32'',''33'',''35'')) then 2
		else ''-1''
		end
	)
	as nvarchar(2))

	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1''
				THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END

		,yhtjarj = 
			CASE
				WHEN lahde = 21 THEN jarj
				WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33 OR lahde = 35) THEN jarj
				WHEN tilv >= 2013 AND lahde = 35 THEN jarj
				WHEN lahde = 34 THEN opjarj
				ELSE ''-1''
			END

		,yhtoppilaitos = 
			CASE
				WHEN lahde = 21 THEN tunn
				WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33 OR lahde = 35) THEN tunn
				WHEN tilv >= 2013 AND lahde = 35 THEN tunn
				ELSE ''-1''
			END

/*
		  ,yht_koul_jarj_kunta = 
			CASE
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END
*/
 
 
		  ,yht_koulutuksen_kunta = 
			CASE
			 WHEN lahde = 21 THEN kkun
			 WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33 OR lahde = 35) THEN kkun
			 WHEN tilv >= 2013 AND lahde = 35 THEN kkun 
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END

	,koulutusryhma_avain =
		CASE
			WHEN aikoul = ''1''
				THEN ''21'' --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN ''22'' --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''31'' --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''32'' --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''33'' --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''33'' --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN ''35'' --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN ''35'' --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN ''35'' --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN ''35'' --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END 


/* 

JOS Aineisto=2.3 JA lahde=21 NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA TILV<2013 JA (lahde=31 TAI lahde=33) NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA TILV>2012 JA lahde=35 NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA lahde=34 NIIN yhtjarj = opjarj;

JOS Aineisto=2.3 JA lahde=21 NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA TILV<2013 JA (lahde=31 TAI lahde=33) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA TILV>2012 JA lahde=35 NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA lahde=34 NIIN yhtoppilaitos = ”Tuntematon”;

*/


FROM VipunenTK_DW.dbo.sa_2_3_Lukio_ja_amm_koulutuksen_opiskelijat AS f
left join VipunenTK.dbo.d_oppilaitoksen_taustatiedot d1 on d1.oppilaitos_avain=coalesce(nullif(coalesce(nullif(f.jarj,''-1''),f.opjarj),''-1''),f.tunn)
























' 
GO
/****** Object:  View [dbo].[v_f_2_3efg_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_3efg_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_2_3efg_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat] AS

-- truncate table [VipunenTK_DW]..f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat
-- insert into [VipunenTK_DW].dbo.f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat select * from v_f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat


SELECT
	 tilastointivuosi = tilv
	,tilv_date
	,lahde
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusluokitus = koulk
	,sukupuoli = sp
	,aidinkieli = aikielir1
	,asuinmaakunta = tilvasmaak
	,aikuisopiskelija = aiopis
	,ika_kirjoihintulovuonna = case ika2 when ''60'' then ''kirikar160'' else ika2 end
	,ikaryhma_kirjoihintulovuonna =
						case 
							when ika2 in (''0'',''1'',''2'') then ''ikaryh2_2''
							when ika2 in (''3'',''4'',''5'') then ''ikaryh2_5''
							when ika2=''6'' then ''ikaryh2_6''
							when ika2 in (''7'',''8'',''9'',''10'',''11'',''12'') then ''ikaryh2_12''
							when ika2 in (''13'',''14'',''15'') then ''ikaryh2_15''
							when ika2 in (''16'',''17'',''18'') then ''ikaryh2_18''
							when ika2 in (''19'',''20'',''21'') then ''ikaryh2_21''
							when ika2 in (''22'',''23'',''24'') then ''ikaryh2_24''
							when ika2 in (''25'',''26'',''27'',''28'',''29'') then ''ikaryh2_29''
							when ika2 in (''30'',''31'',''32'',''33'',''34'') then ''ikaryh2_34''
							when ika2 in (''35'',''36'',''37'',''38'',''39'') then ''ikaryh2_39''
							when ika2 in (''40'',''41'',''42'',''43'',''44'') then ''ikaryh2_44''
							when ika2 in (''45'',''46'',''47'',''48'',''49'') then ''ikaryh2_49''
							when ika2 in (''50'',''51'',''52'',''53'',''54'') then ''ikaryh2_54''
							when ika2 in (''55'',''56'',''57'',''58'',''59'') then ''ikaryh2_59''
							when ika2 in (''60'',''61'',''62'',''63'',''64'') then ''kirikar160''
							else ''-1''
						end
	,ika = case when ika2<>''XX'' and cast(ika2 as int)+(cast(tilv as int)-cast(alvv as int))>=60 then ''kirikar160'' when ika2=''XX'' then ''-1'' else cast(cast(ika2 as int)+(cast(tilv as int)-cast(alvv as int)) as nvarchar) end
	,ikaryhma = 
		case 
			when ika_k in (''0'',''1'',''2'') then ''ikaryh2_2''
			when ika_k in (''3'',''4'',''5'') then ''ikaryh2_5''
			when ika_k=''6'' then ''ikaryh2_6''
			when ika_k in (''7'',''8'',''9'',''10'',''11'',''12'') then ''ikaryh2_12''
			when ika_k in (''13'',''14'',''15'') then ''ikaryh2_15''
			when ika_k in (''16'',''17'',''18'') then ''ikaryh2_18''
			when ika_k in (''19'',''20'',''21'') then ''ikaryh2_21''
			when ika_k in (''22'',''23'',''24'') then ''ikaryh2_24''
			when ika_k in (''25'',''26'',''27'',''28'',''29'') then ''ikaryh2_29''
			when ika_k in (''30'',''31'',''32'',''33'',''34'') then ''ikaryh2_34''
			when ika_k in (''35'',''36'',''37'',''38'',''39'') then ''ikaryh2_39''
			when ika_k in (''40'',''41'',''42'',''43'',''44'') then ''ikaryh2_44''
			when ika_k in (''45'',''46'',''47'',''48'',''49'') then ''ikaryh2_49''
			when ika_k in (''50'',''51'',''52'',''53'',''54'') then ''ikaryh2_54''
			when ika_k in (''55'',''56'',''57'',''58'',''59'') then ''ikaryh2_59''
			when ika_k in (''60'',''61'',''62'',''63'',''64'') then ''kirikar160''
			when ika_k > ''64'' or ika_k like ''10%'' then ''kirikar160''
			when ika_k = ''kirikar160'' then ''kirikar160''
			else ''-1''
		end
			
	
	,koulutuksen_kieli = kkieli
	,koulutuksen_kunta = kkun
	,opetushallinnon_koulutus = ophal
	,kirjoihintulovuosi = alvv
	,opiskelijan_olo_syys = olosyys
	,lukumaara = lkm
	,nuorten_aikuisten_koulutus = aikoul
	,koulutuksen_tutkinnon_aloitusvuosi = tutalv
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,tutkintonimike_ammpk = tunim
	--,tutkintonimike_suomi = sutunim
	--,tutkintonimike_ruotsi = rutunim
	,koulutusohjelma_ammpk = koohj
	--,koulutusohjelma_suomi = sukoohj
	--,koulutusohjelma_ruotsi = rukoohj
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,rahoituslahde_amm = rahoitus
	,tutkinnon_tavoite = tavoite
	,f.tietolahde
	,rivinumero
-- johdetut
	,aineistotunnus = ''2.3efg''
	,koulutussektori = cast(
	(
		case
		when f.lahde = ''*1'' then ''1''
		when f.lahde in (''21'',''22'',''23'') then ''2''
		when f.lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when f.lahde in (''41'',''42'') then ''4''
		when f.lahde in (''51'',''52'') then ''5''
		else ''-1''
		end
	)
	as nvarchar(2))

	,koulutuksen_jarjestamismuoto = cast(
	(
		case
		when f.lahde in (''31'',''32'',''33'',''35'') then ''1''
		when f.lahde in (''34'') then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
		when f.tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
		when f.tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,koulutuksen_tavoite_toteuma = cast(
	(
		case
		when f.tavoite /*tutkinnon_tavoite*/ = ''1'' or coalesce(f.tavoite /*tutkinnon_tavoite*/,'''')='''' then ''1''
		when f.tavoite /*tutkinnon_tavoite*/ = ''2'' then ''2''
		when f.tavoite /*tutkinnon_tavoite*/ = ''9'' then ''3''
		else ''-1''
		end
	)
	as nvarchar(2))

	,aloittaneet = CAST(
	(
		case when f.alvv /*kirjoihintulovuosi*/=f.tilv /*tilastointivuosi*/ 
		          and f.olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then f.lkm /*lukumaara*/ end
	)
	as int)
	,opiskelijat = cast(
	(
		case
		when f.olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then f.lkm /*lukumaara*/
		end
	)
	as int)
	,opiskelijat_lasna = cast(
	(
		case
		when f.olosyys /*opiskelijan_olo_syys*/ in (''1'') then f.lkm /*lukumaara*/
		end
	)
	as int)
	,nuorten_aikuisten_koulutus_amm = cast(
	(
		case
		when f.tutktav /*ops_näyttö*/ = ''1'' and f.lahde in (''31'',''32'',''33'',''35'') then 1
		when (f.tutktav /*ops_näyttö*/ in (''1'',''2'') and f.lahde = ''34'' )
		or (f.tutktav /*ops_näyttö*/ = ''2'' and f.lahde in (''31'',''32'',''33'',''35'')) then 2
		else ''-1''
		end
	)
	as nvarchar(2))

	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1'' THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''  THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'') THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'') THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'') THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'') THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34'' THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34'' THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34'' THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34'' THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END

	,yhtjarj = 
		CASE
			WHEN lahde = 21 THEN jarj
			WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33 or lahde = 35) THEN jarj
			WHEN tilv >= 2013 AND lahde = 35 THEN jarj
			WHEN lahde = 34 THEN opjarj
			ELSE ''-1''
		END

		
/*
		  ,yht_koul_jarj_kunta = 
			CASE
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END
*/
 
 
/* 

JOS Aineisto=2.3 JA lahde=21 NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA TILV<2013 JA (lahde=31 TAI lahde=33) NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA TILV>2012 JA lahde=35 NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA lahde=34 NIIN yhtjarj = opjarj;

JOS Aineisto=2.3 JA lahde=21 NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA TILV<2013 JA (lahde=31 TAI lahde=33) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA TILV>2012 JA lahde=35 NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA lahde=34 NIIN yhtoppilaitos = ”Tuntematon”;

*/


FROM VipunenTK_DW.dbo.sa_2_3efg_Lukio_ja_amm_koulutuksen_opiskelijat AS f

cross apply (SELECT 
		case 
			when ika2<>''XX'' and cast(ika2 as int)+(cast(tilv as int)-cast(alvv as int))>=60 then ''kirikar160'' 
			when ika2 = ''XX'' then ''-1'' 
			else cast(cast(ika2 as int)+(cast(tilv as int)-cast(alvv as int)) as nvarchar) 
		end AS ika_k) aa





































' 
GO
/****** Object:  View [dbo].[v_f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat]'))
EXEC dbo.sp_executesql @statement = N'








CREATE VIEW [dbo].[v_f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat] AS

-- truncate table [VipunenTK_DW]..f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat
-- insert into [VipunenTK_DW].dbo.f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat select * from v_f_2_3h_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_opiskelijat

SELECT
	 tilastointivuosi = tilv
	,tilv_date
	,lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusaste = opmast
	,koulutusala = opmala
	,koulutuksen_kieli = kkieli
	,koulutuksen_kunta = kkun
	,opetushallinnon_koulutus = ophal
	,kotikunta = tilvaskun
	,kotikunta_ed = tilvaskunx
	,kirjoihintulovuosi = alvv
	,opiskelijan_olo_syys = olosyys
	,ika_5v = kirikar1
	,lukumaara = lkm
	,lukiokoulutuksen_koulutuslaji = tutklajl
	,nuorten_aikuisten_koulutus = aikoul
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,tyovoimapoliittinen_koulutus = tyov
	,rahoituslahde_amm = rahoitus
	,tutkinnon_tavoite = tavoite
	,yrittajan_oppisopimuskoulutus = yrit
	,f.tietolahde
	,rivinumero
-- johdetut
	,aineistotunnus = ''2.3h''
	,koulutussektori = cast(
	(
		case
		when f.lahde = ''*1'' then ''1''
		when f.lahde in (''21'',''22'',''23'') then ''2''
		when f.lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when f.lahde in (''41'',''42'') then ''4''
		when f.lahde in (''51'',''52'') then ''5''
		else ''-1''
		end
	)
	as nvarchar(2))
	,hallinnonala = cast(
	(
		case
		when f.ophal /*opetushallinnon_koulutus*/ = ''1'' then ''1''
		when f.tyov  /*tyovoimapoliittinen_koulutus*/ = ''1'' then ''2''
		when f.ophal /*opetushallinnon_koulutus*/<>''1'' and f.tyov /*tyovoimapoliittinen_koulutus*/<>''1'' then ''3''
		else ''-1''
		end
	)
	as nvarchar(2))
	,koulutuksen_jarjestamismuoto = cast(
	(
		case
		when f.lahde in (''31'',''32'',''33'',''35'') then ''1''
		when f.lahde in (''34'') then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
		when f.tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
		when f.tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,koulutuksen_tavoite_toteuma = cast(
	(
		case
		when f.tavoite /*tutkinnon_tavoite*/ = ''1'' or coalesce(f.tavoite /*tutkinnon_tavoite*/,'''')='''' then ''1''
		when f.tavoite /*tutkinnon_tavoite*/ = ''2'' then ''2''
		when f.tavoite /*tutkinnon_tavoite*/ = ''9'' then ''3''
		else ''-1''
		end
	)
	as nvarchar(2))
	,tyovoimapoliittinen = cast(
	(
		case
		when f.tyov /*tyovoimapoliittinen_koulutus*/ = ''1'' then ''1''
		when f.tyov /*tyovoimapoliittinen_koulutus*/ = ''2'' or coalesce(f.tyov /*tyovoimapoliittinen_koulutus*/,'''')='''' then ''2''
		else ''-1''
		end
	)
	as nvarchar(2))
	,aloittaneet = CAST(
	(
		case when f.alvv /*kirjoihintulovuosi*/=f.tilv /*tilastointivuosi*/ 
		          and f.olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then f.lkm /*lukumaara*/ end
	)
	as int)
	,opiskelijat = cast(
	(
		case
		when f.olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then f.lkm /*lukumaara*/
		end
	)
	as int)
	,opiskelijat_lasna = cast(
	(
		case
		when f.olosyys /*opiskelijan_olo_syys*/ in (''1'') then f.lkm /*lukumaara*/
		end
	)
	as int)
	,nuorten_aikuisten_koulutus_amm = cast(
	(
		case
		when f.tutktav /*ops_näyttö*/ = ''1'' and f.lahde in (''31'',''32'',''33'',''35'') then 1
		when (f.tutktav /*ops_näyttö*/ in (''1'',''2'') and f.lahde = ''34'' )
		or (f.tutktav /*ops_näyttö*/ = ''2'' and f.lahde in (''31'',''32'',''33'',''35'')) then 2
		else ''-1''
		end
	)
	as nvarchar(2))

	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1'' THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''  THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'') THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'') THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'') THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'') THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34'' THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34'' THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34'' THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34'' THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END

		,yhtjarj = 
			CASE
				WHEN lahde = 21 THEN jarj
				WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33) THEN jarj
				WHEN tilv >= 2013 AND lahde = 35 THEN jarj
				WHEN lahde = 34 THEN opjarj
				ELSE ''-1''
			END

		,yhtoppilaitos = 
			CASE
				WHEN lahde = 21 THEN tunn
				WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33) THEN tunn
				WHEN tilv >= 2013 AND lahde = 35 THEN tunn
				ELSE ''-1''
			END

/*
		  ,yht_koul_jarj_kunta = 
			CASE
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END
*/
 
 
		  ,yht_koulutuksen_kunta = 
			CASE
			 WHEN lahde = 21 THEN kkun
			 WHEN tilv < 2013 AND (lahde = 31 OR lahde = 33) THEN kkun
			 WHEN tilv >= 2013 AND lahde = 35 THEN kkun 
			 ELSE ''-1''
			END


		  ,kotikunta_sama_kuin_koulutuksen_kunta = 
			CASE
				WHEN tilvaskun in (999) or kkun in (200,999) THEN ''-1''
				WHEN tilvaskun=kkun THEN ''1''
				WHEN tilvaskun<>kkun then ''0''
				ELSE ''-1''
			END

		  ,kotimaakunta_sama_kuin_koulutuksen_maakunta =
		    CASE	
				WHEN tilvaskun in (999) or kkun in (200,999) then ''-1''
				WHEN d2.maakunta_koodi=d1.maakunta_koodi THEN ''1''
				WHEN d2.maakunta_koodi<>d1.maakunta_koodi THEN ''0''
				ELSE ''-1''
			END

		   ,kotikunta_sama_kuin_ed_vuonna = 
			CASE
				WHEN tilvaskun=999 or tilvaskunx=999 or (tilvaskun=200 and tilvaskunx=200) then ''-1''
				WHEN tilvaskun=tilvaskunx THEN ''1''
				WHEN tilvaskun<>tilvaskunx THEN ''0''
				ELSE ''-1''
			END
 
		   ,kotimaakunta_sama_kuin_ed_vuonna =
		    CASE	
				WHEN tilvaskun=999 or tilvaskunx=999 or (tilvaskun=200 and tilvaskunx=200) then ''-1''
				WHEN d2.maakunta_koodi=d3.maakunta_koodi THEN ''1''
				WHEN d2.maakunta_koodi<>d3.maakunta_koodi THEN ''0''
				ELSE ''-1''
			END

		   ,ed_vuoden_kotimaakunta_sama_kuin_koulutuksen_maakunta =
		    CASE	
				WHEN tilvaskunx=999 or kkun=999 or (tilvaskunx=200 and kkun=200) then ''-1''
				WHEN d3.maakunta_koodi=d1.maakunta_koodi THEN ''1''
				WHEN d3.maakunta_koodi<>d1.maakunta_koodi THEN ''0''
				ELSE ''-1''
			END

			,ed_vuoden_kotikunta_sama_kuin_koulutuksen_kunta =
		    CASE	
				WHEN tilvaskunx=999 or kkun=999 or (tilvaskunx=200 and kkun=200) then ''-1''
				WHEN tilvaskunx=kkun THEN ''1''
				WHEN tilvaskunx<>kkun THEN ''0''
				ELSE ''-1''
			END


/* 

JOS Aineisto=2.3 JA lahde=21 NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA TILV<2013 JA (lahde=31 TAI lahde=33) NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA TILV>2012 JA lahde=35 NIIN yhtjarj = jarj;
JOS Aineisto=2.3 JA lahde=34 NIIN yhtjarj = opjarj;

JOS Aineisto=2.3 JA lahde=21 NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA TILV<2013 JA (lahde=31 TAI lahde=33) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA TILV>2012 JA lahde=35 NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.3 JA lahde=34 NIIN yhtoppilaitos = ”Tuntematon”;

*/


FROM VipunenTK_DW.dbo.sa_2_3h_Lukio_ja_amm_koulutuksen_opiskelijat AS f
left join VipunenTK.dbo.d_alueluokitus d1 on d1.kunta_koodi=f.kkun
left join VipunenTK.dbo.d_alueluokitus d2 on d2.kunta_koodi=f.tilvaskun
left join VipunenTK.dbo.d_alueluokitus d3 on d3.kunta_koodi=f.tilvaskunx
























' 
GO
/****** Object:  View [dbo].[v_f_2_4_Ammatillisen_koulutuksen_tutkinnot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_4_Ammatillisen_koulutuksen_tutkinnot]'))
EXEC dbo.sp_executesql @statement = N'



















CREATE VIEW [dbo].[v_f_2_4_Ammatillisen_koulutuksen_tutkinnot] AS

-- truncate table f_2_4_Ammatillisen_koulutuksen_tutkinnot
-- insert into f_2_4_Ammatillisen_koulutuksen_tutkinnot select * from v_f_2_4_Ammatillisen_koulutuksen_tutkinnot

SELECT
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,lahde = lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusluokitus = koulk
	,tutkintonimike_ammpk = tunim
	
	,koulutusohjelma_ammpk = koohj
	
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,koulutuksen_kieli = kkieli
	,koulutuksen_kunta = kkun
	,opetushallinnon_koulutus = ophal
	,sukupuoli = sp
	,aidinkieli_versio1 = aikielir1
	,kirjoihintulovuosi =			CASE
										WHEN alvv IS NULL or alvv = '''' THEN ''Tuntematon''
										else cast(alvv AS varchar(10))
									end
	,jarjestys_kirjoihintulovuosi = CASE
										WHEN alvv IS NULL or alvv = '''' THEN 9999
										else cast(alvv AS int)
									end

	,kirjoihintulokausi = allk
	,aikuisopiskelija = aiopis
	,nuorten_aikuisten_koulutus = aikoul
	,ika_5v = kirikar1
	,suorituspaivamaara = suorpvm
	,lukumaara = lkm
	,koulutuksen_tutkinnon_aloitusvuosi = tutalv
	,koulutuksen_tutkinnon_aloituskausi = tutalk
	,ov_hyvaksiluettu_ennen = hyvennen
	,ov_hyvaksiluettu_aikana = hyvaik
	,ov_suoritettu_koulutuksen_aikana = suorkouaik
	,ov_yhteensa = ovyht
	,ov_tyossaoppiminen = tyop
	,lkm_ammattiosaaminen = ammos
	,lkm_opintokokonaisuus = opintokok
	,tyovoimapoliittinen_koulutus = tyov
	,rahoituslahde_amm = rahoitus
	,vayla_nayttotutkintoon = vayla
	,alkamispaivamaara = alaika
	,paattymispaivamaara = loaika
	,tutkinnon_tavoite = tavoite
	,tutkinnon_toteuma = toteuma_tutk
	,yrittajan_oppisopimuskoulutus = yrit
	,oppisopimus_purkautunut = purku
	,todistus_oppisopimuskoulutuksen_suorittamisesta = todis
	,toimiala_2008 = tol2008
	,oppisopimus_yrityksen_koko = koko
	,tyonantajasektori = tyansek
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''2.4a-c''
	,koulutussektori = cast(
	(
		case
		when lahde = ''*1'' then ''1''
		when lahde in (''21'',''22'',''23'') then ''2''
		when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when lahde in (''41'',''42'') then ''4''
		when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))
	,hallinnonala = cast(
	(
		case
		when ophal /*opetushallinnon_koulutus*/ = ''1'' then ''1''
		when tyov  /*tyovoimapoliittinen_koulutus*/ = ''1'' then ''2''
		when ophal /*opetushallinnon_koulutus*/<>''1'' and tyov /*tyovoimapoliittinen_koulutus*/<>''1'' then ''3''
		end
	)
	as nvarchar(2))
	,hallinnonala2 = cast(
	(
		case
		when f.ophal = ''1'' then ''1'' --Opetushallinto, työvoimakoulutus
		when f.ophal = ''2'' and coalesce(coalesce(d1.koulutuksen_jarjestajan_korvaavakoodi,d1.koulutuksen_jarjestajakoodi),'''') not in (''0145076-7'',''2153105-4'',''150622-3'',''0909306-3'' /*''Ålands Landskapsregering'',''Poliisiammattikorkeakoulu'',''Rikosseuraamusalan Koulutuskeskus'',''Pelastusopisto''*/) then ''2'' --Opetushallinto, pl. työvoimakoulutus
		when f.ophal = ''2'' then ''3'' --Muiden hallinnonalojen alainen koulutus
		else ''-1''
		end
	)
	as nvarchar(2))
	,koulutuksen_jarjestamismuoto = cast(
	(
		case
		when lahde in (''31'',''32'',''33'',''35'') then ''1''
		when lahde in (''34'') then ''2''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
		when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
		when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		end
	)
	as nvarchar(2))
	,koulutuksen_tavoite_toteuma = cast(
	(
		case
		when toteuma_tutk /*tutkinnon_toteuma*/ = ''1'' or coalesce(toteuma_tutk /*tutkinnon_toteuma*/,'''')='''' then ''1''
		when toteuma_tutk /*tutkinnon_toteuma*/ = ''2'' then ''2''
		when toteuma_tutk /*tutkinnon_toteuma*/ = ''9'' then ''3''
		end
	)
	as nvarchar(2))
	,tyovoimapoliittinen = cast(
	(
		case
		when tyov /*tyovoimapoliittinen_koulutus*/ = ''1'' then ''1''
		when tyov /*tyovoimapoliittinen_koulutus*/ = ''2'' or coalesce(tyov /*tyovoimapoliittinen_koulutus*/,'''')='''' then ''2''
		end
	)
	as nvarchar(2))
	,tutkinnot = cast(
		lkm /*lukumaara*/
	as int)
	,nuorten_aikuisten_koulutus_amm = cast(
	(
		case
		when f.tutktav /*ops_näyttö*/ = ''1'' and f.lahde in (''31'',''32'',''33'',''35'') then 1
		when (f.tutktav /*ops_näyttö*/ in (''1'',''2'') and f.lahde = ''34'')
		or (f.tutktav /*ops_näyttö*/ = ''2'' and f.lahde in (''31'',''32'',''33'',''35'')) then 2
		else ''-1''
		end
	)
	as nvarchar(2))

	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1''
				THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END

		,yhtjarj = 
			CASE
				WHEN (lahde = 22 OR lahde = 23) THEN jarj
				WHEN tilv < 2013 AND (lahde = 32 OR lahde = 33 OR lahde = 35) THEN jarj
				WHEN tilv >= 2013 AND lahde = 35 AND jarj_opisk <> ''-1'' THEN jarj_opisk
				WHEN tilv >= 2013 AND lahde = 35 AND jarj_opisk = ''-1'' THEN jarj
				WHEN lahde = 34 THEN opjarj
				ELSE ''-1''
			END

		,yhtoppilaitos = 
			CASE
				WHEN (lahde = 22 OR lahde = 23) THEN tunn
				WHEN tilv < 2013 AND (lahde = 32 OR lahde = 33  OR lahde = 35) THEN tunn
				WHEN tilv >= 2013 AND lahde = 35 AND tunn_opisk <> ''-1'' THEN tunn_opisk
				WHEN tilv >= 2013 AND lahde = 35 AND tunn_opisk = ''-1'' THEN tunn
				ELSE ''-1''
			END


/*
		  , yht_koul_jarj_kunta =
			CASE
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END
*/
 


		   ,yht_koulutuksen_kunta = 
			CASE
			 WHEN (lahde = 22 OR lahde = 23) THEN kkun
			 WHEN tilv < 2013 AND (lahde = 32 OR lahde = 33 OR lahde=35) THEN kkun
			 WHEN tilv >= 2013 AND lahde = 35 AND kkun_opisk <> ''-1'' THEN kkun_opisk
			 WHEN tilv >= 2013 AND lahde = 35 AND kkun_opisk = ''-1'' THEN kkun
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END


	,koulutusryhma_avain =
		CASE
			WHEN aikoul = ''1''
				THEN ''21'' --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN ''22'' --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''31'' --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''32'' --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''33'' --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''33'' --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN ''35'' --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN ''35'' --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN ''35'' --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN ''35'' --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END 
					
/*
JOS Aineisto=2.4 JA (lahde=22 TAI lahde=23) NIIN yhtjarj = jarj;
JOS Aineisto=2.4 JA TILV<2013 JA (lahde=32 TAI lahde=33) NIIN yhtjarj = jarj;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA jarj_opisk<>”” NIIN yhtjarj = jarj_opisk;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA jarj_opisk = ”” NIIN yhtjarj = jarj;
JOS Aineisto=2.4 JA lahde=34 NIIN yhtjarj = opjarj;

JOS Aineisto=2.4 JA (lahde=22 TAI lahde=23) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.4 JA TILV<2013 JA (lahde=32 TAI lahde=33) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA tunn_opisk<>”” NIIN yhtoppilaitos = tunn_opisk;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA tunn_opisk = ”” NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.4 JA lahde=34 NIIN yhtoppilaitos = ”Tuntematon”;

*/


FROM VipunenTK_DW.dbo.[sa_2_4_Amm_koulutuksen_tutkinnot] f
left join VipunenTK.dbo.d_oppilaitoksen_taustatiedot d1 on d1.oppilaitos_avain = coalesce(nullif(coalesce(nullif(f.jarj,''-1''),f.opjarj),''-1''),f.tunn)




















' 
GO
/****** Object:  View [dbo].[v_f_2_4efg_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_tutkinnot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_4efg_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_tutkinnot]'))
EXEC dbo.sp_executesql @statement = N'



















CREATE VIEW [dbo].[v_f_2_4efg_Lukiokoulutuksen_ja_ammatillisen_koulutuksen_tutkinnot] AS

-- truncate table f_2_4_Ammatillisen_koulutuksen_tutkinnot
-- insert into f_2_4_Ammatillisen_koulutuksen_tutkinnot select * from v_f_2_4_Ammatillisen_koulutuksen_tutkinnot

SELECT
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,lahde = lahde
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusluokitus = koulk
	,tutkintonimike_ammpk = tunim
	,koulutusohjelma_ammpk = koohj
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,koulutuksen_kieli = kkieli
	,koulutuksen_kunta = kkun
	,opetushallinnon_koulutus = ophal
	,sukupuoli = sp
	,aidinkieli_versio1 = aikielir1
	,aikuisopiskelija = aiopis
	,nuorten_aikuisten_koulutus = aikoul
	,ika_kirjoihintulovuonna = case ika2 when ''60'' then ''kirikar160'' else ika2 end
	,ikaryhma_kirjoihintulovuonna =
						case 
							when ika2 in (''0'',''1'',''2'') then ''ikaryh2_2''
							when ika2 in (''3'',''4'',''5'') then ''ikaryh2_5''
							when ika2=''6'' then ''ikaryh2_6''
							when ika2 in (''7'',''8'',''9'',''10'',''11'',''12'') then ''ikaryh2_12''
							when ika2 in (''13'',''14'',''15'') then ''ikaryh2_15''
							when ika2 in (''16'',''17'',''18'') then ''ikaryh2_18''
							when ika2 in (''19'',''20'',''21'') then ''ikaryh2_21''
							when ika2 in (''22'',''23'',''24'') then ''ikaryh2_24''
							when ika2 in (''25'',''26'',''27'',''28'',''29'') then ''ikaryh2_29''
							when ika2 in (''30'',''31'',''32'',''33'',''34'') then ''ikaryh2_34''
							when ika2 in (''35'',''36'',''37'',''38'',''39'') then ''ikaryh2_39''
							when ika2 in (''40'',''41'',''42'',''43'',''44'') then ''ikaryh2_44''
							when ika2 in (''45'',''46'',''47'',''48'',''49'') then ''ikaryh2_49''
							when ika2 in (''50'',''51'',''52'',''53'',''54'') then ''ikaryh2_54''
							when ika2 in (''55'',''56'',''57'',''58'',''59'') then ''ikaryh2_59''
							when ika2 in (''60'',''61'',''62'',''63'',''64'') then ''kirikar160''
							else ''-1''
						end
	,ika = case when ika2<>''XX'' and tutalv<>''-1'' and cast(ika2 as int)+(cast(tilv as int)-cast(tutalv as int))>=60 then ''kirikar160'' when ika2=''XX'' or tutalv=''-1'' then ''-1'' else cast(cast(ika2 as int)+(cast(tilv as int)-cast(tutalv as int)) as nvarchar) end
	,ikaryhma = 
		case 
			when ika_k in (''0'',''1'',''2'') then ''ikaryh2_2''
			when ika_k in (''3'',''4'',''5'') then ''ikaryh2_5''
			when ika_k=''6'' then ''ikaryh2_6''
			when ika_k in (''7'',''8'',''9'',''10'',''11'',''12'') then ''ikaryh2_12''
			when ika_k in (''13'',''14'',''15'') then ''ikaryh2_15''
			when ika_k in (''16'',''17'',''18'') then ''ikaryh2_18''
			when ika_k in (''19'',''20'',''21'') then ''ikaryh2_21''
			when ika_k in (''22'',''23'',''24'') then ''ikaryh2_24''
			when ika_k in (''25'',''26'',''27'',''28'',''29'') then ''ikaryh2_29''
			when ika_k in (''30'',''31'',''32'',''33'',''34'') then ''ikaryh2_34''
			when ika_k in (''35'',''36'',''37'',''38'',''39'') then ''ikaryh2_39''
			when ika_k in (''40'',''41'',''42'',''43'',''44'') then ''ikaryh2_44''
			when ika_k in (''45'',''46'',''47'',''48'',''49'') then ''ikaryh2_49''
			when ika_k in (''50'',''51'',''52'',''53'',''54'') then ''ikaryh2_54''
			when ika_k in (''55'',''56'',''57'',''58'',''59'') then ''ikaryh2_59''
			when ika_k in (''60'',''61'',''62'',''63'',''64'') then ''kirikar160''
			when ika_k > ''64'' or ika_k like ''10%'' then ''kirikar160''
			when ika_k = ''kirikar160'' then ''kirikar160''
			else ''-1''
		end
	,lukumaara = lkm
	,koulutuksen_tutkinnon_aloitusvuosi = tutalv
	,koulutuksen_tutkinnon_aloituskausi = tutalk
	,ov_hyvaksiluettu_ennen = hyvennen
	,ov_hyvaksiluettu_aikana = hyvaik
	,ov_suoritettu_koulutuksen_aikana = suorkouaik
	,ov_yhteensa = ovyht
	,ov_tyossaoppiminen = tyop
	,lkm_ammattiosaaminen = ammos
	,lkm_opintokokonaisuus = opintokok
	,lkm_tutkintojen_osat = suorosat
	,rahoituslahde_amm = rahoitus
	,vayla_nayttotutkintoon = vayla
	,tutkinnon_tavoite = tavoite
	,tutkinnon_toteuma = toteuma_tutk
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''2.4a-c''
	,koulutussektori = cast(
	(
		case
			when lahde = ''*1'' then ''1''
			when lahde in (''21'',''22'',''23'') then ''2''
			when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
			when lahde in (''41'',''42'') then ''4''
			when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))

	,koulutuksen_jarjestamismuoto = cast(
	(
		case
			when lahde in (''31'',''32'',''33'',''35'') then ''1''
			when lahde in (''34'') then ''2''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
			when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
			when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		end
	)
	as nvarchar(2))
	,koulutuksen_tavoite_toteuma = cast(
	(
		case
			when toteuma_tutk /*tutkinnon_toteuma*/ = ''1'' or coalesce(toteuma_tutk /*tutkinnon_toteuma*/,'''')='''' then ''1''
			when toteuma_tutk /*tutkinnon_toteuma*/ = ''2'' then ''2''
			when toteuma_tutk /*tutkinnon_toteuma*/ = ''9'' then ''3''
		end
	)
	as nvarchar(2))
	,tutkinnot = cast(
		lkm /*lukumaara*/
	as int)
	,nuorten_aikuisten_koulutus_amm = cast(
	(
		case
			when f.tutktav /*ops_näyttö*/ = ''1'' and f.lahde in (''31'',''32'',''33'',''35'') then 1
			when (f.tutktav /*ops_näyttö*/ in (''1'',''2'') and f.lahde = ''34'') or (f.tutktav /*ops_näyttö*/ = ''2'' and f.lahde in (''31'',''32'',''33'',''35'')) then 2
			else ''-1''
		end
	)
	as nvarchar(2))

	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1''
				THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END

	,yhtjarj = 
		CASE
			WHEN (lahde = 22 OR lahde = 23) THEN jarj
			WHEN tilv < 2013 AND (lahde = 32 OR lahde = 33) THEN jarj
			WHEN tilv >= 2013 AND lahde = 35 AND jarj_opisk <> ''-1'' THEN jarj_opisk
			WHEN tilv >= 2013 AND lahde = 35 AND jarj_opisk = ''-1'' THEN jarj
			WHEN lahde = 34 THEN opjarj
			ELSE ''-1''
		END



/*
		  , yht_koul_jarj_kunta =
			CASE
			 WHEN lahde = 34 THEN kkun
			 ELSE ''-1''
			END
*/
 


	,yht_koulutuksen_kunta = 
		CASE
			WHEN (lahde = 22 OR lahde = 23) THEN kkun
			WHEN tilv < 2013 AND (lahde = 32 OR lahde = 33) THEN kkun
			WHEN tilv >= 2013 AND lahde = 35 AND kkun_opisk <> ''-1'' THEN kkun_opisk
			WHEN tilv >= 2013 AND lahde = 35 AND kkun_opisk = ''-1'' THEN kkun
			WHEN lahde = 34 THEN kkun
			ELSE ''-1''
		END


	,koulutusryhma_avain =
		CASE
			WHEN aikoul = ''1''
				THEN ''21'' --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN ''22'' --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''31'' --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''32'' --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''33'' --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN ''33'' --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN ''35'' --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN ''35'' --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN ''35'' --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN ''35'' --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END 
					
/*
JOS Aineisto=2.4 JA (lahde=22 TAI lahde=23) NIIN yhtjarj = jarj;
JOS Aineisto=2.4 JA TILV<2013 JA (lahde=32 TAI lahde=33) NIIN yhtjarj = jarj;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA jarj_opisk<>”” NIIN yhtjarj = jarj_opisk;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA jarj_opisk = ”” NIIN yhtjarj = jarj;
JOS Aineisto=2.4 JA lahde=34 NIIN yhtjarj = opjarj;

JOS Aineisto=2.4 JA (lahde=22 TAI lahde=23) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.4 JA TILV<2013 JA (lahde=32 TAI lahde=33) NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA tunn_opisk<>”” NIIN yhtoppilaitos = tunn_opisk;
JOS Aineisto=2.4 JA TILV>2012 JA lahde=35 JA tunn_opisk = ”” NIIN yhtoppilaitos = tunn;
JOS Aineisto=2.4 JA lahde=34 NIIN yhtoppilaitos = ”Tuntematon”;

*/


FROM VipunenTK_DW.dbo.[sa_2_4efg_Lukio_ja_amm_koulutuksen_tutkinnot] f



cross apply (SELECT 
		case 
			when ika2<>''XX'' and tutalv<>''-1'' and cast(ika2 as int)+(cast(tilv as int)-cast(tutalv as int))>=60 then ''kirikar160'' 
			when ika2=''XX'' or tutalv=''-1'' then ''-1'' 
			else cast(cast(ika2 as int)+(cast(tilv as int)-cast(tutalv as int)) as nvarchar) 
		end AS ika_k) aa
















' 
GO
/****** Object:  View [dbo].[v_f_2_5_Lukiokoulutuksen_ainevalinnat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_5_Lukiokoulutuksen_ainevalinnat]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_2_5_Lukiokoulutuksen_ainevalinnat] AS

-- drop table f_2_5_Lukiokoulutuksen_ainevalinnat
-- select * into dbo.f_2_5_Lukiokoulutuksen_ainevalinnat from v_f_2_5_Lukiokoulutuksen_ainevalinnat

-- truncate table f_2_5_Lukiokoulutuksen_ainevalinnat
-- insert into f_2_5_Lukiokoulutuksen_ainevalinnat select * from v_f_2_5_Lukiokoulutuksen_ainevalinnat

SELECT
	 tilastointivuosi = tilv
	,tilv_date = CAST(tilv+''0101'' as date)
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj

      ,[nukevy]
      ,[aikevy]
      ,[kev]
      ,[nukevyn]
      ,[aikevyn]
      ,[kevn]
      ,[nukev1]
      ,[nukev2]
      ,[nukev3]
      ,[nukev4]
      ,[nukev]
      ,[nukev1n]
      ,[nukev2n]
      ,[nukev3n]
      ,[nukev4n]
      ,[nukevn]
      ,[aikev1]
      ,[aikev2]
      ,[aikev3]
      ,[aikev4]
      ,[aikev]
      ,[aikev1n]
      ,[aikev2n]
      ,[aikev3n]
      ,[aikev4n]
      ,[aikevn]
      ,[nuvary]
      ,[aivary]
      ,[var]
      ,[nuvaryn]
      ,[aivaryn]
      ,[varn]
      ,[nuyks]
      ,[aiyks]
      ,[yksy]
      ,[nuvar2]
      ,[nuvar25]
      ,[nuvar3]
      ,[nuvar35]
      ,[nuvar4]
      ,[nuvar45]
      ,[nuvar5]
      ,[nuvar]
      ,[nuvar2n]
      ,[nuvar25n]
      ,[nuvar3n]
      ,[nuvar35n]
      ,[nuvar4n]
      ,[nuvar45n]
      ,[nuvar5n]
      ,[nuvarn]
      ,[aivar2]
      ,[aivar25]
      ,[aivar3]
      ,[aivar35]
      ,[aivar4]
      ,[aivar45]
      ,[aivar5]
      ,[aivar]
      ,[aivar2n]
      ,[aivar25n]
      ,[aivar3n]
      ,[aivar35n]
      ,[aivar4n]
      ,[aivar45n]
      ,[aivar5n]
      ,[aivarn]
      ,[ev]
      ,[ort]
      ,[et]
      ,[mu]
      ,[eos]
      ,[kay]
      ,[kieli1]
      ,[kieli2]
      ,[kieli3]
      ,[kieli4]
      ,[kieli5]
      ,[kieli6]
      ,[kieliy]
      ,[sv]
      ,[rv]
      ,[svrv]
      ,[svnn]
      ,[rvnn]
      ,[svrvn]
      ,[yaenm]
      ,[yyenm]
      ,[yen6m]
      ,[len6m]
      ,[alen6m]
      ,[enmm]
      ,[yaenn]
      ,[yyenn]
      ,[yen6n]
      ,[len6n]
      ,[alen6n]
      ,[ennn]
      ,[yarum]
      ,[yyrum]
      ,[yru6m]
      ,[lru6m]
      ,[alru6m]
      ,[rumm]
      ,[yarun]
      ,[yyrun]
      ,[yru6n]
      ,[lru6n]
      ,[alru6n]
      ,[runn]
      ,[yasum]
      ,[yysum]
      ,[ysu6m]
      ,[lsu6m]
      ,[alsu6m]
      ,[summ]
      ,[yasun]
      ,[yysun]
      ,[ysu6n]
      ,[lsu6n]
      ,[alsu6n]
      ,[sunn]
      ,[yaram]
      ,[yyram]
      ,[yra6m]
      ,[lra6m]
      ,[alra6m]
      ,[ramm]
      ,[yaran]
      ,[yyran]
      ,[yra6n]
      ,[lra6n]
      ,[alra6n]
      ,[rann]
      ,[yasam]
      ,[yysam]
      ,[ysa6m]
      ,[lsa6m]
      ,[alsa6m]
      ,[samm]
      ,[yasan]
      ,[yysan]
      ,[ysa6n]
      ,[lsa6n]
      ,[alsa6n]
      ,[sann]
      ,[yavem]
      ,[yyvem]
      ,[yve6m]
      ,[lve6m]
      ,[alve6m]
      ,[vemm]
      ,[yaven]
      ,[yyven]
      ,[yve6n]
      ,[lve6n]
      ,[alve6n]
      ,[vennn]
      ,[yasaam]
      ,[ysaa6m]
      ,[lsaa6m]
      ,[alsaa6m]
      ,[saamm]
      ,[yasaan]
      ,[ysaa6n]
      ,[lsaa6n]
      ,[alsaa6n]
      ,[saann]
      ,[yalatm]
      ,[ylat6m]
      ,[lla6m]
      ,[alla6m]
      ,[lamm]
      ,[yalan]
      ,[ylat6n]
      ,[lla6n]
      ,[alla6n]
      ,[lann]
      ,[yaesm]
      ,[yes6m]
      ,[les6m]
      ,[ales6m]
      ,[esmm]
      ,[yaesn]
      ,[yes6n]
      ,[les6n]
      ,[ales6n]
      ,[esnn]
      ,[yaitm]
      ,[yit6m]
      ,[lit6m]
      ,[alit6m]
      ,[itmm]
      ,[yaitn]
      ,[yit6n]
      ,[lit6n]
      ,[alit6n]
      ,[itnn]
      ,[yamum]
      ,[yymum]
      ,[ymu6m]
      ,[lmu6m]
      ,[almu6m]
      ,[mumm]
      ,[yamun]
      ,[yymun]
      ,[ymu6n]
      ,[lmu6n]
      ,[almu6n]
      ,[munn]
      ,[yyvam]
      ,[vamm]
      ,[yyvan]
      ,[vann]
      ,[pmatm]
      ,[pmatn]
      ,[pmaty]
      ,[lmatm]
      ,[lmatn]
      ,[lmaty]
      ,[matm]
      ,[matn]
      ,[maty]
      ,[pma1m]
      ,[pma1n]
      ,[pma2m]
      ,[pma2n]
      ,[pma3m]
      ,[pma3n]
      ,[pma45m]
      ,[pma45n]
      ,[pma6m]
      ,[pma6n]
      ,[pma7m]
      ,[pma7n]
      ,[lma1m]
      ,[lma1n]
      ,[lma2m]
      ,[lma2n]
      ,[lma3m]
      ,[lma3n]
      ,[lma45m]
      ,[lma45n]
      ,[lma6m]
      ,[lma6n]
      ,[lma7m]
      ,[lma7n]
      ,[fy1m]
      ,[fy1n]
      ,[fy2m]
      ,[fy2n]
      ,[fy3m]
      ,[fy3n]
      ,[fy45m]
      ,[fy45n]
      ,[fy6m]
      ,[fy6n]
      ,[fy7m]
      ,[fy7n]
      ,[ke1m]
      ,[ke1n]
      ,[ke2m]
      ,[ke2n]
      ,[ke3m]
      ,[ke3n]
      ,[ke45m]
      ,[ke45n]
      ,[ke6m]
      ,[ke6n]
      ,[ke7m]
      ,[ke7n]
      ,[bi1m]
      ,[bi1n]
      ,[bi2m]
      ,[bi2n]
      ,[bi3m]
      ,[bi3n]
      ,[bi45m]
      ,[bi45n]
      ,[bi6m]
      ,[bi6n]
      ,[bi7m]
      ,[bi7n]
      ,[mt1m]
      ,[mt1n]
      ,[mt2m]
      ,[mt2n]
      ,[mt3m]
      ,[mt3n]
      ,[mt45m]
      ,[mt45n]
      ,[mt6m]
      ,[mt6n]
      ,[mt7m]
      ,[mt7n]
      ,[soma2m]
      ,[soma2n]
      ,[soma3m]
      ,[soma3n]
      ,[sofy2m]
      ,[sofy2n]
      ,[sofy3m]
      ,[sofy3n]
      ,[soke2m]
      ,[soke2n]
      ,[soke3m]
      ,[soke3n]
      ,[sobi2m]
      ,[sobi2n]
      ,[sobi3m]
      ,[sobi3n]
      ,[somt2m]
      ,[somt2n]
      ,[somt3m]
      ,[somt3n]
      ,[sotek2m]
      ,[sotek2n]
      ,[sotek3m]
      ,[sotek3n]

-- aineistotiedot
	,tietolahde = tietolahde
	,rivinumero = rivinumero
	,aineistotunnus = ''2.5''
FROM VipunenTK_DW.dbo.sa_2_5_Lukiokoulutuksen_ainevalinnat
' 
GO
/****** Object:  View [dbo].[v_f_2_8_Korkeakouluopiskelijat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_8_Korkeakouluopiskelijat]'))
EXEC dbo.sp_executesql @statement = N'











CREATE VIEW [dbo].[v_f_2_8_Korkeakouluopiskelijat] AS

-- truncate table f_2_8_Korkeakouluopiskelijat
-- insert into f_2_8_Korkeakouluopiskelijat select * from v_f_2_8_Korkeakouluopiskelijat


SELECT
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,aineisto = aineisto
	,lahde = lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,koulutusluokitus = koulk
	,koulutuksen_kunta = kkun
	,sukupuoli = sp
	,aidinkieli_versio1x = aikielir1x
	,syntymavuosi = syntv
	,kotikunta = tilvaskun
	,kotikunta1x = tilvaskunx
	,kotikunta2x = tilvaskun2x
	,kansalaisuus_versio2 = kansalr2
	,kirjoihintulovuosi =			CASE
										WHEN alvv IS NULL or alvv = '''' THEN ''Tuntematon''
										else cast(alvv AS varchar(10))
									end
	,jarjestys_kirjoihintulovuosi = CASE
										WHEN alvv IS NULL or alvv = '''' THEN 9999
										else cast(alvv AS int)
									end
	,kirjoihintulokausi = allk
	,opiskelijan_olo_tamm = olotamm
	,opiskelijan_olo_syys = olosyys
	,rahoituslahde = rahlahde
	,opiskelijan_fte_tieto = fte
	,kirjoihintulovuosi_korkeakoulusektori = alvv_kksek
	,kirjoihintulovuosi_korkeakoulusektori_lasnaoleva = alvv_kksek_lasna
	,kirjoihintulovuosi_sektori = alvv_sek
	,kirjoihintulovuosi_sektori_lasnaoleva = alvv_sek_lasna
	,kirjoihintulovuosi_korkeakoulu = alvv_kk
	,kirjoihintulovuosi_korkeakoulu_lasnaoleva = alvv_kk_lasna
	,kirjoihintulovuosi_opintoala = alvv_opa
	,kirjoihintulovuosi_opintoala_lasnaoleva = alvv_opa_lasna
	,lukumaara = lkm
	,lkm_op0 = opyht0
	,lkm_op1_14 = opyht14
	,lkm_op15_29 = opyht29
	,lkm_op30_44 = opyht44
	,lkm_op45_59 = opyht59
	,lkm_op60_74 = opyht74
	,lkm_op75_89 = opyht89
	,lkm_op90_104 = opyht104
	,lkm_op105_119 = opyht119
	,lkm_op120_ = opyht120
	,vahintaan_55_op_suorittanut = op55
	,op_edellinen_syksy = opes
	,op_edellinen_kevat = opek
	,op_kertyma_edel_lkv_loppu = opker
	,tutkinto_amk = tutkamk
	
	,koulutusohjelma_amk = koamk
	
	,suuntautumisvaihtoehto_amk = suun_v
	
	,koulutustyyppi = koultyp
	,koulutuksen_kieli = kkieli
	,lkm_lasnalk = lasnalk
	,lkm_poissalk = poissalk
	,op_suoritettavien_laajuus = oplaaj
	,kirjoihintulovuosi_tutkinto = kirtu1v
	,kirjoihintulokausi_tutkinto = kirtu1k
	,ensisijainen_opintooikeus = ensisop
	,tilauskoulutuksen_sijaintimaa = tilmaa
	,tutkinto_yo = tutkyo
	
	,koulutusohjelma_yo = koyo
	
	,paaaine_yo = paine
	
	,yliopisto = kk
	,tiedekunta_yo = tdk
	,uusi_vanha_opiskelija = fuksi
	,tutkintooikeusvuosi = opoikv
	,opiskelumuoto = om
	,opettajankelpoisuus = opkelp
	,avoinvayla = avo
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''2.8a-c''
	,koulutussektori = cast(
	(
		case
		when lahde = ''*1'' then ''1''
		when lahde in (''21'',''22'',''23'') then ''2''
		when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when lahde in (''41'',''42'') then ''4''
		when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))
	,ika_1v = CAST(
	(
		case
		when isnumeric(syntv)=1 and syntv<tilv
		then cast(cast(tilv as int) - cast(syntv as int) as varchar)
		end
	)
	as nvarchar(4))
	--Tehdään lukumäärämuuttuja Aloittaneet, joka saa arvoja seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_kk_lasna = tilv NIIN Aloittaneet = lkm
	---JOS Aineisto=2.8b-d JA koultyp=6 JA alvv=tilv JA olosyys=1 NIIN Aloittaneet=lkm

	,aloittaneet = CAST(
	(
		case
		-- kaksi ekaa historia-aineistoja varten
			when lahde = 41 --historia-aineisto
				and alvv = tilv 
				and koultyp <> 6 
				--and ensisop = 1
				and tilv<2010
			then lkm

			when alvv = tilv 
				and koultyp = ''6''
				and olosyys  IN (''1'',''2'')
				--and ensisop = 1
				and tilv<2010
			then lkm 
		--
			when lahde = 41
				and alvv = tilv 
				and koultyp not in (''6'' ,''7'')
				and ensisop = 1
			then lkm  

			when alvv = tilv 
				and koultyp in (''6'',''7'')
				and olosyys  IN (''1'',''2'')
				and ensisop = 1
			then lkm 

			when lahde = 51
				and alvv = tilv 
				and olosyys  IN (''1'',''2'')
				and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))
			then lkm 
		end
	)
	as int)



/*


2.8:

 ,aloittaneet = CAST(
  (
   case JOS lahde = 41
   when alvv_kk_lasna /*kirjoihintulovuosi_korkeakoulu_lasnaoleva*/=tilv and koultyp <> 6 and ensiop = 1 /*tilastointivuosi*/ then lkm /*lukumaara*/

  when alvv /*kirjoihintulovuosi*/=tilv /*tilastointivuosi*/
    and koultyp /*koulutustyyppi*/=''6''

   and ensiop = 1
    and olosyys /*opiskelijan_olo_syys*/ IN (''1'',''2'')
   then lkm /*lukumaara*/

JOS lahde = 51

when alvv /*kirjoihintulovuosi*/=tilv /*tilastointivuosi*/

   and olosyys /*opiskelijan_olo_syys*/ IN (''1'',''2'')

   and ensiop = 1
 then lkm /*lukumaara*/

  end
  )
  as int)



*/




	--Aloittaneet_alvv
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv = tilv NIIN Aloittaneet_alvv = lkm
	--Aloittaneet_alvv_kksek
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_kksek, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_kksek = tilv NIIN Aloittaneet_alvv_kksek = lkm
	--Aloittaneet_alvv_kksek_lasna
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_kksek_lasna, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_kksek_lasna = tilv NIIN Aloittaneet_alvv_kksek_lasna = lkm
	--Aloittaneet_alvv_sek
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_sek, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_sek = tilv NIIN Aloittaneet_alvv_sek = lkm
	--Aloittaneet_alvv_sek_lasna
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_sek_lasna, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_sek_lasna = tilv NIIN Aloittaneet_alvv_sek_lasna = lkm
	--Aloittaneet_alvv_kk
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_kk, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_kk = tilv NIIN Aloittaneet_alvv_kk= lkm
	--Aloittaneet_alvv_kk_lasna
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_kk_lasna, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_kk_lasna = tilv NIIN Aloittaneet_alvv_kk_lasna= lkm
	--HUOM! TÄMÄ TARKOITUKSELLA ’UUDELLEEN’ VRT. KOHTA Aloittaneet
	--Aloittaneet_alvv_opa
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_opa, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_opa = tilv NIIN Aloittaneet_alvv_opa = lkm
	--Aloittaneet_alvv_opa_lasna
	--Tehdään lukumäärämuuttuja Aloittaneet_alvv_opa_lasna, joka saa arvon seuraavasti:
	---JOS  Aineisto= 2.8a-c JA alvv_opa_lasna = tilv NIIN Aloittaneet_alvv_opa_lasna= lkm
	,aloittaneet_kirjoihintulovuosi = CAST(
	case when alvv=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_korkeakoulusektori = cast(
	case when alvv_kksek=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_korkeakoulusektori_lasnaoleva =cast(
	case when alvv_kksek_lasna=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_sektori = cast(
	case when alvv_sek=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_sektori_lasnaoleva =cast(
	case when alvv_sek_lasna=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_korkeakoulu =cast(
	case when alvv_kk=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_korkeakoulu_lasnaoleva =cast(
	case when alvv_kk_lasna=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_opintoala =cast(
	case when alvv_opa=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)
	,aloittaneet_opintoala_lasnaoleva =cast(
	case when alvv_opa_lasna=tilv and koulk NOT IN (SELECT DISTINCT koulutusluokitus_avain FROM vipunentk_dw..d_koulutusluokitus where koulutusaste2002_koodi IN (''73'',''81'',''82'',''91''))then lkm end
	as int)

	,opiskelijat = cast(
	(
		case
		when olosyys /*opiskelijan_olo_syys*/ in (''1'',''2'') then lkm /*lukumaara*/
		end
	)
	as int)
	,opiskelijat_lasna = cast(
	(
		case
		when olosyys /*opiskelijan_olo_syys*/ in (''1'') then lkm /*lukumaara*/
		end
	)
	as int)
	,opiskelijat_fte = cast(
	(
		case
		when fte /*opiskelijan_fte_tieto*/=''0'' then 0.0
		when fte = ''1'' then 0.5 * lkm
		when fte = ''2'' then 1.0 * lkm
		end
	)
	as decimal(18,1))


	,koulutuslaji_OKM_avain =
		CASE
			WHEN koultyp = ''1''
				THEN 13	--Ammattikorkeakoulututkinto (nuorten koulutus)  
			WHEN koultyp = ''2''
				THEN 14	--Ammattikorkeakoulututkinto (aikuiskoulutus)  
			WHEN koultyp = ''6'' 
				THEN 15	--Ylempi ammattikorkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 63
							)
				THEN 16	--Alempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 72
							)
				THEN 17	--Ylempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 73
							)
				THEN 18	--Lääkärien erikoistumiskoulutus
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 81
							)

				THEN 19	--Lisensiaatintutkinto
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 82
							)

				THEN 20	--Tohtorintutkinto

			ELSE -1
		END

	,koulutusryhma_avain =
		CASE
			WHEN koultyp = ''1''
				THEN ''41''	--Ammattikorkeakoulututkinto (nuorten koulutus)  
			WHEN koultyp = ''2''
				THEN ''42''	--Ammattikorkeakoulututkinto (aikuiskoulutus)  
			WHEN koultyp = ''6'' 
				THEN ''46''	--Ylempi ammattikorkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 63
							)
				THEN ''51''	--Alempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 72
							)
				THEN ''51''	--Ylempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 73
							)
				THEN ''52''	--Lääkärien erikoistumiskoulutus
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 81
							)

				THEN ''52''	--Lisensiaatintutkinto
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 82
							)

				THEN ''52''	--Tohtorintutkinto

			ELSE -1
		END

      ,ikaryhma1_avain = 
		CASE
			WHEN syntv = 9999 THEN ''-1''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) >59 THEN ''kirikar160''
			ELSE cast(cast(tilv as int) - syntv as varchar(10))
		END
      ,ikaryhma2_avain = 
		CASE
			WHEN syntv = 9999 THEN ''-1''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) <3 THEN ''ikaryh2_2''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 3 AND 5 THEN ''ikaryh2_5''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) = 6 THEN ''ikaryh2_6''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 7 AND 12 THEN ''ikaryh2_12''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 13 AND 15 THEN ''ikaryh2_15''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 16 AND 18 THEN ''ikaryh2_18''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 19 AND 21 THEN ''ikaryh2_21''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 22 AND 24 THEN ''ikaryh2_24''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 25 AND 29 THEN ''ikaryh2_29''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 30 AND 34 THEN ''ikaryh2_34''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 35 AND 39 THEN ''ikaryh2_39''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 40 AND 44 THEN ''ikaryh2_44''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 45 AND 49 THEN ''ikaryh2_49''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 50 AND 54 THEN ''ikaryh2_54''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 55 AND 59 THEN ''ikaryh2_59''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 60 AND 64 THEN ''ikaryh2_64''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) > 64 THEN ''ikaryh2_65''
			ELSE ''-1''
		END

FROM VipunenTK_DW.dbo.sa_2_8_Korkeakoulut_opiskelijat












' 
GO
/****** Object:  View [dbo].[v_f_2_9_Korkeakoulututkinnot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_2_9_Korkeakoulututkinnot]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_f_2_9_Korkeakoulututkinnot] AS

-- truncate table f_2_9_Korkeakoulututkinnot
-- insert into f_2_9_Korkeakoulututkinnot select * from v_f_2_9_Korkeakoulututkinnot


SELECT
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,aineisto = aineisto
	,lahde = lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,koulutusluokitus = koulk
	,opintoala1995 = opm95opa
	,koulutuksen_kunta = kkun
	,sukupuoli = sp
	,aidinkieli_versio1x = aikielir1x
	,syntymavuosi = syntv
	,kotikunta = tilvaskun
	,kotikunta1x = tilvaskunx
	,kansalaisuus_versio2 = kansalr2
	,kirjoihintulovuosi =			CASE
										WHEN alvv IS NULL or alvv = '''' or alvv = ''0998'' THEN ''Tuntematon''
										else cast(alvv AS varchar(10))
									end
	,jarjestys_kirjoihintulovuosi = CASE
										WHEN alvv IS NULL or alvv = '''' THEN 9999
										else cast(alvv AS int)
									end
	,kirjoihintulokausi = allk
	,tutkinnon_suoritusvuosi = suorv
	,tutkinnon_suorituslukukausi = suorlk
	,rahoituslahde = rahlahde
	,kirjoihintulovuosi_korkeakoulusektori = alvv_kksek
	,kirjoihintulovuosi_korkeakoulusektori_lasnaoleva = alvv_kksek_lasna
	,kirjoihintulovuosi_sektori = alvv_sek
	,kirjoihintulovuosi_sektori_lasnaoleva = alvv_sek_lasna
	,kirjoihintulovuosi_korkeakoulu = alvv_kk
	,kirjoihintulovuosi_korkeakoulu_lasnaoleva = alvv_kk_lasna
	,kirjoihintulovuosi_opintoala = alvv_opa
	,kirjoihintulovuosi_opintoala_lasnaoleva = alvv_opa_lasna
	,lukumaara = lkm
	,tutkinto_amk = tutkamk
	
	,koulutusohjelma_amk = koamk
	
	,suuntautumisvaihtoehto_amk = suun_v
	
	,koulutustyyppi = koultyp
	,koulutuksen_kieli = kkieli
	,lkm_lasnalk = lasnalk
	,lkm_poissalk = poissalk
	,op_suoritettavien_laajuus = oplaaj
	,kirjoihintulovuosi_tutkinto = kirtu1v
	,kirjoihintulokausi_tutkinto = kirtu1k
	,op_amk_yhteensa = opyhtamk
	,op_amk_yleissiv_amm_opplait = opylamamk
	,op_amk_muualla = opmuuamk
	,op_amk_oma_amk = opoamk
	,op_amk_muu_amk = opmamk
	,op_amk_yliopistoissa = opyliopamk
	,op_amk_ulkomailla = opulkomamk
	,tilauskoulutuksen_sijaintimaa = tilmaa
	,tutkinto_yo = tutkyo
	
	,koulutusohjelma_yo = koyo
	
	,paaaine_yo = paine
	
	,tiedekunta_yo = tdk
	,opiskelumuoto = om
	,opettajankelpoisuus = opkelp
	,op_yo_yhteensa = opyhtyo
	,op_yo_ulkomailla = opulkyo
	,op_yo_muualla = opmuuyo
	,op_yo_oma_yo = opoylio
	,op_yo_avoimessa = opaylio
	,op_yo_muu_yo = opmylio
	,op_yo_ammattikorkeakouluissa = opamkyo
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''2.9a-c''
	,koulutussektori = cast(
	(
		case
		when lahde = ''*1'' then ''1''
		when lahde in (''21'',''22'',''23'') then ''2''
		when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when lahde in (''41'',''42'') then ''4''
		when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))
	,ika_1v = CAST(
	(
		case
		when isnumeric(syntv)=1 and syntv<tilv
		then cast(cast(tilv as int) - cast(syntv as int) as varchar)
		end
	)
	as nvarchar(4))
	,tutkinnot = cast(
		lkm /*lukumaara*/
	as int)

	,koulutuslaji_OKM_avain =
		CASE
			WHEN koultyp = ''1''
				THEN 13	--Ammattikorkeakoulututkinto (nuorten koulutus)  
			WHEN koultyp = ''2''
				THEN 14	--Ammattikorkeakoulututkinto (aikuiskoulutus)  
			WHEN koultyp = ''6'' 
				THEN 15	--Ylempi ammattikorkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 63
							)
				THEN 16	--Alempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 72
							)
				THEN 17	--Ylempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 73
							)
				THEN 18	--Lääkärien erikoistumiskoulutus
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 81
							)

				THEN 19	--Lisensiaatintutkinto
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 82
							)

				THEN 20	--Tohtorintutkinto

			ELSE -1
		END

	,koulutusryhma_avain =
		CASE
			WHEN koultyp = ''1''
				THEN ''41''	--Ammattikorkeakoulututkinto (nuorten koulutus)  
			WHEN koultyp = ''2''
				THEN ''42''	--Ammattikorkeakoulututkinto (aikuiskoulutus)  
			WHEN koultyp = ''6'' 
				THEN ''46''	--Ylempi ammattikorkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 63
							)
				THEN ''51''	--Alempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 72
							)
				THEN ''51''	--Ylempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 73
							)
				THEN ''52''	--Lääkärien erikoistumiskoulutus
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 81
							)

				THEN ''52''	--Lisensiaatintutkinto
			WHEN koulk IN (
							SELECT distinct [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 82
							)

				THEN ''52''	--Tohtorintutkinto

			ELSE -1
		END

      ,ikaryhma1_avain = 
		CASE
			WHEN syntv = 9999 THEN ''-1''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) >59 THEN ''kirikar160''
			ELSE cast(cast(tilv as int) - syntv as varchar(10))
		END
      ,ikaryhma2_avain = 
		CASE
			WHEN syntv = 9999 THEN ''-1''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) <3 THEN ''ikaryh2_2''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 3 AND 5 THEN ''ikaryh2_5''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) = 6 THEN ''ikaryh2_6''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 7 AND 12 THEN ''ikaryh2_12''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 13 AND 15 THEN ''ikaryh2_15''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 16 AND 18 THEN ''ikaryh2_18''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 19 AND 21 THEN ''ikaryh2_21''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 22 AND 24 THEN ''ikaryh2_24''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 25 AND 29 THEN ''ikaryh2_29''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 30 AND 34 THEN ''ikaryh2_34''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 35 AND 39 THEN ''ikaryh2_39''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 40 AND 44 THEN ''ikaryh2_44''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 45 AND 49 THEN ''ikaryh2_49''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 50 AND 54 THEN ''ikaryh2_54''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 55 AND 59 THEN ''ikaryh2_59''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 60 AND 64 THEN ''ikaryh2_64''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) > 64 THEN ''ikaryh2_65''
			ELSE ''-1''
		END


FROM VipunenTK_DW.dbo.[sa_2_9_Korkeakoulut_tutkinnot]






' 
GO
/****** Object:  View [dbo].[v_f_3_14_Lukio_ja_ammatillisen_koulutuksen_opiskelijoiden_mediaani_iat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_3_14_Lukio_ja_ammatillisen_koulutuksen_opiskelijoiden_mediaani_iat]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_f_3_14_Lukio_ja_ammatillisen_koulutuksen_opiskelijoiden_mediaani_iat] AS

-- truncate table f_3_14_Lukio_ja_ammatillisen_koulutuksen_opiskelijoiden_mediaani_iat
-- insert into f_3_14_Lukio_ja_ammatillisen_koulutuksen_opiskelijoiden_mediaani_iat select * from v_f_3_14_Lukio_ja_ammatillisen_koulutuksen_opiskelijoiden_mediaani_iat

SELECT
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,lahde = lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusluokitus = koulk
	,sukupuoli = sp
	,aidinkieli_versio1 = aikielir1
	,syntymavuosi = syntv
	,syntymakuukausi = synkk
	,kirjoihintulovuosi = alvv
	,kirjoihintulokausi = allk
	,lukumaara = lkm
	,nuorten_aikuisten_koulutus = aikoul
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,opetushallinnon_koulutus = ophal
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''3.14''
	,koulutussektori = cast(
	(
		case
		when lahde = ''*1'' then ''1''
		when lahde in (''21'',''22'',''23'') then ''2''
		when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when lahde in (''41'',''42'') then ''4''
		when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))
	,koulutuksen_jarjestamismuoto = cast(
	(
		case
		when lahde in (''31'',''32'',''33'',''35'') then ''1''
		when lahde in (''34'') then ''2''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
		when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
		when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		end
	)
	as nvarchar(2))
	,ika_1v = CAST(
	(
		case
		when isnumeric(syntv)=1 and syntv<tilv
		then cast(cast(tilv as int) - cast(syntv as int) as varchar)
		end
	)
	as nvarchar(4))
	,aloittaneet = CAST(
	(
		case when alvv /*kirjoihintulovuosi*/=tilv /*tilastointivuosi*/ then lkm /*lukumaara*/ end
	)
	as int)
	,opiskelijat = cast(
	(
		lkm /*lukumaara*/
	)
	as int)


	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1''
				THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END

FROM VipunenTK_DW.dbo.[sa_3_14_Lukio_ja_amm_opisk_mediaani_iat]


' 
GO
/****** Object:  View [dbo].[v_f_3_15_Lukio_ja_ammatillisen_koulutuksen_tutkintojen_mediaani_iat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_3_15_Lukio_ja_ammatillisen_koulutuksen_tutkintojen_mediaani_iat]'))
EXEC dbo.sp_executesql @statement = N'








CREATE VIEW [dbo].[v_f_3_15_Lukio_ja_ammatillisen_koulutuksen_tutkintojen_mediaani_iat] AS

-- truncate table f_3_15_Lukio_ja_ammatillisen_koulutuksen_tutkintojen_mediaani_iat
-- insert into f_3_15_Lukio_ja_ammatillisen_koulutuksen_tutkintojen_mediaani_iat select * from v_f_3_15_Lukio_ja_ammatillisen_koulutuksen_tutkintojen_mediaani_iat

SELECT 
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,lahde = lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,oppisopimuskoulutuksen_jarjestaja = opjarj
	,koulutusluokitus = koulk
	,sukupuoli = sp
	,aidinkieli_versio1 = aikielir1
	,syntymavuosi = syntv
	,syntymakuukausi = synkk
	,kirjoihintulovuosi = alvv
	,kirjoihintulokausi = allk
	,tutkinnon_suoritusvuosi = suorv
	,tutkinnon_suorituskuukausi = suorkk
	,lukumaara = lkm
	-- NB! TK-muuttuja TUTK monikäyttöinen
	,tutkinnon_toteuma = tutk
	,ammatillisen_koulutuksen_koulutuslaji = tutklaja
	,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus = tutktav
	,opetushallinnon_koulutus = ophal
	,nuorten_aikuisten_koulutus = aikoul
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''3.15''
	,koulutussektori = cast(
	(
		case
		when lahde = ''*1'' then ''1''
		when lahde in (''21'',''22'',''23'') then ''2''
		when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when lahde in (''41'',''42'') then ''4''
		when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))
	,ika_1v = CAST(
	(
		case
		when isnumeric(syntv)=1 and syntv<tilv
		then cast(cast(tilv as int) - cast(syntv as int) as varchar)
		end
	)
	as nvarchar(4))
	,koulutuksen_jarjestamismuoto = cast(
	(
		case
		when lahde in (''31'',''32'',''33'',''35'') then ''1''
		when lahde in (''34'') then ''2''
		end
	)
	as nvarchar(2))
	,ammatillinen_peruskoulutus_lisakoulutus = cast(
	(
		case
		when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ = ''1'' then ''1''
		when tutklaja /*ammatillisen_koulutuksen_koulutuslaji*/ in (''2'',''3'') then ''2''
		end
	)
	as nvarchar(2))
	,suoritusika = CAST(
	(
		case
		when ISNUMERIC(syntv)=1 and LEN(syntv)=4
		and ISNUMERIC(synkk)=1 and synkk between 1 and 12
		and ISNUMERIC(suorv)=1 and LEN(suorv)=4
		and ISNUMERIC(suorkk)=1 and suorkk between 1 and 12
		and syntv<suorv
		then
		 cast(
		 cast( ( cast(suorv as integer) + (cast(suorkk as decimal)/12) )
			 - ( cast(syntv as integer) + (cast(synkk  as decimal)/12) ) as decimal(18,6))
		as decimal(18,6))
		ELSE cast(-1 as decimal(18,6))
		end
	)
	as decimal(18,6))

	,jarjestys_suoritusika = 
	
		case
		when ISNUMERIC(syntv)=1 and LEN(syntv)=4
		and ISNUMERIC(synkk)=1 and synkk between 1 and 12
		and ISNUMERIC(suorv)=1 and LEN(suorv)=4
		and ISNUMERIC(suorkk)=1 and suorkk between 1 and 12
		and syntv<suorv
		then
		 cast(
		 cast( ( cast(suorv as integer) + (cast(suorkk as decimal)/12) )
			 - ( cast(syntv as integer) + (cast(synkk  as decimal)/12) ) as decimal(4,1))
		as int)
		ELSE -1
		end


	,suoritusaika = CAST(
	(
		case
		when isnumeric(suorv)=1 and LEN(suorv)=4
		 and isnumeric(suorkk)=1 and cast(suorkk as int) between 1 and 12
		 and isnumeric(alvv)=1 and LEN(alvv)=4
		 and isnumeric(allk)=1 and allk in (''1'',''2'')
		then
		cast(
		 (cast(suorv as integer)
		 +(case
		   when allk=''1'' and cast(suorkk as int) between 1 and 7  then 0.5
		   when allk=''1'' and cast(suorkk as int) between 8 and 12 then 1.0
		   when allk=''2'' and cast(suorkk as int) between 8 and 12 then 0.5
		   when allk=''2'' and cast(suorkk as int) between 1 and 7  then 0.0
		   end
		  )
		 )-cast(alvv as int)
		as decimal(18,6))
		ELSE cast(-1 as decimal(18,6))
		end
	)
	as decimal(18,6))

	,jarjestys_suoritusaika = CAST(
	(
		case
		when isnumeric(suorv)=1 and LEN(suorv)=4
		 and isnumeric(suorkk)=1 and cast(suorkk as int) between 1 and 12
		 and isnumeric(alvv)=1 and LEN(alvv)=4
		 and isnumeric(allk)=1 and allk in (''1'',''2'')
		then
		cast(
		 (cast(suorv as integer)
		 +(case
		   when allk=''1'' and cast(suorkk as int) between 1 and 7  then 0.5
		   when allk=''1'' and cast(suorkk as int) between 8 and 12 then 1.0
		   when allk=''2'' and cast(suorkk as int) between 8 and 12 then 0.5
		   when allk=''2'' and cast(suorkk as int) between 1 and 7  then 0.0
		   end
		  )
		 )-cast(alvv as int)
		as int)
		ELSE -1
		end
	)
	as int)

	,tutkinnot = cast(
		lkm /*lukumaara*/
	as int)


	,koulutuslaji_OKM_avain =
		CASE
			WHEN aikoul = ''1''
				THEN 3 --Lukiokoulutus (nuorten koulutus)
			WHEN aikoul = ''2''
				THEN 4 --Lukiokoulutus (aikuiskoulutus)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 5 --Ammatillinen perustutkinto (oppilaitosmuotoinen, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 6 --Ammatillinen perustutkinto (oppilaitosmuotoinen, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 7 --Ammattitutkinto (oppilaitosmuotoinen)
			WHEN tutklaja = 3 AND lahde in (''31'',''32'',''33'',''35'')
				THEN 8 --Erikoisammattitutkinto  (oppilaitosmuotoinen)
			WHEN tutklaja = 1 AND tutktav = 1 AND lahde = ''34''
				THEN 9 --Ammatillinen perustutkinto (oppisopimuskoulutus, opetussuunnitelmaperusteinen)
			WHEN tutklaja = 1 AND tutktav = 2 AND lahde = ''34''
				THEN 10 --Ammatillinen perustutkinto (oppisopimuskoulutus, näyttötutkinto)
			WHEN tutklaja = 2 AND lahde = ''34''
				THEN 11 --Ammattitutkinto (oppisopimuskoulutus)
			WHEN tutklaja = 3 AND lahde = ''34''
				THEN 12 --Erikoisammattitutkinto (oppisopimuskoulutus)

			ELSE -1
		END



FROM VipunenTK_DW.dbo.[sa_3_15_Lukio_ja_amm_tutk_mediaani_iat]









' 
GO
/****** Object:  View [dbo].[v_f_3_1a_Oppisopimus_paaasiallinen_toiminta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_3_1a_Oppisopimus_paaasiallinen_toiminta]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_f_3_1a_Oppisopimus_paaasiallinen_toiminta] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
	  ,oppisryh = [oppisryh]
      ,sukupuoli = [sp] 
      ,aidinkieli_versio1 = [aikielir1]
      ,ika = CAST(
	  (
		case
		when [ikar2] = ''24'' then ''ikar224''
		when [ikar2] = ''25'' then ''ikar225''
		else ''-1''
		end)
	   as nvarchar(7))
      ,opetushallinnon_koulutusala = [opmala]
      ,opetushallinnon_koulutusaste = [opmast]
      ,ammatillisen_koulutuksen_koulutuslaji = [tutklaja]

      ,koulutuksen_sijaintimaakunta = CAST(
	  (
		case
		when LEN([kmaak]) = 1 then ''0''+[kmaak]
		else [kmaak]
		end)
	   as nvarchar(6))
      ,paaasiallinen_toiminta_versio3 = [ptoim1r3]
      ,ammattiasema = [amas]
      ,opiskelijat = [lkm]
	  ,tietolahde = [tietolahde]
	  ,rivinumero = [rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_3_1a_Oppisopimuskoulutus]







' 
GO
/****** Object:  View [dbo].[v_f_3_1b_Oppisopimus_koulutuksen_kesto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_3_1b_Oppisopimus_koulutuksen_kesto]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_f_3_1b_Oppisopimus_koulutuksen_kesto] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
	  ,oppisryh = [oppisryh]
      ,sukupuoli = [sp] 
      ,aidinkieli_versio1 = [aikielir1]
      ,ika = CAST(
	  (
		case
		when [ikar2] = ''24'' then ''ikar224''
		when [ikar2] = ''25'' then ''ikar225''
		else ''-1''
		end)
	   as nvarchar(7))
      ,opetushallinnon_koulutusala = [opmala]
      ,opetushallinnon_koulutusaste = [opmast]
      ,ammatillisen_koulutuksen_koulutuslaji = [tutklaja]
      ,koulutuksen_sijaintimaakunta = CAST(
	  (
		case
		when LEN([kmaak]) = 1 then ''0''+[kmaak]
		else [kmaak]
		end)
	   as nvarchar(6))
	  ,koulutuksen_arvioitu_kesto = CAST(
	  (
		case
		when [kesto] = '''' then ''XX''
		when [kesto] is NULL then ''XX''
		else [kesto]
		end)
	   as nvarchar(6))
	  ,koulutuksen_toteutunut_kesto = CAST(
	  (
		case
		when [kestotot] = '''' then ''XX''
		when [kestotot] is NULL then ''XX''
		else [kestotot]
		end)
	   as nvarchar(6))
      ,opiskelijat = [lkm]
	  ,[tietolahde] = [tietolahde]
      ,[rivinumero] = [rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_3_1b_Oppisopimuskoulutus]





' 
GO
/****** Object:  View [dbo].[v_f_3_2_Oppisopimus_jatko_opinnot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_3_2_Oppisopimus_jatko_opinnot]'))
EXEC dbo.sp_executesql @statement = N'










CREATE VIEW [dbo].[v_f_3_2_Oppisopimus_jatko_opinnot] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
	  ,oppisryh = [oppisryh]
      ,sukupuoli = [sp] 
      ,aidinkieli_versio1 = [aikielir1]
     ,ika = CAST(
	  (
		case
		when [ikar2] = ''24'' then ''ikar224''
		when [ikar2] = ''25'' then ''ikar225''
		else ''-1''
		end)
	   as nvarchar(7))
      ,opetushallinnon_koulutusala = [opmala]
      ,ammatillisen_koulutuksen_koulutuslaji = [tutklaja]
      ,koulutuksen_sijaintimaakunta = CAST(
	  (
		case
		when LEN([kmaak]) = 1 then ''0''+[kmaak]
		else [kmaak]
		end)
	   as nvarchar(6))
	   ,jatko_opintojen_koulutusaste  = CAST(
	  (
		case
		when [jopmast] is NULL then ''''
		else [jopmast]
		end)
	   as nvarchar(2))
      ,opiskelijat = [lkm]
	  ,[tietolahde] = [tietolahde]
      ,[rivinumero] = [rivinumero]
	  ,[jatko_opiskelu] =  CAST(
	  (
		case
		when [jopmast] = '''' or [jopmast] is NULL then ''2''
		else ''1''
		end)
	   as nvarchar(2))
	,[koulutusaste2002] = CAST(
	  (
		case
		when [opmast] is NULL then ''''
		else [opmast]
		end)
	   as nvarchar(2))
	,[jatko_opiskelun_koulutusala]= CAST(
	  (
		case
		when [jopmala] is NULL then ''''
		else [jopmala]
		end)
	   as nvarchar(1))
FROM [VipunenTK_DW].[dbo].[sa_3_2_Oppisopimuskoulutus]











' 
GO
/****** Object:  View [dbo].[v_f_3_4_Korkeakoulututkinnon_suorittaneiden_mediaani_iat_ja_tutkinnon_suorittamiseen_kuluneet_mediaaniajat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_3_4_Korkeakoulututkinnon_suorittaneiden_mediaani_iat_ja_tutkinnon_suorittamiseen_kuluneet_mediaaniajat]'))
EXEC dbo.sp_executesql @statement = N'








CREATE VIEW [dbo].[v_f_3_4_Korkeakoulututkinnon_suorittaneiden_mediaani_iat_ja_tutkinnon_suorittamiseen_kuluneet_mediaaniajat] AS

-- truncate table f_3_4_Korkeakoulututkinnon_suorittaneiden_mediaani_iat_ja_tutkinnon_suorittamiseen_kuluneet_mediaaniajat
-- insert into f_3_4_Korkeakoulututkinnon_suorittaneiden_mediaani_iat_ja_tutkinnon_suorittamiseen_kuluneet_mediaaniajat select * from v_f_3_4_Korkeakoulututkinnon_suorittaneiden_mediaani_iat_ja_tutkinnon_suorittamiseen_kuluneet_mediaaniajat

SELECT 
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,lahde = lahde
	,oppilaitos = tunn
	,koulutuksen_jarjestaja = jarj
	,koulutusluokitus = koulk
	,koulutustyyppi = koultyp
	,sukupuoli = sp
	,aidinkieli_versio1 = aikielir1
	,syntymavuosi = syntv
	,syntymakuukausi = synkk
	,kirjoihintulovuosi = alvv
	,kirjoihintulokausi = allk
	,kirjoihintulovuosi_korkeakoulu = alvv_kk
	,kirjoihintulokausi_korkeakoulu = allk_kk
	,tutkinnon_suoritusvuosi = suorv
	,tutkinnon_suorituskuukausi = suorkk
	,lukumaara = lkm
	,tietolahde = left(tietolahde,50)
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''3.4''
	,koulutussektori = cast(
	(
		case
		when lahde = ''*1'' then ''1''
		when lahde in (''21'',''22'',''23'') then ''2''
		when lahde in (''31'',''32'',''33'',''34'',''35'') then ''3''
		when lahde in (''41'',''42'') then ''4''
		when lahde in (''51'',''52'') then ''5''
		end
	)
	as nvarchar(2))
	,ika_1v = CAST(
	(
		case
		when isnumeric(syntv)=1 and syntv<tilv
		then cast(cast(tilv as int) - cast(syntv as int) as varchar)
		end
	)
	as nvarchar(4))
	,suoritusika = CAST(
	(
		case
		when ISNUMERIC(syntv)=1 and LEN(syntv)=4
		and ISNUMERIC(synkk)=1 and synkk between 1 and 12
		and ISNUMERIC(suorv)=1 and LEN(suorv)=4
		and ISNUMERIC(suorkk)=1 and suorkk between 1 and 12
		and syntv<suorv
		then
		cast(
		 cast( ( cast(suorv as integer) + (cast(suorkk as decimal)/12) )
			 - ( cast(syntv as integer) + (cast(synkk  as decimal)/12) ) as decimal(18,6))
			 as decimal(18,6))
			 ELSE cast(-1 as decimal(18,6))
		end
	)
	as decimal(18,6))

	,jarjestys_suoritusika = CAST(
	(
		case
		when ISNUMERIC(syntv)=1 and LEN(syntv)=4
		and ISNUMERIC(synkk)=1 and synkk between 1 and 12
		and ISNUMERIC(suorv)=1 and LEN(suorv)=4
		and ISNUMERIC(suorkk)=1 and suorkk between 1 and 12
		and syntv<suorv
		then
		cast(
		 cast( ( cast(suorv as integer) + (cast(suorkk as decimal)/12) )
			 - ( cast(syntv as integer) + (cast(synkk  as decimal)/12) ) as decimal(4,1))
			 as int)
			 ELSE -1
		end
	)
	as int)
	,suoritusaika = CAST(
	(
		case
			when
				alvv = suorv
				and allk = 2
				and suorkk < 9
			then cast(0 as decimal(18,6))   -- negatiiviset suoritusajat nollaksi

		when isnumeric(suorv)=1 and LEN(suorv)=4
		 and isnumeric(suorkk)=1 and cast(suorkk as int) between 1 and 12
		 and isnumeric(alvv)=1 and LEN(alvv)=4
		 and isnumeric(allk)=1 and allk in (''1'',''2'')
		then

				cast( 

				(cast(suorv as integer) + cast(suorkk as decimal)/12)
					- 
				(cast(alvv as int) + CASE WHEN allk = 1 THEN 0 ELSE 0.75 END)
		  
				as decimal(18,6))
		ELSE cast(-1 as decimal(18,6))
		end
	)
	as decimal(18,6))

	,jarjestys_suoritusaika = CAST(
	(
		case
		when isnumeric(suorv)=1 and LEN(suorv)=4
		 and isnumeric(suorkk)=1 and cast(suorkk as int) between 1 and 12
		 and isnumeric(alvv)=1 and LEN(alvv)=4
		 and isnumeric(allk)=1 and allk in (''1'',''2'')
		then

				cast( 

				(cast(suorv as integer) + cast(suorkk as decimal)/12)
					- 
				(cast(alvv as int) + CASE WHEN allk = 1 THEN 0 ELSE 0.75 END)
		  
				as int)
		ELSE -1
		end
	)
	as int)

	,suoritusaika_kk = CAST(
	(
		case
			when
				alvv_kk = suorv
				and allk_kk = 2
				and suorkk < 9
			then cast(0 as decimal(18,6))   -- negatiiviset suoritusajat nollaksi
	
		when isnumeric(suorv)=1 and LEN(suorv)=4
		 and isnumeric(suorkk)=1 and cast(suorkk as int) between 1 and 12
		 and isnumeric(alvv_kk)=1 and LEN(alvv_kk)=4
		 and isnumeric(allk_kk)=1 and allk_kk in (''1'',''2'')
		then

				cast( 

				(cast(suorv as integer) + cast(suorkk as decimal)/12)
					- 
				(cast(alvv_kk as int) + CASE WHEN allk_kk = 1 THEN 0 ELSE 0.75 END)
		  
				as decimal(18,6))
		ELSE cast(-1 as decimal(18,6))
		end
	)
	as decimal(18,6))

	,jarjestys_suoritusaika_kk = CAST(
	(
		case
		when isnumeric(suorv)=1 and LEN(suorv)=4
		 and isnumeric(suorkk)=1 and cast(suorkk as int) between 1 and 12
		 and isnumeric(alvv_kk)=1 and LEN(alvv_kk)=4
		 and isnumeric(allk_kk)=1 and allk_kk in (''1'',''2'')
		then

				cast( 

				(cast(suorv as integer) + cast(suorkk as decimal)/12)
					- 
				(cast(alvv_kk as int) + CASE WHEN allk_kk = 1 THEN 0 ELSE 0.75 END)
		  
				as int)
		ELSE -1
		end
	)
	as int)

	,tutkinnot = cast(
		lkm /*lukumaara*/
	as int)


	,koulutuslaji_OKM_avain =
		CASE
			WHEN koultyp = ''1''
				THEN 13	--Ammattikorkeakoulututkinto (nuorten koulutus)  
			WHEN koultyp = ''2''
				THEN 14	--Ammattikorkeakoulututkinto (aikuiskoulutus)  
			WHEN koultyp = ''6'' 
				THEN 15	--Ylempi ammattikorkeakoulututkinto  
			WHEN koulk IN (
							SELECT [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 63
							)
				THEN 16	--Alempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 72
							)
				THEN 17	--Ylempi korkeakoulututkinto  
			WHEN koulk IN (
							SELECT [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 73
							)
				THEN 18	--Lääkärien erikoistumiskoulutus
			WHEN koulk IN (
							SELECT [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 81
							)

				THEN 19	--Lisensiaatintutkinto
			WHEN koulk IN (
							SELECT [koulutusluokitus_avain]
							FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]
							where koulutusaste2002_koodi = 82
							)

				THEN 20	--Tohtorintutkinto

			ELSE -1
		END



FROM VipunenTK_DW.dbo.sa_3_4_Kk_tutk_suor_mediaani_iat_ja_tutk_mediaani_ajat









' 
GO
/****** Object:  View [dbo].[v_f_4_1_Perusopetuksen_lisäopetuksen_päättäneiden_sijoittuminen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_1_Perusopetuksen_lisäopetuksen_päättäneiden_sijoittuminen]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_f_4_1_Perusopetuksen_lisäopetuksen_päättäneiden_sijoittuminen] AS
 
SELECT 
       [tilastointivuosi]= [tilv]
      ,[tilv_date]=[tilv_date]
      ,[sukupuoli]=[sp]
      ,[aidinkieli_versio1]= [aikielir1]
      ,[asuinmaakunta]= CAST( CASE 
		WHEN NULLIF(asmaak, '''') IS NULL THEN ''-1'' 
		ELSE ''MAAK'' + RIGHT(''00''+case [asmaak] when ''20'' then ''01'' else [asmaak] end, 2)
		END as nvarchar(10))
      ,[opiskelu_toiminta]= ''ASEMA'' + RIGHT(''00''+[asema], 2)
      ,[lukumaara]=[lkm]
      ,[tietolahde]=[tietolahde]
      ,[rivinumero]=[rivinumero]
   FROM [VipunenTK_DW].[dbo].[sa_4_1_Perusopetuksen_lisäopetuksen_päättäneiden_sijoittuminen]




' 
GO
/****** Object:  View [dbo].[v_f_4_10_Vaestorakenne_aidinkielen_mukaan_maakunnittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_10_Vaestorakenne_aidinkielen_mukaan_maakunnittain]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_f_4_10_Vaestorakenne_aidinkielen_mukaan_maakunnittain] AS
 
SELECT 
       [tilastovuosi]= [tilv]
      ,[tilv_date]=[tilv_date]
      ,[asuinmaakunta]= CAST( CASE 
		WHEN NULLIF(asmaak, '''') IS NULL THEN ''-1'' 
		ELSE ''MAAK'' + RIGHT(''00''+case when [asmaak]=''20'' then ''01'' else [asmaak] end, 2)
		END as nvarchar(10))
      ,[aidinkieli_versio3]= [aikielir3]
      ,[kansalaisuus_versio1]= [kansalr1]
      ,[eumaa_valtio_avain]= Case when eumaa in (''1'', ''2'') then ''EU'' + eumaa else ''-1'' end
      ,[etamaa_valtio_avain]= Case when etamaa in (''1'', ''2'') then ''ETA'' + etamaa else ''-1'' end
      ,[ika_avain]= ika_nvarchar
      ,[ika_ikaryhma2_avain]= CAST( CASE 
		WHEN ika_int between 0 and 2 THEN ''ikaryh2_2''
		WHEN ika_int between 3 and 5 THEN ''ikaryh2_5''
		WHEN ika_int = 6 THEN ''ikaryh2_6''
		WHEN ika_int between 7 and 12 THEN ''ikaryh2_12''
		WHEN ika_int between 13 and 15 THEN ''ikaryh2_15''
		WHEN ika_int between 16 and 18 THEN ''ikaryh2_18''
		WHEN ika_int between 19 and 21 THEN ''ikaryh2_21''
		WHEN ika_int between 22 and 24 THEN ''ikaryh2_24''
		WHEN ika_int between 25 and 29 THEN ''ikaryh2_29''
		WHEN ika_int between 30 and 34 THEN ''ikaryh2_34''
		WHEN ika_int between 35 and 39 THEN ''ikaryh2_39''
		WHEN ika_int between 40 and 44 THEN ''ikaryh2_44''
		WHEN ika_int between 45 and 49 THEN ''ikaryh2_49''
		WHEN ika_int between 50 and 54 THEN ''ikaryh2_54''
		WHEN ika_int between 55 and 59 THEN ''ikaryh2_59''
		WHEN ika_int between 60 and 64 THEN ''ikaryh2_64''
		WHEN ika_int >= 65 THEN ''ikaryh2_65''
		ELSE ''-1'' END AS NVARCHAR(10))
      ,[ika_ikaryhma2b_avain]= CAST( CASE 
		WHEN ika_int between 0 and 2 THEN ''ikar2b_2''
		WHEN ika_int between 3 and 5 THEN ''ikar2b_5''
		WHEN ika_int = 6 THEN ''ikar2b_6''
		WHEN ika_int between 7 and 12 THEN ''ikar2b_12''
		WHEN ika_int between 13 and 15 THEN ''ikar2b_15''
		WHEN ika_int between 16 and 18 THEN ''ikar2b_18''
		WHEN ika_int between 19 and 21 THEN ''ikar2b_21''
		WHEN ika_int between 22 and 24 THEN ''ikar2b_24''
		WHEN ika_int between 25 and 64 THEN ''ikar2b_64''
		WHEN ika_int >= 65 THEN ''ikar2b_65''
		ELSE ''-1'' END AS NVARCHAR(10))
	  ,henkiloiden_lkm = ika_arvo
      ,[tietolahde]=[tietolahde]
      ,[rivinumero]=[rivinumero]
   FROM ( --ikarivit
SELECT [tilv]
      ,[tilv_date]
      ,[asmaak]
      ,[aikielir3]
      ,[kansalr1]
      ,[eumaa]
      ,[etamaa]
	  ,ika_arvo
	  ,ika_id
      ,[ika_nvarchar]= Cast(REPLACE(REPLACE(ika_id, ''ika'', ''''), ''_'', '''') as nvarchar(10))
      ,[ika_int]= Cast(REPLACE(REPLACE(ika_id, ''ika'', ''''), ''_'', '''') as int)
--      ,[lkm] otetaan vain ikäkohtaiset määrät, niiden summaa ei tarvita
      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[sa_4_10_Vaestorakenne_aidinkielen_mukaan_maakunnittain]
UNPIVOT
   (ika_arvo FOR ika_id IN 
      (
      [ika0]
      ,[ika1]
      ,[ika2]
      ,[ika3]
      ,[ika4]
      ,[ika5]
      ,[ika6]
      ,[ika7]
      ,[ika8]
      ,[ika9]
      ,[ika10]
      ,[ika11]
      ,[ika12]
      ,[ika13]
      ,[ika14]
      ,[ika15]
      ,[ika16]
      ,[ika17]
      ,[ika18]
      ,[ika19]
      ,[ika20]
      ,[ika21]
      ,[ika22]
      ,[ika23]
      ,[ika24]
      ,[ika25]
      ,[ika26]
      ,[ika27]
      ,[ika28]
      ,[ika29]
      ,[ika30]
      ,[ika31]
      ,[ika32]
      ,[ika33]
      ,[ika34]
      ,[ika35]
      ,[ika36]
      ,[ika37]
      ,[ika38]
      ,[ika39]
      ,[ika40]
      ,[ika41]
      ,[ika42]
      ,[ika43]
      ,[ika44]
      ,[ika45]
      ,[ika46]
      ,[ika47]
      ,[ika48]
      ,[ika49]
      ,[ika50]
      ,[ika51]
      ,[ika52]
      ,[ika53]
      ,[ika54]
      ,[ika55]
      ,[ika56]
      ,[ika57]
      ,[ika58]
      ,[ika59]
      ,[ika60]
      ,[ika61]
      ,[ika62]
      ,[ika63]
      ,[ika64]
      ,[ika65]
      ,[ika66]
      ,[ika67]
      ,[ika68]
      ,[ika69]
      ,[ika70]
      ,[ika71]
      ,[ika72]
      ,[ika73]
      ,[ika74]
      ,[ika75]
      ,[ika76]
      ,[ika77]
      ,[ika78]
      ,[ika79]
      ,[ika80]
      ,[ika81]
      ,[ika82]
      ,[ika83]
      ,[ika84]
      ,[ika85]
      ,[ika86]
      ,[ika87]
      ,[ika88]
      ,[ika89]
      ,[ika90]
      ,[ika91]
      ,[ika92]
      ,[ika93]
      ,[ika94]
      ,[ika95]
      ,[ika96]
      ,[ika97]
      ,[ika98]
      ,[ika99]
      ,[ika100_]
)) as unpvt
WHERE ika_arvo > 0
   ) ikarivit 




' 
GO
/****** Object:  View [dbo].[v_f_4_11_Vaeston_maassamuutto_asuinmaakunnan_ja_koulutuksen_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_11_Vaeston_maassamuutto_asuinmaakunnan_ja_koulutuksen_mukaan]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_f_4_11_Vaeston_maassamuutto_asuinmaakunnan_ja_koulutuksen_mukaan] AS
 
SELECT 
       [tilastovuosi]= [tilv]
      ,[tilv_date]=[tilv_date]
      ,[asuinmaakunta]= CAST( CASE 
		WHEN NULLIF(asmaak, '''') IS NULL THEN ''-1'' 
		ELSE ''MAAK'' + RIGHT(''00''+case when [asmaak]=''20'' then ''01'' else [asmaak] end, 2)
		END as nvarchar(10))
      ,[koulutuskoodi]= CAST( CASE 
		WHEN NULLIF(koulk, '''') IS NULL THEN ''-1'' 
		ELSE koulk
		END as nvarchar(10))
      ,sisaanmuutto
      ,ulosmuutto
      ,[tietolahde]
      ,[rivinumero]
   FROM [VipunenTK_DW].[dbo].[sa_4_11_Vaeston_maassamuutto_asuinmaakunnan_ja_koulutuksen_mukaan]




' 
GO
/****** Object:  View [dbo].[v_f_4_2_Vaeston_koulutusrakenne_ja_paaasiallinen_toiminta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_2_Vaeston_koulutusrakenne_ja_paaasiallinen_toiminta]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_f_4_2_Vaeston_koulutusrakenne_ja_paaasiallinen_toiminta] AS
 
SELECT 
       [tilastointivuosi]= [tilv]
      ,[tilv_date]=[tilv_date]
      ,[aineisto]= [aineisto] 
      ,[sukupuoli]=[sp]
      ,[aidinkieli_versio1]= [aikielir1]
      ,[syntymavuosi]= [syntv]
      ,[asuinmaakunta]= [tilvasmaak]
      ,[kansalaisuus_versio1]= [kansalr1]
      ,[pohjoismaa]= [pohjmaa]
      ,[eumaa]=[eumaa]
      ,[etamaa]=[etamaa]
      ,[tutkinnon_suoritusvuosi]=[suorv]
      ,[tutkinnon_suoritusmaakunta]=[suormaak]
      ,[koulutusluokitus] = CAST(
      (
		case
		when [koulk] = ''999999'' then ''SA9999''
		when [koulk] = '' '' then ''SA9999''
		when [koulk]  IS NULL then ''SA9999''
		else [koulk]
		end)
	   as nvarchar(6))
      ,[koulutusmuoto]= [kouljat]
      ,[oppisopimuskoulutus]=
	  CAST(
      (
		case
		when [oppis]  IS NULL then ''2''
		when [oppis]= '''' then ''2''
		when [oppis]= ''XX'' then ''2''
		else [oppis]
		end)
	   as nvarchar(2))
      ,[ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa]=[tutklaja_tr]
      ,[paaasiallinen_toiminta_versio6]=[ptoim1r6]
      ,[ammattiluokitus_2001]=[amm2001]
      ,[ammattiluokitus_2010] = CAST(
      (
		case
		when [amm2010] = ''XX'' then '' ''
		when [amm2010]  IS NULL then '' ''
		else [amm2010]
		end)
	   as nvarchar(2))
      ,[tyossakayntitilaston_tyonantajasektori] = CAST(
      (
		case
		when [tsekt] = ''9'' then '' ''
		else [tsekt]
		end)
	   as nvarchar(2))
      ,[lukumaara]=[lkm]
      ,[tietolahde]=[tietolahde]
      ,[rivinumero]=[rivinumero]
      ,[vaeston_ika_1v]= cast ((cast(tilv as int) - cast(syntv as int)) as nvarchar (10))
      ,[vaeston_ika_5v]=cast(
       (
		case
		when (cast(tilv as int) - cast(syntv as int)) < 15 then ''5v10''
		when ((cast(tilv as int) - cast(syntv as int)) >= 15 and (cast(tilv as int) - cast(syntv as int)) <= 19) then ''5v15''
		when ((cast(tilv as int) - cast(syntv as int)) >= 20 and (cast(tilv as int) - cast(syntv as int)) <= 24) then ''5v20''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''5v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''5v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''5v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''5v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''5v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''5v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''5v55''
		when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''5v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65 and (cast(tilv as int) - cast(syntv as int)) <= 69) then ''5v65''
		when ((cast(tilv as int) - cast(syntv as int)) >= 70 and (cast(tilv as int) - cast(syntv as int)) <= 74) then ''5v70''
		when ((cast(tilv as int) - cast(syntv as int)) >= 75 and (cast(tilv as int) - cast(syntv as int)) <= 79) then ''5v75''
		when ((cast(tilv as int) - cast(syntv as int)) >= 80 and (cast(tilv as int) - cast(syntv as int)) <= 84) then ''5v80''
		when ((cast(tilv as int) - cast(syntv as int)) >= 85 and (cast(tilv as int) - cast(syntv as int)) <= 89) then ''5v85''
		when ((cast(tilv as int) - cast(syntv as int)) >= 90 and (cast(tilv as int) - cast(syntv as int)) <= 94) then ''5v90''
		when ((cast(tilv as int) - cast(syntv as int)) >= 95) then ''5v95''
		
		end
	   ) as nvarchar (10))
     
      ,[tutkinnon_suoritusika_1v]=cast(
       (
		case
		when suorv != '''' then cast ((cast(suorv as int) - cast(syntv as int)) as nvarchar (10))
		else ''''

		end
	   ) as nvarchar (10))
      ,[tutkinnon_ika_1v]=cast(
       (
		case
		when suorv != '''' then cast ((cast(tilv as int) - cast(suorv as int)) as nvarchar (10))
		else ''''

		end
	   ) as nvarchar (10))
   FROM [VipunenTK_DW].[dbo].[sa_4_2_Vaeston_koulutusrakenne_ja_paaasiallinen_toiminta]



' 
GO
/****** Object:  View [dbo].[v_f_4_3_Tutkinnon_suorittaneiden_paaasiallinen_toiminta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_3_Tutkinnon_suorittaneiden_paaasiallinen_toiminta]'))
EXEC dbo.sp_executesql @statement = N'











CREATE VIEW [dbo].[v_f_4_3_Tutkinnon_suorittaneiden_paaasiallinen_toiminta] AS
 
SELECT 
       tilastointivuosi = [tilv]
      ,tilv_date=[tilv_date]
      ,aineisto = [aineisto] 
      ,asuinmaakunta = [tilvasmaak]
      ,aikuisopiskelija= [aiopis] 
      ,tutkinnon_suoritusvuosi=[suorv] 
      ,tutkinnon_suorittamismaakunta=[tutkmaak] 
      ,koulutuksen_jarjestaja = [jarj] 
      ,oppilaitos=[tunn] 
      ,valiaikainen_amk=Cast(left(ltrim([akk]),2) as nvarchar(2)) 
      ,koulutusluokitus =[koulk] 
      ,koulutusmuoto=[kouljat] 
      ,oppisopimuskoulutus = [oppis] 
      ,ammatillisen_koulutuksen_koulutuslaji_tutkintorekisterissa =[tutklaja_tr] 
      ,paaasiallinen_toiminta=[ptoim1r2] 
      ,maassaolo = [maassaolo] 
      ,ammattiasema = [amas] 
      ,ammattiluokitus_2010 = [amm2010] 
      ,lukumaara =[lkm] 

      ,eu_etamaat_avain = eu_etamaat
	  ,aikielir1_avain = aikielir1
	  ,kansalaisuus_maanosa_avain = 
	    CASE 
			WHEN mosa <> ''-1'' THEN ''M'' + mosa
			ELSE mosa
		END 

      ,tietolahde = l.[tietolahde]
      ,rivinumero = [rivinumero]
      ,aineistotunnus = Cast(''4.3'' as nvarchar(8))
      ,tutkintolaji_tyollistymiseen = cast( 
	    (
	     -- eka
		case
	    when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					  where 
							 kluok.koulutusaste2002_koodi   = ''20''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat=''1''
	      then ''01''
		 -- toinen
		when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where
							 kluok.koulutusaste2002_koodi   = ''31''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat=''1''
	      then ''02'' 
		   -- kolmas
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
							  kluok.koulutusaste2002_koodi   = ''31''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat=''3''
			          then ''03''
		   -- neljas
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
							  kluok.koulutusaste2002_koodi   = ''32''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''1''
			 and l.kouljat=''1''
			          then ''04''
		   -- viides
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
							  kluok.koulutusaste2002_koodi   = ''32''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''1''
			 and l.kouljat=''8''
			          then ''05''
		   -- kuudes
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
							  kluok.koulutusaste2002_koodi   = ''32''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''2''
			          then ''06''
		   -- seitsemas
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
			
						kluok.koulutusaste2002_koodi   = ''32''
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''3''
			          then ''07''
		   -- kahdeksas
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					   
							 (kluok.koulutusaste2002_koodi   = ''61'' or kluok.koulutusaste_koodi = ''50'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''1''
			          then ''08''
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					
							 (kluok.koulutusaste2002_koodi   = ''50'' or kluok.koulutusaste_koodi = ''50'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''1''
			 and l.kouljat = ''1''
			          then ''08''
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					
							  (kluok.koulutusaste2002_koodi   = ''61'' or kluok.koulutusaste_koodi = ''50'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''1''
			 and l.kouljat = ''1''
			          then ''08''
		   -- yhdeksän
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					
							(kluok.koulutusaste2002_koodi   = ''62'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''1''
			          then ''09''
		   -- kymmenen
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					  
							 (kluok.koulutusaste2002_koodi   = ''62'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''3''
			          then ''10''
		   -- yksitoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					  
							 (kluok.koulutusaste2002_koodi   = ''71'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''3''
			          then ''11''
		   -- kaksitoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					   
							 (kluok.koulutusaste2002_koodi   = ''63'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''1''
			          then ''12''
		   -- kolmetoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					  
							 (kluok.koulutusaste2002_koodi   = ''72'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''1''
			          then ''13''
		   -- neljatoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where
					  
							 (kluok.koulutusaste2002_koodi   = ''73'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''1''
			          then ''14''
		   -- viisitoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					   
							  (kluok.koulutusaste2002_koodi   = ''81'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''1''
			          then ''15''
		   -- kuusitoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					   
							 (kluok.koulutusaste2002_koodi   = ''82'')
							 and kluok.koulutus_koodi = l.koulk)
			 and l.tutklaja_tr=''9''
			 and l.kouljat = ''1''
			          then ''16''
		   -- seitsemantoista
		  when l.koulk in (select (kluok.koulutus_koodi )
					   from VipunenTK_DW.dbo.d_koulutusluokitus kluok
					   where 
					
							 (kluok.koulutusaste2002_koodi   = ''90'')
							 and kluok.koulutus_koodi = l.koulk)
			          then ''17''
		  end
	   ) as nvarchar(2))
, sijoittuminen_1v_tutkinnon_jalkeen = case when cast(l.suorv as int) = (cast(l.tilv as int) - 1) then  cast(lkm as int) else '''' end 
, sijoittuminen_3v_tutkinnon_jalkeen = case when cast(l.suorv as int) = (cast(l.tilv as int) - 3) then  cast(lkm as int) else '''' end
, sijoittuminen_5v_tutkinnon_jalkeen = case when cast(l.suorv as int) = (cast(l.tilv as int) - 5) then  cast(lkm as int) else '''' end  
, paaasiallinen_toiminta_ja_maasta_muuttaneet = cast(
	(
		case
			when maassaolo = ''2'' then ''8''
			when ptoim1r2 = ''10'' then ''1''
			when ptoim1r2 = ''12'' then ''4''
			when ptoim1r2 = ''13'' then ''2''
			when ptoim1r2 = ''22'' then ''3''
			when ptoim1r2 = ''25'' then ''5''
			when ptoim1r2 = ''26'' then ''6''
			when ptoim1r2 = ''99'' then ''7''
			else ''9''
		end
	)
	as nvarchar(2))
,paaasiallinen_toiminta_okm= cast(
	(
		case
			when maassaolo = ''2'' then ''5''	
			when (ptoim1r2 = ''10'' or ptoim1r2 = ''13'') then ''1''
			when ptoim1r2 = ''22''  then ''2''
			when ptoim1r2 = ''12''  then ''3''
			when (ptoim1r2 = ''25'' or ptoim1r2 = ''26''or ptoim1r2 = ''28'' or ptoim1r2 = ''99'') then ''4''
			else ''-1''
		end
	)
	as nvarchar(2))
		

  FROM [VipunenTK_DW].[dbo].[sa_4_3_Tutkinnon_suorittaneiden_paaasiallinen_toiminta] as l













' 
GO
/****** Object:  View [dbo].[v_f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus]'))
EXEC dbo.sp_executesql @statement = N'





CREATE view [dbo].[v_f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus] as

-- CSC JN 10.9.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus
-- Select * into VipunenTK_DW.dbo.f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus from VipunenTK_DW.dbo.v_f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus
-- Insert into VipunenTK_DW.dbo.f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus Select * from VipunenTK_DW.dbo.v_f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus 


SELECT tilastovuosi = [tilv]
      ,[tilv_date]
      ,sukupuoli_koodi = [sp]
	  ,aidinkieli_versio1_koodi = aikielir1
      ,[suorv]
      ,[suorlk]
      ,[suorituskausikoodi]
      ,koulutusluokitus_avain = [koulk]
      ,[alvv]
      ,[allk]
      ,[aloituskausikoodi]
      ,[oppisopimuskoulutus_koodi] = [oppis]
      ,[ammatillisen_koulutuksen_koulutuslaji_koodi] = [tutklaja]
      ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi] = [tutktav]
      ,[nuorten_aikuisten_koulutus_amm_koodi] = [aikoul]
      ,[syntv]
      ,ika_avain = ika
	  ,henkiloiden_lkm = [lkm]

      ,[lulkm]
      ,[lukoulk]
      ,[lusuorv]
      ,[luaikoul]
	  ,lu_ika = Case when lulkm>0 and lusuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(lusuorv as int)) else NULL end
	  ,lu_myohempi_tutkinto_suoritettu = Case when lulkm>0 then ''K'' else ''E'' end

      ,[ammlkm]
      ,[ammkoulk]
      ,[ammsuorv]
      ,[ammoppis]
      ,[ammtutklaja]
      ,[ammtutktav]
	  ,amm_ika = Case when ammlkm>0 and ammsuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ammsuorv as int)) else NULL end
	  ,amm_myohempi_tutkinto_suoritettu = Case when ammlkm>0 then ''K'' else ''E'' end
      
	  ,[opistlkm]
      ,[opistkoulk]
      ,[opistsuorv]
	  ,opist_ika = Case when opistlkm>0 and opistsuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(opistsuorv as int)) else NULL end
	  ,opist_myohempi_tutkinto_suoritettu = Case when opistlkm>0 then ''K'' else ''E'' end

      ,[ammkalkm]
      ,[ammkakoulk]
      ,[ammkasuorv]
	  ,ammka_ika = Case when ammkalkm>0 and ammkasuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ammkasuorv as int)) else NULL end
	  ,ammka_myohempi_tutkinto_suoritettu = Case when ammkalkm>0 then ''K'' else ''E'' end

      ,[amklkm]
      ,[amkkoulk]
      ,[amksuorv]
      ,[amkaikoul]
	  ,amk_ika = Case when amklkm>0 and amksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(amksuorv as int)) else NULL end
	  ,amk_myohempi_tutkinto_suoritettu = Case when amklkm>0 then ''K'' else ''E'' end

      ,[akklkm]
      ,[akkkoulk]
      ,[akksuorv]
	  ,akk_ika = Case when akklkm>0 and akksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(akksuorv as int)) else NULL end
	  ,akk_myohempi_tutkinto_suoritettu = Case when akklkm>0 then ''K'' else ''E'' end

      ,[ylamklkm]
      ,[ylamkkoulk]
      ,[ylamksuorv]
	  ,ylamk_ika = Case when ylamklkm>0 and ylamksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ylamksuorv as int)) else NULL end
	  ,ylamk_myohempi_tutkinto_suoritettu = Case when ylamklkm>0 then ''K'' else ''E'' end

      ,[ykklkm]
      ,[ykkkoulk]
      ,[ykksuorv]
	  ,ykk_ika = Case when ykklkm>0 and ykksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ykksuorv as int)) else NULL end
	  ,ykk_myohempi_tutkinto_suoritettu = Case when ykklkm>0 then ''K'' else ''E'' end

      ,[laakerlkm]
      ,[laakerkoulk]
      ,[laakersuorv]
	  ,laaker_ika = Case when laakerlkm>0 and laakersuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(laakersuorv as int)) else NULL end
	  ,laaker_myohempi_tutkinto_suoritettu = Case when laakerlkm>0 then ''K'' else ''E'' end
      
	  ,[lislkm]
      ,[liskoulk]
      ,[lissuorv]
	  ,lis_ika = Case when lislkm>0 and lissuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(lissuorv as int)) else NULL end
	  ,lis_myohempi_tutkinto_suoritettu = Case when lislkm>0 then ''K'' else ''E'' end

      ,[tohtlkm]
      ,[tohtkoulk]
      ,[tohtsuorv]
	  ,toht_ika = Case when tohtlkm>0 and tohtsuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(tohtsuorv as int)) else NULL end
	  ,toht_myohempi_tutkinto_suoritettu = Case when tohtlkm>0 then ''K'' else ''E'' end

      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[sa_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus]



' 
GO
/****** Object:  View [dbo].[v_f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus]'))
EXEC dbo.sp_executesql @statement = N'






CREATE view [dbo].[v_f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus] as

-- CSC JN 6.10.2015
-- Tehty kopiona ja muokkauksena 4.7-näkymästä
--  4_7 -> 4_8
--  aiempi -> myohempi

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus
-- Select * into VipunenTK_DW.dbo.f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus from VipunenTK_DW.dbo.v_f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus
-- Insert into VipunenTK_DW.dbo.f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus Select * from VipunenTK_DW.dbo.v_f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus 


SELECT tilastovuosi = [tilv]
      ,[tilv_date]
      ,sukupuoli_koodi = [sp]
	  ,aidinkieli_versio1_koodi = aikielir1
      ,[suorv]
      ,[suorlk]
      ,[suorituskausikoodi]
      ,koulutusluokitus_avain = [koulk]
      ,[alvv]
      ,[allk]
      ,[aloituskausikoodi]
      ,[oppisopimuskoulutus_koodi] = [oppis]
      ,[ammatillisen_koulutuksen_koulutuslaji_koodi] = [tutklaja]
      ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi] = [tutktav]
      ,[nuorten_aikuisten_koulutus_amm_koodi] = [aikoul]
      ,[syntv]
      ,ika_avain = ika
	  ,henkiloiden_lkm = [lkm]

      ,[lulkm]
      ,[lukoulk]
      ,[lusuorv]
      ,[luaikoul]
	  ,lu_ika = Case when lulkm>0 and lusuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(lusuorv as int)) else NULL end
	  ,lu_myohempi_tutkinto_suoritettu = Case when lulkm>0 then ''K'' else ''E'' end

      ,[ammlkm]
      ,[ammkoulk]
      ,[ammsuorv]
      ,[ammoppis]
      ,[ammtutklaja]
      ,[ammtutktav]
	  ,amm_ika = Case when ammlkm>0 and ammsuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ammsuorv as int)) else NULL end
	  ,amm_myohempi_tutkinto_suoritettu = Case when ammlkm>0 then ''K'' else ''E'' end
      
	  ,[opistlkm]
      ,[opistkoulk]
      ,[opistsuorv]
	  ,opist_ika = Case when opistlkm>0 and opistsuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(opistsuorv as int)) else NULL end
	  ,opist_myohempi_tutkinto_suoritettu = Case when opistlkm>0 then ''K'' else ''E'' end

      ,[ammkalkm]
      ,[ammkakoulk]
      ,[ammkasuorv]
	  ,ammka_ika = Case when ammkalkm>0 and ammkasuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ammkasuorv as int)) else NULL end
	  ,ammka_myohempi_tutkinto_suoritettu = Case when ammkalkm>0 then ''K'' else ''E'' end

      ,[amklkm]
      ,[amkkoulk]
      ,[amksuorv]
      ,[amkaikoul]
	  ,amk_ika = Case when amklkm>0 and amksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(amksuorv as int)) else NULL end
	  ,amk_myohempi_tutkinto_suoritettu = Case when amklkm>0 then ''K'' else ''E'' end

      ,[akklkm]
      ,[akkkoulk]
      ,[akksuorv]
	  ,akk_ika = Case when akklkm>0 and akksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(akksuorv as int)) else NULL end
	  ,akk_myohempi_tutkinto_suoritettu = Case when akklkm>0 then ''K'' else ''E'' end

      ,[ylamklkm]
      ,[ylamkkoulk]
      ,[ylamksuorv]
	  ,ylamk_ika = Case when ylamklkm>0 and ylamksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ylamksuorv as int)) else NULL end
	  ,ylamk_myohempi_tutkinto_suoritettu = Case when ylamklkm>0 then ''K'' else ''E'' end

      ,[ykklkm]
      ,[ykkkoulk]
      ,[ykksuorv]
	  ,ykk_ika = Case when ykklkm>0 and ykksuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(ykksuorv as int)) else NULL end
	  ,ykk_myohempi_tutkinto_suoritettu = Case when ykklkm>0 then ''K'' else ''E'' end

      ,[laakerlkm]
      ,[laakerkoulk]
      ,[laakersuorv]
	  ,laaker_ika = Case when laakerlkm>0 and laakersuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(laakersuorv as int)) else NULL end
	  ,laaker_myohempi_tutkinto_suoritettu = Case when laakerlkm>0 then ''K'' else ''E'' end
      
	  ,[lislkm]
      ,[liskoulk]
      ,[lissuorv]
	  ,lis_ika = Case when lislkm>0 and lissuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(lissuorv as int)) else NULL end
	  ,lis_myohempi_tutkinto_suoritettu = Case when lislkm>0 then ''K'' else ''E'' end

      ,[tohtlkm]
      ,[tohtkoulk]
      ,[tohtsuorv]
	  ,toht_ika = Case when tohtlkm>0 and tohtsuorv not in ('''',''9999'') then ABS(Cast(suorv as int)-Cast(tohtsuorv as int)) else NULL end
	  ,toht_myohempi_tutkinto_suoritettu = Case when tohtlkm>0 then ''K'' else ''E'' end

      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[sa_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus]

--Jostain syystä aineistossa on rivejä, joissa lkm on nolla mutta tutkintoja on suuret määrät.
--Suodatetaan ne pois.
--CSC Jarmo 6.10.2015
WHERE lkm > 0


' 
GO
/****** Object:  View [dbo].[v_f_4_9_Vaestorakenne_kunnittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_9_Vaestorakenne_kunnittain]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_4_9_Vaestorakenne_kunnittain] AS

-- truncate table f_4_9_Vaestorakenne_kunnittain
-- insert into f_4_9_Vaestorakenne_kunnittain select * from v_f_4_9_Vaestorakenne_kunnittain

SELECT
	 tilastointivuosi = tilv
	,tilv_date = tilv_date
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika0vuotta = ika0
	,ika1vuotta = ika1
	,ika2vuotta = ika2
	,ika3vuotta = ika3
	,ika4vuotta = ika4
	,ika5vuotta = ika5
	,ika6vuotta = ika6
	,ika7vuotta = ika7
	,ika8vuotta = ika8
	,ika9vuotta = ika9
	,ika10vuotta = ika10
	,ika11vuotta = ika11
	,ika12vuotta = ika12
	,ika13vuotta = ika13
	,ika14vuotta = ika14
	,ika15vuotta = ika15
	,ika16vuotta = ika16
	,ika17vuotta = ika17
	,ika18vuotta = ika18
	,ika19vuotta = ika19
	,ika20vuotta = ika20
	,ika21vuotta = ika21
	,ika22vuotta = ika22
	,ika23vuotta = ika23
	,ika24vuotta = ika24
	,ika25vuotta = ika25
	,ika26vuotta = ika26
	,ika27vuotta = ika27
	,ika28vuotta = ika28
	,ika29vuotta = ika29
	,ika30vuotta = ika30
	,ika31vuotta = ika31
	,ika32vuotta = ika32
	,ika33vuotta = ika33
	,ika34vuotta = ika34
	,ika35vuotta = ika35
	,ika36vuotta = ika36
	,ika37vuotta = ika37
	,ika38vuotta = ika38
	,ika39vuotta = ika39
	,ika40vuotta = ika40
	,ika41vuotta = ika41
	,ika42vuotta = ika42
	,ika43vuotta = ika43
	,ika44vuotta = ika44
	,ika45vuotta = ika45
	,ika46vuotta = ika46
	,ika47vuotta = ika47
	,ika48vuotta = ika48
	,ika49vuotta = ika49
	,ika50vuotta = ika50
	,ika51vuotta = ika51
	,ika52vuotta = ika52
	,ika53vuotta = ika53
	,ika54vuotta = ika54
	,ika55vuotta = ika55
	,ika56vuotta = ika56
	,ika57vuotta = ika57
	,ika58vuotta = ika58
	,ika59vuotta = ika59
	,ika60vuotta = ika60
	,ika61vuotta = ika61
	,ika62vuotta = ika62
	,ika63vuotta = ika63
	,ika64vuotta = ika64
	,ika65vuotta = ika65
	,ika66vuotta = ika66
	,ika67vuotta = ika67
	,ika68vuotta = ika68
	,ika69vuotta = ika69
	,ika70vuotta = ika70
	,ika71vuotta = ika71
	,ika72vuotta = ika72
	,ika73vuotta = ika73
	,ika74vuotta = ika74
	,ika75vuotta = ika75
	,ika76vuotta = ika76
	,ika77vuotta = ika77
	,ika78vuotta = ika78
	,ika79vuotta = ika79
	,ika80vuotta = ika80
	,ika81vuotta = ika81
	,ika82vuotta = ika82
	,ika83vuotta = ika83
	,ika84vuotta = ika84
	,ika85vuotta = ika85
	,ika86vuotta = ika86
	,ika87vuotta = ika87
	,ika88vuotta = ika88
	,ika89vuotta = ika89
	,ika90vuotta = ika90
	,ika91vuotta = ika91
	,ika92vuotta = ika92
	,ika93vuotta = ika93
	,ika94vuotta = ika94
	,ika95vuotta = ika95
	,ika96vuotta = ika96
	,ika97vuotta = ika97
	,ika98vuotta = ika98
	,ika99vuotta = ika99
	,ika100_vuotta = ika100_
	,lukumaara = lkm
	,tietolahde = tietolahde
	,rivinumero = rivinumero
-- johdetut
	,aineistotunnus = ''4.9''
	--Tehdään luokittelumuuttuja Aidinkieli
	--JOS Aineisto= 4.9 JA (aikielir2=’fi’ TAI aikielir2=’se’) NIIN Aidinkieli= ’Suomi (sis. saame)’ ;
	--JOS Aineisto= 4.9 JA (aikielir2=’sv’) NIIN Aidinkieli= ’Ruotsi’ ;
	--JOS Aineisto= 4.9 JA (aikielir2=’99’) NIIN Aidinkieli= ’Muu tai tuntematon’ ;
	-- => siis aikielir2 => aikielir1
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
	--Tehdään seuraavat summamuuttujat aineiston ’4.9 Väestörakenne kunnittain 2010’ ikä --lukumäärämuuttujien avulla:  
	--ika0_24_lkm= summa muuttujat väliltä ika0… ika24
	--ika0_100_lkm= summa muuttujat väliltä ika0… ika100_
	--ika6_lkm=ika6
	--ika7_lkm=ika7
	--ika7_12_lkm= summataan muuttujat väliltä ika7 … ika12
	--ika13_15_lkm= summataan muuttujat väliltä ika13 … ika15
	--ika15_64_lkm= summataan muuttujat väliltä ika15 … ika64
	--ika15_100_lkm= summataan muuttujat väliltä ika15 … ika100_
	--ika16_lkm= ika16
	--ika16_18_lkm= summataan muuttujat väliltä ika16 … ika18
	--ika16_19_lkm= summataan muuttujat väliltä ika16 … ika19
	--ika16_21_lkm= summataan muuttujat väliltä ika16 … ika21
	--ika19_lkm= ika19
	--ika19_20_lkm= summataan muuttujat väliltä ika19 … ika20
	--ika19_21_lkm= summataan muuttujat väliltä ika19 … ika21
	--ika20_24_lkm= summataan muuttujat väliltä ika20… ika24
	--ika20_29_lkm= summataan muuttujat väliltä ika20… ika29
	--ika25_lkm= ika25
	--ika25_34_lkm= summataan muuttujat väliltä ika25… ika34
	--ika25_64_lkm= summataan muuttujat väliltä ika25… ika64
	--ika25_100_lkm= summataan muuttujat väliltä ika25… ika100_
	--ika30_lkm= ika30
	--ika30_34_lkm= summataan muuttujat väliltä ika30… ika34	
--	
	--,ika0_24_lkm
	--  =isnull(ika0,0)+isnull(ika1,0)+isnull(ika2,0)+isnull(ika3,0)+isnull(ika4,0)+isnull(ika5,0)+isnull(ika6,0)+isnull(ika7,0)+isnull(ika8,0)+isnull(ika9,0)
	--  +isnull(ika10,0)+isnull(ika11,0)+isnull(ika12,0)+isnull(ika13,0)+isnull(ika14,0)+isnull(ika15,0)+isnull(ika16,0)+isnull(ika17,0)+isnull(ika18,0)+isnull(ika19,0)
	--  +isnull(ika20,0)+isnull(ika21,0)+isnull(ika22,0)+isnull(ika23,0)+isnull(ika24,0)
	--,ika0_100_lkm
	--  =isnull(ika0,0)+isnull(ika1,0)+isnull(ika2,0)+isnull(ika3,0)+isnull(ika4,0)+isnull(ika5,0)+isnull(ika6,0)+isnull(ika7,0)+isnull(ika8,0)+isnull(ika9,0)
	--  +isnull(ika10,0)+isnull(ika11,0)+isnull(ika12,0)+isnull(ika13,0)+isnull(ika14,0)+isnull(ika15,0)+isnull(ika16,0)+isnull(ika17,0)+isnull(ika18,0)+isnull(ika19,0)
	--  +isnull(ika20,0)+isnull(ika21,0)+isnull(ika22,0)+isnull(ika23,0)+isnull(ika24,0)+isnull(ika25,0)+isnull(ika26,0)+isnull(ika27,0)+isnull(ika28,0)+isnull(ika29,0)
	--  +isnull(ika30,0)+isnull(ika31,0)+isnull(ika32,0)+isnull(ika33,0)+isnull(ika34,0)+isnull(ika35,0)+isnull(ika36,0)+isnull(ika37,0)+isnull(ika38,0)+isnull(ika39,0)
	--  +isnull(ika40,0)+isnull(ika41,0)+isnull(ika42,0)+isnull(ika43,0)+isnull(ika44,0)+isnull(ika45,0)+isnull(ika46,0)+isnull(ika47,0)+isnull(ika48,0)+isnull(ika49,0)
	--  +isnull(ika50,0)+isnull(ika51,0)+isnull(ika52,0)+isnull(ika53,0)+isnull(ika54,0)+isnull(ika55,0)+isnull(ika56,0)+isnull(ika57,0)+isnull(ika58,0)+isnull(ika59,0)
	--            +isnull(ika60,0)+isnull(ika61,0)+isnull(ika62,0)+isnull(ika63,0)+isnull(ika64,0)+isnull(ika65,0)+isnull(ika66,0)+isnull(ika67,0)+isnull(ika68,0)+isnull(ika69,0)
	--            +isnull(ika70,0)+isnull(ika71,0)+isnull(ika72,0)+isnull(ika73,0)+isnull(ika74,0)+isnull(ika75,0)+isnull(ika76,0)+isnull(ika77,0)+isnull(ika78,0)+isnull(ika79,0)
	--            +isnull(ika80,0)+isnull(ika81,0)+isnull(ika82,0)+isnull(ika83,0)+isnull(ika84,0)+isnull(ika85,0)+isnull(ika86,0)+isnull(ika87,0)+isnull(ika88,0)+isnull(ika89,0)
	--            +isnull(ika90,0)+isnull(ika91,0)+isnull(ika92,0)+isnull(ika93,0)+isnull(ika94,0)+isnull(ika95,0)+isnull(ika96,0)+isnull(ika97,0)+isnull(ika98,0)+isnull(ika99,0)
	--            +ISNULL(ika100_,0)
	--,ika6_lkm=ika6
	--,ika7_lkm=ika7
	--,ika7_12_lkm=isnull(ika7,0)+isnull(ika8,0)+isnull(ika9,0)+isnull(ika10,0)+isnull(ika11,0)+isnull(ika12,0)
	--,ika13_15_lkm=isnull(ika13,0)+isnull(ika14,0)+isnull(ika15,0)
	--,ika15_64_lkm=isnull(ika15,0)+isnull(ika16,0)+isnull(ika17,0)+isnull(ika18,0)+isnull(ika19,0)
	--            +isnull(ika20,0)+isnull(ika21,0)+isnull(ika22,0)+isnull(ika23,0)+isnull(ika24,0)+isnull(ika25,0)+isnull(ika26,0)+isnull(ika27,0)+isnull(ika28,0)+isnull(ika29,0)
	--            +isnull(ika30,0)+isnull(ika31,0)+isnull(ika32,0)+isnull(ika33,0)+isnull(ika34,0)+isnull(ika35,0)+isnull(ika36,0)+isnull(ika37,0)+isnull(ika38,0)+isnull(ika39,0)
	--            +isnull(ika40,0)+isnull(ika41,0)+isnull(ika42,0)+isnull(ika43,0)+isnull(ika44,0)+isnull(ika45,0)+isnull(ika46,0)+isnull(ika47,0)+isnull(ika48,0)+isnull(ika49,0)
	--            +isnull(ika50,0)+isnull(ika51,0)+isnull(ika52,0)+isnull(ika53,0)+isnull(ika54,0)+isnull(ika55,0)+isnull(ika56,0)+isnull(ika57,0)+isnull(ika58,0)+isnull(ika59,0)
	--            +isnull(ika60,0)+isnull(ika61,0)+isnull(ika62,0)+isnull(ika63,0)+isnull(ika64,0)
-- ylläoleva kesken. haettu okm-kannan proseduurista
---
--
---
      , (CONVERT(DECIMAL, (CASE [ika0] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika0] END)) + CONVERT(DECIMAL, (CASE [ika1] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika1] END)) + CONVERT(DECIMAL, (CASE [ika2] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika2] END)) + CONVERT(DECIMAL, (CASE [ika3] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika3] END)) + CONVERT(DECIMAL, (CASE [ika4] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika4] END)) + CONVERT(DECIMAL, (CASE [ika5] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika5] END)) + CONVERT(DECIMAL, (CASE [ika6] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika6] END)) + CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)) + CONVERT(DECIMAL, (CASE [ika8] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika8] END)) + CONVERT(DECIMAL, (CASE [ika9] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika9] END)) + CONVERT(DECIMAL, (CASE [ika10] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika10] END)) + CONVERT(DECIMAL, (CASE [ika11] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika11] END)) + CONVERT(DECIMAL, (CASE [ika12] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika12] END)) + CONVERT(DECIMAL, (CASE [ika13] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika13] END)) + CONVERT(DECIMAL, (CASE [ika14] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika14] END)) + CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END))) AS [ika0_24_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika0] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika0] END)) + CONVERT(DECIMAL, (CASE [ika1] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika1] END)) + CONVERT(DECIMAL, (CASE [ika2] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika2] END)) + CONVERT(DECIMAL, (CASE [ika3] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika3] END)) + CONVERT(DECIMAL, (CASE [ika4] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika4] END)) + CONVERT(DECIMAL, (CASE [ika5] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika5] END)) + CONVERT(DECIMAL, (CASE [ika6] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika6] END)) + CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)) + CONVERT(DECIMAL, (CASE [ika8] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika8] END)) + CONVERT(DECIMAL, (CASE [ika9] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika9] END)) + CONVERT(DECIMAL, (CASE [ika10] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika10] END)) + CONVERT(DECIMAL, (CASE [ika11] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika11] END)) + CONVERT(DECIMAL, (CASE [ika12] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika12] END)) + CONVERT(DECIMAL, (CASE [ika13] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika13] END)) + CONVERT(DECIMAL, (CASE [ika14] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika14] END)) + CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)))/25) AS [ika0_24_ka]
      , (CONVERT(DECIMAL, (CASE [ika0] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika0] END)) + CONVERT(DECIMAL, (CASE [ika1] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika1] END)) + CONVERT(DECIMAL, (CASE [ika2] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika2] END)) + CONVERT(DECIMAL, (CASE [ika3] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika3] END)) + CONVERT(DECIMAL, (CASE [ika4] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika4] END)) + CONVERT(DECIMAL, (CASE [ika5] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika5] END)) + CONVERT(DECIMAL, (CASE [ika6] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika6] END)) + CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)) + CONVERT(DECIMAL, (CASE [ika8] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika8] END)) + CONVERT(DECIMAL, (CASE [ika9] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika9] END)) + CONVERT(DECIMAL, (CASE [ika10] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika10] END)) + CONVERT(DECIMAL, (CASE [ika11] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika11] END)) + CONVERT(DECIMAL, (CASE [ika12] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika12] END)) + CONVERT(DECIMAL, (CASE [ika13] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika13] END)) + CONVERT(DECIMAL, (CASE [ika14] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika14] END)) + CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)) + CONVERT(DECIMAL, (CASE [ika65] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika65] END)) + CONVERT(DECIMAL, (CASE [ika66] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika66] END)) + CONVERT(DECIMAL, (CASE [ika67] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika67] END)) + CONVERT(DECIMAL, (CASE [ika68] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika68] END)) + CONVERT(DECIMAL, (CASE [ika69] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika69] END)) + CONVERT(DECIMAL, (CASE [ika70] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika70] END)) + CONVERT(DECIMAL, (CASE [ika71] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika71] END)) + CONVERT(DECIMAL, (CASE [ika72] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika72] END)) + CONVERT(DECIMAL, (CASE [ika73] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika73] END)) + CONVERT(DECIMAL, (CASE [ika74] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika74] END)) + CONVERT(DECIMAL, (CASE [ika75] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika75] END)) + CONVERT(DECIMAL, (CASE [ika76] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika76] END)) + CONVERT(DECIMAL, (CASE [ika77] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika77] END)) + CONVERT(DECIMAL, (CASE [ika78] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika78] END)) + CONVERT(DECIMAL, (CASE [ika79] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika79] END)) + CONVERT(DECIMAL, (CASE [ika80] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika80] END)) + CONVERT(DECIMAL, (CASE [ika81] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika81] END)) + CONVERT(DECIMAL, (CASE [ika82] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika82] END)) + CONVERT(DECIMAL, (CASE [ika83] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika83] END)) + CONVERT(DECIMAL, (CASE [ika84] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika84] END)) + CONVERT(DECIMAL, (CASE [ika85] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika85] END)) + CONVERT(DECIMAL, (CASE [ika86] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika86] END)) + CONVERT(DECIMAL, (CASE [ika87] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika87] END)) + CONVERT(DECIMAL, (CASE [ika88] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika88] END)) + CONVERT(DECIMAL, (CASE [ika89] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika89] END)) + CONVERT(DECIMAL, (CASE [ika90] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika90] END)) + CONVERT(DECIMAL, (CASE [ika91] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika91] END)) + CONVERT(DECIMAL, (CASE [ika92] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika92] END)) + CONVERT(DECIMAL, (CASE [ika93] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika93] END)) + CONVERT(DECIMAL, (CASE [ika94] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika94] END)) + CONVERT(DECIMAL, (CASE [ika95] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika95] END)) + CONVERT(DECIMAL, (CASE [ika96] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika96] END)) + CONVERT(DECIMAL, (CASE [ika97] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika97] END)) + CONVERT(DECIMAL, (CASE [ika98] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika98] END)) + CONVERT(DECIMAL, (CASE [ika99] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika99] END)) + CONVERT(DECIMAL, (CASE [ika100_] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika100_] END))) AS [ika0_100_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika0] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika0] END)) + CONVERT(DECIMAL, (CASE [ika1] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika1] END)) + CONVERT(DECIMAL, (CASE [ika2] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika2] END)) + CONVERT(DECIMAL, (CASE [ika3] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika3] END)) + CONVERT(DECIMAL, (CASE [ika4] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika4] END)) + CONVERT(DECIMAL, (CASE [ika5] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika5] END)) + CONVERT(DECIMAL, (CASE [ika6] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika6] END)) + CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)) + CONVERT(DECIMAL, (CASE [ika8] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika8] END)) + CONVERT(DECIMAL, (CASE [ika9] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika9] END)) + CONVERT(DECIMAL, (CASE [ika10] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika10] END)) + CONVERT(DECIMAL, (CASE [ika11] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika11] END)) + CONVERT(DECIMAL, (CASE [ika12] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika12] END)) + CONVERT(DECIMAL, (CASE [ika13] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika13] END)) + CONVERT(DECIMAL, (CASE [ika14] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika14] END)) + CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)) + CONVERT(DECIMAL, (CASE [ika65] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika65] END)) + CONVERT(DECIMAL, (CASE [ika66] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika66] END)) + CONVERT(DECIMAL, (CASE [ika67] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika67] END)) + CONVERT(DECIMAL, (CASE [ika68] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika68] END)) + CONVERT(DECIMAL, (CASE [ika69] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika69] END)) + CONVERT(DECIMAL, (CASE [ika70] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika70] END)) + CONVERT(DECIMAL, (CASE [ika71] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika71] END)) + CONVERT(DECIMAL, (CASE [ika72] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika72] END)) + CONVERT(DECIMAL, (CASE [ika73] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika73] END)) + CONVERT(DECIMAL, (CASE [ika74] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika74] END)) + CONVERT(DECIMAL, (CASE [ika75] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika75] END)) + CONVERT(DECIMAL, (CASE [ika76] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika76] END)) + CONVERT(DECIMAL, (CASE [ika77] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika77] END)) + CONVERT(DECIMAL, (CASE [ika78] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika78] END)) + CONVERT(DECIMAL, (CASE [ika79] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika79] END)) + CONVERT(DECIMAL, (CASE [ika80] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika80] END)) + CONVERT(DECIMAL, (CASE [ika81] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika81] END)) + CONVERT(DECIMAL, (CASE [ika82] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika82] END)) + CONVERT(DECIMAL, (CASE [ika83] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika83] END)) + CONVERT(DECIMAL, (CASE [ika84] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika84] END)) + CONVERT(DECIMAL, (CASE [ika85] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika85] END)) + CONVERT(DECIMAL, (CASE [ika86] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika86] END)) + CONVERT(DECIMAL, (CASE [ika87] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika87] END)) + CONVERT(DECIMAL, (CASE [ika88] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika88] END)) + CONVERT(DECIMAL, (CASE [ika89] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika89] END)) + CONVERT(DECIMAL, (CASE [ika90] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika90] END)) +  CONVERT(DECIMAL, (CASE [ika91] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika91] END)) + CONVERT(DECIMAL, (CASE [ika92] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika92] END)) + CONVERT(DECIMAL, (CASE [ika93] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika93] END)) + CONVERT(DECIMAL, (CASE [ika94] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika94] END)) + CONVERT(DECIMAL, (CASE [ika95] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika95] END)) + CONVERT(DECIMAL, (CASE [ika96] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika96] END)) + CONVERT(DECIMAL, (CASE [ika97] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika97] END)) + CONVERT(DECIMAL, (CASE [ika98] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika98] END)) + CONVERT(DECIMAL, (CASE [ika99] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika99] END)) + CONVERT(DECIMAL, (CASE [ika100_] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika100_] END)))/101) AS [ika0_100_ka]
      , (CONVERT(DECIMAL, (CASE [ika6] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika6] END))) AS [ika6_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika6] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika6] END)))/1) AS [ika6_ka]
      , (CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END))) AS [ika7_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)))/1) AS [ika7_ka]
      , (CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)) + CONVERT(DECIMAL, (CASE [ika8] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika8] END)) + CONVERT(DECIMAL, (CASE [ika9] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika9] END)) + CONVERT(DECIMAL, (CASE [ika10] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika10] END)) + CONVERT(DECIMAL, (CASE [ika11] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika11] END)) + CONVERT(DECIMAL, (CASE [ika12] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika12] END))) AS [ika7_12_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika7] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika7] END)) + CONVERT(DECIMAL, (CASE [ika8] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika8] END)) + CONVERT(DECIMAL, (CASE [ika9] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika9] END)) + CONVERT(DECIMAL, (CASE [ika10] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika10] END)) + CONVERT(DECIMAL, (CASE [ika11] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika11] END)) + CONVERT(DECIMAL, (CASE [ika12] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika12] END)))/6) AS [ika7_12_ka]
      , (CONVERT(DECIMAL, (CASE [ika13] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika13] END)) + CONVERT(DECIMAL, (CASE [ika14] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika14] END)) + CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END))) AS [ika13_15_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika13] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika13] END)) + CONVERT(DECIMAL, (CASE [ika14] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika14] END)) + CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)))/3) AS [ika13_15_ka]
      , (CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60]  WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END))) AS [ika15_64_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)))/50) AS [ika15_64_ka]
      , (CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60]  WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)) + CONVERT(DECIMAL, (CASE [ika65] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika65] END)) + CONVERT(DECIMAL, (CASE [ika66] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika66] END)) + CONVERT(DECIMAL, (CASE [ika67] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika67] END)) + CONVERT(DECIMAL, (CASE [ika68] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika68] END)) + CONVERT(DECIMAL, (CASE [ika69] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika69] END)) + CONVERT(DECIMAL, (CASE [ika70] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika70] END)) + CONVERT(DECIMAL, (CASE [ika71] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika71] END)) + CONVERT(DECIMAL, (CASE [ika72] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika72] END)) + CONVERT(DECIMAL, (CASE [ika73] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika73] END)) + CONVERT(DECIMAL, (CASE [ika74] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika74] END)) + CONVERT(DECIMAL, (CASE [ika75] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika75] END)) + CONVERT(DECIMAL, (CASE [ika76] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika76] END)) + CONVERT(DECIMAL, (CASE [ika77] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika77] END)) + CONVERT(DECIMAL, (CASE [ika78] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika78] END)) + CONVERT(DECIMAL, (CASE [ika79] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika79] END)) + CONVERT(DECIMAL, (CASE [ika80] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika80] END)) + CONVERT(DECIMAL, (CASE [ika81] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika81] END)) + CONVERT(DECIMAL, (CASE [ika82] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika82] END)) + CONVERT(DECIMAL, (CASE [ika83] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika83] END)) + CONVERT(DECIMAL, (CASE [ika84] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika84] END)) + CONVERT(DECIMAL, (CASE [ika85] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika85] END)) + CONVERT(DECIMAL, (CASE [ika86] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika86] END)) + CONVERT(DECIMAL, (CASE [ika87] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika87] END)) + CONVERT(DECIMAL, (CASE [ika88] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika88] END)) + CONVERT(DECIMAL, (CASE [ika89] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika89] END)) + CONVERT(DECIMAL, (CASE [ika90] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika90] END)) + CONVERT(DECIMAL, (CASE [ika91] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika91] END)) + CONVERT(DECIMAL, (CASE [ika92] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika92] END)) + CONVERT(DECIMAL, (CASE [ika93] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika93] END)) + CONVERT(DECIMAL, (CASE [ika94] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika94] END)) + CONVERT(DECIMAL, (CASE [ika95] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika95] END)) + CONVERT(DECIMAL, (CASE [ika96] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika96] END)) + CONVERT(DECIMAL, (CASE [ika97] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika97] END)) + CONVERT(DECIMAL, (CASE [ika98] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika98] END)) + CONVERT(DECIMAL, (CASE [ika99] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika99] END)) + CONVERT(DECIMAL, (CASE [ika100_] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika100_] END))) AS [ika15_100_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika15] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika15] END)) + CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)) + CONVERT(DECIMAL, (CASE [ika65] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika65] END)) + CONVERT(DECIMAL, (CASE [ika66] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika66] END)) + CONVERT(DECIMAL, (CASE [ika67] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika67] END)) + CONVERT(DECIMAL, (CASE [ika68] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika68] END)) + CONVERT(DECIMAL, (CASE [ika69] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika69] END)) + CONVERT(DECIMAL, (CASE [ika70] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika70] END)) + CONVERT(DECIMAL, (CASE [ika71] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika71] END)) + CONVERT(DECIMAL, (CASE [ika72] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika72] END)) + CONVERT(DECIMAL, (CASE [ika73] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika73] END)) + CONVERT(DECIMAL, (CASE [ika74] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika74] END)) + CONVERT(DECIMAL, (CASE [ika75] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika75] END)) + CONVERT(DECIMAL, (CASE [ika76] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika76] END)) + CONVERT(DECIMAL, (CASE [ika77] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika77] END)) + CONVERT(DECIMAL, (CASE [ika78] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika78] END)) + CONVERT(DECIMAL, (CASE [ika79] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika79] END)) + CONVERT(DECIMAL, (CASE [ika80] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika80] END)) + CONVERT(DECIMAL, (CASE [ika81] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika81] END)) + CONVERT(DECIMAL, (CASE [ika82] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika82] END)) + CONVERT(DECIMAL, (CASE [ika83] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika83] END)) + CONVERT(DECIMAL, (CASE [ika84] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika84] END)) + CONVERT(DECIMAL, (CASE [ika85] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika85] END)) + CONVERT(DECIMAL, (CASE [ika86] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika86] END)) + CONVERT(DECIMAL, (CASE [ika87] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika87] END)) + CONVERT(DECIMAL, (CASE [ika88] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika88] END)) + CONVERT(DECIMAL, (CASE [ika89] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika89] END)) + CONVERT(DECIMAL, (CASE [ika90] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika90] END)) + CONVERT(DECIMAL, (CASE [ika91] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika91] END)) + CONVERT(DECIMAL, (CASE [ika92] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika92] END)) + CONVERT(DECIMAL, (CASE [ika93] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika93] END)) + CONVERT(DECIMAL, (CASE [ika94] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika94] END)) + CONVERT(DECIMAL, (CASE [ika95] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika95] END)) + CONVERT(DECIMAL, (CASE [ika96] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika96] END)) + CONVERT(DECIMAL, (CASE [ika97] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika97] END)) + CONVERT(DECIMAL, (CASE [ika98] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika98] END)) + CONVERT(DECIMAL, (CASE [ika99] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika99] END)) + CONVERT(DECIMAL, (CASE [ika100_] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika100_] END)))/86) AS [ika15_100_ka]
      , (CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END))) AS [ika16_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)))/1) AS [ika16_ka]
      , (CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END))) AS [ika16_18_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)))/3) AS [ika16_18_ka]
      , (CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END))) AS [ika16_19_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)))/4) AS [ika16_19_ka]
      , (CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END))) AS [ika16_21_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika16] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika16] END)) + CONVERT(DECIMAL, (CASE [ika17] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika17] END)) + CONVERT(DECIMAL, (CASE [ika18] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika18] END)) + CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)))/6) AS [ika16_21_ka]
      , (CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END))) AS [ika19_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)))/1) AS [ika19_ka]
      , (CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END))) AS [ika19_20_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)))/2) AS [ika19_20_ka]
      , (CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END))) AS [ika19_21_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika19] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika19] END)) + CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)))/3) AS [ika19_21_ka]
      , (CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END))) AS [ika20_24_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)))/5) AS [ika20_24_ka]
      , (CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END))) AS [ika20_29_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika20] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika20] END)) + CONVERT(DECIMAL, (CASE [ika21] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika21] END)) + CONVERT(DECIMAL, (CASE [ika22] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika22] END)) + CONVERT(DECIMAL, (CASE [ika23] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika23] END)) + CONVERT(DECIMAL, (CASE [ika24] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika24] END)) + CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)))/10) AS [ika20_29_ka]
      , (CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END))) AS [ika25_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)))/1) AS [ika25_ka]
      , (CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END))) AS [ika25_34_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)))/10) AS [ika25_34_ka]
      , (CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END))) AS [ika25_64_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)))/40) AS [ika25_64_ka]
      , (CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)) + CONVERT(DECIMAL, (CASE [ika65] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika65] END)) + CONVERT(DECIMAL, (CASE [ika66] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika66] END)) + CONVERT(DECIMAL, (CASE [ika67] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika67] END)) + CONVERT(DECIMAL, (CASE [ika68] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika68] END)) + CONVERT(DECIMAL, (CASE [ika69] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika69] END)) + CONVERT(DECIMAL, (CASE [ika70]  WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika70] END)) + CONVERT(DECIMAL, (CASE [ika71] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika71] END)) + CONVERT(DECIMAL, (CASE [ika72] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika72] END)) + CONVERT(DECIMAL, (CASE [ika73] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika73] END)) + CONVERT(DECIMAL, (CASE [ika74] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika74] END)) + CONVERT(DECIMAL, (CASE [ika75] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika75] END)) + CONVERT(DECIMAL, (CASE [ika76] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika76] END)) + CONVERT(DECIMAL, (CASE [ika77] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika77] END)) + CONVERT(DECIMAL, (CASE [ika78] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika78] END)) + CONVERT(DECIMAL, (CASE [ika79] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika79] END)) + CONVERT(DECIMAL, (CASE [ika80] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika80] END)) + CONVERT(DECIMAL, (CASE [ika81] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika81] END)) + CONVERT(DECIMAL, (CASE [ika82] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika82] END)) + CONVERT(DECIMAL, (CASE [ika83] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika83] END)) + CONVERT(DECIMAL, (CASE [ika84] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika84] END)) + CONVERT(DECIMAL, (CASE [ika85] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika85] END)) + CONVERT(DECIMAL, (CASE [ika86] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika86] END)) + CONVERT(DECIMAL, (CASE [ika87] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika87] END)) + CONVERT(DECIMAL, (CASE [ika88] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika88] END)) + CONVERT(DECIMAL, (CASE [ika89] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika89] END)) + CONVERT(DECIMAL, (CASE [ika90] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika90] END)) + CONVERT(DECIMAL, (CASE [ika91] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika91] END)) + CONVERT(DECIMAL, (CASE [ika92] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika92] END)) + CONVERT(DECIMAL, (CASE [ika93] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika93] END)) + CONVERT(DECIMAL, (CASE [ika94] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika94] END)) + CONVERT(DECIMAL, (CASE [ika95] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika95] END)) + CONVERT(DECIMAL, (CASE [ika96] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika96] END)) + CONVERT(DECIMAL, (CASE [ika97] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika97] END)) + CONVERT(DECIMAL, (CASE [ika98] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika98] END)) + CONVERT(DECIMAL, (CASE [ika99] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika99] END)) + CONVERT(DECIMAL, (CASE [ika100_] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika100_] END))) AS [ika25_100_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika25] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika25] END)) + CONVERT(DECIMAL, (CASE [ika26] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika26] END)) + CONVERT(DECIMAL, (CASE [ika27] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika27] END)) + CONVERT(DECIMAL, (CASE [ika28] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika28] END)) + CONVERT(DECIMAL, (CASE [ika29] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika29] END)) + CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)) + CONVERT(DECIMAL, (CASE [ika35] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika35] END)) + CONVERT(DECIMAL, (CASE [ika36] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika36] END)) + CONVERT(DECIMAL, (CASE [ika37] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika37] END)) + CONVERT(DECIMAL, (CASE [ika38] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika38] END)) + CONVERT(DECIMAL, (CASE [ika39] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika39] END)) + CONVERT(DECIMAL, (CASE [ika40] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika40] END)) + CONVERT(DECIMAL, (CASE [ika41] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika41] END)) + CONVERT(DECIMAL, (CASE [ika42] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika42] END)) + CONVERT(DECIMAL, (CASE [ika43] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika43] END)) + CONVERT(DECIMAL, (CASE [ika44] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika44] END)) + CONVERT(DECIMAL, (CASE [ika45] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika45] END)) + CONVERT(DECIMAL, (CASE [ika46] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika46] END)) + CONVERT(DECIMAL, (CASE [ika47] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika47] END)) + CONVERT(DECIMAL, (CASE [ika48] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika48] END)) + CONVERT(DECIMAL, (CASE [ika49] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika49] END)) + CONVERT(DECIMAL, (CASE [ika50] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika50] END)) + CONVERT(DECIMAL, (CASE [ika51] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika51] END)) + CONVERT(DECIMAL, (CASE [ika52] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika52] END)) + CONVERT(DECIMAL, (CASE [ika53] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika53] END)) + CONVERT(DECIMAL, (CASE [ika54] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika54] END)) + CONVERT(DECIMAL, (CASE [ika55] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika55] END)) + CONVERT(DECIMAL, (CASE [ika56] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika56] END)) + CONVERT(DECIMAL, (CASE [ika57] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika57] END)) + CONVERT(DECIMAL, (CASE [ika58] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika58] END)) + CONVERT(DECIMAL, (CASE [ika59] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika59] END)) + CONVERT(DECIMAL, (CASE [ika60] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika60] END)) + CONVERT(DECIMAL, (CASE [ika61] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika61] END)) + CONVERT(DECIMAL, (CASE [ika62] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika62] END)) + CONVERT(DECIMAL, (CASE [ika63] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika63] END)) + CONVERT(DECIMAL, (CASE [ika64] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika64] END)) + CONVERT(DECIMAL, (CASE [ika65] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika65] END)) + CONVERT(DECIMAL, (CASE [ika66] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika66] END)) + CONVERT(DECIMAL, (CASE [ika67] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika67] END)) + CONVERT(DECIMAL, (CASE [ika68] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika68] END)) + CONVERT(DECIMAL, (CASE [ika69] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika69] END)) + CONVERT(DECIMAL, (CASE [ika70] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika70] END)) + CONVERT(DECIMAL, (CASE [ika71] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika71] END)) + CONVERT(DECIMAL, (CASE [ika72] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika72] END)) + CONVERT(DECIMAL, (CASE [ika73] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika73] END)) + CONVERT(DECIMAL, (CASE [ika74] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika74] END)) + CONVERT(DECIMAL, (CASE [ika75] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika75] END)) + CONVERT(DECIMAL, (CASE [ika76] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika76] END)) + CONVERT(DECIMAL, (CASE [ika77] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika77] END)) + CONVERT(DECIMAL, (CASE [ika78] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika78] END)) + CONVERT(DECIMAL, (CASE [ika79] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika79] END)) + CONVERT(DECIMAL, (CASE [ika80] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika80] END)) + CONVERT(DECIMAL, (CASE [ika81] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika81] END)) + CONVERT(DECIMAL, (CASE [ika82] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika82] END)) + CONVERT(DECIMAL, (CASE [ika83] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika83] END)) + CONVERT(DECIMAL, (CASE [ika84] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika84] END)) + CONVERT(DECIMAL, (CASE [ika85] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika85] END)) + CONVERT(DECIMAL, (CASE [ika86] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika86] END)) + CONVERT(DECIMAL, (CASE [ika87] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika87] END)) + CONVERT(DECIMAL, (CASE [ika88] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika88] END)) + CONVERT(DECIMAL, (CASE [ika89] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika89] END)) + CONVERT(DECIMAL, (CASE [ika90] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika90] END)) + CONVERT(DECIMAL, (CASE [ika91] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika91] END)) + CONVERT(DECIMAL, (CASE [ika92] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika92] END)) + CONVERT(DECIMAL, (CASE [ika93] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika93] END)) + CONVERT(DECIMAL, (CASE [ika94] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika94] END)) + CONVERT(DECIMAL, (CASE [ika95] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika95] END)) + CONVERT(DECIMAL, (CASE [ika96] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika96] END)) + CONVERT(DECIMAL, (CASE [ika97] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika97] END)) + CONVERT(DECIMAL, (CASE [ika98] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika98] END)) + CONVERT(DECIMAL, (CASE [ika99] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika99] END)) + CONVERT(DECIMAL, (CASE [ika100_] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika100_] END)))/76) AS [ika25_100_ka]
      , (CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END))) AS [ika30_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)))/1) AS [ika30_ka]
      , (CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END))) AS [ika30_34_lkm]
      , ((CONVERT(DECIMAL, (CASE [ika30] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika30] END)) + CONVERT(DECIMAL, (CASE [ika31] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika31] END)) + CONVERT(DECIMAL, (CASE [ika32] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika32] END)) + CONVERT(DECIMAL, (CASE [ika33] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika33] END)) + CONVERT(DECIMAL, (CASE [ika34] WHEN NULL THEN ''0'' WHEN '''' THEN ''0'' ELSE [ika34] END)))/5) AS [ika30_34_ka]

FROM VipunenTK_DW.dbo.[sa_4_9_Vaestorakenne_kunnittain]
' 
GO
/****** Object:  View [dbo].[v_f_4_9_Vaestorakenne_kunnittain2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_4_9_Vaestorakenne_kunnittain2]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_f_4_9_Vaestorakenne_kunnittain2] AS

-- truncate table f_4_9_Vaestorakenne_kunnittain
-- insert into f_4_9_Vaestorakenne_kunnittain select * from v_f_4_9_Vaestorakenne_kunnittain

SELECT 
	tilastointivuosi = f.tilastointivuosi
	,sukupuoli = f.sukupuoli
	,kotikunta  = f.kotikunta
	,aidinkieli_versio2 = f.aidinkieli_versio2
	,kansalaisuus_versio1 = f.kansalaisuus_versio1
	,maanosa = f.maanosa
	,pohjoismaa = f.pohjoismaa
	,eumaa  = f.eumaa
	,etamaa = f.etamaa
	,ika  = cast(f.ika as nvarchar(5))
	,lukumaara = f.lukumaara
	,tietolahde = f.tietolahde
	,aineistotunnus = f.aineistotunnus
	,aidinkieli = f.aidinkieli

FROM (

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 0
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika0>0


UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 1
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika1>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 2
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika2>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 3
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika3>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 4
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika4>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 5
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika5>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 6
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika6>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 7
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika7>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 8
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika8>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 9
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika9>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 10
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika10>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 11
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika11>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 12
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika12>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 13
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika13>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 14
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika14>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 15
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika15>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 16
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika16>0


UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 17
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika17>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 18
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika18>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 19
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika19>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 20
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika20>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 21
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika21>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 22
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika22>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 23
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika23>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 24
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika24>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 25
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika25>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 26
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika26>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 27
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika27>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 28
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika28>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 29
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika29>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 30
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika30>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 31
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika31>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 32
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika32>0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 33
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika33 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 34
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika34 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 35
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika35 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 36
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika36 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 37
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika37 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 38
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika38 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 39
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika39 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 40
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika40 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 41
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika41 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 42
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika42 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 43
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika43 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 44
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika44 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 45
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika45 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 46
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika46 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 47
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika47 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 48
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika48 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 49
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika49 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 50
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika50 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 51
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika51 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 52
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika52 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 53
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika53 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 54
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika54 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 55
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika55 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 56
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika56 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 57
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika57 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 58
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika58 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 59
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika59 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 60
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika60 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 61
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika61 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 62
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika62 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 63
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika63 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 64
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika64 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 65
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika65 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 66
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika66 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 67
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika67 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 68
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika68 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 69
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika69 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 70
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika70 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 71
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika71 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 72
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika72 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 73
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika73 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 74
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika74 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 75
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika75 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 76
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika76 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 77
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika77 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 78
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika78 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 79
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika79 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 80
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika80 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 81
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika81 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 82
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika82 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 83
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika83 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 84
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika84 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 85
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika85 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 86
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika86 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 87
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika87 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 88
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika88 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 89
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika89 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 90
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika90 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 91
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika91 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 92
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika92 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 93
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika93 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 94
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika94 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 95
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika95 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 96
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika96 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 97
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika97 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 98
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika98 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 99
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika99 > 0

UNION ALL

SELECT
	 tilastointivuosi = tilv
	,sukupuoli = sp
	,kotikunta = tilvaskun
	,aidinkieli_versio2 = aikielir2
	,kansalaisuus_versio1 = kansalr1
	,maanosa = mosa
	,pohjoismaa = pohjmaa
	,eumaa = eumaa
	,etamaa = etamaa
	,ika = 100
	,lukumaara = lkm
	,tietolahde = tietolahde
-- johdetut
	,aineistotunnus = ''4.9''
	,aidinkieli = cast(
	(
		case
		when aikielir2 in (''fi'',''se'') then ''fs''
		when aikielir2 = ''sv'' then ''sv''
		else ''99''
		end
	)
	as nvarchar(2))
FROM VipunenTK_DW.[dbo].[sa_4_9_Vaestorakenne_kunnittain] f
WHERE ika100_ > 0



) F




























' 
GO
/****** Object:  View [dbo].[v_f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain]'))
EXEC dbo.sp_executesql @statement = N'


CREATE view [dbo].[v_f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain] as

-- CSC JN 26.1.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain
-- Select * into VipunenTK_DW.dbo.f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain from VipunenTK_DW.dbo.v_f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain
-- Insert into VipunenTK_DW.dbo.f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain Select * from VipunenTK_DW.dbo.v_f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain


SELECT tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = tunn
      ,tieteenala_avain = [tiede]
      ,virkaryhma_avain = [vryhma]
      ,ika_avain = Cast(Case [ikar4] 
				when ''1'' then ''ikar41''
				when ''2'' then ''ikar42''
				when ''3'' then ''ikar43''
				when ''4'' then ''ikar44''
				when ''5'' then ''ikar45''
				when ''6'' then ''ikar46''
				when ''7'' then ''ikar47''
				when ''8'' then ''ikar48''
				when ''9'' then ''ikar49''
				when ''10'' then ''ikar40''
				else ''-1''
			end as nvarchar(10))
      ,sukupuoli_avain = [sp]
      ,tutkintotaso_avain = [tutktaso]
      ,[lkm_tutkimushenkilokunta]
      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[sa_5_1_Yliopistojen_tutkimushenkilökunta_yliopistoittain]


' 
GO
/****** Object:  View [dbo].[v_f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain]'))
EXEC dbo.sp_executesql @statement = N'



CREATE view [dbo].[v_f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain] as

-- CSC JN 26.1.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain
-- Select * into VipunenTK_DW.dbo.f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain from VipunenTK_DW.dbo.v_f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain
-- Insert into VipunenTK_DW.dbo.f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain Select * from VipunenTK_DW.dbo.v_f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain


SELECT tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = tunn
      ,tieteenala_avain = [tiede]
      ,virkaryhma_avain = [vryhma]
      ,ika_avain = Cast(Case [ikar4] 
				when ''1'' then ''ikar41''
				when ''2'' then ''ikar42''
				when ''3'' then ''ikar43''
				when ''4'' then ''ikar44''
				when ''5'' then ''ikar45''
				when ''6'' then ''ikar46''
				when ''7'' then ''ikar47''
				when ''8'' then ''ikar48''
				when ''9'' then ''ikar49''
				when ''10'' then ''ikar40''
				else ''-1''
			end as nvarchar(10))
      ,sukupuoli_avain = [sp]
      ,tutkintotaso_avain = [tutktaso]
      ,[lkm_tutkimustyovuodet]
      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[sa_5_2_Yliopistojen_tutkimustyovuodet_yliopistoittain]



' 
GO
/****** Object:  View [dbo].[v_f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain]'))
EXEC dbo.sp_executesql @statement = N'


CREATE view [dbo].[v_f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] as

-- CSC JN 26.1.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain
-- Select * into VipunenTK_DW.dbo.f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain from VipunenTK_DW.dbo.v_f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain
-- Insert into VipunenTK_DW.dbo.f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain Select * from VipunenTK_DW.dbo.v_f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain


SELECT tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = tunn
      ,tieteenala_avain = [tiede]

,''Tutkimusmenot_yhteensa'' = yhme
,''Kayttomenot_yhteensa'' = kmeno
,''Kayttomenoista_palkat'' = palme
,''Kayttomenoista_apurahat'' = apuraha
,''Laskettu_muutkayttomenot'' = kmeno-palme-apuraha
,''Menot_laitehankinnat'' = mkmeno
,''OKM_perusrahoitus'' = ptmeno
,''SuomenAkatemia'' = SAKAT
,''Muu_OKM'' = MOKM
,''TEKES'' = TEKES
,''Muu_TEM'' = MTEM
,''UM'' = UM
,''OM'' = OM
,''SM'' = SM
,''PM'' = PM
,''VM'' = VM
,''MMM'' = MMM
,''LVM'' = LVM
,''STM'' = STM
,''YM'' = YM
,''Kunnat'' = kunnat
,''Muu_julkinen_rahoitus'' = mjulk
,''Kotimaiset_rahastot'' = krahas
,''Kotimaiset_yritykset'' = kyrit
,''Ulkomaiset_yritykset'' = uyrit
,''EU_puiteohjelmarahoitus'' = eupuite
,''EU_aluekehitysrahoitus'' = [eakr]
,''EU_sosiaalirahasto'' = [esr]
,''Muu_EU'' = [muueu]
,''Ulkomaiset_rahastot'' = urahas
,''Kansainvaliset_jarjestot'' = kv_jarj
,''Muu_ulkomainen_rahoitus'' = mulko
,''Korkeakoulun_omat_varat'' = ot_menot



      ,[tietolahde]
      ,[rivinumero]
  FROM [dbo].[sa_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain]


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_rahoitus


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,rahoituslahde_avain
	  ,tutkimusrahoitus
      ,[tietolahde]
      ,[rivinumero]

  FROM ( --kaikki
  
--Select 
--	 tilv
--	,[tilv_date]
--	,TK_koodi
--	,rahoituslahde_avain = ''OKM_PERUS''
--	,tutkimusrahoitus = [OKM_perusrahoitus]
--	,[tietolahde]
--    ,[rivinumero]
--From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
--Where [OKM_perusrahoitus] <> 0.0

--Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''TEKES''
	,tutkimusrahoitus = TEKES
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where TEKES <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''TEM_MUU''
	,tutkimusrahoitus = MTEM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MTEM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''AKATEMIA''
	,tutkimusrahoitus = AKATEMIA
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where AKATEMIA <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''GRAD''
	,tutkimusrahoitus = GRAD
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where GRAD <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''OKM_MUU''
	,tutkimusrahoitus = MOPEM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MOPEM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''LVM''
	,tutkimusrahoitus = LIIKM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where LIIKM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''MMM''
	,tutkimusrahoitus = MAAM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MAAM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''OM''
	,tutkimusrahoitus = OM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where OM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''PM''
	,tutkimusrahoitus = PM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where PM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''SM''
	,tutkimusrahoitus = SISAM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where SISAM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''STM''
	,tutkimusrahoitus = SOSM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where SOSM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''UM''
	,tutkimusrahoitus = UM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where UM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''VN''
	,tutkimusrahoitus = VN
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where VN <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''VM''
	,tutkimusrahoitus = VM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where VM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YM''
	,tutkimusrahoitus = YMP
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where YMP <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''JULK_MUU''
	,tutkimusrahoitus = MUUJU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MUUJU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''RAHASTO_K''
	,tutkimusrahoitus = RAHAS
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where RAHAS <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YRITYS_K''
	,tutkimusrahoitus = KOTIM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where KOTIM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YRITYS_U''
	,tutkimusrahoitus = ULKOY
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where ULKOY <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU''
	,tutkimusrahoitus = UEU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where UEU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_PUITE''
	,tutkimusrahoitus = EUPUITE
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where EUPUITE <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_ALUE''
	,tutkimusrahoitus = EAKR
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where EAKR <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_SOS''
	,tutkimusrahoitus = ESR
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where ESR <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_MUU''
	,tutkimusrahoitus = MUUEU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MUUEU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''MUU_U''
	,tutkimusrahoitus = MULKO
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MULKO <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''KUNNAT''
	,tutkimusrahoitus = KUNNAT
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where KUNNAT <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''JARJESTO_U''
	,tutkimusrahoitus = MKVJ
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where MKVJ <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''ORAHAS''
	,tutkimusrahoitus = ORAHAS
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where ORAHAS <> 0.0
 ) kaikki



' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain]'))
EXEC dbo.sp_executesql @statement = N'



CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL

--order by oppilaitos_avain, tilastovuosi


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain]'))
EXEC dbo.sp_executesql @statement = N'





CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain


--Tutkijat
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty1 - ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE pty1 - ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty2 - ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE pty2 - ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty3 - ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE pty3 - ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty4 - ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE pty4 - ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty5 - ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE pty5 - ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty6 - ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE pty6 - ptn6 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE ptn6 <> 0

--Muu henkilökunta
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy1 - phn1 - pty1 + ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phy1 - phn1 - pty1 + ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn1 - ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phn1 - ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy2 - phn2 - pty2 + ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phy2 - phn2 - pty2 + ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn2 - ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phn2 - ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy3 - phn3 - pty3 + ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phy3 - phn3 - pty3 + ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn3 - ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phn3 - ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy4 - phn4 - pty4 + ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phy4 - phn4 - pty4 + ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn4 - ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phn4 - ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy5 - phn5 - pty5 + ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phy5 - phn5 - pty5 + ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn5 - ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phn5 - ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy6 - phn6 - pty6 + ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phy6 - phn6 - pty6 + ptn6 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn6 - ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE phn6 - ptn6 <> 0


--order by oppilaitos_avain, tilastovuosi






' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain]'))
EXEC dbo.sp_executesql @statement = N'




CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimushenkilokunta_tutkintotasoittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

--Lukujen summa löytyy aineistosta myös kentistä
-- yhte
-- yhte2
-- henlkmy


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = [TOLKM] - [NTOLKM]
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = [NTOLKM]
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = LISLKM - NLISLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NLISLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = DILKM - NDIPLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NDIPLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = INSLKM - NOPINS
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NOPINS
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = MKOULKM - NMKOULKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NMKOULKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = OPISTLKM - NOPISTLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NOPISTLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 

--order by oppilaitos_avain, tilastovuosi



' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot] as

-- CSC JN 16.4.2015
-- CSC JN 27.4.2015 Lisätään mukaan arviot seuraavasta vuodesta

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot

-- YHME = PAME + OSTPAL + KMENO + HMENO

SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,menokohde_avain
	  ,tutkimusmenot
	  ,tutkimusmenot_arvio_seuraavatilastovuosi
      ,[tietolahde]
      ,[rivinumero]
FROM ( --kaikki
  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''PALKAT''
	,tutkimusmenot = PAME
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where PAME <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''OSTPAL''
	,tutkimusmenot = OSTPAL
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where OSTPAL <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''MUUTKMENOT''
	,tutkimusmenot = KMENO
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where KMENO <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''MUUTMENOT''
	,tutkimusmenot = HMENO
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where HMENO <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''-1''
	,tutkimusmenot = NULL
	,tutkimusmenot_arvio_seuraavatilastovuosi = tk_arvioe
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
Where HMENO <> 0.0

) kaikki


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain] as

-- CSC JN 16.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,tutkimusmenot_alueittain = TKMENO1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL
  AND TKMENO1 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,tutkimusmenot_alueittain = TKMENO2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL
  AND TKMENO2 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,tutkimusmenot_alueittain = TKMENO3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL
  AND TKMENO3 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,tutkimusmenot_alueittain = TKMENO4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL
  AND TKMENO4 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,tutkimusmenot_alueittain = TKMENO5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL
  AND TKMENO5 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,tutkimusmenot_alueittain = TKMENO6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL
  AND TKMENO6 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,tutkimusmenot_alueittain = TKMENO7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL
  AND TKMENO7 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,tutkimusmenot_alueittain = TKMENO8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL
  AND TKMENO8 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,tutkimusmenot_alueittain = TKMENO9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL
  AND TKMENO9 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,tutkimusmenot_alueittain = TKMENO10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL
  AND TKMENO10 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,tutkimusmenot_alueittain = TKMENO11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL
  AND TKMENO11 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,tutkimusmenot_alueittain = TKMENO12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL
  AND TKMENO12 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,tutkimusmenot_alueittain = TKMENO13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL
  AND TKMENO13 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,tutkimusmenot_alueittain = TKMENO14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL
  AND TKMENO14 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,tutkimusmenot_alueittain = TKMENO15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL
  AND TKMENO15 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,tutkimusmenot_alueittain = TKMENO16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL
  AND TKMENO16 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,tutkimusmenot_alueittain = TKMENO17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL
  AND TKMENO17 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,tutkimusmenot_alueittain = TKMENO18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL
  AND TKMENO18 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,tutkimusmenot_alueittain = TKMENO19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL
  AND TKMENO19 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,tutkimusmenot_alueittain = TKMENO20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL
  AND TKMENO20 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,tutkimusmenot_alueittain = TKMENO21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL
  AND TKMENO21 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,tutkimusmenot_alueittain = TKMENO22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL
  AND TKMENO22 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,tutkimusmenot_alueittain = TKMENO23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL
  AND TKMENO23 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,tutkimusmenot_alueittain = TKMENO24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL
  AND TKMENO24 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,tutkimusmenot_alueittain = TKMENO25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL
  AND TKMENO25 <> 0.0
  
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,tutkimusmenot_alueittain = TKMENOY - TKMENO1 - TKMENO2 - TKMENO3 - TKMENO4 - TKMENO5 - TKMENO6 - TKMENO7 - TKMENO8 - TKMENO9 - TKMENO10
												- TKMENO11 - TKMENO12 - TKMENO13 - TKMENO14 - TKMENO15 - TKMENO16 - TKMENO17 - TKMENO18 - TKMENO19 - TKMENO20
												- TKMENO21 - TKMENO22 - TKMENO23 - TKMENO24 - TKMENO25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE (TKMENOY - TKMENO1 - TKMENO2 - TKMENO3 - TKMENO4 - TKMENO5 - TKMENO6 - TKMENO7 - TKMENO8 - TKMENO9 - TKMENO10
			 - TKMENO11 - TKMENO12 - TKMENO13 - TKMENO14 - TKMENO15 - TKMENO16 - TKMENO17 - TKMENO18 - TKMENO19 - TKMENO20
			 - TKMENO21 - TKMENO22 - TKMENO23 - TKMENO24 - TKMENO25) <> 0.0



' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain] as

-- CSC JN 16.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA1
	  ,tutkimusmenot_tieteenaloittain = YHME*TA1P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA1 IS NOT NULL
  AND TA1P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA2
	  ,tutkimusmenot_tieteenaloittain = YHME*TA2P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA2 IS NOT NULL
  AND TA2P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA3
	  ,tutkimusmenot_tieteenaloittain = YHME*TA3P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA3 IS NOT NULL
  AND TA3P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA4
	  ,tutkimusmenot_tieteenaloittain = YHME*TA4P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA4 IS NOT NULL
  AND TA4P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA5
	  ,tutkimusmenot_tieteenaloittain = YHME*TA5P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA5 IS NOT NULL
  AND TA5P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA6
	  ,tutkimusmenot_tieteenaloittain = YHME*TA6P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA6 IS NOT NULL
  AND TA6P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA7
	  ,tutkimusmenot_tieteenaloittain = YHME*TA7P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA7 IS NOT NULL
  AND TA7P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA8
	  ,tutkimusmenot_tieteenaloittain = YHME*TA8P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA8 IS NOT NULL
  AND TA8P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA9
	  ,tutkimusmenot_tieteenaloittain = YHME*TA9P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA9 IS NOT NULL
  AND TA9P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA10
	  ,tutkimusmenot_tieteenaloittain = YHME*TA10P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA10 IS NOT NULL
  AND TA10P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA11
	  ,tutkimusmenot_tieteenaloittain = YHME*TA11P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA11 IS NOT NULL
  AND TA11P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA12
	  ,tutkimusmenot_tieteenaloittain = YHME*TA12P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA12 IS NOT NULL
  AND TA12P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA13
	  ,tutkimusmenot_tieteenaloittain = YHME*TA13P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA13 IS NOT NULL
  AND TA13P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA14
	  ,tutkimusmenot_tieteenaloittain = YHME*TA14P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA14 IS NOT NULL
  AND TA14P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA15
	  ,tutkimusmenot_tieteenaloittain = YHME*TA15P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA15 IS NOT NULL
  AND TA15P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA16
	  ,tutkimusmenot_tieteenaloittain = YHME*TA16P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA16 IS NOT NULL
  AND TA16P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA17
	  ,tutkimusmenot_tieteenaloittain = YHME*TA17P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA17 IS NOT NULL
  AND TA17P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,tieteenala_avain = TA18
	  ,tutkimusmenot_tieteenaloittain = YHME*TA18P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TA18 IS NOT NULL
  AND TA18P <> 0.0

' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain]'))
EXEC dbo.sp_executesql @statement = N'





CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,lkm_tutkimustyovuodet_alueittain = TYOV1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL
  AND TYOV1 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,lkm_tutkimustyovuodet_alueittain = TYOV2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL
  AND TYOV2 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,lkm_tutkimustyovuodet_alueittain = TYOV3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL
  AND TYOV3 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,lkm_tutkimustyovuodet_alueittain = TYOV4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL
  AND TYOV4 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,lkm_tutkimustyovuodet_alueittain = TYOV5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL
  AND TYOV5 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,lkm_tutkimustyovuodet_alueittain = TYOV6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL
  AND TYOV6 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,lkm_tutkimustyovuodet_alueittain = TYOV7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL
  AND TYOV7 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,lkm_tutkimustyovuodet_alueittain = TYOV8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL
  AND TYOV8 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,lkm_tutkimustyovuodet_alueittain = TYOV9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL
  AND TYOV9 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,lkm_tutkimustyovuodet_alueittain = TYOV10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL
  AND TYOV10 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,lkm_tutkimustyovuodet_alueittain = TYOV11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL
  AND TYOV11 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,lkm_tutkimustyovuodet_alueittain = TYOV12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL
  AND TYOV12 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,lkm_tutkimustyovuodet_alueittain = TYOV13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL
  AND TYOV13 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,lkm_tutkimustyovuodet_alueittain = TYOV14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL
  AND TYOV14 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,lkm_tutkimustyovuodet_alueittain = TYOV15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL
  AND TYOV15 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,lkm_tutkimustyovuodet_alueittain = TYOV16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL
  AND TYOV16 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,lkm_tutkimustyovuodet_alueittain = TYOV17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL
  AND TYOV17 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,lkm_tutkimustyovuodet_alueittain = TYOV18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL
  AND TYOV18 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,lkm_tutkimustyovuodet_alueittain = TYOV19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL
  AND TYOV19 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,lkm_tutkimustyovuodet_alueittain = TYOV20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL
  AND TYOV20 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,lkm_tutkimustyovuodet_alueittain = TYOV21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL
  AND TYOV21 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,lkm_tutkimustyovuodet_alueittain = TYOV22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL
  AND TYOV22 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,lkm_tutkimustyovuodet_alueittain = TYOV23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL
  AND TYOV23 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,lkm_tutkimustyovuodet_alueittain = TYOV24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL
  AND TYOV24 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,lkm_tutkimustyovuodet_alueittain = TYOV25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL
  AND TYOV25 <> 0.0
  
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
	  ,alueluokitus_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,lkm_tutkimustyovuodet_alueittain = TYOVY - TYOV1 - TYOV2 - TYOV3 - TYOV4 - TYOV5 - TYOV6 - TYOV7 - TYOV8 - TYOV9 - TYOV10
												- TYOV11 - TYOV12 - TYOV13 - TYOV14 - TYOV15 - TYOV16 - TYOV17 - TYOV18 - TYOV19 - TYOV20
												- TYOV21 - TYOV22 - TYOV23 - TYOV24 - TYOV25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE (TYOVY - TYOV1 - TYOV2 - TYOV3 - TYOV4 - TYOV5 - TYOV6 - TYOV7 - TYOV8 - TYOV9 - TYOV10
			 - TYOV11 - TYOV12 - TYOV13 - TYOV14 - TYOV15 - TYOV16 - TYOV17 - TYOV18 - TYOV19 - TYOV20
			 - TYOV21 - TYOV22 - TYOV23 - TYOV24 - TYOV25) <> 0.0

--order by oppilaitos_avain, tilastovuosi




' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain]'))
EXEC dbo.sp_executesql @statement = N'




CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_tyorooleittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain



SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tehtava_avain = ''TUTKIJA'' --Tutkija
	  ,lkm_tutkimustyovuodet_tyorooleittain = TUTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TUTTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,lkm_tutkimustyovuodet_tyorooleittain = MTKTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE MTKTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tehtava_avain = ''KORJAUS'' --Muu tutkimushenkilökunta
	  ,lkm_tutkimustyovuodet_tyorooleittain = YHTTTV - TUTTTV - MTKTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE YHTTTV - TUTTTV - MTKTTV <> 0.0


--order by oppilaitos_avain, tilastovuosi

' 
GO
/****** Object:  View [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain]'))
EXEC dbo.sp_executesql @statement = N'






CREATE view [dbo].[v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_kehitys_tutkimustyovuodet_tutkintotasoittain from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

--Lukujen summa löytyy aineistosta myös kentistä
-- YHTTTV
-- TYOVY


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = TOTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE TOTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = LISTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE LISTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = DIPTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE DIPTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = OPINSTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE OPINSTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = MKOUTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE MKOUTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = OPISTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE OPISTTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,oppilaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = YHTTTV - TOTTV - LISTTV - DIPTTV - OPINSTTV - MKOUTTV - OPISTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Ammattikorkeakoulujen_tutkimus_ja_kehitys] 
WHERE YHTTTV - TOTTV - LISTTV - DIPTTV - OPINSTTV - MKOUTTV - OPISTTTV <> 0.0

--order by oppilaitos_avain, tilastovuosi


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_rahoitus


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,rahoituslahde_avain
	  ,tutkimusrahoitus
      ,[tietolahde]
      ,[rivinumero]

  FROM ( --kaikki
  
--Select 
--	 tilv
--	,[tilv_date]
--	,TK_koodi
--	,rahoituslahde_avain = ''OKM_PERUS''
--	,tutkimusrahoitus = [OKM_perusrahoitus]
--	,[tietolahde]
--    ,[rivinumero]
--From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
--Where [OKM_perusrahoitus] <> 0.0

--Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''TEKES''
	,tutkimusrahoitus = TEKES
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where TEKES <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''TEM_MUU''
	,tutkimusrahoitus = MTEM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MTEM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''AKATEMIA''
	,tutkimusrahoitus = AKATEMIA
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where AKATEMIA <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''GRAD''
	,tutkimusrahoitus = GRAD
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where GRAD <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''OKM_MUU''
	,tutkimusrahoitus = MOPEM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MOPEM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''LVM''
	,tutkimusrahoitus = LIIKM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where LIIKM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''MMM''
	,tutkimusrahoitus = MAAM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MAAM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''OM''
	,tutkimusrahoitus = OM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where OM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''PM''
	,tutkimusrahoitus = PM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where PM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''SM''
	,tutkimusrahoitus = SISAM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where SISAM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''STM''
	,tutkimusrahoitus = SOSM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where SOSM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''UM''
	,tutkimusrahoitus = UM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where UM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''VN''
	,tutkimusrahoitus = VN
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where VN <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''VM''
	,tutkimusrahoitus = VM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where VM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YM''
	,tutkimusrahoitus = YMP
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where YMP <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''JULK_MUU''
	,tutkimusrahoitus = MUUJU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MUUJU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''RAHASTO_K''
	,tutkimusrahoitus = RAHAS
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where RAHAS <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YRITYS_K''
	,tutkimusrahoitus = KOTIM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where KOTIM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YRITYS_U''
	,tutkimusrahoitus = ULKOY
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where ULKOY <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU''
	,tutkimusrahoitus = UEU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where UEU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_PUITE''
	,tutkimusrahoitus = EUPUITE
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where EUPUITE <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_ALUE''
	,tutkimusrahoitus = EAKR
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where EAKR <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_SOS''
	,tutkimusrahoitus = ESR
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where ESR <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_MUU''
	,tutkimusrahoitus = MUUEU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MUUEU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''MUU_U''
	,tutkimusrahoitus = MULKO
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MULKO <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''KUNNAT''
	,tutkimusrahoitus = KUNNAT
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where KUNNAT <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''JARJESTO_U''
	,tutkimusrahoitus = MKVJ
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where MKVJ <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''ORAHAS''
	,tutkimusrahoitus = ORAHAS
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where ORAHAS <> 0.0
 ) kaikki



' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain]'))
EXEC dbo.sp_executesql @statement = N'



CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL

--order by sektoritutkimuslaitos_avain, tilastovuosi


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain]'))
EXEC dbo.sp_executesql @statement = N'





CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain


--Tutkijat
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty1 - ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE pty1 - ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty2 - ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE pty2 - ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty3 - ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE pty3 - ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty4 - ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE pty4 - ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty5 - ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE pty5 - ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty6 - ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE pty6 - ptn6 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE ptn6 <> 0

--Muu henkilökunta
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy1 - phn1 - pty1 + ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phy1 - phn1 - pty1 + ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn1 - ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phn1 - ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy2 - phn2 - pty2 + ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phy2 - phn2 - pty2 + ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn2 - ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phn2 - ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy3 - phn3 - pty3 + ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phy3 - phn3 - pty3 + ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn3 - ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phn3 - ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy4 - phn4 - pty4 + ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phy4 - phn4 - pty4 + ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn4 - ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phn4 - ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy5 - phn5 - pty5 + ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phy5 - phn5 - pty5 + ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn5 - ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phn5 - ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy6 - phn6 - pty6 + ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phy6 - phn6 - pty6 + ptn6 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn6 - ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE phn6 - ptn6 <> 0


--order by sektoritutkimuslaitos_avain, tilastovuosi






' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain]'))
EXEC dbo.sp_executesql @statement = N'




CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

--Lukujen summa löytyy aineistosta myös kentistä
-- yhte
-- yhte2
-- henlkmy


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = [TOLKM] - [NTOLKM]
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = [NTOLKM]
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = LISLKM - NLISLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NLISLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = DILKM - NDIPLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NDIPLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = INSLKM - NOPINS
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NOPINS
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = MKOULKM - NMKOULKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NMKOULKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = OPISTLKM - NOPISTLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NOPISTLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 

--order by sektoritutkimuslaitos_avain, tilastovuosi



' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot] as

-- CSC JN 16.4.2015
-- CSC JN 27.4.2015 Lisätään mukaan arviot seuraavasta vuodesta

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot

-- YHME = PAME + OSTPAL + KMENO + HMENO

SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,menokohde_avain
	  ,tutkimusmenot
	  ,tutkimusmenot_arvio_seuraavatilastovuosi
      ,[tietolahde]
      ,[rivinumero]
FROM ( --kaikki
  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''PALKAT''
	,tutkimusmenot = PAME
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where PAME <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''OSTPAL''
	,tutkimusmenot = OSTPAL
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where OSTPAL <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''MUUTKMENOT''
	,tutkimusmenot = KMENO
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where KMENO <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''MUUTMENOT''
	,tutkimusmenot = HMENO
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where HMENO <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''-1''
	,tutkimusmenot = NULL
	,tutkimusmenot_arvio_seuraavatilastovuosi = tk_arvioe
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
Where HMENO <> 0.0

) kaikki


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain]'))
EXEC dbo.sp_executesql @statement = N'







CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain] as

-- CSC JN 16.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,tutkimusmenot_alueittain = TKMENO1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL
  AND TKMENO1 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,tutkimusmenot_alueittain = TKMENO2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL
  AND TKMENO2 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,tutkimusmenot_alueittain = TKMENO3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL
  AND TKMENO3 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,tutkimusmenot_alueittain = TKMENO4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL
  AND TKMENO4 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,tutkimusmenot_alueittain = TKMENO5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL
  AND TKMENO5 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,tutkimusmenot_alueittain = TKMENO6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL
  AND TKMENO6 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,tutkimusmenot_alueittain = TKMENO7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL
  AND TKMENO7 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,tutkimusmenot_alueittain = TKMENO8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL
  AND TKMENO8 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,tutkimusmenot_alueittain = TKMENO9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL
  AND TKMENO9 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,tutkimusmenot_alueittain = TKMENO10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL
  AND TKMENO10 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,tutkimusmenot_alueittain = TKMENO11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL
  AND TKMENO11 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,tutkimusmenot_alueittain = TKMENO12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL
  AND TKMENO12 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,tutkimusmenot_alueittain = TKMENO13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL
  AND TKMENO13 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,tutkimusmenot_alueittain = TKMENO14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL
  AND TKMENO14 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,tutkimusmenot_alueittain = TKMENO15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL
  AND TKMENO15 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,tutkimusmenot_alueittain = TKMENO16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL
  AND TKMENO16 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,tutkimusmenot_alueittain = TKMENO17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL
  AND TKMENO17 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,tutkimusmenot_alueittain = TKMENO18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL
  AND TKMENO18 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,tutkimusmenot_alueittain = TKMENO19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL
  AND TKMENO19 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,tutkimusmenot_alueittain = TKMENO20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL
  AND TKMENO20 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,tutkimusmenot_alueittain = TKMENO21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL
  AND TKMENO21 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,tutkimusmenot_alueittain = TKMENO22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL
  AND TKMENO22 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,tutkimusmenot_alueittain = TKMENO23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL
  AND TKMENO23 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,tutkimusmenot_alueittain = TKMENO24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL
  AND TKMENO24 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,tutkimusmenot_alueittain = TKMENO25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL
  AND TKMENO25 <> 0.0
  
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,tutkimusmenot_alueittain = TKMENOY - TKMENO1 - TKMENO2 - TKMENO3 - TKMENO4 - TKMENO5 - TKMENO6 - TKMENO7 - TKMENO8 - TKMENO9 - TKMENO10
												- TKMENO11 - TKMENO12 - TKMENO13 - TKMENO14 - TKMENO15 - TKMENO16 - TKMENO17 - TKMENO18 - TKMENO19 - TKMENO20
												- TKMENO21 - TKMENO22 - TKMENO23 - TKMENO24 - TKMENO25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE (TKMENOY - TKMENO1 - TKMENO2 - TKMENO3 - TKMENO4 - TKMENO5 - TKMENO6 - TKMENO7 - TKMENO8 - TKMENO9 - TKMENO10
			 - TKMENO11 - TKMENO12 - TKMENO13 - TKMENO14 - TKMENO15 - TKMENO16 - TKMENO17 - TKMENO18 - TKMENO19 - TKMENO20
			 - TKMENO21 - TKMENO22 - TKMENO23 - TKMENO24 - TKMENO25) <> 0.0


' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain] as

-- CSC JN 16.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA1
	  ,tutkimusmenot_tieteenaloittain = YHME*TA1P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA1 IS NOT NULL
  AND TA1P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA2
	  ,tutkimusmenot_tieteenaloittain = YHME*TA2P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA2 IS NOT NULL
  AND TA2P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA3
	  ,tutkimusmenot_tieteenaloittain = YHME*TA3P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA3 IS NOT NULL
  AND TA3P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA4
	  ,tutkimusmenot_tieteenaloittain = YHME*TA4P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA4 IS NOT NULL
  AND TA4P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA5
	  ,tutkimusmenot_tieteenaloittain = YHME*TA5P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA5 IS NOT NULL
  AND TA5P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA6
	  ,tutkimusmenot_tieteenaloittain = YHME*TA6P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA6 IS NOT NULL
  AND TA6P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA7
	  ,tutkimusmenot_tieteenaloittain = YHME*TA7P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA7 IS NOT NULL
  AND TA7P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA8
	  ,tutkimusmenot_tieteenaloittain = YHME*TA8P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA8 IS NOT NULL
  AND TA8P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA9
	  ,tutkimusmenot_tieteenaloittain = YHME*TA9P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA9 IS NOT NULL
  AND TA9P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA10
	  ,tutkimusmenot_tieteenaloittain = YHME*TA10P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA10 IS NOT NULL
  AND TA10P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA11
	  ,tutkimusmenot_tieteenaloittain = YHME*TA11P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA11 IS NOT NULL
  AND TA11P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA12
	  ,tutkimusmenot_tieteenaloittain = YHME*TA12P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA12 IS NOT NULL
  AND TA12P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA13
	  ,tutkimusmenot_tieteenaloittain = YHME*TA13P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA13 IS NOT NULL
  AND TA13P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA14
	  ,tutkimusmenot_tieteenaloittain = YHME*TA14P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA14 IS NOT NULL
  AND TA14P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA15
	  ,tutkimusmenot_tieteenaloittain = YHME*TA15P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA15 IS NOT NULL
  AND TA15P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA16
	  ,tutkimusmenot_tieteenaloittain = YHME*TA16P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA16 IS NOT NULL
  AND TA16P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA17
	  ,tutkimusmenot_tieteenaloittain = YHME*TA17P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA17 IS NOT NULL
  AND TA17P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,tieteenala_avain = TA18
	  ,tutkimusmenot_tieteenaloittain = YHME*TA18P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TA18 IS NOT NULL
  AND TA18P <> 0.0

' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain]'))
EXEC dbo.sp_executesql @statement = N'




CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,lkm_tutkimustyovuodet_alueittain = TYOV1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL
  AND TYOV1 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,lkm_tutkimustyovuodet_alueittain = TYOV2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL
  AND TYOV2 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,lkm_tutkimustyovuodet_alueittain = TYOV3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL
  AND TYOV3 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,lkm_tutkimustyovuodet_alueittain = TYOV4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL
  AND TYOV4 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,lkm_tutkimustyovuodet_alueittain = TYOV5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL
  AND TYOV5 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,lkm_tutkimustyovuodet_alueittain = TYOV6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL
  AND TYOV6 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,lkm_tutkimustyovuodet_alueittain = TYOV7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL
  AND TYOV7 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,lkm_tutkimustyovuodet_alueittain = TYOV8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL
  AND TYOV8 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,lkm_tutkimustyovuodet_alueittain = TYOV9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL
  AND TYOV9 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,lkm_tutkimustyovuodet_alueittain = TYOV10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL
  AND TYOV10 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,lkm_tutkimustyovuodet_alueittain = TYOV11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL
  AND TYOV11 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,lkm_tutkimustyovuodet_alueittain = TYOV12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL
  AND TYOV12 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,lkm_tutkimustyovuodet_alueittain = TYOV13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL
  AND TYOV13 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,lkm_tutkimustyovuodet_alueittain = TYOV14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL
  AND TYOV14 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,lkm_tutkimustyovuodet_alueittain = TYOV15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL
  AND TYOV15 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,lkm_tutkimustyovuodet_alueittain = TYOV16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL
  AND TYOV16 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,lkm_tutkimustyovuodet_alueittain = TYOV17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL
  AND TYOV17 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,lkm_tutkimustyovuodet_alueittain = TYOV18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL
  AND TYOV18 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,lkm_tutkimustyovuodet_alueittain = TYOV19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL
  AND TYOV19 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,lkm_tutkimustyovuodet_alueittain = TYOV20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL
  AND TYOV20 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,lkm_tutkimustyovuodet_alueittain = TYOV21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL
  AND TYOV21 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,lkm_tutkimustyovuodet_alueittain = TYOV22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL
  AND TYOV22 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,lkm_tutkimustyovuodet_alueittain = TYOV23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL
  AND TYOV23 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,lkm_tutkimustyovuodet_alueittain = TYOV24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL
  AND TYOV24 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,lkm_tutkimustyovuodet_alueittain = TYOV25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL
  AND TYOV25 <> 0.0
  
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
	  ,alueluokitus_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,lkm_tutkimustyovuodet_alueittain = TYOVY - TYOV1 - TYOV2 - TYOV3 - TYOV4 - TYOV5 - TYOV6 - TYOV7 - TYOV8 - TYOV9 - TYOV10
												- TYOV11 - TYOV12 - TYOV13 - TYOV14 - TYOV15 - TYOV16 - TYOV17 - TYOV18 - TYOV19 - TYOV20
												- TYOV21 - TYOV22 - TYOV23 - TYOV24 - TYOV25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE (TYOVY - TYOV1 - TYOV2 - TYOV3 - TYOV4 - TYOV5 - TYOV6 - TYOV7 - TYOV8 - TYOV9 - TYOV10
			 - TYOV11 - TYOV12 - TYOV13 - TYOV14 - TYOV15 - TYOV16 - TYOV17 - TYOV18 - TYOV19 - TYOV20
			 - TYOV21 - TYOV22 - TYOV23 - TYOV24 - TYOV25) <> 0.0

--order by sektoritutkimuslaitos_avain, tilastovuosi



' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain]'))
EXEC dbo.sp_executesql @statement = N'




CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tyorooleittain



SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tehtava_avain = ''TUTKIJA'' --Tutkija
	  ,lkm_tutkimustyovuodet_tyorooleittain = TUTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TUTTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,lkm_tutkimustyovuodet_tyorooleittain = MTKTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE MTKTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tehtava_avain = ''KORJAUS'' --Muu tutkimushenkilökunta
	  ,lkm_tutkimustyovuodet_tyorooleittain = YHTTTV - TUTTTV - MTKTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE YHTTTV - TUTTTV - MTKTTV <> 0.0


--order by sektoritutkimuslaitos_avain, tilastovuosi

' 
GO
/****** Object:  View [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain]'))
EXEC dbo.sp_executesql @statement = N'






CREATE view [dbo].[v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain
-- Select * into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain
-- Insert into VipunenTK_DW.dbo.f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

--Lukujen summa löytyy aineistosta myös kentistä
-- YHTTTV
-- TYOVY


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = TOTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE TOTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = LISTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE LISTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = DIPTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE DIPTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = OPINSTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE OPINSTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = MKOUTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE MKOUTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = OPISTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE OPISTTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,sektoritutkimuslaitos_avain = TK_koodi
      ,tutkintotaso_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = YHTTTV - TOTTV - LISTTV - DIPTTV - OPINSTTV - MKOUTTV - OPISTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_Sektoritutkimuslaitosten_tutkimus_ja_kehitys] 
WHERE YHTTTV - TOTTV - LISTTV - DIPTTV - OPINSTTV - MKOUTTV - OPISTTTV <> 0.0

--order by sektoritutkimuslaitos_avain, tilastovuosi


' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus]'))
EXEC dbo.sp_executesql @statement = N'









CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_rahoitus


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,rahoituslahde_avain
	  ,tutkimusrahoitus
      ,[tietolahde]
      ,[rivinumero]

  FROM ( --kaikki
  
--Select 
--	 tilv
--	,[tilv_date]
--	,TK_koodi
--	,rahoituslahde_avain = ''OKM_PERUS''
--	,tutkimusrahoitus = [OKM_perusrahoitus]
--	,[tietolahde]
--    ,[rivinumero]
--From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
--Where [OKM_perusrahoitus] <> 0.0

--Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''TEKES''
	,tutkimusrahoitus = TEKES
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where TEKES <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''TEM_MUU''
	,tutkimusrahoitus = MTEM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MTEM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''AKATEMIA''
	,tutkimusrahoitus = AKATEMIA
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where AKATEMIA <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''GRAD''
	,tutkimusrahoitus = GRAD
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where GRAD <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''OKM_MUU''
	,tutkimusrahoitus = MOPEM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MOPEM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''LVM''
	,tutkimusrahoitus = LIIKM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where LIIKM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''MMM''
	,tutkimusrahoitus = MAAM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MAAM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''OM''
	,tutkimusrahoitus = OM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where OM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''PM''
	,tutkimusrahoitus = PM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where PM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''SM''
	,tutkimusrahoitus = SISAM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where SISAM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''STM''
	,tutkimusrahoitus = SOSM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where SOSM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''UM''
	,tutkimusrahoitus = UM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where UM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''VN''
	,tutkimusrahoitus = VN
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where VN <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''VM''
	,tutkimusrahoitus = VM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where VM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YM''
	,tutkimusrahoitus = YMP
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where YMP <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''JULK_MUU''
	,tutkimusrahoitus = MUUJU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MUUJU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''RAHASTO_K''
	,tutkimusrahoitus = RAHAS
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where RAHAS <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YRITYS_K''
	,tutkimusrahoitus = KOTIM
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where KOTIM <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''YRITYS_U''
	,tutkimusrahoitus = ULKOY
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where ULKOY <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU''
	,tutkimusrahoitus = UEU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where UEU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_PUITE''
	,tutkimusrahoitus = EUPUITE
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where EUPUITE <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_ALUE''
	,tutkimusrahoitus = EAKR
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where EAKR <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_SOS''
	,tutkimusrahoitus = ESR
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where ESR <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''EU_MUU''
	,tutkimusrahoitus = MUUEU
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MUUEU <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''MUU_U''
	,tutkimusrahoitus = MULKO
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MULKO <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''KUNNAT''
	,tutkimusrahoitus = KUNNAT
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where KUNNAT <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''JARJESTO_U''
	,tutkimusrahoitus = MKVJ
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where MKVJ <> 0.0

Union all  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,rahoituslahde_avain = ''ORAHAS''
	,tutkimusrahoitus = ORAHAS
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where ORAHAS <> 0.0
 ) kaikki




' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain]'))
EXEC dbo.sp_executesql @statement = N'




CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,lkm_tutkimushenkilokunta_alueittain = HENLKM25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL

--order by yosairaala_avain, tilastovuosi



' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain]'))
EXEC dbo.sp_executesql @statement = N'






CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_paatieteenaloittain_tehtavittain


--Tutkijat
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty1 - ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE pty1 - ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty2 - ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE pty2 - ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty3 - ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE pty3 - ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty4 - ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE pty4 - ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty5 - ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE pty5 - ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = pty6 - ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE pty6 - ptn6 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''TUTKIJA'' --Tutkijat
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE ptn6 <> 0

--Muu henkilökunta
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy1 - phn1 - pty1 + ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phy1 - phn1 - pty1 + ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_1''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn1 - ptn1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phn1 - ptn1 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy2 - phn2 - pty2 + ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phy2 - phn2 - pty2 + ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_2''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn2 - ptn2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phn2 - ptn2 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy3 - phn3 - pty3 + ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phy3 - phn3 - pty3 + ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_3''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn3 - ptn3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phn3 - ptn3 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy4 - phn4 - pty4 + ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phy4 - phn4 - pty4 + ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_4''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn4 - ptn4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phn4 - ptn4 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy5 - phn5 - pty5 + ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phy5 - phn5 - pty5 + ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_5''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn5 - ptn5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phn5 - ptn5 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''1'' --mies
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phy6 - phn6 - pty6 + ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phy6 - phn6 - pty6 + ptn6 <> 0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,sukupuoli_avain = ''2'' --nainen
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,tieteenala_avain = ''TA10_6''
	  ,lkm_tutkimushenkilokunta_paatieteenaloittain_tehtavittain = phn6 - ptn6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE phn6 - ptn6 <> 0


--order by yosairaala_avain, tilastovuosi







' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain]'))
EXEC dbo.sp_executesql @statement = N'





CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimushenkilokunta_tutkintotasoittain

--Lukujen summa löytyy aineistosta myös kentistä
-- yhte
-- yhte2
-- henlkmy


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = [TOLKM] - [NTOLKM]
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = [NTOLKM]
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = LISLKM - NLISLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NLISLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = DILKM - NDIPLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NDIPLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = INSLKM - NOPINS
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NOPINS
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = MKOULKM - NMKOULKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NMKOULKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,sukupuoli_avain = ''1'' --mies
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = OPISTLKM - NOPISTLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,sukupuoli_avain = ''2'' --nainen
	  ,lkm_tutkimushenkilokunta_tutkintotasoittain = NOPISTLKM
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 

--order by yosairaala_avain, tilastovuosi




' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot]'))
EXEC dbo.sp_executesql @statement = N'









CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot] as

-- CSC JN 16.4.2015
-- CSC JN 27.4.2015 Lisätään mukaan arviot seuraavasta vuodesta

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot

-- YHME = PAME + OSTPAL + KMENO + HMENO

SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,menokohde_avain
	  ,tutkimusmenot
	  ,tutkimusmenot_arvio_seuraavatilastovuosi
      ,[tietolahde]
      ,[rivinumero]
FROM ( --kaikki
  
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''PALKAT''
	,tutkimusmenot = PAME
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where PAME <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''OSTPAL''
	,tutkimusmenot = OSTPAL
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where OSTPAL <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''MUUTKMENOT''
	,tutkimusmenot = KMENO
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where KMENO <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''MUUTMENOT''
	,tutkimusmenot = HMENO
	,tutkimusmenot_arvio_seuraavatilastovuosi = NULL
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where HMENO <> 0.0

Union All
Select 
	 tilv
	,[tilv_date]
	,TK_koodi
	,menokohde_avain = ''-1''
	,tutkimusmenot = NULL
	,tutkimusmenot_arvio_seuraavatilastovuosi = tk_arvioe
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
Where HMENO <> 0.0

) kaikki



' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain]'))
EXEC dbo.sp_executesql @statement = N'








CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain] as

-- CSC JN 16.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,tutkimusmenot_alueittain = TKMENO1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL
  AND TKMENO1 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,tutkimusmenot_alueittain = TKMENO2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL
  AND TKMENO2 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,tutkimusmenot_alueittain = TKMENO3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL
  AND TKMENO3 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,tutkimusmenot_alueittain = TKMENO4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL
  AND TKMENO4 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,tutkimusmenot_alueittain = TKMENO5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL
  AND TKMENO5 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,tutkimusmenot_alueittain = TKMENO6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL
  AND TKMENO6 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,tutkimusmenot_alueittain = TKMENO7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL
  AND TKMENO7 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,tutkimusmenot_alueittain = TKMENO8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL
  AND TKMENO8 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,tutkimusmenot_alueittain = TKMENO9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL
  AND TKMENO9 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,tutkimusmenot_alueittain = TKMENO10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL
  AND TKMENO10 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,tutkimusmenot_alueittain = TKMENO11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL
  AND TKMENO11 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,tutkimusmenot_alueittain = TKMENO12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL
  AND TKMENO12 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,tutkimusmenot_alueittain = TKMENO13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL
  AND TKMENO13 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,tutkimusmenot_alueittain = TKMENO14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL
  AND TKMENO14 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,tutkimusmenot_alueittain = TKMENO15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL
  AND TKMENO15 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,tutkimusmenot_alueittain = TKMENO16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL
  AND TKMENO16 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,tutkimusmenot_alueittain = TKMENO17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL
  AND TKMENO17 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,tutkimusmenot_alueittain = TKMENO18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL
  AND TKMENO18 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,tutkimusmenot_alueittain = TKMENO19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL
  AND TKMENO19 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,tutkimusmenot_alueittain = TKMENO20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL
  AND TKMENO20 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,tutkimusmenot_alueittain = TKMENO21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL
  AND TKMENO21 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,tutkimusmenot_alueittain = TKMENO22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL
  AND TKMENO22 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,tutkimusmenot_alueittain = TKMENO23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL
  AND TKMENO23 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,tutkimusmenot_alueittain = TKMENO24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL
  AND TKMENO24 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,tutkimusmenot_alueittain = TKMENO25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL
  AND TKMENO25 <> 0.0
  
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,tutkimusmenot_alueittain = TKMENOY - TKMENO1 - TKMENO2 - TKMENO3 - TKMENO4 - TKMENO5 - TKMENO6 - TKMENO7 - TKMENO8 - TKMENO9 - TKMENO10
												- TKMENO11 - TKMENO12 - TKMENO13 - TKMENO14 - TKMENO15 - TKMENO16 - TKMENO17 - TKMENO18 - TKMENO19 - TKMENO20
												- TKMENO21 - TKMENO22 - TKMENO23 - TKMENO24 - TKMENO25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE (TKMENOY - TKMENO1 - TKMENO2 - TKMENO3 - TKMENO4 - TKMENO5 - TKMENO6 - TKMENO7 - TKMENO8 - TKMENO9 - TKMENO10
			 - TKMENO11 - TKMENO12 - TKMENO13 - TKMENO14 - TKMENO15 - TKMENO16 - TKMENO17 - TKMENO18 - TKMENO19 - TKMENO20
			 - TKMENO21 - TKMENO22 - TKMENO23 - TKMENO24 - TKMENO25) <> 0.0



' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain]'))
EXEC dbo.sp_executesql @statement = N'









CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain] as

-- CSC JN 16.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimusmenot_tieteenaloittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA1
	  ,tutkimusmenot_tieteenaloittain = YHME*TA1P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA1 IS NOT NULL
  AND TA1P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA2
	  ,tutkimusmenot_tieteenaloittain = YHME*TA2P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA2 IS NOT NULL
  AND TA2P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA3
	  ,tutkimusmenot_tieteenaloittain = YHME*TA3P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA3 IS NOT NULL
  AND TA3P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA4
	  ,tutkimusmenot_tieteenaloittain = YHME*TA4P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA4 IS NOT NULL
  AND TA4P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA5
	  ,tutkimusmenot_tieteenaloittain = YHME*TA5P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA5 IS NOT NULL
  AND TA5P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA6
	  ,tutkimusmenot_tieteenaloittain = YHME*TA6P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA6 IS NOT NULL
  AND TA6P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA7
	  ,tutkimusmenot_tieteenaloittain = YHME*TA7P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA7 IS NOT NULL
  AND TA7P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA8
	  ,tutkimusmenot_tieteenaloittain = YHME*TA8P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA8 IS NOT NULL
  AND TA8P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA9
	  ,tutkimusmenot_tieteenaloittain = YHME*TA9P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA9 IS NOT NULL
  AND TA9P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA10
	  ,tutkimusmenot_tieteenaloittain = YHME*TA10P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA10 IS NOT NULL
  AND TA10P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA11
	  ,tutkimusmenot_tieteenaloittain = YHME*TA11P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA11 IS NOT NULL
  AND TA11P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA12
	  ,tutkimusmenot_tieteenaloittain = YHME*TA12P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA12 IS NOT NULL
  AND TA12P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA13
	  ,tutkimusmenot_tieteenaloittain = YHME*TA13P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA13 IS NOT NULL
  AND TA13P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA14
	  ,tutkimusmenot_tieteenaloittain = YHME*TA14P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA14 IS NOT NULL
  AND TA14P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA15
	  ,tutkimusmenot_tieteenaloittain = YHME*TA15P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA15 IS NOT NULL
  AND TA15P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA16
	  ,tutkimusmenot_tieteenaloittain = YHME*TA16P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA16 IS NOT NULL
  AND TA16P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA17
	  ,tutkimusmenot_tieteenaloittain = YHME*TA17P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA17 IS NOT NULL
  AND TA17P <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,tieteenala_avain = TA18
	  ,tutkimusmenot_tieteenaloittain = YHME*TA18P/100.0
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TA18 IS NOT NULL
  AND TA18P <> 0.0


' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain]'))
EXEC dbo.sp_executesql @statement = N'





CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_alueittain


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA1
	  ,lkm_tutkimustyovuodet_alueittain = TYOV1
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA1 IS NOT NULL
  AND TYOV1 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA2
	  ,lkm_tutkimustyovuodet_alueittain = TYOV2
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA2 IS NOT NULL
  AND TYOV2 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA3
	  ,lkm_tutkimustyovuodet_alueittain = TYOV3
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA3 IS NOT NULL
  AND TYOV3 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA4
	  ,lkm_tutkimustyovuodet_alueittain = TYOV4
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA4 IS NOT NULL
  AND TYOV4 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA5
	  ,lkm_tutkimustyovuodet_alueittain = TYOV5
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA5 IS NOT NULL
  AND TYOV5 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA6
	  ,lkm_tutkimustyovuodet_alueittain = TYOV6
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA6 IS NOT NULL
  AND TYOV6 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA7
	  ,lkm_tutkimustyovuodet_alueittain = TYOV7
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA7 IS NOT NULL
  AND TYOV7 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA8
	  ,lkm_tutkimustyovuodet_alueittain = TYOV8
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA8 IS NOT NULL
  AND TYOV8 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA9
	  ,lkm_tutkimustyovuodet_alueittain = TYOV9
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA9 IS NOT NULL
  AND TYOV9 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA10
	  ,lkm_tutkimustyovuodet_alueittain = TYOV10
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA10 IS NOT NULL
  AND TYOV10 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA11
	  ,lkm_tutkimustyovuodet_alueittain = TYOV11
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA11 IS NOT NULL
  AND TYOV11 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA12
	  ,lkm_tutkimustyovuodet_alueittain = TYOV12
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA12 IS NOT NULL
  AND TYOV12 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA13
	  ,lkm_tutkimustyovuodet_alueittain = TYOV13
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA13 IS NOT NULL
  AND TYOV13 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA14
	  ,lkm_tutkimustyovuodet_alueittain = TYOV14
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA14 IS NOT NULL
  AND TYOV14 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA15
	  ,lkm_tutkimustyovuodet_alueittain = TYOV15
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA15 IS NOT NULL
  AND TYOV15 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA16
	  ,lkm_tutkimustyovuodet_alueittain = TYOV16
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA16 IS NOT NULL
  AND TYOV16 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA17
	  ,lkm_tutkimustyovuodet_alueittain = TYOV17
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA17 IS NOT NULL
  AND TYOV17 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA18
	  ,lkm_tutkimustyovuodet_alueittain = TYOV18
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA18 IS NOT NULL
  AND TYOV18 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA19
	  ,lkm_tutkimustyovuodet_alueittain = TYOV19
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA19 IS NOT NULL
  AND TYOV19 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA20
	  ,lkm_tutkimustyovuodet_alueittain = TYOV20
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA20 IS NOT NULL
  AND TYOV20 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA21
	  ,lkm_tutkimustyovuodet_alueittain = TYOV21
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA21 IS NOT NULL
  AND TYOV21 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA22
	  ,lkm_tutkimustyovuodet_alueittain = TYOV22
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA22 IS NOT NULL
  AND TYOV22 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA23
	  ,lkm_tutkimustyovuodet_alueittain = TYOV23
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA23 IS NOT NULL
  AND TYOV23 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA24
	  ,lkm_tutkimustyovuodet_alueittain = TYOV24
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA24 IS NOT NULL
  AND TYOV24 <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = KUNTA25
	  ,lkm_tutkimustyovuodet_alueittain = TYOV25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE KUNTA25 IS NOT NULL
  AND TYOV25 <> 0.0
  
UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
	  ,alueluokitus_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,lkm_tutkimustyovuodet_alueittain = TYOVY - TYOV1 - TYOV2 - TYOV3 - TYOV4 - TYOV5 - TYOV6 - TYOV7 - TYOV8 - TYOV9 - TYOV10
												- TYOV11 - TYOV12 - TYOV13 - TYOV14 - TYOV15 - TYOV16 - TYOV17 - TYOV18 - TYOV19 - TYOV20
												- TYOV21 - TYOV22 - TYOV23 - TYOV24 - TYOV25
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE (TYOVY - TYOV1 - TYOV2 - TYOV3 - TYOV4 - TYOV5 - TYOV6 - TYOV7 - TYOV8 - TYOV9 - TYOV10
			 - TYOV11 - TYOV12 - TYOV13 - TYOV14 - TYOV15 - TYOV16 - TYOV17 - TYOV18 - TYOV19 - TYOV20
			 - TYOV21 - TYOV22 - TYOV23 - TYOV24 - TYOV25) <> 0.0

--order by yosairaala_avain, tilastovuosi




' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tehtavittain



SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tehtava_avain = ''TUTKIJA'' --Tutkija
	  ,lkm_tutkimustyovuodet_tehtavittain = TUTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TUTTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tehtava_avain = ''MUU'' --Muu tutkimushenkilökunta
	  ,lkm_tutkimustyovuodet_tehtavittain = MTKTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE MTKTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tehtava_avain = ''KORJAUS'' --Muu tutkimushenkilökunta
	  ,lkm_tutkimustyovuodet_tehtavittain = YHTTTV - TUTTTV - MTKTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE YHTTTV - TUTTTV - MTKTTV <> 0.0
' 
GO
/****** Object:  View [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain]'))
EXEC dbo.sp_executesql @statement = N'







CREATE view [dbo].[v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain] as

-- CSC JN 13.4.2015

-- Taulun luonti
-- Drop table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain
-- Select * into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

-- Taulun populointi
-- Truncate table VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain
-- Insert into VipunenTK_DW.dbo.f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

-- Kysely
-- Select * from VipunenTK_DW.dbo.v_f_5_4_yosairaaloiden_tutkimus_ja_kehitys_tutkimustyovuodet_tutkintotasoittain

--Lukujen summa löytyy aineistosta myös kentistä
-- YHTTTV
-- TYOVY


SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''82'' --tohtori
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = TOTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE TOTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''81'' --lisensiaatti
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = LISTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE LISTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''70'' --yliopistotutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = DIPTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE DIPTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''60'' --amk-tutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = OPINSTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE OPINSTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''30'' --Muu koulutus
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = MKOUTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE MKOUTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''50'' --Muu opistoasteen tutkinto
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = OPISTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE OPISTTTV <> 0.0

UNION ALL
SELECT 
	   tilastovuosi = [tilv]
      ,[tilv_date]
      ,yosairaala_avain = TK_koodi
      ,tutkintotaso_avain = ''-1'' --Täsmäytys, jotta aineiston redundantit summat ovat samat
	  ,lkm_tutkimustyovuodet_tutkintotasoittain = YHTTTV - TOTTV - LISTTV - DIPTTV - OPINSTTV - MKOUTTV - OPISTTTV
      ,[tietolahde]
      ,[rivinumero]
FROM [VipunenTK_DW].[dbo].[sa_5_4_yosairaaloiden_tutkimus_ja_kehitys] 
WHERE YHTTTV - TOTTV - LISTTV - DIPTTV - OPINSTTV - MKOUTTV - OPISTTTV <> 0.0

--order by yosairaala_avain, tilastovuosi



' 
GO
/****** Object:  View [dbo].[v_f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot] AS

/*
Drop table [VipunenTK_DW].[dbo].[f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]
Select * into [VipunenTK_DW].[dbo].[f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot] FROM [VipunenTK_SA].[dbo].[v_sa_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]
Truncate table [VipunenTK_DW].[dbo].[f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]
Insert into [VipunenTK_DW].[dbo].[f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]
  Select * FROM [VipunenTK_SA].[dbo].[v_sa_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
      ,oppilaitoksen_kieli = [p_okieli]
      ,oppilaitostyyppi = [p_oltyp]
      ,tyosuhde_vakinainen = [p_tyos1]
      ,tyosuhde_maara_aikainen = [p_tyos2]
      ,tyosuhde_viransijainen = [p_tyos3]
	  ,tyosuhde_virkavapaa = [p_tyos4]
      ,tyosuhde_oa_elake = [p_tyos5]
      ,tehtavatyyppi_perusopetuksessa = [p_virka]
      ,paaasiallinen_koulutusmuoto = [p_aste]
      ,kelp_esiopetus = [p_k1]
      ,kelp_luokanopettaja = [p_k2]
      ,kelp_aineenopettaja = [p_k3]
      ,kelp_aineenopettaja_lukio = [p_k4]
      ,kelp_erityisluokan_opettaja = [p_k5]
      ,kelp_erityisopettaja_osa_aikainen = [p_k6]
      ,kelp_oppilaanohjaaja = [p_k7]
      ,kelp_opinto_ohjaaja = [p_k8]
      ,kelp_muu = [p_k9]
      ,kelp_ei = [p_k10]
      ,kelp_kehitysvammaiset = [p_k11]
      ,oman_luokan_aste = [p_olaste]
      ,oman_luokan_oppilasmäärä = [p_oluom]
      ,opettajan_eniten_opettama_aine = [p_aine]
      ,sukupuoli = [p_sp]
      ,maakunta_oppilaitos = [p_maakunta]
      ,kuntaryhmitys_oppilaitos = [p_okunryh]
      ,ika = p_ika
	  ,kelp = p_kelpu
      
  FROM VipunenTK_DW.dbo.f_7_1_Perusopetuksen_opettajat_kelpoisuus_opetusryhmakoot

 






' 
GO
/****** Object:  View [dbo].[v_f_7_10_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_10_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]'))
EXEC dbo.sp_executesql @statement = N'










CREATE VIEW [dbo].[v_f_7_10_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus] AS

/*
Drop table [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus]
Select * into [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus] FROM [VipunenTK_DW].[dbo].[v_f_7_10_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]
Truncate table [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus]
Insert into [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus]
Select * FROM [VipunenTK_DW].[dbo].[v_f_7_10_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
	  ,oppilaitoksen_kieli = [a_okieli]
      ,pääasiallinen_koulutusaste = [a_aste] 
      ,erityisopetus = [a_g16] 
      ,opinto_ohjaus = [a_g17] 
      ,valma = [a_g18] 
      ,telma = [a_g19] 
      ,mamu = [a_g20] 
      ,ammpk_valmistava = [a_g21] 
      ,kotitalousopetus = [a_g22]
      ,kelp_amm = [a_h6] 
      ,kelp_yht = [a_h7] 
      ,kelp_opo = [a_h8] 
      ,kelp_erope = [a_h9]
      ,kelp_muu = [a_h10] 
      ,kelp_ei_muod = [a_h11]
      ,eikelp_paa = [a_h1]
      ,eikelp_pedag = [a_h2]
      ,eikelp_tyokok = [a_h3] 
      ,eikelp_tieto_puuttuu = [a_h4] 
	  ,kelp_kaikki = [a_h5]
	  ,opettajan_eniten_opettama_ala = [a_ala]
      ,opettajan_eniten_opettama_aine = [a_aine] 
      --,opettajan_koulutus = [a_koulk] 
      --,[a_oppil] 
      --,koul_jarj_koko_ei_oppis = [a_eioppilkm]
      --,koul_jarj_koko_oppis = [a_oppilkm] 
      --,koul_jarj_kieli = [a_ykieli] 
      --,koul_jarj_maakunta = [a_ymkunta] 
      ,oppilaitoksen_maakunta = [a_maakunta] 
  
  FROM VipunenTK_DW.dbo.f_7_10_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus

 










' 
GO
/****** Object:  View [dbo].[v_f_7_12_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_12_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_f_7_12_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus] AS

/*
Drop table [VipunenTK_DW].[dbo].[f_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj]
Select * into [VipunenTK_DW].[dbo].[f_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj] FROM [VipunenTK_SA].[dbo].[v_sa_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj]
Truncate table [VipunenTK_DW].[dbo].[f_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj]
Insert into [VipunenTK_DW].[dbo].[f_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj]
Select *  FROM [VipunenTK_SA].[dbo].[v_sa_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj]
*/

SELECT [tilastovuosi] = f.tilv
	  ,[oppilaitoksen_kieli] = d1.opetuskieli
      ,[oppilaitostyyppi] = d2.oppilaitostyyppi
      ,[tyosuhde_vakinainen] = d3.kylla_ei
      ,[tyosuhde_maara_aikainen] = d4.kylla_ei
      ,[tyosuhde_viransijainen] = d5.kylla_ei
      ,[tyosuhde_virkavapaa] = d6.kylla_ei
      ,[tyosuhde_osa_aika_elake] = d7.kylla_ei
      ,[tehtavatyyppi] = d8.tehtavatyyppi
      ,[kelp_kunnossa] = d9.kylla_ei
      ,[kelp_tutkinto_puuttuu] = d10.kylla_ei
      ,[kelp_pedag_puuttuu] = d11.kylla_ei
      ,[kelp_tark_tieto_puuttuu] = d12.kylla_ei
      ,[eniten_opettama_ala] = NULL
      ,[eniten_opettama_aine] = NULL
      ,[sukupuoli] = d14.sukupuoli
      ,[oppilaitoksen_maakunta] = d15.maakunta
      ,[oppilaitoksen_kuntaryhmä] = NULL
      ,[ika] = NULL
      ,[koul_jarj_kieli]  = NULL
      ,[koul_jarj_omistajatyyppi]  = NULL
      ,[koul_jarj_maakunta]  = NULL
      ,[koul_jarJ_kuntaryhma] = NULL

  FROM (

  SELECT [tilv]
      ,[v_okieli]
	  ,[v_oltyp]
      ,[v_tyos1]
      ,[v_tyos2]
      ,[v_tyos3]
      ,[v_tyos4]
      ,[v_tyos5]
      ,[v_virka]
      ,[v_h1]
      ,[v_h2]
      ,[v_h3]
      ,[v_h4]
	  ,[v_ala1]
      ,[v_aine1]
      ,[v_sp]
      ,[v_maakunta]
      ,[v_okunryh]
      ,[v_ika]
      ,[v_ykieli] = NULL
      ,[v_yomist] = NULL
      ,[v_ymkunta] = NULL
      ,[v_ykunryh] = NULL
  FROM [VipunenTK_DW].[dbo].[f_7_12_Vapaan_sivistystyön_opettajat_kelpoisuus_aine]

  UNION ALL

  SELECT [tilv]
      ,[v_okieli]
	  ,[v_oltyp] = NULL
      ,[v_tyos1] = NULL
      ,[v_tyos2] = NULL
      ,[v_tyos3] = NULL
      ,[v_tyos4] = NULL
      ,[v_tyos5] = NULL
      ,[v_virka] = NULL
      ,[v_h1]
      ,[v_h2]
      ,[v_h3]
      ,[v_h4]
	  ,[v_ala1] = NULL
      ,[v_aine1] = NULL
      ,[v_sp] = NULL
      ,[v_maakunta] = NULL
      ,[v_okunryh] = NULL
      ,[v_ika] = NULL
      ,[v_ykieli]
      ,[v_yomist]
      ,[v_ymkunta]
      ,[v_ykunryh]
  FROM [VipunenTK_DW].[dbo].[f_7_13_Vapaan_sivistystyön_opettajat_kelpoisuus_kouljarj]


) f


LEFT JOIN VipunenTK_DW.dbo.d_opetuskieli2 d1 on d1.opetuskieli_koodi=f.v_okieli
LEFT JOIN VipunenTK_DW.dbo.d_oppilaitostyyppi d2 on d2.oppilaitostyyppi_koodi=f.v_oltyp
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d3 on d3.kylla_ei_koodi=f.v_tyos1
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d4 on d4.kylla_ei_koodi=f.v_tyos2
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d5 on d5.kylla_ei_koodi=f.v_tyos3
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d6 on d6.kylla_ei_koodi=f.v_tyos4
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d7 on d7.kylla_ei_koodi=f.v_tyos5
LEFT JOIN VipunenTK_DW.dbo.d_opettajan_tehtavatyyppi_vapaassa_sivistystyossa d8 on d8.tehtavatyyppi_koodi=f.v_virka
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d9 on d9.kylla_ei_koodi=f.v_h1
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d10 on d10.kylla_ei_koodi=f.v_h2
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d11 on d11.kylla_ei_koodi=f.v_h3
LEFT JOIN VipunenTK_DW.dbo.d_kylla_ei d12 on d12.kylla_ei_koodi=f.v_h4
--LEFT JOIN VipunenTK_DW.dbo.d_opettajat_aine_amm
LEFT JOIN VipunenTK_DW.dbo.d_sukupuoli d14 on d14.sukupuoli_koodi=f.v_sp
LEFT JOIN VipunenTK_DW.dbo.d_alueluokitus d15 on d15.alueluokitus_avain=''MAAK''+f.v_maakunta












' 
GO
/****** Object:  View [dbo].[v_f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot] AS

/*
Drop table [VipunenTK_DW].[dbo].[f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Select * into [VipunenTK].[dbo].[f_Opettajat_perusopetus_koulutuksen_jarjestaja_opetusryhmakoot] FROM [VipunenTK_DW].[dbo].[v_f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Truncate table [VipunenTK_DW].[dbo].[f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Insert into [VipunenTK].[dbo].[f_Opettajat_perusopetus_koulutuksen_jarjestaja_opetusryhmakoot]
  Select * FROM [VipunenTK_DW].[dbo].[v_sa_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date] 
	  ,oppilaitoksen_kieli = [p_okieli]
      ,oman_luokan_aste = [p_olaste]
      ,oman_luokan_oppilasmäärä = [p_oluom]
      ,koulutuksen_jarjestajan_koko = [p_yopp19]
      ,koulutuksen_jarjestajan_kieli = [p_ykieli]
	  ,koulutuksen_jarjestajan_omistajatyyppi = [p_yomist] 
      ,koulutuksen_jarjestajan_maakunta = [p_ymkunta] 
      ,koulutuksen_jarjestajan_kuntaryhmitys = [p_ykunryh] 
      ,tietolahde = [tietolahde] 
      ,rivinumero = [rivinumero]
  FROM VipunenTK_DW.dbo.f_7_2_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot

 






' 
GO
/****** Object:  View [dbo].[v_f_7_3_Perusopetuksen_opettajat_osallistuminen_taydennyskoulutukseen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_3_Perusopetuksen_opettajat_osallistuminen_taydennyskoulutukseen]'))
EXEC dbo.sp_executesql @statement = N'







CREATE VIEW [dbo].[v_f_7_3_Perusopetuksen_opettajat_osallistuminen_taydennyskoulutukseen] AS

/*
Drop table [VipunenTK_DW].[dbo].[f_7_3_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Select * into [VipunenTK].[dbo].[f_Opettajat_perusopetus_osallistuminen_taydennyskoulutukseen] FROM [VipunenTK_DW].[dbo].[v_f_7_3_Perusopetuksen_opettajat_osallistuminen_taydennyskoulutukseen]
Truncate table [VipunenTK_DW].[dbo].[f_7_3_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Insert into [VipunenTK].[dbo].[f_Opettajat_perusopetus_koulutuksen_jarjestaja_opetusryhmakoot]
  Select * FROM [VipunenTK_DW].[dbo].[v_sa_7_3_Perusopetuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
	  ,oppilaitoksen_kieli = [p_okieli]
      ,tehtavatyyppi_perusopetuksessa = [p_virka]
      ,taydennyskoulutus_osallistuminen = [p_taydjo]
      ,taydennyskoulutus_ei_tietoa = [p_taydeit]
      ,taydennyskoulutus_ei = [p_eitayd]
      ,taydennyskoulutus_tyoaika = [p_tutktyo] 
      ,taydennyskoulutus_oma_aika = [p_tutkoma] 
      ,taydennyskoulutus_kelp_tyoaika = [p_pattyo] 
      ,taydennyskoulutus_kelp_oma_aika = [p_patoma] 
      ,taydennyskoulutus_tantaja_tyoaika = [p_henktyo]
      ,taydennyskoulutus_tantaja_oma_aika = [p_henkoma] 
      ,taydennyskoulutus_muu_tyoaika = [p_muutyo] 
      ,taydennyskoulutus_muu_oma_aika = [p_muuoma] 
      ,asiantuntijavaihto_tyoaika = [p_kanstyo]
      ,asiantuntijavaihto_oma_aika = [p_kansoma] 
      ,koulutussuunnitelma = [p_kehsuu] 
      ,sukupuoli = [p_sp] 
      ,maakunta_oppilaitos = [p_maakunta] 
      ,ika = [p_ika] 
      ,tietolahde = [tietolahde] 
      ,rivinumero = [rivinumero] 

FROM VipunenTK_DW.dbo.f_7_3_Perusopetuksen_opettajat_osallistuminen_taydennyskoulutukseen

 







' 
GO
/****** Object:  View [dbo].[v_f_7_4_Lukiokoulutuksen_opettajat_kelpoisuus_aine]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_4_Lukiokoulutuksen_opettajat_kelpoisuus_aine]'))
EXEC dbo.sp_executesql @statement = N'







CREATE VIEW [dbo].[v_f_7_4_Lukiokoulutuksen_opettajat_kelpoisuus_aine] AS

/*
Drop table [VipunenTK].[dbo].[f_Opettajat_lukiokoulutus_kelpoisuus_aine]
Select * into [VipunenTK].[dbo].[f_Opettajat_lukiokoulutus_kelpoisuus_aine] FROM [VipunenTK_DW].[dbo].[v_f_7_4_Lukiokoulutuksen_opettajat_kelpoisuus_aine]
Truncate table [VipunenTK].[dbo].[f_Opettajat_lukiokoulutus_kelpoisuus_aine]
Insert into [VipunenTK].[dbo].[f_Opettajat_lukiokoulutus_kelpoisuus_aine]
Select * FROM [VipunenTK_DW].[dbo].[v_f_7_4_Lukiokoulutuksen_opettajat_kelpoisuus_aine]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
      ,oppilaitoksen_kieli = [l_okieli]
      ,tyosuhde_vakinainen = [l_tyos1]
      ,tyosuhde_maara_aikainen = [l_tyos2]
      ,tyosuhde_viransijainen = [l_tyos3]
	  ,tyosuhde_virkavapaa = [l_tyos4]
      ,tyosuhde_oa_elake = [l_tyos5]
      ,tehtavatyyppi_perusopetuksessa = [l_virka]
      ,paaasiallinen_koulutusmuoto = [l_aste]
      ,kelp_esiopetus = [l_k1]
      ,kelp_luokanopettaja = [l_k2]
      ,kelp_aineenopettaja = [l_k3]
      ,kelp_aineenopettaja_lukio = [l_k4]
      ,kelp_erityisluokan_opettaja = [l_k5]
      ,kelp_erityisopettaja_osa_aikainen = [l_k6]
      ,kelp_oppilaanohjaaja = [l_k7]
      ,kelp_opinto_ohjaaja = [l_k8]
      ,kelp_muu = [l_k9]
      ,kelp_ei = [l_k10]
      ,kelp_kehitysvammaiset = [l_k11]
      ,opettajan_eniten_opettama_aine = [l_aine]
      ,sukupuoli = [l_sp]
      ,maakunta_oppilaitos = [l_maakunta]
      ,kuntaryhmitys_oppilaitos = [l_okunryh]
      ,ika = l_ika
	  ,kelp = l_kelpu
  
  FROM VipunenTK_DW.dbo.f_7_4_Lukiokoulutuksen_opettajat_kelpoisuus_aine

 







' 
GO
/****** Object:  View [dbo].[v_f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja]'))
EXEC dbo.sp_executesql @statement = N'







CREATE VIEW [dbo].[v_f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja] AS

/*
Drop table [VipunenTK_DW].[dbo].[f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Select * into [VipunenTK].[dbo].[f_Opettajat_perusopetus_koulutuksen_jarjestaja_opetusryhmakoot] FROM [VipunenTK_DW].[dbo].[v_f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Truncate table [VipunenTK_DW].[dbo].[f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Insert into [VipunenTK].[dbo].[f_Opettajat_perusopetus_koulutuksen_jarjestaja_opetusryhmakoot]
  Select * FROM [VipunenTK_DW].[dbo].[v_sa_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date] 
	  ,oppilaitoksen_kieli = [l_okieli]
      ,koulutuksen_jarjestajan_koko = [l_yopp21_22]
      ,koulutuksen_jarjestajan_kieli = [l_ykieli]
	  ,koulutuksen_jarjestajan_omistajatyyppi = [l_yomist] 
      ,koulutuksen_jarjestajan_maakunta = [l_ymkunta] 
      ,koulutuksen_jarjestajan_kuntaryhmitys = [l_ykunryh] 
     
FROM VipunenTK_DW.dbo.f_7_5_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja

 







' 
GO
/****** Object:  View [dbo].[v_f_7_6_Lukiokoulutuksen_opettajat_osallistuminen_taydennyskoulutukseen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_6_Lukiokoulutuksen_opettajat_osallistuminen_taydennyskoulutukseen]'))
EXEC dbo.sp_executesql @statement = N'









CREATE VIEW [dbo].[v_f_7_6_Lukiokoulutuksen_opettajat_osallistuminen_taydennyskoulutukseen] AS

/*
Drop table [VipunenTK_DW].[dbo].[f_7_6_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Select * into [VipunenTK].[dbo].[f_Opettajat_perusopetus_osallistuminen_taydennyskoulutukseen] FROM [VipunenTK_DW].[dbo].[v_f_7_6_Lukiokoulutuksen_opettajat_osallistuminen_taydennyskoulutukseen]
Truncate table [VipunenTK_DW].[dbo].[f_7_6_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
Insert into [VipunenTK].[dbo].[f_Opettajat_perusopetus_koulutuksen_jarjestaja_opetusryhmakoot]
  Select * FROM [VipunenTK_DW].[dbo].[v_sa_7_6_Lukiokoulutuksen_opettajat_koulutuksen_jarjestaja_opetusryhmakoot]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
	  ,oppilaitoksen_kieli = [l_okieli]
      ,tehtavatyyppi_lukiokoulutuksessa = [l_virka]
      ,taydennyskoulutus_osallistuminen = [l_taydjo]
      ,taydennyskoulutus_ei_tietoa = [l_taydeit]
      ,taydennyskoulutus_ei = [l_eitayd]
      ,taydennyskoulutus_tyoaika = [l_tutktyo] 
      ,taydennyskoulutus_oma_aika = [l_tutkoma] 
      ,taydennyskoulutus_kell_tyoaika = [l_pattyo] 
      ,taydennyskoulutus_kell_oma_aika = [l_patoma] 
      ,taydennyskoulutus_tantaja_tyoaika = [l_henktyo]
      ,taydennyskoulutus_tantaja_oma_aika = [l_henkoma] 
      ,taydennyskoulutus_muu_tyoaika = [l_muutyo] 
      ,taydennyskoulutus_muu_oma_aika = [l_muuoma] 
      ,asiantuntijavaihto_tyoaika = [l_kanstyo]
      ,asiantuntijavaihto_oma_aika = [l_kansoma] 
      ,koulutussuunnitelma = [l_kehsuu] 
      ,sukupuoli = [l_sp] 
      ,maakunta_oppilaitos = [l_maakunta] 
      ,ika = [l_ika] 


FROM VipunenTK_DW.dbo.f_7_6_Lukiokoulutuksen_opettajat_osallistuminen_taydennyskoulutukseen

 









' 
GO
/****** Object:  View [dbo].[v_f_7_7_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_7_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]'))
EXEC dbo.sp_executesql @statement = N'











CREATE VIEW [dbo].[v_f_7_7_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus] AS

/*
Drop table [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus_jarjkieli]
Select * into [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus_jarjkieli] FROM [VipunenTK_DW].[dbo].[v_f_7_7_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]
Truncate table [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus_jarjkieli]
Insert into [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_kelpoisuus_koulutus_jarjkieli]
Select * FROM [VipunenTK_DW].[dbo].[v_f_7_7_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
	  ,oppilaitoksen_kieli = [a_okieli]
      ,pääasiallinen_koulutusaste = [a_aste] 
      ,erityisopetus = [a_g16] 
      ,opinto_ohjaus = [a_g17] 
      ,valma = [a_g18] 
      ,telma = [a_g19] 
      ,mamu = [a_g20] 
      ,ammpk_valmistava = [a_g21] 
      ,kotitalousopetus = [a_g22]
      ,kelp_amm = [a_h6] 
      ,kelp_yht = [a_h7] 
      ,kelp_opo = [a_h8] 
      ,kelp_erope = [a_h9]
      ,kelp_muu = [a_h10] 
      ,kelp_ei_muod = [a_h11]
      ,eikelp_paa = [a_h1]
      ,eikelp_pedag = [a_h2]
      ,eikelp_tyokok = [a_h3] 
      ,eikelp_tieto_puuttuu = [a_h4] 
	  ,kelp_kaikki = [a_h5]
	  ,opettajan_eniten_opettama_ala = [a_ala]
      ,opettajan_eniten_opettama_aine = [a_aine] 
      ,opettajan_koulutus = [a_koulk] 
      ,[a_oppil] 
      ,koul_jarj_koko_ei_oppis = [a_eioppilkm]
      ,koul_jarj_koko_oppis = [a_oppilkm] 
      ,koul_jarj_kieli = [a_ykieli] 
      ,koul_jarj_maakunta = [a_ymkunta] 
      ,oppilaitoksen_maakunta = [a_maakunta] 
  
  FROM VipunenTK_DW.dbo.f_7_7_Ammatillisen_koulutuksen_opettajat_kelpoisuus_koulutus

 











' 
GO
/****** Object:  View [dbo].[v_f_7_8_Ammatillisen_koulutuksen_opettajat_osallistuminen_täydennyskoulutukseen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_8_Ammatillisen_koulutuksen_opettajat_osallistuminen_täydennyskoulutukseen]'))
EXEC dbo.sp_executesql @statement = N'








CREATE VIEW [dbo].[v_f_7_8_Ammatillisen_koulutuksen_opettajat_osallistuminen_täydennyskoulutukseen] AS

/*
Drop table [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_osallistuminen_taydennyskoulutukseen]
Select * into [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_osallistuminen_taydennyskoulutukseen] FROM [VipunenTK_DW].[dbo].[v_f_7_8_Ammatillisen_koulutuksen_opettajat_osallistuminen_täydennyskoulutukseen]
Truncate table [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_osallistuminen_taydennyskoulutukseen]
Insert into [VipunenTK].[dbo].[f_Opettajat_ammatillinen_koulutus_osallistuminen_taydennyskoulutukseen]
Select * FROM [VipunenTK_DW].[dbo].[v_f_7_8_Ammatillisen_koulutuksen_opettajat_osallistuminen_täydennyskoulutukseen]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
      ,[a_okieli]
      ,[a_virka]
      ,[a_aste]
      ,[a_ala108]
      ,[a_taydjo]
      ,[a_taydeit]
      ,[a_eitayd]
      ,[a_tutktyo]
      ,[a_tutkoma]
      ,[a_pattyo]
      ,[a_patoma]
      ,[a_henktyo]
      ,[a_henkoma]
      ,[a_muutyo]
      ,[a_muuoma]
      ,[a_kanstyo]
      ,[a_kansoma]
      ,[a_kehsuu]
      ,[tyojakp]
      ,[eityojak]
      ,[tyojakeit]
      ,[a_sp]
      ,[a_maakunta]
      ,[a_ika] 
  
  FROM VipunenTK_DW.dbo.f_7_8_Ammatillisen_koulutuksen_opettajat_osallistuminen_täydennyskoulutukseen

 








' 
GO
/****** Object:  View [dbo].[v_f_7_9_Vapaan_sivistystyön_opettajat_osallistuminen_täydennyskoulutukseen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_7_9_Vapaan_sivistystyön_opettajat_osallistuminen_täydennyskoulutukseen]'))
EXEC dbo.sp_executesql @statement = N'









CREATE VIEW [dbo].[v_f_7_9_Vapaan_sivistystyön_opettajat_osallistuminen_täydennyskoulutukseen] AS

/*
Drop table [VipunenTK].[dbo].[f_Opettajat_vapaa_sivistystyö_osallistuminen_taydennyskoulutukseen]
Select * into [VipunenTK].[dbo].[f_Opettajat_vapaa_sivistystyö_osallistuminen_taydennyskoulutukseen] FROM [VipunenTK_DW].[dbo].[v_f_7_9_Vapaan_sivistystyön_opettajat_osallistuminen_täydennyskoulutukseen]
Truncate table [VipunenTK].[dbo].[f_Opettajat_vapaa_sivistystyö_osallistuminen_taydennyskoulutukseen]
Insert into [VipunenTK].[dbo].[f_Opettajat_vapaa_sivistystyö_osallistuminen_taydennyskoulutukseen]
Select * FROM [VipunenTK_DW].[dbo].[v_f_7_9_Vapaan_sivistystyön_opettajat_osallistuminen_täydennyskoulutukseen]
*/

SELECT tilastointivuosi = [tilv]
      ,tilv_date = [tilv_date]
      ,[v_okieli]
      ,[v_virka]
      ,[v_taydjo] 
      ,[v_taydeit]
      ,[v_eitayd] 
      ,[v_tutktyo]
      ,[v_tutkoma]
      ,[v_pattyo]
      ,[v_patoma]
      ,[v_henktyo] 
      ,[v_henkoma] 
      ,[v_muutyo]
      ,[v_muuoma] 
	  ,[v_kehsuu]
      ,[v_sp]
      ,[v_maakunta]
	  ,[v_ika]
  
  FROM VipunenTK_DW.dbo.f_7_9_Vapaan_sivistystyön_opettajat_osallistuminen_täydennyskoulutukseen

 









' 
GO
/****** Object:  View [dbo].[v_f_Ainevalinnat_2_1_Peruskoulutiedosto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Ainevalinnat_2_1_Peruskoulutiedosto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_Ainevalinnat_2_1_Peruskoulutiedosto] AS
--Select * from [v_sa_2_1_Peruskoulutiedosto_dw]

Select 
	tilv, tilv_date, jarj, tunn, 
	--11kev1, kev1n, kev2, kev2n, kev3, kev3n, kev4, kev4n, kev5, kev5n, kev6, kev6n, kev7, kev7n, kev8, kev8n, kev9, kev9n, kev, kevn, luok1, luok1n, luok2, luok2n, luok3, luok3n, luok4, luok4n, luok5, luok5n, luok6, luok6n, luok7, luok7n, luok8, luok8n, luok9, luok9n, luok, luokn, laim, laimn, erotod, erotodn, eitod, eitodn, tod, todn, tutkt, tutktn, suor10, suor10n, ove, oven, ov1, ov1n, ov2, ov2n, ov3, ov3n, ov4, ov4n, ov5, ov5n, ov6, ov6n, ov7, ov7n, ov8, ov8n, ov9, ov9n, ov10, ov10n, ovy, ovyn, eroppe, eropp1, eropp2, eropp3, eropp4, eropp5, eropp6, eropp7, eropp8, eropp9, eropp0, eropp, vaikvame, vaikvam1, vaikvam2, vaikvam3, vaikvam4, vaikvam5, vaikvam6, vaikvam7, vaikvam8, vaikvam9, vaikvam0, vaikvam, muuvame, muuvam1, muuvam2, muuvam3, muuvam4, muuvam5, muuvam6, muuvam7, muuvam8, muuvam9, muuvam0, muuvam, opksu, opkru, opksaa, opkmuu, opky, kiele, kiele9, kiele11v, kiele11m, kielk, kielk9, kielk11v, kielk11m, kulje, kulje9, kulje11v, kulje11m, kuljk, kuljk9, kuljk11v, kuljk11m, maje, maje9, maje11v, maje11m, majk, majk9, majk11v, majk11m, lykk, lykkn, kotona, kotonan, ulkom, ulkomn, ika5e, ika5en, ika6e, ika6en, ika61, ika61n, ika7e, ika7en, ika71, ika71n, ika81, ika81n, ika91, ika91n, ikae, ikaen, ika1, ika1n, oeriy, kokint0, kokint1, kokint2, kokint3, kokint4, kokint5, kokint6, kokint7, kokint8, kokint9, kokint10, kokint, kokintn, osint0, osint1, osint2, osint3, osint4, osint5, osint6, osint7, osint8, osint9, osint10, osint, osintn, eritlk0, eritlk1, eritlk2, eritlk3, eritlk4, eritlk5, eritlk6, eritlk7, eritlk8, eritlk9, eritlk10, eritlk, eritlkn, int0, int1, int2, int3, int4, int5, int6, int7, int8, int9, int10, inty, intyn, int0n, int1n, int2n, int3n, int4n, int5n, int6n, int7n, int8n, int9n, int10n, intn, aev, yev, ev, aort, yort, ort, aet, yet, et, amu, ymu, mu, aeos, yeos, eos, akay, ykay, kay, asv, ysv, sv, arv, yrv, rv, asvrv, ysvrv, svrv, eng1, eng2, eng3, eng4, eng5, eng6, eny, enn, ru1, ru2, ru3, ru4, ru5, ru6, ruy, run, su1, su2, su3, su4, su5, su6, suy, sun, ra1, ra2, ra3, ra4, ra5, ra6, ray, ran, sa1, sa2, sa3, sa4, sa5, sa6, say, san, ve1, ve2, ve3, ve4, ve5, ve6, vey, ven, saa1, saa2, saa3, saa4, saa5, saa6, saay, saan, mu1, mu2, mu3, mu4, mu5, mu6, muy, mun, eopis1, eopis2, eopis3, eopis4, eopis5, eopis6, eopisy, eopisn, yht1, yht2, yht3, yht4, yht5, yht6, yht, tyt, ven1, ven2, ven3, ven4, ven5, ven6, veny, venn, vru1, vru2, vru3, vru4, vru5, vru6, vruy, vsu1, vsu2, vsu3, vsu4, vsu5, vsu6, vsuy, vsun, vrun, vra1, vra2, vra3, vra4, vra5, vra6, vray, vran, vsa1, vsa2, vsa3, vsa4, vsa5, vsa6, vsay, vsan, vve1, vve2, vve3, vve4, vve5, vve6, vvey, vven, vsaa1, vsaa2, vsaa3, vsaa4, vsaa5, vsaa6, vsaay, vsaan, vmu1, vmu2, vmu3, vmu4, vmu5, vmu6, vmuy, vmun, vyht1, vyht2, vyht3, vyht4, vyht5, vyht6, vyht, vtyt, kieli0, kieli1, kieli2, kieli3, kieli4, kieliy, yaen1m, yyenm, yenm, yaen2m, enmm, yaen1n, yyenn, yenn, yaen2n, ennn, yaru1m, yyrum, yrum, yaru2m, rumm, yaru1n, yyrun, yrun, yaru2n, runn, yasu1m, yysum, ysum, yasu2m, summ, yasu1n, yysun, ysun, yasu2n, sunn, yara1m, yyram, yram, yara2m, ramm, yara1n, yyran, yran, yara2n, rann, yasa1m, yysam, ysam, yasa2m, samm, yasa1n, yysan, ysan, yasa2n, sann, yave1m, yvem, yave2m, vemm, yave1n, yven, yave2n, vennn, yasaa1m, ysaam, yasaa2m, saamm, yasaa1n, ysaan, yasaa2n, saann, yalat1m, ylatm, yalat2m, lamm, yalat1n, ylatn, yalat2n, lann, yamuu1m, ymuum, yamuu2m, mumm, yamuu1n, ymuun, yamuu2n, munn, yaei1m, yyeim, eimm, yaei1n, yyein, einn, ma14m, ma14n, ma12m, ma12n, ma1m, ma1n, ma2m, ma2n, ma3m, ma3n, fy14m, fy14n, fy12m, fy12n, fy1m, fy1n, fy2m, fy2n, fy3m, fy3n, ke14m, ke14n, ke12m, ke12n, ke1m, ke1n, ke2m, ke2n, ke3m, ke3n, bi14m, bi14n, bi12m, bi12n, bi1m, bi1n, bi2m, bi2n, bi3m, bi3n, mt14m, mt14n, mt12m, mt12n, mt1m, mt1n, mt2m, mt2n, mt3m, mt3n, ttek14m, ttek14n, ttek12m, ttek12n, ttek1m, ttek1n, ttek2m, ttek2n, ttek3m, ttek3n, tt14m, tt14n, tt12m, tt12n, tt1m, tt1n, tt2m, tt2n, tt3m, tt3n, ts14m, ts14n, ts12m, ts12n, ts1m, ts1n, ts2m, ts2n, ts3m, ts3n
	tietolahde, rivinumero
   ,lkm_arvo, lkm_id

from
(Select 
	tilv, tilv_date, jarj, tunn, kev1, kev1n, kev2, kev2n, kev3, kev3n, kev4, kev4n, kev5, kev5n, kev6, kev6n, kev7, kev7n, kev8, kev8n, kev9, kev9n, kev, kevn, luok1, luok1n, luok2, luok2n, luok3, luok3n, luok4, luok4n, luok5, luok5n, luok6, luok6n, luok7, luok7n, luok8, luok8n, luok9, luok9n, luok, luokn, laim, laimn, erotod, erotodn, eitod, eitodn, tod, todn, tutkt, tutktn, suor10, suor10n, ove, oven, ov1, ov1n, ov2, ov2n, ov3, ov3n, ov4, ov4n, ov5, ov5n, ov6, ov6n, ov7, ov7n, ov8, ov8n, ov9, ov9n, ov10, ov10n, ovy, ovyn, eroppe, eropp1, eropp2, eropp3, eropp4, eropp5, eropp6, eropp7, eropp8, eropp9, eropp0, eropp, vaikvame, vaikvam1, vaikvam2, vaikvam3, vaikvam4, vaikvam5, vaikvam6, vaikvam7, vaikvam8, vaikvam9, vaikvam0, vaikvam, muuvame, muuvam1, muuvam2, muuvam3, muuvam4, muuvam5, muuvam6, muuvam7, muuvam8, muuvam9, muuvam0, muuvam, opksu, opkru, opksaa, opkmuu, opky, kiele, kiele9, kiele11v, kiele11m, kielk, kielk9, kielk11v, kielk11m, kulje, kulje9, kulje11v, kulje11m, kuljk, kuljk9, kuljk11v, kuljk11m, maje, maje9, maje11v, maje11m, majk, majk9, majk11v, majk11m, lykk, lykkn, kotona, kotonan, ulkom, ulkomn, ika5e, ika5en, ika6e, ika6en, ika61, ika61n, ika7e, ika7en, ika71, ika71n, ika81, ika81n, ika91, ika91n, ikae, ikaen, ika1, ika1n, oeriy, kokint0, kokint1, kokint2, kokint3, kokint4, kokint5, kokint6, kokint7, kokint8, kokint9, kokint10, kokint, kokintn, osint0, osint1, osint2, osint3, osint4, osint5, osint6, osint7, osint8, osint9, osint10, osint, osintn, eritlk0, eritlk1, eritlk2, eritlk3, eritlk4, eritlk5, eritlk6, eritlk7, eritlk8, eritlk9, eritlk10, eritlk, eritlkn, int0, int1, int2, int3, int4, int5, int6, int7, int8, int9, int10, inty, intyn, int0n, int1n, int2n, int3n, int4n, int5n, int6n, int7n, int8n, int9n, int10n, intn, aev, yev, ev, aort, yort, ort, aet, yet, et, amu, ymu, mu, aeos, yeos, eos, akay, ykay, kay, asv, ysv, sv, arv, yrv, rv, asvrv, ysvrv, svrv, eng1, eng2, eng3, eng4, eng5, eng6, eny, enn, ru1, ru2, ru3, ru4, ru5, ru6, ruy, run, su1, su2, su3, su4, su5, su6, suy, sun, ra1, ra2, ra3, ra4, ra5, ra6, ray, ran, sa1, sa2, sa3, sa4, sa5, sa6, say, san, ve1, ve2, ve3, ve4, ve5, ve6, vey, ven, saa1, saa2, saa3, saa4, saa5, saa6, saay, saan, mu1, mu2, mu3, mu4, mu5, mu6, muy, mun, eopis1, eopis2, eopis3, eopis4, eopis5, eopis6, eopisy, eopisn, yht1, yht2, yht3, yht4, yht5, yht6, yht, tyt, ven1, ven2, ven3, ven4, ven5, ven6, veny, venn, vru1, vru2, vru3, vru4, vru5, vru6, vruy, vsu1, vsu2, vsu3, vsu4, vsu5, vsu6, vsuy, vsun, vrun, vra1, vra2, vra3, vra4, vra5, vra6, vray, vran, vsa1, vsa2, vsa3, vsa4, vsa5, vsa6, vsay, vsan, vve1, vve2, vve3, vve4, vve5, vve6, vvey, vven, vsaa1, vsaa2, vsaa3, vsaa4, vsaa5, vsaa6, vsaay, vsaan, vmu1, vmu2, vmu3, vmu4, vmu5, vmu6, vmuy, vmun, vyht1, vyht2, vyht3, vyht4, vyht5, vyht6, vyht, vtyt, kieli0, kieli1, kieli2, kieli3, kieli4, kieliy, yaen1m, yyenm, yenm, yaen2m, enmm, yaen1n, yyenn, yenn, yaen2n, ennn, yaru1m, yyrum, yrum, yaru2m, rumm, yaru1n, yyrun, yrun, yaru2n, runn, yasu1m, yysum, ysum, yasu2m, summ, yasu1n, yysun, ysun, yasu2n, sunn, yara1m, yyram, yram, yara2m, ramm, yara1n, yyran, yran, yara2n, rann, yasa1m, yysam, ysam, yasa2m, samm, yasa1n, yysan, ysan, yasa2n, sann, yave1m, yvem, yave2m, vemm, yave1n, yven, yave2n, vennn, yasaa1m, ysaam, yasaa2m, saamm, yasaa1n, ysaan, yasaa2n, saann, yalat1m, ylatm, yalat2m, lamm, yalat1n, ylatn, yalat2n, lann, yamuu1m, ymuum, yamuu2m, mumm, yamuu1n, ymuun, yamuu2n, munn, yaei1m, yyeim, eimm, yaei1n, yyein, einn, ma14m, ma14n, ma12m, ma12n, ma1m, ma1n, ma2m, ma2n, ma3m, ma3n, fy14m, fy14n, fy12m, fy12n, fy1m, fy1n, fy2m, fy2n, fy3m, fy3n, ke14m, ke14n, ke12m, ke12n, ke1m, ke1n, ke2m, ke2n, ke3m, ke3n, bi14m, bi14n, bi12m, bi12n, bi1m, bi1n, bi2m, bi2n, bi3m, bi3n, mt14m, mt14n, mt12m, mt12n, mt1m, mt1n, mt2m, mt2n, mt3m, mt3n, ttek14m, ttek14n, ttek12m, ttek12n, ttek1m, ttek1n, ttek2m, ttek2n, ttek3m, ttek3n, tt14m, tt14n, tt12m, tt12n, tt1m, tt1n, tt2m, tt2n, tt3m, tt3n, ts14m, ts14n, ts12m, ts12n, ts1m, ts1n, ts2m, ts2n, ts3m, ts3n, tietolahde, rivinumero
from VipunenTK_DW.[dbo].[f_2_1_Peruskoulutiedosto]
) p
  UNPIVOT 
   (lkm_arvo FOR lkm_id IN 
      (
	--tilv, tilv_date, jarj, tunn, 
	kev1, kev1n, kev2, kev2n, kev3, kev3n, kev4, kev4n, kev5, kev5n, kev6, kev6n, kev7, kev7n, kev8, kev8n, kev9, kev9n, kev, kevn, luok1, luok1n, luok2, luok2n, luok3, luok3n, luok4, luok4n, luok5, luok5n, luok6, luok6n, luok7, luok7n, luok8, luok8n, luok9, luok9n, luok, luokn, laim, laimn, erotod, erotodn, eitod, eitodn, tod, todn, tutkt, tutktn, suor10, suor10n, ove, oven, ov1, ov1n, ov2, ov2n, ov3, ov3n, ov4, ov4n, ov5, ov5n, ov6, ov6n, ov7, ov7n, ov8, ov8n, ov9, ov9n, ov10, ov10n, ovy, ovyn, eroppe, eropp1, eropp2, eropp3, eropp4, eropp5, eropp6, eropp7, eropp8, eropp9, eropp0, eropp, vaikvame, vaikvam1, vaikvam2, vaikvam3, vaikvam4, vaikvam5, vaikvam6, vaikvam7, vaikvam8, vaikvam9, vaikvam0, vaikvam, muuvame, muuvam1, muuvam2, muuvam3, muuvam4, muuvam5, muuvam6, muuvam7, muuvam8, muuvam9, muuvam0, muuvam, opksu, opkru, opksaa, opkmuu, opky, kiele, kiele9, kiele11v, kiele11m, kielk, kielk9, kielk11v, kielk11m, kulje, kulje9, kulje11v, kulje11m, kuljk, kuljk9, kuljk11v, kuljk11m, maje, maje9, maje11v, maje11m, majk, majk9, majk11v, majk11m, lykk, lykkn, kotona, kotonan, ulkom, ulkomn, ika5e, ika5en, ika6e, ika6en, ika61, ika61n, ika7e, ika7en, ika71, ika71n, ika81, ika81n, ika91, ika91n, ikae, ikaen, ika1, ika1n, oeriy, kokint0, kokint1, kokint2, kokint3, kokint4, kokint5, kokint6, kokint7, kokint8, kokint9, kokint10, kokint, kokintn, osint0, osint1, osint2, osint3, osint4, osint5, osint6, osint7, osint8, osint9, osint10, osint, osintn, eritlk0, eritlk1, eritlk2, eritlk3, eritlk4, eritlk5, eritlk6, eritlk7, eritlk8, eritlk9, eritlk10, eritlk, eritlkn, int0, int1, int2, int3, int4, int5, int6, int7, int8, int9, int10, inty, intyn, int0n, int1n, int2n, int3n, int4n, int5n, int6n, int7n, int8n, int9n, int10n, intn, aev, yev, ev, aort, yort, ort, aet, yet, et, amu, ymu, mu, aeos, yeos, eos, akay, ykay, kay, asv, ysv, sv, arv, yrv, rv, asvrv, ysvrv, svrv, eng1, eng2, eng3, eng4, eng5, eng6, eny, enn, ru1, ru2, ru3, ru4, ru5, ru6, ruy, run, su1, su2, su3, su4, su5, su6, suy, sun, ra1, ra2, ra3, ra4, ra5, ra6, ray, ran, sa1, sa2, sa3, sa4, sa5, sa6, say, san, ve1, ve2, ve3, ve4, ve5, ve6, vey, ven, saa1, saa2, saa3, saa4, saa5, saa6, saay, saan, mu1, mu2, mu3, mu4, mu5, mu6, muy, mun, eopis1, eopis2, eopis3, eopis4, eopis5, eopis6, eopisy, eopisn, yht1, yht2, yht3, yht4, yht5, yht6, yht, tyt, ven1, ven2, ven3, ven4, ven5, ven6, veny, venn, vru1, vru2, vru3, vru4, vru5, vru6, vruy, vsu1, vsu2, vsu3, vsu4, vsu5, vsu6, vsuy, vsun, vrun, vra1, vra2, vra3, vra4, vra5, vra6, vray, vran, vsa1, vsa2, vsa3, vsa4, vsa5, vsa6, vsay, vsan, vve1, vve2, vve3, vve4, vve5, vve6, vvey, vven, vsaa1, vsaa2, vsaa3, vsaa4, vsaa5, vsaa6, vsaay, vsaan, vmu1, vmu2, vmu3, vmu4, vmu5, vmu6, vmuy, vmun, vyht1, vyht2, vyht3, vyht4, vyht5, vyht6, vyht, vtyt, kieli0, kieli1, kieli2, kieli3, kieli4, kieliy, yaen1m, yyenm, yenm, yaen2m, enmm, yaen1n, yyenn, yenn, yaen2n, ennn, yaru1m, yyrum, yrum, yaru2m, rumm, yaru1n, yyrun, yrun, yaru2n, runn, yasu1m, yysum, ysum, yasu2m, summ, yasu1n, yysun, ysun, yasu2n, sunn, yara1m, yyram, yram, yara2m, ramm, yara1n, yyran, yran, yara2n, rann, yasa1m, yysam, ysam, yasa2m, samm, yasa1n, yysan, ysan, yasa2n, sann, yave1m, yvem, yave2m, vemm, yave1n, yven, yave2n, vennn, yasaa1m, ysaam, yasaa2m, saamm, yasaa1n, ysaan, yasaa2n, saann, yalat1m, ylatm, yalat2m, lamm, yalat1n, ylatn, yalat2n, lann, yamuu1m, ymuum, yamuu2m, mumm, yamuu1n, ymuun, yamuu2n, munn, yaei1m, yyeim, eimm, yaei1n, yyein, einn, ma14m, ma14n, ma12m, ma12n, ma1m, ma1n, ma2m, ma2n, ma3m, ma3n, fy14m, fy14n, fy12m, fy12n, fy1m, fy1n, fy2m, fy2n, fy3m, fy3n, ke14m, ke14n, ke12m, ke12n, ke1m, ke1n, ke2m, ke2n, ke3m, ke3n, bi14m, bi14n, bi12m, bi12n, bi1m, bi1n, bi2m, bi2n, bi3m, bi3n, mt14m, mt14n, mt12m, mt12n, mt1m, mt1n, mt2m, mt2n, mt3m, mt3n, ttek14m, ttek14n, ttek12m, ttek12n, ttek1m, ttek1n, ttek2m, ttek2n, ttek3m, ttek3n, tt14m, tt14n, tt12m, tt12n, tt1m, tt1n, tt2m, tt2n, tt3m, tt3n, ts14m, ts14n, ts12m, ts12n, ts1m, ts1n, ts2m, ts2n, ts3m, ts3n
	--, tietolahde, rivinumero

  )  ) AS unpvt
  where lkm_arvo is not null and lkm_arvo <> 0
' 
GO
/****** Object:  View [dbo].[v_f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat] AS
--Select * from VipunenTK_DW.dbo.v_f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat


/*
Truncate table VipunenTK_DW.dbo.f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat
Insert into VipunenTK_DW.dbo.f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat
Select * from VipunenTK_DW.dbo.v_f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat
--Drop table VipunenTK_DW.dbo.f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat
--Select * into VipunenTK_DW.dbo.f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat from VipunenTK_DW.dbo.v_f_Ainevalinnat_2_5_Lukiokoulutuksen_ainevalinnat
*/

Select 
			tilastointivuosi
           ,oppilaitos
           ,koulutuksen_jarjestaja
           ,[tietolahde]
           ,[rivinumero]
           ,[aineistotunnus]
           ,[lkm_arvo]
           ,[lkm_id]
           ,[tilv_date]
from
(Select 
      tilastointivuosi, tilv_date, oppilaitos, koulutuksen_jarjestaja, nukevy, aikevy, kev, nukevyn, aikevyn, kevn, nukev1, nukev2, nukev3, nukev4, nukev, nukev1n, nukev2n, nukev3n, nukev4n, nukevn, aikev1, aikev2, aikev3, aikev4, aikev, aikev1n, aikev2n, aikev3n, aikev4n, aikevn, nuvary, aivary, var, nuvaryn, aivaryn, varn, nuyks, aiyks, yksy, nuvar2, nuvar25, nuvar3, nuvar35, nuvar4, nuvar45, nuvar5, nuvar, nuvar2n, nuvar25n, nuvar3n, nuvar35n, nuvar4n, nuvar45n, nuvar5n, nuvarn, aivar2, aivar25, aivar3, aivar35, aivar4, aivar45, aivar5, aivar, aivar2n, aivar25n, aivar3n, aivar35n, aivar4n, aivar45n, aivar5n, aivarn, ev, ort, et, mu, eos, kay, kieli1, kieli2, kieli3, kieli4, kieli5, kieli6, kieliy, sv, rv, svrv, svnn, rvnn, svrvn, yaenm, yyenm, yen6m, len6m, alen6m, enmm, yaenn, yyenn, yen6n, len6n, alen6n, ennn, yarum, yyrum, yru6m, lru6m, alru6m, rumm, yarun, yyrun, yru6n, lru6n, alru6n, runn, yasum, yysum, ysu6m, lsu6m, alsu6m, summ, yasun, yysun, ysu6n, lsu6n, alsu6n, sunn, yaram, yyram, yra6m, lra6m, alra6m, ramm, yaran, yyran, yra6n, lra6n, alra6n, rann, yasam, yysam, ysa6m, lsa6m, alsa6m, samm, yasan, yysan, ysa6n, lsa6n, alsa6n, sann, yavem, yyvem, yve6m, lve6m, alve6m, vemm, yaven, yyven, yve6n, lve6n, alve6n, vennn, yasaam, ysaa6m, lsaa6m, alsaa6m, saamm, yasaan, ysaa6n, lsaa6n, alsaa6n, saann, yalatm, ylat6m, lla6m, alla6m, lamm, yalan, ylat6n, lla6n, alla6n, lann, yaesm, yes6m, les6m, ales6m, esmm, yaesn, yes6n, les6n, ales6n, esnn, yaitm, yit6m, lit6m, alit6m, itmm, yaitn, yit6n, lit6n, alit6n, itnn, yamum, yymum, ymu6m, lmu6m, almu6m, mumm, yamun, yymun, ymu6n, lmu6n, almu6n, munn, yyvam, vamm, yyvan, vann, pmatm, pmatn, pmaty, lmatm, lmatn, lmaty, matm, matn, maty, pma1m, pma1n, pma2m, pma2n, pma3m, pma3n, pma45m, pma45n, pma6m, pma6n, pma7m, pma7n, lma1m, lma1n, lma2m, lma2n, lma3m, lma3n, lma45m, lma45n, lma6m, lma6n, lma7m, lma7n, fy1m, fy1n, fy2m, fy2n, fy3m, fy3n, fy45m, fy45n, fy6m, fy6n, fy7m, fy7n, ke1m, ke1n, ke2m, ke2n, ke3m, ke3n, ke45m, ke45n, ke6m, ke6n, ke7m, ke7n, bi1m, bi1n, bi2m, bi2n, bi3m, bi3n, bi45m, bi45n, bi6m, bi6n, bi7m, bi7n, mt1m, mt1n, mt2m, mt2n, mt3m, mt3n, mt45m, mt45n, mt6m, mt6n, mt7m, mt7n, soma2m, soma2n, soma3m, soma3n, sofy2m, sofy2n, sofy3m, sofy3n, soke2m, soke2n, soke3m, soke3n, sobi2m, sobi2n, sobi3m, sobi3n, somt2m, somt2n, somt3m, somt3n, sotek2m, sotek2n, sotek3m, sotek3n, tietolahde, rivinumero, aineistotunnus
from dbo.f_2_5_Lukiokoulutuksen_ainevalinnat
) p
  UNPIVOT 
   (lkm_arvo FOR lkm_id IN 
      (
      --tilastointivuosi, tilv_date, oppilaitos, koulutuksen_jarjestaja, 
      nukevy, aikevy, kev, nukevyn, aikevyn, kevn, nukev1, nukev2, nukev3, nukev4, nukev, nukev1n, nukev2n, nukev3n, nukev4n, nukevn, aikev1, aikev2, aikev3, aikev4, aikev, aikev1n, aikev2n, aikev3n, aikev4n, aikevn, nuvary, aivary, var, nuvaryn, aivaryn, varn, nuyks, aiyks, yksy, nuvar2, nuvar25, nuvar3, nuvar35, nuvar4, nuvar45, nuvar5, nuvar, nuvar2n, nuvar25n, nuvar3n, nuvar35n, nuvar4n, nuvar45n, nuvar5n, nuvarn, aivar2, aivar25, aivar3, aivar35, aivar4, aivar45, aivar5, aivar, aivar2n, aivar25n, aivar3n, aivar35n, aivar4n, aivar45n, aivar5n, aivarn, ev, ort, et, mu, eos, kay, kieli1, kieli2, kieli3, kieli4, kieli5, kieli6, kieliy, sv, rv, svrv, svnn, rvnn, svrvn, yaenm, yyenm, yen6m, len6m, alen6m, enmm, yaenn, yyenn, yen6n, len6n, alen6n, ennn, yarum, yyrum, yru6m, lru6m, alru6m, rumm, yarun, yyrun, yru6n, lru6n, alru6n, runn, yasum, yysum, ysu6m, lsu6m, alsu6m, summ, yasun, yysun, ysu6n, lsu6n, alsu6n, sunn, yaram, yyram, yra6m, lra6m, alra6m, ramm, yaran, yyran, yra6n, lra6n, alra6n, rann, yasam, yysam, ysa6m, lsa6m, alsa6m, samm, yasan, yysan, ysa6n, lsa6n, alsa6n, sann, yavem, yyvem, yve6m, lve6m, alve6m, vemm, yaven, yyven, yve6n, lve6n, alve6n, vennn, yasaam, ysaa6m, lsaa6m, alsaa6m, saamm, yasaan, ysaa6n, lsaa6n, alsaa6n, saann, yalatm, ylat6m, lla6m, alla6m, lamm, yalan, ylat6n, lla6n, alla6n, lann, yaesm, yes6m, les6m, ales6m, esmm, yaesn, yes6n, les6n, ales6n, esnn, yaitm, yit6m, lit6m, alit6m, itmm, yaitn, yit6n, lit6n, alit6n, itnn, yamum, yymum, ymu6m, lmu6m, almu6m, mumm, yamun, yymun, ymu6n, lmu6n, almu6n, munn, yyvam, vamm, yyvan, vann, pmatm, pmatn, pmaty, lmatm, lmatn, lmaty, matm, matn, maty, pma1m, pma1n, pma2m, pma2n, pma3m, pma3n, pma45m, pma45n, pma6m, pma6n, pma7m, pma7n, lma1m, lma1n, lma2m, lma2n, lma3m, lma3n, lma45m, lma45n, lma6m, lma6n, lma7m, lma7n, fy1m, fy1n, fy2m, fy2n, fy3m, fy3n, fy45m, fy45n, fy6m, fy6n, fy7m, fy7n, ke1m, ke1n, ke2m, ke2n, ke3m, ke3n, ke45m, ke45n, ke6m, ke6n, ke7m, ke7n, bi1m, bi1n, bi2m, bi2n, bi3m, bi3n, bi45m, bi45n, bi6m, bi6n, bi7m, bi7n, mt1m, mt1n, mt2m, mt2n, mt3m, mt3n, mt45m, mt45n, mt6m, mt6n, mt7m, mt7n, soma2m, soma2n, soma3m, soma3n, sofy2m, sofy2n, sofy3m, sofy3n, soke2m, soke2n, soke3m, soke3n, sobi2m, sobi2n, sobi3m, sobi3n, somt2m, somt2n, somt3m, somt3n, sotek2m, sotek2n, sotek3m, sotek3n
      --, tietolahde, rivinumero, aineistotunnus
  )  ) AS unpvt
  where lkm_arvo is not null and lkm_arvo <> 0
' 
GO
/****** Object:  View [dbo].[v_f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk] AS
--Select * from [v_f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk]


/*
Truncate table VipunenTK_DW.dbo.f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk
Insert into VipunenTK_DW.dbo.f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk
Select * from [v_f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk]
--Drop table VipunenTK_DW.dbo.f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk
--Select * into VipunenTK_DW.dbo.f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk from [v_f_Ainevalinnat_R2_22_Oppilaitostason_oppil_ja_opisk]
*/

Select 
			[tilv]
           ,[jarj]
           ,[tiedtype]
           ,[tunn]
           ,[edesi]
           ,[edala]
           ,[edyla]
           ,[edlisa]
           ,[edainep]
           ,[syesi]
           ,[syala]
           ,[syyla]
           ,[sylisa]
           ,[symamu]
           ,[sylukio]
           ,[syamm]
           ,[symuu]
           ,[aku]
           ,[kaytto]
           ,[tietolahde]
           ,[rivinumero]
           ,[lkm_arvo]
           ,[lkm_id]
           ,[tilv_date]
from
(Select 
tilv, tilv_date, jarj, tiedtype, tunn, edesi, edala, edyla, edlisa, edainep, syesi, syala, syyla, sylisa, symamu, sylukio, syamm, symuu, keven, kev1, kev1n, kev2, kev2n, kev3, kev3n, kev4, kev4n, kev5, kev5n, kev6, kev6n, kev7, kev7n, kev8, kev8n, kev9, kev9n, kev10, kev10n, kev, kevn, luok1, luok1n, luok2, luok2n, luok3, luok3n, luok4, luok4n, luok5, luok5n, luok6, luok6n, luok7, luok7n, luok8, luok8n, luok9, luok9n, luok, luokn, kelaim, kelaimn, tod, todn, tutkt, tutktn, suor10, suor10n, oeriy, oeriyn, ilmtod, ilmtodn, aku, mamukurs, oppkurs, muukurs, akukurs, kmamu, kmamun, syulkom, syulkomn, sykoti, sykotin, ika4e, ika4en, ika5e, ika5en, pid5v, ika6e, ika6en, ika7e, ika7en, ikae, ikaen, ove, ov1, ov2, ov3, ov4, ov5, ov6, ov7, ov8, ov9, ov10, ovy, tehoe, teho1, teho2, teho3, teho4, teho5, teho6, teho7, teho8, teho9, teho10, tehoy, eipide, eipid1, eipid2, eipid3, eipid4, eipid5, eipid6, eipid7, eipid8, eipid9, eipid10, eipidy, ertuve, ertuv1, ertuv2, ertuv3, ertuv4, ertuv5, ertuv6, ertuv7, ertuv8, ertuv9, ertuv10, ertuvy, ertume, ertum1, ertum2, ertum3, ertum4, ertum5, ertum6, ertum7, ertum8, ertum9, ertum10, ertumy, tavove, tavov1, tavov2, tavov3, tavov4, tavov5, tavov6, tavov7, tavov8, tavov9, tavov10, tavovy, oven, ov1n, ov2n, ov3n, ov4n, ov5n, ov6n, ov7n, ov8n, ov9n, ov10n, ovyn, tehoen, teho1n, teho2n, teho3n, teho4n, teho5n, teho6n, teho7n, teho8n, teho9n, teho10n, tehoyn, eipiden, eipid1n, eipid2n, eipid3n, eipid4n, eipid5n, eipid6n, eipid7n, eipid8n, eipid9n, eipid10n, eipidyn, ertuven, ertuv1n, ertuv2n, ertuv3n, ertuv4n, ertuv5n, ertuv6n, ertuv7n, ertuv8n, ertuv9n, ertuv10n, ertuvyn, ertumen, ertum1n, ertum2n, ertum3n, ertum4n, ertum5n, ertum6n, ertum7n, ertum8n, ertum9n, ertum10n, ertumyn, tavoven, tavov1n, tavov2n, tavov3n, tavov4n, tavov5n, tavov6n, tavov7n, tavov8n, tavov9n, tavov10n, tavovyn, eipidec, eipidpc, eipidlc, eipidyc, ertuvec, ertuvpc, ertuvlc, ertuvyc, ertumec, ertumpc, ertumlc, ertumyc, muuec, muupc, muulc, muuyc, ovec, ovpc, ovlc, ovyc, sisae, sisap, sisal, sisam, sisay, maeipide, maeipidp, maeipidl, maeipidy, maertuve, maertuvp, maertuvl, maertuvy, maertume, maertump, maertuml, maertumy, mamuue, mamuup, mamuul, mamuuy, maove, maovp, maovl, maovy, kueipide, kueipidp, kueipidl, kueipidy, kuertuve, kuertuvp, kuertuvl, kuertuvy, kuertume, kuertump, kuertuml, kuertumy, kumuue, kumuup, kumuul, kumuuy, kuove, kuovp, kuovl, kuovy, vieipide, vieipidp, vieipidl, vieipidy, viertuve, viertuvp, viertuvl, viertuvy, viertume, viertump, viertuml, viertumy, vimuue, vimuup, vimuul, vimuuy, viove, viovp, viovl, viovy, ika61, ika61n, ika71, ika71n, ika81, ika81n, ika91, ika91n, ika1, ika1n, lykk, lykkn, jopo, jopon, kan17v, muu17v, op17v, lukoko, lukokon, luib, luibn, reife, reifen, gymn, gymnn, lueb, luebn, lukio, lukion, opsamm, opsammn, muuamm, muuammn, amm, ammn, peain, peainn, luain, luainn, vapsiv, vapsivn, taiop, taiopn, muukoul, muukouln, muuop, muuopn, tehoec, teho16c, teho79c, teholc, tehoyc, ertuec, ertu16c, ertu79c, ertulc, ertuyc, eritec, erit16c, erit79c, eritlc, erityc, inte4, int164, int794, intl4, inty4, inte3, int163, int793, intl3, inty3, inte2, int162, int792, intl2, inty2, inte1, int161, int791, intl1, inty1, inte0, int160, int790, intl0, inty0, intey, int16y, int79y, intly, intyy, yks160, yks790, yksl0, yksy0, yks161, yks791, yksl1, yksy1, yks162, yks792, yksl2, yksy2, yks164, yks794, yksl4, yksy4, yks16t, yks79t, ykslt, yksyt, yks16y, yks79y, yksly, yksyy, tehoosa, ertuosa, eritosa, tehotuki, ertutuki, erittuki, tehoavu, ertuavu, eritavu, tehomuu, ertumuu, eritmuu, alc, ylc, luc, amc, alkieli0, alkieli1, alkieli2, alkieli3, alkieli4, alkieliy, ylkieli0, ylkieli1, ylkieli2, ylkieli3, ylkieli4, ylkieli5, ylkieliy, lukieli0, lukieli1, lukieli2, lukieli3, lukieli4, lukieli5, lukieli6, lukieliy, amkieli0, amkieli1, amkieli2, amkieli3, amkieli4, amkieli5, amkieli6, amkieliy, aleny, alruy, alsuy, alray, alsay, alvey, alesy, ality, alsaay, almuy, yleny, ylruy, ylsuy, ylray, ylsay, ylvey, ylesy, ylity, ylsaay, yllaty, ylmuy, lueny, luruy, lusuy, luray, lusay, luvey, luesy, luity, lusaay, lulaty, lumuy, ameny, amruy, amsuy, amray, amsay, amvey, amesy, amity, amsaay, amlaty, ammuy, ov1c, ov2c, ov3c, ov4c, ov5c, ov6c, ov16yc, ov16nc, eng1, ru1, su1, ra1, sa1, ve1, es1, it1, saa1, mu1, eopis1, eng2, ru2, su2, ra2, sa2, ve2, es2, it2, saa2, mu2, eopis2, eng3, ru3, su3, ra3, sa3, ve3, es3, it3, saa3, mu3, eopis3, eng4, ru4, su4, ra4, sa4, ve4, es4, it4, saa4, mu4, eopis4, eng5, ru5, su5, ra5, sa5, ve5, es5, it5, saa5, mu5, eopis5, eng6, ru6, su6, ra6, sa6, ve6, es6, it6, saa6, mu6, eopis6, eny, ruy, suy, ray, say, vey, esy, ity, saay, muy, eopisy, enn, run, sun, ran, san, ven, esn, itn, saan, mun, eopisn, ven1, vru1, vsu1, vra1, vsa1, vve1, ves1, vit1, vsaa1, vmu1, vyht1, ven2, vru2, vsu2, vra2, vsa2, vve2, ves2, vit2, vsaa2, vmu2, vyht2, ven3, vru3, vsu3, vra3, vsa3, vve3, ves3, vit3, vsaa3, vmu3, vyht3, ven4, vru4, vsu4, vra4, vsa4, vve4, ves4, vit4, vsaa4, vmu4, vyht4, ven5, vru5, vsu5, vra5, vsa5, vve5, ves5, vit5, vsaa5, vmu5, vyht5, ven6, vru6, vsu6, vra6, vsa6, vve6, ves6, vit6, vsaa6, vmu6, vyht6, veny, vruy, vsuy, vray, vsay, vvey, vesy, vity, vsaay, vmuy, vyht, venn, vrun, vsun, vran, vsan, vven, vesn, vitn, vsaan, vmun, vtyt, ov79yc, ov79nc, yaen1, yaru1, yasu1, yara1, yasa1, yave1, yaes1, yait1, yasaa1, yalat1, yamuu1, yaen2, yaru2, yasu2, yara2, yasa2, yave2, yaes2, yait2, yasaa2, yalat2, yamuu2, yyen, yyru, yysu, yyra, yysa, yen, yru, ysu, yra, ysa, yve, yes, yit, ysaa, ylat, ymuu, enyy, ruyy, suyy, rayy, sayy, veyy, esyy, ityy, saayy, layy, muyy, yaen1n, yaru1n, yasu1n, yara1n, yasa1n, yave1n, yaes1n, yait1n, yasaa1n, yalat1n, yamuu1n, yaen2n, yaru2n, yasu2n, yara2n, yasa2n, yave2n, yaes2n, yait2n, yasaa2n, yalat2n, yamuu2n, yyenn, yyrun, yysun, yyran, yysan, yenn, yrun, ysun, yran, ysan, yven, yesn, yitn, ysaan, ylatn, ymuun, ennn, runn, sunn, rann, sann, vennn, esnn, itnn, saann, lann, munn, asv, arv, asvrv, ysv, yrv, ysvrv, sv, rv, svrv, aev, aort, aisl, amu, aet, aeos, akay, yev, yort, yisl, ymu, yet, yeos, ykay, ev, ort, isl, mu, et, eos, kay, ov89yc, ov89nc, ai, rsb, ma, yl, bi, ge, fy, ke, ter, ue, eti, hi, yh, mus, ku, tt, ts, li, ko, yhd, ain, rsbn, man, yln, bin, gen, fyn, ken, tern, uen, etin, hin, yhn, musn, kun, ttn, tsn, lin, kon, yhdn, tietop, tietok, tietoi, verkko, kaytto, tietolahde, rivinumero
from dbo.f_R2_22_Oppilaitostason_oppil_ja_opisk
) p
  UNPIVOT 
   (lkm_arvo FOR lkm_id IN 
      (
      --tilv, tilv_date, jarj, tiedtype, tunn, edesi, edala, edyla, edlisa, edainep, syesi, syala, syyla, sylisa, symamu, sylukio, syamm, symuu, 
      keven, kev1, kev1n, kev2, kev2n, kev3, kev3n, kev4, kev4n, kev5, kev5n, kev6, kev6n, kev7, kev7n, kev8, kev8n, kev9, kev9n, kev10, kev10n, kev, kevn, luok1, luok1n, luok2, luok2n, luok3, luok3n, luok4, luok4n, luok5, luok5n, luok6, luok6n, luok7, luok7n, luok8, luok8n, luok9, luok9n, luok, luokn, kelaim, kelaimn, tod, todn, tutkt, tutktn, suor10, suor10n, oeriy, oeriyn, ilmtod, ilmtodn
      --, aku
      , mamukurs, oppkurs, muukurs, akukurs, kmamu, kmamun, syulkom, syulkomn, sykoti, sykotin, ika4e, ika4en, ika5e, ika5en, pid5v, ika6e, ika6en, ika7e, ika7en, ikae, ikaen, ove, ov1, ov2, ov3, ov4, ov5, ov6, ov7, ov8, ov9, ov10, ovy, tehoe, teho1, teho2, teho3, teho4, teho5, teho6, teho7, teho8, teho9, teho10, tehoy, eipide, eipid1, eipid2, eipid3, eipid4, eipid5, eipid6, eipid7, eipid8, eipid9, eipid10, eipidy, ertuve, ertuv1, ertuv2, ertuv3, ertuv4, ertuv5, ertuv6, ertuv7, ertuv8, ertuv9, ertuv10, ertuvy, ertume, ertum1, ertum2, ertum3, ertum4, ertum5, ertum6, ertum7, ertum8, ertum9, ertum10, ertumy, tavove, tavov1, tavov2, tavov3, tavov4, tavov5, tavov6, tavov7, tavov8, tavov9, tavov10, tavovy, oven, ov1n, ov2n, ov3n, ov4n, ov5n, ov6n, ov7n, ov8n, ov9n, ov10n, ovyn, tehoen, teho1n, teho2n, teho3n, teho4n, teho5n, teho6n, teho7n, teho8n, teho9n, teho10n, tehoyn, eipiden, eipid1n, eipid2n, eipid3n, eipid4n, eipid5n, eipid6n, eipid7n, eipid8n, eipid9n, eipid10n, eipidyn, ertuven, ertuv1n, ertuv2n, ertuv3n, ertuv4n, ertuv5n, ertuv6n, ertuv7n, ertuv8n, ertuv9n, ertuv10n, ertuvyn, ertumen, ertum1n, ertum2n, ertum3n, ertum4n, ertum5n, ertum6n, ertum7n, ertum8n, ertum9n, ertum10n, ertumyn, tavoven, tavov1n, tavov2n, tavov3n, tavov4n, tavov5n, tavov6n, tavov7n, tavov8n, tavov9n, tavov10n, tavovyn, eipidec, eipidpc, eipidlc, eipidyc, ertuvec, ertuvpc, ertuvlc, ertuvyc, ertumec, ertumpc, ertumlc, ertumyc, muuec, muupc, muulc, muuyc, ovec, ovpc, ovlc, ovyc, sisae, sisap, sisal, sisam, sisay, maeipide, maeipidp, maeipidl, maeipidy, maertuve, maertuvp, maertuvl, maertuvy, maertume, maertump, maertuml, maertumy, mamuue, mamuup, mamuul, mamuuy, maove, maovp, maovl, maovy, kueipide, kueipidp, kueipidl, kueipidy, kuertuve, kuertuvp, kuertuvl, kuertuvy, kuertume, kuertump, kuertuml, kuertumy, kumuue, kumuup, kumuul, kumuuy, kuove, kuovp, kuovl, kuovy, vieipide, vieipidp, vieipidl, vieipidy, viertuve, viertuvp, viertuvl, viertuvy, viertume, viertump, viertuml, viertumy, vimuue, vimuup, vimuul, vimuuy, viove, viovp, viovl, viovy, ika61, ika61n, ika71, ika71n, ika81, ika81n, ika91, ika91n, ika1, ika1n, lykk, lykkn, jopo, jopon, kan17v, muu17v, op17v, lukoko, lukokon, luib, luibn, reife, reifen, gymn, gymnn, lueb, luebn, lukio, lukion, opsamm, opsammn, muuamm, muuammn, amm, ammn, peain, peainn, luain, luainn, vapsiv, vapsivn, taiop, taiopn, muukoul, muukouln, muuop, muuopn, tehoec, teho16c, teho79c, teholc, tehoyc, ertuec, ertu16c, ertu79c, ertulc, ertuyc, eritec, erit16c, erit79c, eritlc, erityc, inte4, int164, int794, intl4, inty4, inte3, int163, int793, intl3, inty3, inte2, int162, int792, intl2, inty2, inte1, int161, int791, intl1, inty1, inte0, int160, int790, intl0, inty0, intey, int16y, int79y, intly, intyy, yks160, yks790, yksl0, yksy0, yks161, yks791, yksl1, yksy1, yks162, yks792, yksl2, yksy2, yks164, yks794, yksl4, yksy4, yks16t, yks79t, ykslt, yksyt, yks16y, yks79y, yksly, yksyy, tehoosa, ertuosa, eritosa, tehotuki, ertutuki, erittuki, tehoavu, ertuavu, eritavu, tehomuu, ertumuu, eritmuu, alc, ylc, luc, amc, alkieli0, alkieli1, alkieli2, alkieli3, alkieli4, alkieliy, ylkieli0, ylkieli1, ylkieli2, ylkieli3, ylkieli4, ylkieli5, ylkieliy, lukieli0, lukieli1, lukieli2, lukieli3, lukieli4, lukieli5, lukieli6, lukieliy, amkieli0, amkieli1, amkieli2, amkieli3, amkieli4, amkieli5, amkieli6, amkieliy, aleny, alruy, alsuy, alray, alsay, alvey, alesy, ality, alsaay, almuy, yleny, ylruy, ylsuy, ylray, ylsay, ylvey, ylesy, ylity, ylsaay, yllaty, ylmuy, lueny, luruy, lusuy, luray, lusay, luvey, luesy, luity, lusaay, lulaty, lumuy, ameny, amruy, amsuy, amray, amsay, amvey, amesy, amity, amsaay, amlaty, ammuy, ov1c, ov2c, ov3c, ov4c, ov5c, ov6c, ov16yc, ov16nc, eng1, ru1, su1, ra1, sa1, ve1, es1, it1, saa1, mu1, eopis1, eng2, ru2, su2, ra2, sa2, ve2, es2, it2, saa2, mu2, eopis2, eng3, ru3, su3, ra3, sa3, ve3, es3, it3, saa3, mu3, eopis3, eng4, ru4, su4, ra4, sa4, ve4, es4, it4, saa4, mu4, eopis4, eng5, ru5, su5, ra5, sa5, ve5, es5, it5, saa5, mu5, eopis5, eng6, ru6, su6, ra6, sa6, ve6, es6, it6, saa6, mu6, eopis6, eny, ruy, suy, ray, say, vey, esy, ity, saay, muy, eopisy, enn, run, sun, ran, san, ven, esn, itn, saan, mun, eopisn, ven1, vru1, vsu1, vra1, vsa1, vve1, ves1, vit1, vsaa1, vmu1, vyht1, ven2, vru2, vsu2, vra2, vsa2, vve2, ves2, vit2, vsaa2, vmu2, vyht2, ven3, vru3, vsu3, vra3, vsa3, vve3, ves3, vit3, vsaa3, vmu3, vyht3, ven4, vru4, vsu4, vra4, vsa4, vve4, ves4, vit4, vsaa4, vmu4, vyht4, ven5, vru5, vsu5, vra5, vsa5, vve5, ves5, vit5, vsaa5, vmu5, vyht5, ven6, vru6, vsu6, vra6, vsa6, vve6, ves6, vit6, vsaa6, vmu6, vyht6, veny, vruy, vsuy, vray, vsay, vvey, vesy, vity, vsaay, vmuy, vyht, venn, vrun, vsun, vran, vsan, vven, vesn, vitn, vsaan, vmun, vtyt, ov79yc, ov79nc, yaen1, yaru1, yasu1, yara1, yasa1, yave1, yaes1, yait1, yasaa1, yalat1, yamuu1, yaen2, yaru2, yasu2, yara2, yasa2, yave2, yaes2, yait2, yasaa2, yalat2, yamuu2, yyen, yyru, yysu, yyra, yysa, yen, yru, ysu, yra, ysa, yve, yes, yit, ysaa, ylat, ymuu, enyy, ruyy, suyy, rayy, sayy, veyy, esyy, ityy, saayy, layy, muyy, yaen1n, yaru1n, yasu1n, yara1n, yasa1n, yave1n, yaes1n, yait1n, yasaa1n, yalat1n, yamuu1n, yaen2n, yaru2n, yasu2n, yara2n, yasa2n, yave2n, yaes2n, yait2n, yasaa2n, yalat2n, yamuu2n, yyenn, yyrun, yysun, yyran, yysan, yenn, yrun, ysun, yran, ysan, yven, yesn, yitn, ysaan, ylatn, ymuun, ennn, runn, sunn, rann, sann, vennn, esnn, itnn, saann, lann, munn, asv, arv, asvrv, ysv, yrv, ysvrv, sv, rv, svrv, aev, aort, aisl, amu, aet, aeos, akay, yev, yort, yisl, ymu, yet, yeos, ykay, ev, ort, isl, mu, et, eos, kay, ov89yc, ov89nc, ai, rsb, ma, yl, bi, ge, fy, ke, ter, ue, eti, hi, yh, mus, ku, tt, ts, li, ko, yhd, ain, rsbn, man, yln, bin, gen, fyn, ken, tern, uen, etin, hin, yhn, musn, kun, ttn, tsn, lin, kon, yhdn, tietop, tietok, tietoi, verkko
      --, kaytto, tietolahde, rivinumero
  )  ) AS unpvt
  where lkm_arvo is not null and lkm_arvo <> 0
' 
GO
/****** Object:  View [dbo].[v_f_K2_17_ulkomaalaistaustaiset_opisk_ja_tutk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_K2_17_ulkomaalaistaustaiset_opisk_ja_tutk]'))
EXEC dbo.sp_executesql @statement = N'











/****** Script for SelectTopNRows command from SSMS  ******/


CREATE VIEW [dbo].[v_f_K2_17_ulkomaalaistaustaiset_opisk_ja_tutk] AS

--truncate table f_K2_17_ulkomaalaistaustaiset_opisk_ja_tutk

--insert into f_K2_17_ulkomaalaistaustaiset_opisk_ja_tutk

SELECT  
       tilastovuosi = [tilv]
      ,sukupuoli_avain = [sp]
      ,syntymavuosi = 
			CASE WHEN [syntv] = ''9999'' or syntv IS NULL THEN ''Tuntematon''
			ELSE cast(syntv as varchar(10))
			END
      ,jarjestys_syntymavuosi = 
			CASE WHEN [syntv] = ''9999'' or syntv IS NULL THEN 9999
			ELSE cast(syntv as int)
			END
      ,kotikunta_avain = [tilvaskun]
      ,kotikunta_sama_kuin_edeltavana_vuonna_avain = [tilvaskunsama]
      ,edeltavan_vuoden_asuinpaikka_avain = [oleskelux]
      ,suomeen_muuttamisvuosi = 
			CASE WHEN muuttov IS NULL THEN ''Asunut koko ikänsä Suomessa''
			ELSE cast([muuttov] as Varchar(30))
			END
      ,jarjestys_suomeen_muuttamisvuosi = 
			CASE WHEN muuttov IS NULL THEN 9999
			ELSE cast([muuttov] as int)
			END
      ,aidinkieli_versio4_avain = 
		CASE
			WHEN aikielir4 = ''99'' THEN ''90'' -- ohjataan muuksi tuntemattoman sijaan
			ELSE aikielir4
		END	  
      ,kansalaisuus_avain = [kansalr3]
      ,syntymamaa_avain = [svaltr3]
      ,aidin_syntymamaa_avain = [svaltr3_aiti]
      ,isan_syntymamaa_avain = [svaltr3_isa]
      ,henkilotunnuksen_oikeellisuus_avain = [htok]
      ,koulutusryhma_avain = [klajir1]
      ,opetushallinnon_koulutus_avain = [ophal]
      ,koulutusluokitus_avain = ''OPMOPA'' + [opmopa]
      ,koulutuksen_opetuskieli_avain = [kkieli]
      ,koulutuksen_sijaintikunta_koodi = [kkun]
      ,tutkinnon_aloittamisvuosi = 
			CASE WHEN [alvv] = ''9999'' or alvv is null THEN ''Tuntematon''
			ELSE cast(alvv as varchar(10))
			END
      ,jarjestys_tutkinnon_aloittamisvuosi = 
			CASE WHEN [alvv] = ''9999'' or alvv is null THEN 9999
			ELSE cast(alvv as int)
			END
      ,opiskelijan_olo_avain = [olosyys]
      ,maassaolo_avain = [maassaolo]
      ,osatutkinto_koodi = [osatutk]
      ,aloittaneet = [uusi]
      ,opiskelijat = [opisk]
      ,tutkinnot = [tutk]
      

/*** johdetut dimensiot ***/

      ,tutkinnon_toteuma_avain =   
		CASE 
			WHEN osatutk = 1 THEN 2
			WHEN osatutk = 2 THEN 1
			ELSE -1
		END
      ,aineisto_avain  -- ennakko / lopullinen
      --,aineisto_OTV_avain = ''K2.17a-b''  -- ei tarvita aineistokäsittelynä 28.4.2015
      ,koulutussektori_avain = 
        CASE
			WHEN klajir1 IN (21, 22) THEN 2
			WHEN klajir1 IN (31, 32, 33, 34, 35) THEN 3
			WHEN klajir1 IN (41, 42, 46) THEN 4
			WHEN klajir1 IN (51, 52) THEN 5
			ELSE -1
        END
      ,ika1v_avain = 
		CASE
			WHEN syntv = 9999 THEN -1
			ELSE cast(tilv as int) - syntv
		END
      ,ikaryhma1_avain = 
		CASE
			WHEN syntv = 9999 THEN ''-1''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) >59 THEN ''kirikar160''
			ELSE cast(cast(tilv as int) - syntv as varchar(10))
		END
      ,ikaryhma2_avain = 
		CASE
			WHEN syntv = 9999 THEN ''-1''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) <3 THEN ''ikaryh2_2''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 3 AND 5 THEN ''ikaryh2_5''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) = 6 THEN ''ikaryh2_6''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 7 AND 12 THEN ''ikaryh2_12''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 13 AND 15 THEN ''ikaryh2_15''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 16 AND 18 THEN ''ikaryh2_18''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 19 AND 21 THEN ''ikaryh2_21''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 22 AND 24 THEN ''ikaryh2_24''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 25 AND 29 THEN ''ikaryh2_29''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 30 AND 34 THEN ''ikaryh2_34''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 35 AND 39 THEN ''ikaryh2_39''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 40 AND 44 THEN ''ikaryh2_44''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 45 AND 49 THEN ''ikaryh2_49''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 50 AND 54 THEN ''ikaryh2_54''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 55 AND 59 THEN ''ikaryh2_59''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) between 60 AND 64 THEN ''ikaryh2_64''
			WHEN syntv <> 9999 AND (cast(tilv as int) - syntv) > 64 THEN ''ikaryh2_65''
			ELSE ''-1''
		END
      ,suoritusaika = 
	    CASE
			WHEN alvv = 9999 or alvv IS NULL THEN ''Tuntematon''
			ELSE cast(cast(tilv as int) - alvv as varchar(10))
		END
      ,jarjestys_suoritusaika = 
	    CASE
			WHEN alvv = 9999 or alvv IS NULL THEN 9999
			ELSE cast(tilv as int) - alvv
		END

      ,aidinkieli_versio1_avain =
		CASE
			WHEN aikielir4 IN (''fi'', ''se'') THEN ''fs''
			WHEN aikielir4 IN (''sv'') THEN aikielir4
			ELSE ''99''
		END
     
      ,aidinkieli_versio2_avain =
		CASE
			WHEN aikielir4 IN (''fi'', ''sv'', ''se'') THEN aikielir4
			ELSE ''99''
		END
	  ,maahantulo_ja_toisen_asteen_koul_aloittaminen_avain =   
		CASE
			WHEN klajir1 IN (21, 22, 31, 32, 33, 35) AND muuttov < alvv AND muuttov IS NOT NULL THEN 1 --''Maahantulo ennen opiskelun aloittamisvuotta''
			WHEN klajir1 IN (21, 22, 31, 32, 33, 35) AND muuttov = alvv AND muuttov IS NOT NULL THEN 2 --''Maahantulo opiskelun aloittamisvuonna''
			WHEN muuttov IS NULL THEN 3
			ELSE ''-1''
		END
	  ,maahantulo_ja_korkeakoulutuksen_aloittaminen_avain =  
		CASE
			WHEN klajir1 IN (41, 42, 46, 51, 52) AND muuttov < alvv AND muuttov IS NOT NULL THEN 1 --''Maahantulo ennen opiskelun aloittamisvuotta''
			WHEN klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv AND muuttov IS NOT NULL THEN 2 --''Maahantulo opiskelun aloittamisvuonna''
			WHEN muuttov IS NULL THEN 3
			ELSE ''-1''
		END      

		,koulutuksen_jarjestamismuoto_avain = cast(
		(
			case
				when klajir1 in (''31'',''32'',''33'') then ''1''
				when klajir1 in (''35'') then ''2''
			else ''-1''
			end
		)
		as nvarchar(2))

		
/*** johdetut mittarit ***/

	  ,aloittaneet_ulkomaalaistausta_kielen_mukaan =
		CASE
			WHEN ((aikielir4<>''fi'' AND aikielir4<>''sv'' AND aikielir4<>''se'') 
				OR (aikielir4=''sv'' AND svaltr3_aiti<>246 AND svaltr3_aiti<>248 AND svaltr3_isa<>246 AND svaltr3_isa<>248))
				AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
				AND klajir1 <> 52
			
			THEN uusi
		END	   
	  ,opiskelijat_ulkomaalaistausta_kielen_mukaan =
		CASE
			WHEN ((aikielir4<>''fi'' AND aikielir4<>''sv'' AND aikielir4<>''se'') 
				OR (aikielir4=''sv'' AND svaltr3_aiti<>246 AND svaltr3_aiti<>248 AND svaltr3_isa<>246 AND svaltr3_isa<>248)) 
				AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN opisk											
		END
	  ,tutkinnot_ulkomaalaistausta_kielen_mukaan =
		CASE
			WHEN ((aikielir4<>''fi'' AND aikielir4<>''sv'' AND aikielir4<>''se'') 
				OR (aikielir4=''sv'' AND svaltr3_aiti<>246 AND svaltr3_aiti<>248 AND svaltr3_isa<>246 AND svaltr3_isa<>248)) 
				AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN tutk
		END	
	  ,aloittaneet_ulkomaalaistausta_vanhempien_synnyinmaan_mukaan =
		CASE
			WHEN (svaltr3_aiti<>246 AND svaltr3_aiti<>248 AND svaltr3_isa<>246 AND svaltr3_isa<>248) 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			AND klajir1 <> 52
			THEN uusi
		END
	  ,opiskelijat_ulkomaalaistausta_vanhempien_synnyinmaan_mukaan =
		CASE
			WHEN (svaltr3_aiti<>246 AND svaltr3_aiti<>248 AND svaltr3_isa<>246 AND svaltr3_isa<>248) 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN opisk
		END
	  ,tutkinnot_ulkomaalaistausta_vanhempien_synnyinmaan_mukaan =
		CASE
			WHEN (svaltr3_aiti<>246 AND svaltr3_aiti<>248 AND svaltr3_isa<>246 AND svaltr3_isa<>248) 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN tutk
		END
	  ,aloittaneet_ulkomaalaiset =
		CASE
			WHEN kansalr3<>246 and kansalr3<>248 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			AND klajir1 <> 52
			THEN uusi
		END
	  ,opiskelijat_ulkomaalaiset =
		CASE
			WHEN kansalr3<>246 and kansalr3<>248 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			
			THEN opisk
		END
	  ,tutkinnot_ulkomaalaiset =
		CASE
			WHEN kansalr3<>246 and kansalr3<>248 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN tutk
		END
	  ,aloittaneet_ulkomailla_syntyneet =
		CASE
			WHEN svaltr3<>246 and svaltr3<>248 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			AND klajir1 <> 52
			THEN uusi
		END
	  ,opiskelijat_ulkomailla_syntyneet =
		CASE
			WHEN svaltr3<>246 and svaltr3<>248 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN opisk
		END
	  ,tutkinnot_ulkomailla_syntyneet =
		CASE
			WHEN svaltr3<>246 and svaltr3<>248 
			AND NOT (klajir1 IN (41, 42, 46, 51, 52) AND muuttov = alvv and muuttov IS NOT NULL) 	
			THEN tutk
		END	  
	  
FROM (

SELECT [tilv]
      ,[sp]
      ,[syntv]
      ,[tilvaskun]
      ,[tilvaskunsama]
      ,[oleskelux]
      ,[muuttov]
      ,[aikielir4]
      ,[kansalr3]
      ,[svaltr3]
      ,[svaltr3_aiti]
      ,[svaltr3_isa]
      ,[htok]
      ,[klajir1]
      ,[ophal]
      ,[opmopa]
      ,[kkieli]
      ,[kkun]
      ,[alvv]
      ,[olosyys]
      ,[maassaolo]
      ,[osatutk]
      ,[uusi]
      ,[opisk]
      ,[tutk]
      ,aineisto_avain = ''L''  -- lopullinen
  FROM [VipunenTK_DW].[dbo].[sa_K2_17a_Ulkomaalaistaustaiset_opisk_ja_tutk]

UNION ALL
  
SELECT [tilv]
      ,[sp]
      ,[syntv]
      ,[tilvaskun]
      ,[tilvaskunsama]
      ,[oleskelux]
      ,[muuttov]
      ,[aikielir4]
      ,[kansalr3]
      ,[svaltr3]
      ,[svaltr3_aiti]
      ,[svaltr3_isa]
      ,[htok]
      ,[klajir1]
      ,[ophal]
      ,[opmopa]
      ,[kkieli]
      ,[kkun]
      ,[alvv]
      ,[olosyys]
      ,[maassaolo]
      ,[osatutk]
      ,[uusi]
      ,[opisk]
      ,[tutk]
      ,aineisto_avain = ''E''  -- ennakko
 FROM [VipunenTK_DW].[dbo].[sa_K2_17b_Ulkomaalaistaustaiset_opisk_ja_tutk]  
) ulkomaalaistaustaiset












' 
GO
/****** Object:  View [dbo].[v_f_K3_11_Keskeyttaneet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_K3_11_Keskeyttaneet]'))
EXEC dbo.sp_executesql @statement = N'





























CREATE VIEW [dbo].[v_f_K3_11_Keskeyttaneet] AS
 
SELECT 
       tilastovuosi = ([tilv]+''01'')
      ,tilv_date = [tilv_date]
      ,aineisto = [aineisto]
      ,lahde = [lahde]
      ,sukupuoli = [sp]
      ,aidinkieli_versio1x = [aikielir1]
       ,ika_1v = cast ((cast(tilv as int) - cast(syntv as int)) as nvarchar (10))
      ,ika_5v =cast(
       (
		case
		when (cast(tilv as int) - cast(syntv as int)) < 15 then ''5v10''
		when ((cast(tilv as int) - cast(syntv as int)) >= 15 and (cast(tilv as int) - cast(syntv as int)) <= 19) then ''5v15''
		when ((cast(tilv as int) - cast(syntv as int)) >= 20 and (cast(tilv as int) - cast(syntv as int)) <= 24) then ''5v20''
		when ((cast(tilv as int) - cast(syntv as int)) >= 25 and (cast(tilv as int) - cast(syntv as int)) <= 29) then ''5v25''
		when ((cast(tilv as int) - cast(syntv as int)) >= 30 and (cast(tilv as int) - cast(syntv as int)) <= 34) then ''5v30''
		when ((cast(tilv as int) - cast(syntv as int)) >= 35 and (cast(tilv as int) - cast(syntv as int)) <= 39) then ''5v35''
		when ((cast(tilv as int) - cast(syntv as int)) >= 40 and (cast(tilv as int) - cast(syntv as int)) <= 44) then ''5v40''
		when ((cast(tilv as int) - cast(syntv as int)) >= 45 and (cast(tilv as int) - cast(syntv as int)) <= 49) then ''5v45''
		when ((cast(tilv as int) - cast(syntv as int)) >= 50 and (cast(tilv as int) - cast(syntv as int)) <= 54) then ''5v50''
		when ((cast(tilv as int) - cast(syntv as int)) >= 55 and (cast(tilv as int) - cast(syntv as int)) <= 59) then ''5v55''
		when ((cast(tilv as int) - cast(syntv as int)) >= 60 and (cast(tilv as int) - cast(syntv as int)) <= 64) then ''5v60''
		when ((cast(tilv as int) - cast(syntv as int)) >= 65 and (cast(tilv as int) - cast(syntv as int)) <= 69) then ''5v65''
		when ((cast(tilv as int) - cast(syntv as int)) >= 70 and (cast(tilv as int) - cast(syntv as int)) <= 74) then ''5v70''
		when ((cast(tilv as int) - cast(syntv as int)) >= 75 and (cast(tilv as int) - cast(syntv as int)) <= 79) then ''5v75''
		when ((cast(tilv as int) - cast(syntv as int)) >= 80 and (cast(tilv as int) - cast(syntv as int)) <= 84) then ''5v80''
		when ((cast(tilv as int) - cast(syntv as int)) >= 85 and (cast(tilv as int) - cast(syntv as int)) <= 89) then ''5v85''
		when ((cast(tilv as int) - cast(syntv as int)) >= 90 and (cast(tilv as int) - cast(syntv as int)) <= 94) then ''5v90''
		when ((cast(tilv as int) - cast(syntv as int)) >= 95) then ''5v95''
		
		end
	   ) as nvarchar (10))
      ,kotikunta = cast(
       (
	   case
		when [tilvaskun] = ''999'' then ''-1''
		else [tilvaskun]
		end)as nvarchar (3))

      ,kansalaisuus_versio1 = [kansalr1]
      ,eumaa = [eumaa]
      ,etamaa = [etamaa]
      ,pohjoismaa = [pohjmaa]
      ,kirjoihintulovuosi = [alvv]
      ,kirjoihintulolukukausi = 
	   (case
	when allk = ''1''  then (alvv+''0''+allk)
	when allk = ''2''  then (alvv+''0''+''8'')
	else ''''
	end)
      ,opiskelijan_olo_lk = [ololk]
      ,oppilaitoksen_taustatiedot =[tunn]
	  ,koulutusluokitus = [koulk]
      ,koulutuksen_kieli_versio1 = [kkielir1]
      ,koulutuksen_kunta = cast(
       (
	   case
		when [kkun] = ''999'' then ''-1''
		else [kkun]
		end)as nvarchar (3))
      ,opetushallinnon_koulutus = [ophal]
	  ,hallinnonala2 = 
		case
			when ophal = ''1'' then ''1'' --Opetushallinto, työvoimakoulutus
			when ophal = ''2'' and coalesce(coalesce(d1.koulutuksen_jarjestajan_korvaavakoodi,d1.koulutuksen_jarjestajakoodi),'''') not in (''0145076-7'',''2153105-4'',''150622-3'',''0909306-3'' /*''Ålands Landskapsregering'',''Poliisiammattikorkeakoulu'',''Rikosseuraamusalan Koulutuskeskus'',''Pelastusopisto''*/) then ''2'' --Opetushallinto, pl. työvoimakoulutus
			when ophal = ''2'' then ''3'' --Muiden hallinnonalojen alainen koulutus
			else ''-1''
		end
	
      ,koulutustyyppi = [koultyp]
      ,tutkinnon_suorittamismaakunta = [tutkmaak]
      ,tutkinnon_jarjestaja = [tutkjarj]
      ,tutkinnon_suorittamisoppilaitos = [tutktunn]
      ,tutkinnon_koulutusluokitus = [tutkkoulk]
      ,tutkinnon_koulutustyyppi = [tutkkoultyp]
      ,seuraavan_vuoden_maakunta = [seurvkmaak]
      ,seuraavan_vuoden_jarjestaja = [seurvjarj]
      ,seuraavan_vuoden_oppilaitos = [seurvtunn]
      ,seuraavan_vuoden_koulutusluokitus = [seurvkoulk]
      ,seuraavan_vuoden_koulutustyyppi = [seurvkoultyp]
      ,pääasiallinen_toiminta_versio2 = [ptoim1r2]
      ,ammattiasema = [amas1]
      ,opiskelijat = [lkm]
	  ,[1a_opiskelijoiden_opintojen_kulku_koulutusaste_2002_mukaan]=cast(
       (
	   case
	   --Tutkinto alkuperäisellä koulutusasteella (2002),tavoitetutkinto
		when (([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' )  then ''1''
        --Tutkinto alkuperäisellä koulutusasteella (2002), välitutkinto
		when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		     or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') then ''2''
		--Tutkinto muulla koulutusasteella (2002)
		when [koulk_koulutusaste] <> [tutk_koulutusaste] and ([tutk_koulutusaste] <> NULL or [tutk_koulutusaste] <> '''') then ''3''
		--Opiskelee alkuperäisellä koulutusasteella (2002)
		when [koulk_koulutusaste] = [seurv_koulutusaste] then ''4''
		--Opiskelee muulla koulutusastella (2002)
		when [koulk_koulutusaste] <> [seurv_koulutusaste] and ([seurv_koulutusaste] <> NULL or [seurv_koulutusaste]<> '''') then ''5''
		--Keskeyttänyt työllinen
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''10'' then ''6''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		--Keskeyttänyt työtön
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''12'' then ''7''
        --Keskeyttänyt muu
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''')  and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''8''
	    else ''-1''
         end
		
	   ) as nvarchar (2))
	  ,[1b_opiskelijoiden_opintojen_kulku_koulutusaste_2002_mukaan]=cast(
        (
	   case
	   --Tutkinto alkuperäisellä koulutusasteella (2002),tavoitetutkinto
		when (([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' )  then ''1''
        --Tutkinto alkuperäisellä koulutusasteella (2002), välitutkinto
		when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		     or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') then ''2''
		--Opiskelee alkuperäisellä koulutusasteella (2002)
		when [koulk_koulutusaste] = [seurv_koulutusaste] then ''4''
		----Tutkinto muulla koulutusasteella (2002)
		when [koulk_koulutusaste] <> [tutk_koulutusaste] and ([tutk_koulutusaste] <> NULL or [tutk_koulutusaste] <> '''') then ''3'' 
        ----Opiskelee muulla koulutusastella (2002)
		when [koulk_koulutusaste] <> [seurv_koulutusaste] and ([seurv_koulutusaste] <> NULL or [seurv_koulutusaste]<> '''') then ''5''
		--Keskeyttänyt työllinen
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''10'' then ''6''
		----Keskeyttänyt työtön
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''12'' then ''7''
        --Keskeyttänyt muu
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''')  and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''8''
		else ''-1''
         end
		
	   ) as nvarchar (2))


	   ,[1c_tutkinto_alkuperaisella_koulutusasteella_2002]=cast(
        (
	   
        case
	  	when (([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' )  then ''1''

		when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		     or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') then ''2''
		else ''3''
		end
		
	   ) as nvarchar (2))



	   ,[1d_tutkinto_muulla_koulutusasteella_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusaste] <> [tutk_koulutusaste] and ([tutk_koulutusaste] <> NULL or [tutk_koulutusaste] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	   ,[1e_jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusaste]= [seurv_koulutusaste]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))

	   ,[1f_jatkaa_opiskelua_muulla_koulutusasteella_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusaste]<> [seurv_koulutusaste] and ([seurv_koulutusaste] <> NULL or [seurv_koulutusaste] <> '''')  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	  ,[2a_opiskelijoiden_opintojen_kulku_koulutusala_2002_mukaan]=cast(
       (
	    case
		--Tutkinto alkuperäisellä opintoalalla (2002)
	    when [koulk_koulutusala]= [tutk_koulutusala]  then ''1''
		--Tutkinto muulla opintoalalla (2002)
		when [koulk_koulutusala] <> [tutk_koulutusala] and ([tutk_koulutusala] <> NULL or [tutk_koulutusala] <> '''') then ''2''
		--Opiskelee alkuperäisellä opintoalalla (2002)
		when [koulk_koulutusala] = [seurv_koulutusala] then ''3''
		--Opiskelee muulla opintoalalla (2002)
		when [koulk_koulutusala] <> [seurv_koulutusala] and ([seurv_koulutusala] <> NULL or [seurv_koulutusala] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''')and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
	   ) as nvarchar (2))
	  ,[2b_opiskelijoiden_opintojen_kulku_koulutusala_2002_mukaan]=cast(
       (
	   case
	   --Tutkinto alkuperäisellä opintoalalla (2002)
		when [koulk_koulutusala]= [tutk_koulutusala]  then ''1''
		--Opiskelee alkuperäisellä opintoalalla (2002)
		when [koulk_koulutusala] = [seurv_koulutusala] then ''3''
		--Tutkinto muulla opintoalalla (2002)
		when [koulk_koulutusala] <> [tutk_koulutusala] and ([tutk_koulutusala] <> NULL or [tutk_koulutusala] <> '''') then ''2''
		--Opiskelee muulla opintoalalla (2002)
		when [koulk_koulutusala] <> [seurv_koulutusala] and ([seurv_koulutusala] <> NULL or [seurv_koulutusala] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	   ,[2bb_opiskelijoiden_opintojen_kulku_koulutusala_2002_mukaan]=cast(
       (
	   case
	   --Suorittanut tavoitetutkinnon
		when (([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' )  then ''1''

        -- Jatkaa opiskelua samalla koulutusalalla
        when( ([koulk_koulutusaste] = [seurv_koulutusaste] or ([koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'') or ([koulk_koulutusaste]= ''72'' and [seurv_koulutusaste] = ''63''))
		 and ([koulk_koulutusala] = [seurv_koulutusala])
		  )  then ''2''

		-- Jatkaa opiskelua muulla koulutusalalla
		 when( ([koulk_koulutusaste] = [seurv_koulutusaste] or [koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'' )
		 and ([koulk_koulutusala] <> [seurv_koulutusala])
		  )  then ''3''
        -- Suorittanut kandidaatin tutkinnon ja keskeyttänyt
        when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		  or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') then ''4'' 
        -- Opiskelee tai tehnyt tutkinnon muulla koulutussektorilla
		when ([koulk_koulutusaste] <> [tutk_koulutusaste] or [koulk_koulutusaste] <> [seurv_koulutusaste] ) then ''5''
		-- keskeyttänyt työllinen
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and ptoim1r2= ''10'' then ''6''

	    --keskeyttänyt työtön
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and ptoim1r2= ''12'' then ''7''
        --keskeyttänyt muu
		when ([tutk_koulutusala] is NULL or [tutk_koulutusala] = '''') and
		     ([seurv_koulutusala] is NULL or [seurv_koulutusala] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''8''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	   ,[2c_tutkinto_alkuperaisella_koulutusalalla_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusala]= [tutk_koulutusala]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	   ,[2d_tutkinto_muulla_koulutusalalla_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusala]<> [tutk_koulutusala] and ([tutk_koulutusala] <> NULL or [tutk_koulutusala] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	   ,[2e_jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusala]= [seurv_koulutusala]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	   ,[2f_jatkaa_opiskelua_muulla_koulutusalalla_2002]=cast(
        (
	   
        case
	    when [koulk_koulutusala]<> [seurv_koulutusala] and ([seurv_koulutusala] <> NULL or [seurv_koulutusala] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	 ,[3a_opiskelijoiden_opintojen_kulku_opintoala_2002_mukaan]=cast(
     (
	    case
		--Tutkinto alkuperäisellä opintoalalla (2002)
	    when [koulk_opintoala]= [tutk_opintoala]  then ''1''
		--Tutkinto muulla opintoalalla (2002)
		when [koulk_opintoala] <> [tutk_opintoala] and ([tutk_opintoala] <> NULL or [tutk_opintoala] <> '''') then ''2''
		--Opiskelee alkuperäisellä opintoalalla (2002)
		when [koulk_opintoala] = [seurv_opintoala] then ''3''
		--Opiskelee muulla opintoalalla (2002)
		when [koulk_opintoala] <> [seurv_opintoala] and ([seurv_opintoala] <> NULL or [seurv_opintoala] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and ptoim1r2= ''12'' then ''6''
        --Keskeyttänyt muu
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
	   ) as nvarchar (2))
	 ,[3b_opiskelijoiden_opintojen_kulku_opintoala_2002_mukaan]=cast(
       (
	   case
	   --Tutkinto alkuperäisellä opintoalalla (2002)
		when [koulk_opintoala]= [tutk_opintoala]  then ''1''
		--Opiskelee alkuperäisellä opintoalalla (2002)
		when [koulk_opintoala] = [seurv_opintoala] then ''3''
		--Tutkinto muulla opintoalalla (2002)
		when [koulk_opintoala] <> [tutk_opintoala] and ([tutk_opintoala] <> NULL or [tutk_opintoala] <> '''') then ''2''
		--Opiskelee muulla opintoalalla (2002)
		when [koulk_opintoala] <> [seurv_opintoala] and ([seurv_opintoala] <> NULL or [seurv_opintoala] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and ptoim1r2= ''10'' then ''5''
        --Keskeyttänyt työtön
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and ptoim1r2= ''12'' then ''6''
	    --Keskeyttänyt muu
			when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	 	   ,[3bb_opiskelijoiden_opintojen_kulku_opintoala_2002_mukaan]=cast(
       (
	   case
	   -- Tutkinto alkuperäisellä koulutusasteella (2002), tavoitetutkinto
		when (([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' )  then ''1''

        -- Opiskelee alkuperäisellä opintoalalla (2002)
        when( ([koulk_koulutusaste] = [seurv_koulutusaste] or [koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'' )
		 and ([koulk_opintoala] = [seurv_opintoala])
		  )  then ''2''

		-- Opiskelee muulla opintoalalla (2002)
		 when( ([koulk_koulutusaste] = [seurv_koulutusaste] or [koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'' )
		 and ([koulk_opintoala] <> [seurv_opintoala])
		  )  then ''3''
        -- Tutkinto alkuperäisellä koulutusasteella (2002), välitutkinto
        when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		  or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') then ''4'' 
        -- Opiskelee muulla koulutusasteella (2002) tai tutkinto muulla koulutusasteella (2002)
		when ([koulk_koulutusaste] <> [tutk_koulutusaste] or [koulk_koulutusaste] <> [seurv_koulutusaste] ) then ''5''
		-- keskeyttänyt työllinen
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and ptoim1r2= ''10'' then ''6''

	    --keskeyttänyt työtön
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and ptoim1r2= ''12'' then ''7''
        --keskeyttänyt muu
		when ([tutk_opintoala] is NULL or [tutk_opintoala] = '''') and
		     ([seurv_opintoala] is NULL or [seurv_opintoala] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''8''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	  ,[3c_tutkinto_alkuperaisella_opintoalalla_2002]=cast(
        (
	   
        case
	    when [koulk_opintoala]= [tutk_opintoala]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[3d_tutkinto_muulla_opintoalalla_2002]=cast(
        (
	   
        case
	    when [koulk_opintoala]<> [tutk_opintoala] and ([tutk_opintoala] <> NULL or [tutk_opintoala] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))

	   ,[3e_jatkaa_opiskelua_alkuperaisella_opintoalalla_2002]=cast(
        (
	   
        case
	    when [koulk_opintoala]= [seurv_opintoala]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[3f_jatkaa_opiskelua_muulla_opintoalalla_2002]=cast(
        (
	   
        case
	    when [koulk_opintoala]<>[seurv_opintoala] and ([seurv_opintoala] <> NULL or [seurv_opintoala] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))

	  ,[4a_opiskelijoiden_opintojen_kulku_koul_jarjestajan_mukaan]=cast(
     (
	    case
		--Tutkinto alkuperäisellä koulutuksen järjestäjällä
	    when [jarj]= [tutkjarj]  then ''1''
		--Tutkinto muulla koulutuksen järjestäjällä
		when [jarj] <> [tutkjarj] and ([tutkjarj] <> NULL or [tutkjarj] <> '''') then ''2''
		--Opiskelee alkuperäisellä koulutuksen järjestäjällä
		when [jarj] = [seurvjarj] then ''3''
		--Opiskelee muulla koulutuksen järjestäjällä
		when [jarj] <> [seurvjarj] and ([seurvjarj] <> NULL or [seurvjarj] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
	   ) as nvarchar (2))
	  ,[4b_opiskelijoiden_opintojen_kulku_koul_jarjestajan_mukaan]=cast(
       (
	   case
	   ----Tutkinto alkuperäisellä koulutuksen järjestäjällä
		when [jarj]= [tutkjarj]  then ''1''
		--Opiskelee alkuperäisellä koulutuksen järjestäjällä
		when [jarj] = [seurvjarj] then ''3''
		--Tutkinto muulla koulutuksen järjestäjällä
		when [jarj] <> [tutkjarj] and ([tutkjarj] <> NULL or [tutkjarj] <> '''') then ''2''
		----Opiskelee muulla koulutuksen järjestäjällä
		when [jarj] <> [seurvjarj] and ([seurvjarj] <> NULL or [seurvjarj] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and ptoim1r2= ''12'' then ''6''
        --Keskeyttänyt muu
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''')  and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	,[4bb_opiskelijoiden_opintojen_kulku_koul_jarjestajan_mukaan]=cast(
       (
	   case
	   -- Tutkinto alkuperäisellä koulutusasteella (2002), tavoitetutkinto
		when (([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' )  then ''1''

        -- Opiskelee alkuperäisellä koulutuksen järjestäjällä
        when( ([koulk_koulutusaste] = [seurv_koulutusaste] or [koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'' )
		 and ([jarj] = [seurvjarj])
		  )  then ''2''

		-- Opiskelee muulla koulutuksen järjestäjällä
		 when( ([koulk_koulutusaste] = [seurv_koulutusaste] or [koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'' )
		 and ([jarj] <> [seurvjarj])
		  )  then ''3''
        -- Tutkinto alkuperäisellä koulutusasteella (2002), välitutkinto
        when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		  or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') then ''4'' 
        -- Opiskelee muulla koulutusasteella (2002) tai tutkinto muulla koulutusasteella (2002)
		when ([koulk_koulutusaste] <> [tutk_koulutusaste] or [koulk_koulutusaste] <> [seurv_koulutusaste] ) then ''5''
		-- keskeyttänyt työllinen
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and ptoim1r2= ''10'' then ''6''

	    --keskeyttänyt työtön
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and ptoim1r2= ''12'' then ''7''
        --keskeyttänyt muu
		when ([tutkjarj] is NULL or [tutkjarj] = '''') and
		     ([seurvjarj] is NULL or [seurvjarj] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''8''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	    ,[4c_tutkinto_alkuperaisella_koulutuksen_jarjestajalla]=cast(
        (
	   
        case
	    when [jarj]= [tutkjarj]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))

	   ,[4d_tutkinto_muulla_koulutuksen_jarjestajalla]=cast(
        (
	   
        case
	    when [jarj]<> [tutkjarj] and ([tutkjarj] <> NULL or [tutkjarj] <> '''')   then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	   ,[4e_jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla]=cast(
        (
	   
        case
	    when [tutkjarj]= [seurvjarj]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	   ,[4f_jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla]=cast(
        (
	   
        case
	    when [tutkjarj]<> [seurvjarj] and ([seurvjarj] <> NULL or [seurvjarj] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))


	  ,[5a_opiskelijoiden_opintojen_kulku_oppilaitoksen_mukaan]=cast(
      (
	    case
		--Tutkinto alkuperäisessä oppilaitoksessa
	    when [tunn]= [tutktunn]  then ''1''
		--Tutkinto muussa oppilaitoksessa
		when [tunn] <> [tutktunn] and ([tutktunn] <> NULL or [tutktunn] <> '''') then ''2''
		--Opiskelee alkuperäisessä  oppilaitoksessa
		when [tunn] = [seurvtunn] then ''3''
		--Opiskelee muussa oppilaitoksessa
		when [tunn] <> [seurvtunn] and ([seurvtunn] <> NULL or [seurvtunn] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
	   ) as nvarchar (2))
	 ,[5b_opiskelijoiden_opintojen_kulku_oppilaitoksen_mukaan]=cast(
     (
	   case
	   ----Tutkinto alkuperäisessä oppilaitoksessa
		when [tunn]= [tutktunn]  then ''1''
		--Opiskelee alkuperäisessä  oppilaitoksessa
		when [tunn] = [seurvtunn] then ''3''
		--Tutkinto muussa oppilaitoksessa
		when [tunn] <> [tutktunn] and ([tutktunn] <> NULL or [tutktunn] <> '''') then ''2''
		--Opiskelee muussa oppilaitoksessa
		when [tunn] <> [seurvtunn] and ([seurvtunn] <> NULL or [seurvtunn] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
		
	   ) as nvarchar (2))

	   ,[5bb_opiskelijoiden_opintojen_kulku_oppilaitoksen_mukaan]=cast(
       (
	   case
	   -- Suorittanut tavoitetutkinnon
		when ((([koulk_koulutusaste]= [tutk_koulutusaste] and (koulk_koulutusaste <> ''63'' and tutk_koulutusaste <> ''63''))
		      
		      or  [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''72''  )  
		      or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''612101'' )
			  or ([koulk_koulutusaste]= ''63'' and [tutkkoulk] = ''672401'' ))  then ''1''

        -- Jatkaa opiskelua samassa korkeakoulussa 
        when( 

		([koulk_koulutusaste] = [seurv_koulutusaste] or ([koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'') or ([koulk_koulutusaste]= ''72'' and [seurv_koulutusaste] = ''63''))
		 
		 and 
		 
		(select top 1 coalesce(nullif(oppilaitoksen_korvaavakoodi,''''), tunn) FROM [VipunenTK].[dbo].[d_oppilaitoksen_taustatiedot_historia] where [tunn]=oppilaitoskoodi and tilv+''-01-01'' between
	     alkaa and paattyy)  = [seurvtunn])

		 then ''2''

		-- Jatkaa opiskelua muussa korkeakoulussa
		 when( ([koulk_koulutusaste] = [seurv_koulutusaste] or [koulk_koulutusaste]= ''63'' and [seurv_koulutusaste] = ''72'' )
		 and ([tunn] <> [seurvtunn])
		  )  then ''3''
        -- Suorittanut kandidaatin tutkinnon ja keskeyttänyt
        when ( [koulk_koulutusaste]= ''63'' and [tutk_koulutusaste] = ''63''
		  or  [koulk_koulutusaste]= ''72'' and [tutk_koulutusaste] = ''63'') and (ptoim1r2<> ''13'' and ptoim1r2 <> ''22'') then ''4'' 
        -- Opiskelee tai tehnyt tutkinnon muulla koulutussektorilla
		--when ([koulk_koulutusaste] <> [tutk_koulutusaste] or [koulk_koulutusaste] <> [seurv_koulutusaste] ) then ''5''
		when (([koulk_koulutusaste] <> [tutk_koulutusaste]) or (ptoim1r2= ''13'' or ptoim1r2 = ''22'') ) then ''5''
		-- keskeyttänyt työllinen
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and ptoim1r2= ''10'' then ''6''

	    --keskeyttänyt työtön
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and ptoim1r2= ''12'' then ''7''
        --keskeyttänyt muu
		when ([tutktunn] is NULL or [tutktunn] = '''') and
		     ([seurvtunn] is NULL or [seurvtunn] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''8''
		else ''-1''
         end
		
	   ) as nvarchar (2))


	  ,[5c_tutkinto_alkuperaisessa_oppilaitoksessa]=cast(
        (
	   
        case
	    when [tunn]= [tutktunn]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[5d_tutkinto_muussa_oppilaitoksessa]=cast(
        (
	   
        case
	     when [tunn]<> [tutktunn] and ([tutktunn] <> NULL or [tutktunn] <> '''') then ''1''
		 else ''2''
		end
		
	   ) as nvarchar (2))

	   ,[5e_jatkaa_opiskelua_alkuperaisella_oppilaitoksessa]=cast(
        (
	   
        case
	    when [tutktunn]= [seurvtunn]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[5f_jatkaa_opiskelua_muussa_oppilaitoksessa]=cast(
        (
	   
        case
	    when [tutktunn]<>[seurvtunn] and ([seurvtunn] <> NULL or [seurvtunn] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	  ,[6a_opiskelijoiden_opintojen_kulku_maakunnan_mukaan]=cast(
      (
	    case
		--Tutkinto alkuperäisessä maakunnassa
	    when [kkun_kmaak]= [tutkmaak]  then ''1''
		--Tutkinto muussa maakunnassa
		when [kkun_kmaak] <> [tutkmaak] and ([tutkmaak] <> NULL or [tutkmaak] <> '''')then ''2''
		--Opiskelee alkuperäisessä maakunnassa
		when [kkun_kmaak] = [seurvkmaak] then ''3''
		--Opiskelee muussa maakunnassa
		when [kkun_kmaak] <> [seurvkmaak] and ([seurvkmaak] <> NULL or [seurvkmaak] <> '''') then ''4''
		--Keskeyttänyt työllinen
		when ([tutkmaak] is NULL or [tutkmaak] = '''') and
		     ([seurvkmaak] is NULL or [seurvkmaak] = '''') and ptoim1r2= ''10'' then ''5''
		--Keskeyttänyt työtön
		when ([tutkmaak] is NULL or [tutkmaak] = '''') and
		     ([seurvkmaak] is NULL or [seurvkmaak] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutkmaak] is NULL or [tutkmaak] = '''') and
		     ([seurvkmaak] is NULL or [seurvkmaak] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
	   ) as nvarchar (2))
	 ,[6b_opiskelijoiden_opintojen_kulku_maakunnan_mukaan]=cast(
     (
	   case
	   --Tutkinto alkuperäisessä maakunnassa
		when [kkun_kmaak]= [tutkmaak]  then ''1''
		----Opiskelee alkuperäisessä maakunnassa
		when [kkun_kmaak] = [seurvkmaak] then ''3''
		----Tutkinto muussa maakunnassa
		when [kkun_kmaak] <> [tutkmaak] and ([tutkmaak] <> NULL or [tutkmaak] <> '''') then ''2''
		--Opiskelee muussa maakunnassa
		when [kkun_kmaak] <> [seurvkmaak] and ([seurvkmaak] <> NULL or [seurvkmaak] <> '''')  then ''4''
		--Keskeyttänyt työllinen
		when ([tutkmaak] is NULL or [tutkmaak] = '''') and
		     ([seurvkmaak] is NULL or [seurvkmaak] = '''') and ptoim1r2= ''10'' then ''5''
		----Keskeyttänyt työtön
		when ([tutkmaak] is NULL or [tutkmaak] = '''') and
		     ([seurvkmaak] is NULL or [seurvkmaak] = '''') and ptoim1r2= ''12'' then ''6''
		--Keskeyttänyt muu
		when ([tutkmaak] is NULL or [tutkmaak] = '''') and
		     ([seurvkmaak] is NULL or [seurvkmaak] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
		
	   ) as nvarchar (2))


	 ,[6c_tutkinto_alkuperaisessa_maakunnassa]=cast(
        (
	   
        case
	    when [kkun_kmaak]= [tutkmaak]  then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[6d_tutkinto_muussa_maakunnassa]=cast(
        (
	   
        case
	     when [kkun_kmaak]<> [tutkmaak] and ([tutkmaak] <> NULL or [tutkmaak] <> '''')  then ''1''
		 else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[6e_jatkaa_opiskelua_alkuperaisella_maakunnassa]=cast(
        (
	   
        case
	     when [tutkmaak]= [seurvkmaak]  then ''1''
		 else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[6f_jatkaa_opiskelua_muussa_maakunnassa]=cast(
        (
	   
        case
	    when [tutkmaak]<> [seurvkmaak] and ([seurvkmaak] <> NULL or [seurvkmaak] <> '''') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	  ,[7a_opiskelijoiden_opintojen_kulku_koulutussektorin_mukaan]=cast(
      (
	    case
	    when ([lahde]=''21'' and  [tutk_koulutusaste] = ''31'')
		    or ([lahde]=''31'' and  [tutk_koulutusaste] = ''32'')
			or ([lahde]=''41'' and  [tutk_koulutusaste] = ''62'')
			or ([lahde]=''51'' and  [tutk_koulutusaste] = ''31'') then ''1''

		when (
		       ([lahde]=''21'' and  [tutk_koulutusaste] <> ''31'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
		    or ([lahde]=''31'' and  [tutk_koulutusaste] <> ''32'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
			or ([lahde]=''41'' and  [tutk_koulutusaste] <> ''62'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
			or ([lahde]=''51'' and  [tutk_koulutusaste] <> ''31''and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL)) )  then ''2''
		when ([lahde]=''21'' and  [seurv_koulutusaste] = ''31'')
		    or ([lahde]=''31'' and  [seurv_koulutusaste] = ''32'')
			or ([lahde]=''41'' and  [seurv_koulutusaste] = ''62'')
			or ([lahde]=''51'' and  [seurv_koulutusaste] = ''31'') then ''3''
		when (
		       ([lahde]=''21'' and  [seurv_koulutusaste] <> ''31'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
		    or ([lahde]=''31'' and  [seurv_koulutusaste] <> ''32'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
			or ([lahde]=''41'' and  [seurv_koulutusaste] <> ''62''and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL ))
			or ([lahde]=''51'' and  [seurv_koulutusaste] <> ''31'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))  )  then ''4''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''10'' then ''5''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''12'' then ''6''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
	   ) as nvarchar (2))
	 ,[7b_opiskelijoiden_opintojen_kulku_koulutussektorin_mukaan]=cast(
     (
	   case
		 when ([lahde]=''21'' and  [tutk_koulutusaste] = ''31'')
		    or ([lahde]=''31'' and  [tutk_koulutusaste] = ''32'')
			or ([lahde]=''41'' and  [tutk_koulutusaste] = ''62'')
			or ([lahde]=''51'' and  [tutk_koulutusaste] = ''31'') then ''1''
		when ([lahde]=''21'' and  [seurv_koulutusaste] = ''31'')
		    or ([lahde]=''31'' and  [seurv_koulutusaste] = ''32'')
			or ([lahde]=''41'' and  [seurv_koulutusaste] = ''62'')
			or ([lahde]=''51'' and  [seurv_koulutusaste] = ''31'') then ''3''
		when (
		       ([lahde]=''21'' and  [tutk_koulutusaste] <> ''31'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
		    or ([lahde]=''31'' and  [tutk_koulutusaste] <> ''32'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
			or ([lahde]=''41'' and  [tutk_koulutusaste] <> ''62'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
			or ([lahde]=''51'' and  [tutk_koulutusaste] <> ''31'' and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL)))  then ''2''
		when (
		       ([lahde]=''21'' and  [seurv_koulutusaste] <> ''31'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
		    or ([lahde]=''31'' and  [seurv_koulutusaste] <> ''32'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
			or ([lahde]=''41'' and  [seurv_koulutusaste] <> ''62'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
			or ([lahde]=''51'' and  [seurv_koulutusaste] <> ''31'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))) then ''4''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''10'' then ''5''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and ptoim1r2= ''12'' then ''6''
		when ([tutk_koulutusaste] is NULL or [tutk_koulutusaste] = '''') and
		     ([seurv_koulutusaste] is NULL or [seurv_koulutusaste] = '''') and (ptoim1r2 <> ''10'' and ptoim1r2<> ''12'' or ptoim1r2 is NULL) then ''7''
		else ''-1''
         end
		
	   ) as nvarchar (2))
	  ,[7c_tutkinto_alkuperaisella_koulutussektorilla]=cast(
        (
	   
        case
	     when ([lahde]=''21'' and  [tutk_koulutusaste] = ''31'')
		    or ([lahde]=''31'' and  [tutk_koulutusaste] = ''32'')
			or ([lahde]=''41'' and  [tutk_koulutusaste] = ''62'')
			or ([lahde]=''51'' and  [tutk_koulutusaste] = ''31'') then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[7d_tutkinto_muulla_koulutussektorilla]=cast(
        (
	   
        case
	     when (([lahde]=''21'' and  [tutk_koulutusaste] <> ''31''  and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
		    or ([lahde]=''31'' and  [tutk_koulutusaste] <> ''32''  and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
			or ([lahde]=''41'' and  [tutk_koulutusaste] <> ''62''  and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))
			or ([lahde]=''51'' and  [tutk_koulutusaste] <> ''31''   and ([tutk_koulutusaste] <> '''' or [tutk_koulutusaste] <> NULL))) then ''1''
		 else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[7e_jatkaa_opiskelua_alkuperaisella_koulutussektorilla]=cast(
        (
	   
        case
	     when ([lahde]=''21'' and  [seurv_koulutusaste] = ''31'')
		    or ([lahde]=''31'' and  [seurv_koulutusaste] = ''32'')
			or ([lahde]=''41'' and  [seurv_koulutusaste] = ''62'')
			or ([lahde]=''51'' and  [seurv_koulutusaste] = ''31'')  then ''1''
		 else ''2''
		end
		
	   ) as nvarchar (2))
	   ,[7f_jatkaa_opiskelua_muulla_koulutussektorilla]=cast(
        (
	   
        case
	   when (([lahde]=''21'' and  [seurv_koulutusaste] <> ''31'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
		    or ([lahde]=''31'' and  [seurv_koulutusaste] <> ''32'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
			or ([lahde]=''41'' and  [seurv_koulutusaste] <> ''62'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))
			or ([lahde]=''51'' and  [seurv_koulutusaste] <> ''31'' and ([seurv_koulutusaste] <> '''' or [seurv_koulutusaste] <> NULL))) then ''1''
		else ''2''
		end
		
	   ) as nvarchar (2))



FROM [VipunenTK_DW].[dbo].[sa_K3_11_ Tutkinnon suorittaneiden osuus poistumasta]
left join VipunenTK.dbo.d_oppilaitoksen_taustatiedot d1 on d1.oppilaitos_avain=tunn
where aineisto = ''L''






























' 
GO
/****** Object:  View [dbo].[v_f_K3_16_Moninkertainen_haku]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_K3_16_Moninkertainen_haku]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_K3_16_Moninkertainen_haku] AS

-- truncate table VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
-- insert into VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku select * from VipunenTK_DW.dbo.v_f_K3_16_Moninkertainen_haku

-- Drop table VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
-- Select * into VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku from VipunenTK_DW.dbo.v_f_K3_16_Moninkertainen_haku


SELECT Tilastovuosi = [tilv]
      ,[tilv_date]
	  ,Koulutuksen_alkamislukukausi_avain = [tilv] + [allk]
      ,Koulutuksen_alkamislukukausi = [allk]
      ,[luammhaku1_tunn]
      ,[luammhaku2_tunn]
      ,[luammhaku3_tunn]
      ,[luammhaku4_tunn]
      ,[luammhaku5_tunn]
      ,[luammhaku1_opmast_avain] = ''OPMAST'' + [luammhaku1_opmast]
      ,[luammhaku2_opmast_avain] = ''OPMAST'' + [luammhaku2_opmast]
      ,[luammhaku3_opmast_avain] = ''OPMAST'' + [luammhaku3_opmast]
      ,[luammhaku4_opmast_avain] = ''OPMAST'' + [luammhaku4_opmast]
      ,[luammhaku5_opmast_avain] = ''OPMAST'' + [luammhaku5_opmast]
      ,[luammhaku1_opmopa_avain] = ''OPMOPA'' + [luammhaku1_opmopa]
      ,[luammhaku2_opmopa_avain] = ''OPMOPA'' + [luammhaku2_opmopa]
      ,[luammhaku3_opmopa_avain] = ''OPMOPA'' + [luammhaku3_opmopa]
      ,[luammhaku4_opmopa_avain] = ''OPMOPA'' + [luammhaku4_opmopa]
      ,[luammhaku5_opmopa_avain] = ''OPMOPA'' + [luammhaku5_opmopa]
      ,[luammhaku1_opm95opa_avain] = ''OPM95OPA'' + [luammhaku1_opm95opa]
      ,[luammhaku2_opm95opa_avain] = ''OPM95OPA'' + [luammhaku2_opm95opa]
      ,[luammhaku3_opm95opa_avain] = ''OPM95OPA'' + [luammhaku3_opm95opa]
      ,[luammhaku4_opm95opa_avain] = ''OPM95OPA'' + [luammhaku4_opm95opa]
      ,[luammhaku5_opm95opa_avain] = ''OPM95OPA'' + [luammhaku5_opm95opa]
      ,[luammhaku1_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku1_opmopa])
      ,[luammhaku2_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku2_opmopa])
      ,[luammhaku3_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku3_opmopa])
      ,[luammhaku4_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku4_opmopa])
      ,[luammhaku5_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku5_opmopa])
      ,[luammhaku1_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku1_opm95opa])
      ,[luammhaku2_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku2_opm95opa])
      ,[luammhaku3_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku3_opm95opa])
      ,[luammhaku4_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku4_opm95opa])
      ,[luammhaku5_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku5_opm95opa])
      ,[luammhaku1_opmast] = [luammhaku1_opmast]
      ,[luammhaku2_opmast] = [luammhaku2_opmast]
      ,[luammhaku3_opmast] = [luammhaku3_opmast]
      ,[luammhaku4_opmast] = [luammhaku4_opmast]
      ,[luammhaku5_opmast] = [luammhaku5_opmast]
      ,[luammhaku1_opmopa] = [luammhaku1_opmopa]
      ,[luammhaku2_opmopa] = [luammhaku2_opmopa]
      ,[luammhaku3_opmopa] = [luammhaku3_opmopa]
      ,[luammhaku4_opmopa] = [luammhaku4_opmopa]
      ,[luammhaku5_opmopa] = [luammhaku5_opmopa]
      ,[luammhaku1_opm95opa] = [luammhaku1_opm95opa]
      ,[luammhaku2_opm95opa] = [luammhaku2_opm95opa]
      ,[luammhaku3_opm95opa] = [luammhaku3_opm95opa]
      ,[luammhaku4_opm95opa] = [luammhaku4_opm95opa]
      ,[luammhaku5_opm95opa] = [luammhaku5_opm95opa]
      ,[luammhaku1_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku1_opmopa])
      ,[luammhaku2_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku2_opmopa])
      ,[luammhaku3_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku3_opmopa])
      ,[luammhaku4_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku4_opmopa])
      ,[luammhaku5_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[luammhaku5_opmopa])
      ,[luammhaku1_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku1_opm95opa])
      ,[luammhaku2_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku2_opm95opa])
      ,[luammhaku3_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku3_opm95opa])
      ,[luammhaku4_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku4_opm95opa])
      ,[luammhaku5_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[luammhaku5_opm95opa])
      ,[luammhaku1_okieli]
      ,[luammhaku2_okieli]
      ,[luammhaku3_okieli]
      ,[luammhaku4_okieli]
      ,[luammhaku5_okieli]
      ,[luammhaku1_hyv]
      ,[luammhaku2_hyv]
      ,[luammhaku3_hyv]
      ,[luammhaku4_hyv]
      ,[luammhaku5_hyv]
      ,[luammhaku1_vastotto]
      ,[luammhaku2_vastotto]
      ,[luammhaku3_vastotto]
      ,[luammhaku4_vastotto]
      ,[luammhaku5_vastotto]
      ,[amkhaku1_tunn]
      ,[amkhaku2_tunn]
      ,[amkhaku3_tunn]
      ,[amkhaku4_tunn]
      ,[amkhakum_tunn]
      ,[amkhaku1_opmast_avain] = ''OPMAST'' + [amkhaku1_opmast]
      ,[amkhaku2_opmast_avain] = ''OPMAST'' + [amkhaku2_opmast]
      ,[amkhaku3_opmast_avain] = ''OPMAST'' + [amkhaku3_opmast]
      ,[amkhaku4_opmast_avain] = ''OPMAST'' + [amkhaku4_opmast]
      ,[amkhakum_opmast_avain] = ''OPMAST'' + [amkhakum_opmast]
      ,[amkhaku1_opmopa_avain] = ''OPMOPA'' + [amkhaku1_opmopa]
      ,[amkhaku2_opmopa_avain] = ''OPMOPA'' + [amkhaku2_opmopa]
      ,[amkhaku3_opmopa_avain] = ''OPMOPA'' + [amkhaku3_opmopa]
      ,[amkhaku4_opmopa_avain] = ''OPMOPA'' + [amkhaku4_opmopa]
      ,[amkhakum_opmopa_avain] = ''OPMOPA'' + [amkhakum_opmopa]
      ,[amkhaku1_opm95opa_avain] = ''OPM95OPA'' + [amkhaku1_opm95opa]
      ,[amkhaku2_opm95opa_avain] = ''OPM95OPA'' + [amkhaku2_opm95opa]
      ,[amkhaku3_opm95opa_avain] = ''OPM95OPA'' + [amkhaku3_opm95opa]
      ,[amkhaku4_opm95opa_avain] = ''OPM95OPA'' + [amkhaku4_opm95opa]
      ,[amkhakum_opm95opa_avain] = ''OPM95OPA'' + [amkhakum_opm95opa]
      ,[amkhaku1_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku1_opmopa])
      ,[amkhaku2_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku2_opmopa])
      ,[amkhaku3_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku3_opmopa])
      ,[amkhaku4_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku4_opmopa])
      ,[amkhakum_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhakum_opmopa])
      ,[amkhaku1_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku1_opm95opa])
      ,[amkhaku2_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku2_opm95opa])
      ,[amkhaku3_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku3_opm95opa])
      ,[amkhaku4_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku4_opm95opa])
      ,[amkhakum_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhakum_opm95opa])
      ,[amkhaku1_opmast] = [amkhaku1_opmast]
      ,[amkhaku2_opmast] = [amkhaku2_opmast]
      ,[amkhaku3_opmast] = [amkhaku3_opmast]
      ,[amkhaku4_opmast] = [amkhaku4_opmast]
      ,[amkhakum_opmast] = [amkhakum_opmast]
      ,[amkhaku1_opmopa] = [amkhaku1_opmopa]
      ,[amkhaku2_opmopa] = [amkhaku2_opmopa]
      ,[amkhaku3_opmopa] = [amkhaku3_opmopa]
      ,[amkhaku4_opmopa] = [amkhaku4_opmopa]
      ,[amkhakum_opmopa] = [amkhakum_opmopa]
      ,[amkhaku1_opm95opa] = [amkhaku1_opm95opa]
      ,[amkhaku2_opm95opa] = [amkhaku2_opm95opa]
      ,[amkhaku3_opm95opa] = [amkhaku3_opm95opa]
      ,[amkhaku4_opm95opa] = [amkhaku4_opm95opa]
      ,[amkhakum_opm95opa] = [amkhakum_opm95opa]
      ,[amkhaku1_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku1_opmopa])
      ,[amkhaku2_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku2_opmopa])
      ,[amkhaku3_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku3_opmopa])
      ,[amkhaku4_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhaku4_opmopa])
      ,[amkhakum_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[amkhakum_opmopa])
      ,[amkhaku1_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku1_opm95opa])
      ,[amkhaku2_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku2_opm95opa])
      ,[amkhaku3_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku3_opm95opa])
      ,[amkhaku4_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhaku4_opm95opa])
      ,[amkhakum_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[amkhakum_opm95opa])
      ,[amkhaku1_koultyp]
      ,[amkhaku2_koultyp]
      ,[amkhaku3_koultyp]
      ,[amkhaku4_koultyp]
      ,[amkhakum_koultyp]
      ,[amkhaku1_okieli]
      ,[amkhaku2_okieli]
      ,[amkhaku3_okieli]
      ,[amkhaku4_okieli]
      ,[amkhakum_okieli]
      ,[amkhaku1_hyv]
      ,[amkhaku2_hyv]
      ,[amkhaku3_hyv]
      ,[amkhaku4_hyv]
      ,[amkhakum_hyv]
      ,[amkhaku1_vastotto]
      ,[amkhaku2_vastotto]
      ,[amkhaku3_vastotto]
      ,[amkhaku4_vastotto]
      ,[amkhakum_vastotto]
      ,[yohakua_tunn]
      ,[yohakub_tunn]
      ,[yohakuc_tunn]
      ,[yohakud_tunn]
      ,[yohakue_tunn]
      ,[yohakuf_tunn]
      ,[yohakug_tunn]
      ,[yohakuh_tunn]
      ,[yohakui_tunn]
      ,[yohakua_opmast_avain] = ''OPMAST'' + [yohakua_opmast]
      ,[yohakub_opmast_avain] = ''OPMAST'' + [yohakub_opmast]
      ,[yohakuc_opmast_avain] = ''OPMAST'' + [yohakuc_opmast]
      ,[yohakud_opmast_avain] = ''OPMAST'' + [yohakud_opmast]
      ,[yohakue_opmast_avain] = ''OPMAST'' + [yohakue_opmast]
      ,[yohakuf_opmast_avain] = ''OPMAST'' + [yohakuf_opmast]
      ,[yohakug_opmast_avain] = ''OPMAST'' + [yohakug_opmast]
      ,[yohakuh_opmast_avain] = ''OPMAST'' + [yohakuh_opmast]
      ,[yohakui_opmast_avain] = ''OPMAST'' + [yohakui_opmast]
      ,[yohakua_opmopa_avain] = ''OPMOPA'' + [yohakua_opmopa]
      ,[yohakub_opmopa_avain] = ''OPMOPA'' + [yohakub_opmopa]
      ,[yohakuc_opmopa_avain] = ''OPMOPA'' + [yohakuc_opmopa]
      ,[yohakud_opmopa_avain] = ''OPMOPA'' + [yohakud_opmopa]
      ,[yohakue_opmopa_avain] = ''OPMOPA'' + [yohakue_opmopa]
      ,[yohakuf_opmopa_avain] = ''OPMOPA'' + [yohakuf_opmopa]
      ,[yohakug_opmopa_avain] = ''OPMOPA'' + [yohakug_opmopa]
      ,[yohakuh_opmopa_avain] = ''OPMOPA'' + [yohakuh_opmopa]
      ,[yohakui_opmopa_avain] = ''OPMOPA'' + [yohakui_opmopa]
      ,[yohakua_opm95opa_avain] = ''OPM95OPA'' + [yohakua_opm95opa]
      ,[yohakub_opm95opa_avain] = ''OPM95OPA'' + [yohakub_opm95opa]
      ,[yohakuc_opm95opa_avain] = ''OPM95OPA'' + [yohakuc_opm95opa]
      ,[yohakud_opm95opa_avain] = ''OPM95OPA'' + [yohakud_opm95opa]
      ,[yohakue_opm95opa_avain] = ''OPM95OPA'' + [yohakue_opm95opa]
      ,[yohakuf_opm95opa_avain] = ''OPM95OPA'' + [yohakuf_opm95opa]
      ,[yohakug_opm95opa_avain] = ''OPM95OPA'' + [yohakug_opm95opa]
      ,[yohakuh_opm95opa_avain] = ''OPM95OPA'' + [yohakuh_opm95opa]
      ,[yohakui_opm95opa_avain] = ''OPM95OPA'' + [yohakui_opm95opa]
      ,[yohakua_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakua_opmopa])
      ,[yohakub_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakub_opmopa])
      ,[yohakuc_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakuc_opmopa])
      ,[yohakud_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakud_opmopa])
      ,[yohakue_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakue_opmopa])
      ,[yohakuf_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakuf_opmopa])
      ,[yohakug_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakug_opmopa])
      ,[yohakuh_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakuh_opmopa])
      ,[yohakui_opmala_avain] = ''OPMALA'' + (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakui_opmopa])
      ,[yohakua_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakua_opm95opa])
      ,[yohakub_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakub_opm95opa])
      ,[yohakuc_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakuc_opm95opa])
      ,[yohakud_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakud_opm95opa])
      ,[yohakue_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakue_opm95opa])
      ,[yohakuf_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakuf_opm95opa])
      ,[yohakug_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakug_opm95opa])
      ,[yohakuh_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakuh_opm95opa])
      ,[yohakui_opm95ala_avain] = ''OPM95ALA'' + (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakui_opm95opa])
      ,[yohakua_opmast] = [yohakua_opmast]
      ,[yohakub_opmast] = [yohakub_opmast]
      ,[yohakuc_opmast] = [yohakuc_opmast]
      ,[yohakud_opmast] = [yohakud_opmast]
      ,[yohakue_opmast] = [yohakue_opmast]
      ,[yohakuf_opmast] = [yohakuf_opmast]
      ,[yohakug_opmast] = [yohakug_opmast]
      ,[yohakuh_opmast] = [yohakuh_opmast]
      ,[yohakui_opmast] = [yohakui_opmast]
      ,[yohakua_opmopa] = [yohakua_opmopa]
      ,[yohakub_opmopa] = [yohakub_opmopa]
      ,[yohakuc_opmopa] = [yohakuc_opmopa]
      ,[yohakud_opmopa] = [yohakud_opmopa]
      ,[yohakue_opmopa] = [yohakue_opmopa]
      ,[yohakuf_opmopa] = [yohakuf_opmopa]
      ,[yohakug_opmopa] = [yohakug_opmopa]
      ,[yohakuh_opmopa] = [yohakuh_opmopa]
      ,[yohakui_opmopa] = [yohakui_opmopa]
      ,[yohakua_opm95opa] = [yohakua_opm95opa]
      ,[yohakub_opm95opa] = [yohakub_opm95opa]
      ,[yohakuc_opm95opa] = [yohakuc_opm95opa]
      ,[yohakud_opm95opa] = [yohakud_opm95opa]
      ,[yohakue_opm95opa] = [yohakue_opm95opa]
      ,[yohakuf_opm95opa] = [yohakuf_opm95opa]
      ,[yohakug_opm95opa] = [yohakug_opm95opa]
      ,[yohakuh_opm95opa] = [yohakuh_opm95opa]
      ,[yohakui_opm95opa] = [yohakui_opm95opa]
      ,[yohakua_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakua_opmopa])
      ,[yohakub_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakub_opmopa])
      ,[yohakuc_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakuc_opmopa])
      ,[yohakud_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakud_opmopa])
      ,[yohakue_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakue_opmopa])
      ,[yohakuf_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakuf_opmopa])
      ,[yohakug_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakug_opmopa])
      ,[yohakuh_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakuh_opmopa])
      ,[yohakui_opmala] = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPMOPA''+[yohakui_opmopa])
      ,[yohakua_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakua_opm95opa])
      ,[yohakub_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakub_opm95opa])
      ,[yohakuc_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakuc_opm95opa])
      ,[yohakud_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakud_opm95opa])
      ,[yohakue_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakue_opm95opa])
      ,[yohakuf_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakuf_opm95opa])
      ,[yohakug_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakug_opm95opa])
      ,[yohakuh_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakuh_opm95opa])
      ,[yohakui_opm95ala] = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ''OPM95OPA''+[yohakui_opm95opa])
      ,[yohakua_hyv]
      ,[yohakub_hyv]
      ,[yohakuc_hyv]
      ,[yohakud_hyv]
      ,[yohakue_hyv]
      ,[yohakuf_hyv]
      ,[yohakug_hyv]
      ,[yohakuh_hyv]
      ,[yohakui_hyv]
      ,[yohakua_vastotto]
      ,[yohakub_vastotto]
      ,[yohakuc_vastotto]
      ,[yohakud_vastotto]
      ,[yohakue_vastotto]
      ,[yohakuf_vastotto]
      ,[yohakug_vastotto]
      ,[yohakuh_vastotto]
      ,[yohakui_vastotto]
      ,[yohakua_harekast] = Case when yohakua_harekast <> '''' then yohakua_harekast else ''-1'' end
      ,[yohakub_harekast] = Case when yohakub_harekast <> '''' then yohakub_harekast else ''-1'' end
      ,[yohakuc_harekast] = Case when yohakuc_harekast <> '''' then yohakuc_harekast else ''-1'' end
      ,[yohakud_harekast] = Case when yohakud_harekast <> '''' then yohakud_harekast else ''-1'' end
      ,[yohakue_harekast] = Case when yohakue_harekast <> '''' then yohakue_harekast else ''-1'' end
      ,[yohakuf_harekast] = Case when yohakuf_harekast <> '''' then yohakuf_harekast else ''-1'' end
      ,[yohakug_harekast] = Case when yohakug_harekast <> '''' then yohakug_harekast else ''-1'' end
      ,[yohakuh_harekast] = Case when yohakuh_harekast <> '''' then yohakuh_harekast else ''-1'' end
      ,[yohakui_harekast] = Case when yohakui_harekast <> '''' then yohakui_harekast else ''-1'' end
      ,[yohakua_ylempi] = Case when yohakua_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakub_ylempi] = Case when yohakub_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakuc_ylempi] = Case when yohakuc_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakud_ylempi] = Case when yohakud_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakue_ylempi] = Case when yohakue_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakuf_ylempi] = Case when yohakuf_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakug_ylempi] = Case when yohakug_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakuh_ylempi] = Case when yohakuh_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakui_ylempi] = Case when yohakui_ylempi = ''1'' then ''1'' else ''2'' end
      ,[yohakua_erval]
      ,[yohakub_erval]
      ,[yohakuc_erval]
      ,[yohakud_erval]
      ,[yohakue_erval]
      ,[yohakuf_erval]
      ,[yohakug_erval]
      ,[yohakuh_erval]
      ,[yohakui_erval]
      ,[luhakux]
      ,[luhaku2x]
      ,[luhaku3x]
      ,[ammhakux]
      ,[ammhaku2x]
      ,[ammhaku3x]
      ,[amkhakux]
      ,[amkhaku2x]
      ,[amkhaku3x]
      ,[yohakux]
      ,[yohaku2x]
      ,[yohaku3x]
      ,Sukupuoli_avain = [sp]
      ,Aidinkielir1_avain = [aikielir1]
      ,Syntymavuosi = [syntv]
      ,Ika = Case when syntv<>'''' then Cast(tilv as integer) - Cast(syntv as integer) else -1 end
      ,Kotikunta_vuotta_aiemmin_avain = [tilvaskunx]
      ,Kansalaisuusr1_avain = [kansalr1]
--Aiempi tutkinto
      ,[aikyotutk]
      ,[aikyotutkkoulk]
      ,aikyotutkkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikyotutkkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikyotutkkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikyotutkkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikyotutkkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikyotutkkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikyotutkkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikyotutkkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikyotutkkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikyotutkkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,[suvuosiyotutk]
      ,[tunnyotutk]
      ,[aikamm]
      ,[aikammkoulk]
      ,aikammkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikammkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikammkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikammkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikammkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikammkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikammkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikammkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,aikammkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikammkoulk and Cast(suvuosiyotutk+''0101'' as date) between alkaa and paattyy)
      ,[suvuosiamm]
      ,[tunnamm]
      ,[aikamk]
      ,[aikamkkoulk]
      ,aikamkkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikamkkoulk and Cast(suvuosiamk+''0101'' as date) between alkaa and paattyy)
      ,aikamkkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikamkkoulk and Cast(suvuosiamk+''0101'' as date) between alkaa and paattyy)
      ,aikamkkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikamkkoulk and Cast(suvuosiamk+''0101'' as date) between alkaa and paattyy)
      ,aikamkkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikamkkoulk and Cast(suvuosiamk+''0101'' as date) between alkaa and paattyy)
      ,aikamkkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikamkkoulk and Cast(suvuosiamk+''0101'' as date) between alkaa and paattyy)
      ,[suvuosiamk]
      ,[tunnamk]
      ,[aikylamk]
      ,[aikylamkkoulk]
      ,aikylamkkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylamkkoulk and Cast(suvuosiylamk+''0101'' as date) between alkaa and paattyy)
      ,aikylamkkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylamkkoulk and Cast(suvuosiylamk+''0101'' as date) between alkaa and paattyy)
      ,aikylamkkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylamkkoulk and Cast(suvuosiylamk+''0101'' as date) between alkaa and paattyy)
      ,aikylamkkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylamkkoulk and Cast(suvuosiylamk+''0101'' as date) between alkaa and paattyy)
      ,aikylamkkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylamkkoulk and Cast(suvuosiylamk+''0101'' as date) between alkaa and paattyy)
      ,[suvuosiylamk]
      ,[tunnylamk]
      ,[aikalkk]
      ,[aikalkkkoulk]
      ,aikalkkkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikalkkkoulk and Cast(suvuosialkk+''0101'' as date) between alkaa and paattyy)
      ,aikalkkkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikalkkkoulk and Cast(suvuosialkk+''0101'' as date) between alkaa and paattyy)
      ,aikalkkkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikalkkkoulk and Cast(suvuosialkk+''0101'' as date) between alkaa and paattyy)
      ,aikalkkkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikalkkkoulk and Cast(suvuosialkk+''0101'' as date) between alkaa and paattyy)
      ,aikalkkkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikalkkkoulk and Cast(suvuosialkk+''0101'' as date) between alkaa and paattyy)
      ,[suvuosialkk]
      ,[tunnalkk]
      ,[aikylkk]
      ,[aikylkkkoulk]
      ,aikylkkkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylkkkoulk and Cast(suvuosiylkk+''0101'' as date) between alkaa and paattyy)
      ,aikylkkkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylkkkoulk and Cast(suvuosiylkk+''0101'' as date) between alkaa and paattyy)
      ,aikylkkkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylkkkoulk and Cast(suvuosiylkk+''0101'' as date) between alkaa and paattyy)
      ,aikylkkkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylkkkoulk and Cast(suvuosiylkk+''0101'' as date) between alkaa and paattyy)
      ,aikylkkkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aikylkkkoulk and Cast(suvuosiylkk+''0101'' as date) between alkaa and paattyy)
      ,[suvuosiylkk]
      ,[tunnylkk]
      ,[aiklistri]
      ,[aiklistrikoulk]
      ,aiklistrikoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aiklistrikoulk and Cast(suvuosilistri+''0101'' as date) between alkaa and paattyy)
      ,aiklistrikoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aiklistrikoulk and Cast(suvuosilistri+''0101'' as date) between alkaa and paattyy)
      ,aiklistrikoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aiklistrikoulk and Cast(suvuosilistri+''0101'' as date) between alkaa and paattyy)
      ,aiklistrikoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aiklistrikoulk and Cast(suvuosilistri+''0101'' as date) between alkaa and paattyy)
      ,aiklistrikoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = aiklistrikoulk and Cast(suvuosilistri+''0101'' as date) between alkaa and paattyy)
      ,[suvuosilistri]
      ,[tunnlistri]
--Edellisen vuoden opiskelu
      ,[yotutkopisx]
      ,[yotutkopisxkoulk]
      ,yotutkopisxkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yotutkopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yotutkopisxkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yotutkopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yotutkopisxkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yotutkopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yotutkopisxkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yotutkopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yotutkopisxkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yotutkopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[yotutkopisxtunn]
      ,[ammopisx]
      ,[ammopisxkoulk]
      ,ammopisxkoulk_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ammopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,ammopisxkoulk_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ammopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,ammopisxkoulk_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ammopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,ammopisxkoulk_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ammopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,ammopisxkoulk_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = ammopisxkoulk and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[ammopisxtunn]
      ,[amkopisx1]
      ,[amkopisxkoulk1]
      ,amkopisxkoulk1_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk1_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk1_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk1_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk1_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[amkopisxtunn1]
      ,[amkopisx2]
      ,[amkopisxkoulk2]
      ,amkopisxkoulk2_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk2_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk2_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk2_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk2_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[amkopisxtunn2]
      ,[amkopisx3]
      ,[amkopisxkoulk3]
      ,amkopisxkoulk3_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk3_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk3_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk3_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,amkopisxkoulk3_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = amkopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[amkopisxtunn3]
      ,[yoopisx1]
      ,[yoopisxkoulk1]
      ,yoopisxkoulk1_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk1_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk1_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk1_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk1_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk1 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[yoopisxtunn1]
      ,[yoopisx2]
      ,[yoopisxkoulk2]
      ,yoopisxkoulk2_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk2_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk2_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk2_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk2_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk2 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[yoopisxtunn2]
      ,[yoopisx3]
      ,[yoopisxkoulk3]
      ,yoopisxkoulk3_opmast = (Select top 1 koulutusaste2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk3_opm95opa = (Select top 1 opintoala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk3_opmopa = (Select top 1 opintoala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk3_opm95ala = (Select top 1 koulutusala1995_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,yoopisxkoulk3_opmala = (Select top 1 koulutusala2002_koodi from VipunenTK_DW.dbo.d_koulutusluokitus where koulutusluokitus_avain = yoopisxkoulk3 and Dateadd(y,-1,tilv_date) between alkaa and paattyy)
      ,[yoopisxtunn3]
      ,[ptoim1r3x]
      ,[htok]
      ,[lkm]
      ,[tietolahde]
      ,[rivinumero]
  FROM [VipunenTK_DW].[dbo].[sa_K3_16_Moninkertainen_haku]
' 
GO
/****** Object:  View [dbo].[v_f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat]'))
EXEC dbo.sp_executesql @statement = N'







/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat] AS
/*
drop table [VipunenTK_DW]..f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat;
select * into [VipunenTK_DW].dbo.f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat from [VipunenTK_DW]..v_f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat;

truncate table [VipunenTK_DW]..f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat;
insert into [VipunenTK_DW]..f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat select * from [VipunenTK_DW]..v_f_K5_5_Tieteen_ja_teknologian_henkilovoimavarat;
*/

SELECT tilastovuosi = [tilv]
      ,syntymamaa_avain = [svalt]
      ,kansalaisuus_avain = [kansal]
      ,sukupuoli_avain = [sp]
      ,ika_avain = ''ikar5_'' + [ikar5]
      ,asuinmaakunta_avain = Case when [maakunta]=''-1'' then maakunta else ''MAAK'' + [maakunta] end
      ,paaasiallinen_toiminta_versio3_avain = [ptoim1]
      ,koulutusluokitus_avain = [koulk]
      ,tutkinnon_suoritusvuosi = case
									when suorv = ''9999'' then ''Tuntematon''
									else suorv
								 end
	  ,koulutuksesta_kulunut_aika_koodi = Case 
		when len(suorv) <> 4 then ''-1''
		when suorv not between ''1900'' and ''2999'' then ''-1''
		else Cast(Cast(tilv as int) - Cast(suorv as int) as nvarchar(20)) end
      ,tutkinnon_suoritusmaakunta = Case when [suormaak]=''-1'' then [suormaak] else ''MAAK'' + [suormaak] end
      ,ammattikoodi_2010_avain = Cast([amm2010_2] as nvarchar(10))
      ,tyopaikan_sijaintimaakunta_avain = Case when tmaak=''-1'' then tmaak else ''MAAK'' + tmaak end
      ,toimialaluokitus_tthv_avain = [tol2008_akatemia]
	  ,toimialaluokitus_ed_tthv_avain = [tol2008_tthv_ed]
      ,tyonantajasektori2_avain = [tsekt_2]
	  ,tyonantajasektori2_ed_avain = [tsekt_ed]
	  ,yrityksen_koko_avain = sl
	  ,tyonantaja_vaihtunut_avain = ta_vaihdos
      ,[lkm]

/* johdetut muuttujat */
	  ,tyonantajasektori2_tthv_avain = case [tsekt_2] when 7 then 1 else tsekt_2 end
	  ,tyonantajasektori2_ed_tthv_avain = case [tsekt_ed] when 7 then 1 else tsekt_ed end

	  ,asuinmaakunta_sama_kuin_tyopaikan_sijaintikunta_avain = 
				case
					when maakunta = tmaak and not (maakunta in (''-1'',''99'') and tmaak in (''-1'',''99'')) then 1
					when maakunta <> tmaak and not (maakunta in (''-1'',''99'') or tmaak in (''-1'',''99'')) then 2
					else -1
				end
	  ,tyonantajasektori_sama_kuin_ed_vuonna_avain = 
				case
					when tsekt_2 <> 0 and tsekt_ed not in (0,-1) and (case [tsekt_2] when 7 then 1 else tsekt_2 end) = (case [tsekt_ed] when 7 then 1 else tsekt_ed end) then 1
					when tsekt_2 <> 0 and tsekt_ed not in (0,-1) and (case [tsekt_2] when 7 then 1 else tsekt_2 end) <> (case [tsekt_ed] when 7 then 1 else tsekt_ed end) then 2
					else -1
				end
	  ,toimiala_tthv1_sama_kuin_ed_vuonna_avain =
				case	
					when d1.toimiala_tthv_avain not in (-1,0) and d2.toimiala_tthv_avain not in (-1,0) and d1.paatoimiala_tthv = d2.paatoimiala_tthv then 1
					when d1.toimiala_tthv_avain not in (-1,0) and d2.toimiala_tthv_avain not in (-1,0) and d1.paatoimiala_tthv <> d2.paatoimiala_tthv then 2
					else -1
				end
	  ,toimiala_tthv2_sama_kuin_ed_vuonna_avain =
				case	
					when d1.toimiala_tthv_avain not in (-1,0) and d2.toimiala_tthv_avain not in (-1,0) and d1.toimiala_tthv_avain = d2.toimiala_tthv_avain then 1
					when d1.toimiala_tthv_avain not in (-1,0) and d2.toimiala_tthv_avain not in (-1,0) and d1.toimiala_tthv_avain <> d2.toimiala_tthv_avain then 2
					else -1
				end

  FROM [VipunenTK_DW].[dbo].[sa_K5_5_Tieteen_ja_teknologian_henkilovoimavarat] f
  left join VipunenTK.dbo.d_toimiala_tthv d1 on d1.toimiala_tthv_avain=f.tol2008_akatemia
  left join VipunenTK.dbo.d_toimiala_tthv d2 on d2.toimiala_tthv_avain=f.tol2008_tthv_ed







' 
GO
/****** Object:  View [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_3_menot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_3_menot]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_3_menot] AS
--
--Drop table VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_menot
--Select * into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_menot from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_3_menot

--Delete from VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_menot 
--Insert into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_menot Select * from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_3_menot 


SELECT [tilastovuosi]
      ,[tilv_date]
      ,kaikki.[oppilaitos_avain]
      ,[oppilaitos_id] = ISNULL(d_ol.id, -2)
      --,[oppilaitos_sijaintikunta_avain] = ISNULL(d_ol.sijaintikuntakoodi, ''-1'')
      --,[oppilaitos_sijaintikunta_id] = ISNULL(d_ol_al.id, -1)
      ,kaikki.[tieteenala_avain]
      ,[tieteenala_id] = ISNULL(d_ta.id, -2)
      ,kaikki.menokohde_avain
      ,[menokohde_id] = ISNULL(d_mk.id, -2)
	  ,tutkimusmenot
      ,kaikki.[tietolahde]
      ,[rivinumero]
  FROM ( --kaikki
  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,menokohde_avain = ''PALKAT''
	,tutkimusmenot = [Kayttomenoista_palkat]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Kayttomenoista_palkat] <> 0.0

Union all  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,menokohde_avain = ''APURAHAT''
	,tutkimusmenot = [Kayttomenoista_apurahat]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Kayttomenoista_apurahat] <> 0.0

Union all  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,menokohde_avain = ''MUUTKMENOT''
	,tutkimusmenot = [Laskettu_muutkayttomenot]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Laskettu_muutkayttomenot] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,menokohde_avain = ''MUUTMENOT''
	,tutkimusmenot = [Menot_laitehankinnat]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Menot_laitehankinnat] <> 0.0

 ) kaikki
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = kaikki.oppilaitos_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
--	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_tieteenala d_ta
	ON d_ta.tieteenala_avain = kaikki.tieteenala_avain
LEFT JOIN VipunenTK.dbo.d_tutkimusmenojen_kohde d_mk
	ON d_mk.menokohde_avain = kaikki.menokohde_avain
	


' 
GO
/****** Object:  View [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus] AS
--
--Drop table VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus
--Select * into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus

--Delete from VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus 
--Insert into VipunenTK.dbo.f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus Select * from VipunenTK_DW.dbo.v_f_korkeakoulujen_tutkimus_kehitys_5_3_rahoitus 


SELECT [tilastovuosi]
      ,[tilv_date]
      ,kaikki.[oppilaitos_avain]
      ,[oppilaitos_id] = ISNULL(d_ol.id, -2)
      --,[oppilaitos_sijaintikunta_avain] = ISNULL(d_ol.sijaintikuntakoodi, ''-1'')
      --,[oppilaitos_sijaintikunta_id] = ISNULL(d_ol_al.id, -1)
      ,kaikki.[tieteenala_avain]
      ,[tieteenala_id] = ISNULL(d_ta.id, -2)
      ,kaikki.[rahoituslahde_avain]
      ,[rahoituslahde_id] = ISNULL(d_rl.id, -2)
	  ,tutkimusrahoitus
      ,kaikki.[tietolahde]
      ,[rivinumero]
  FROM ( --kaikki
  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''OKM_PERUS''
	,tutkimusrahoitus = [OKM_perusrahoitus]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [OKM_perusrahoitus] <> 0.0

Union all  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''AKATEMIA''
	,tutkimusrahoitus = [SuomenAkatemia]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [SuomenAkatemia] <> 0.0

Union all  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''OKM_MUU''
	,tutkimusrahoitus = [Muu_OKM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Muu_OKM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''TEKES''
	,tutkimusrahoitus = [TEKES]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [TEKES] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''TEM_MUU''
	,tutkimusrahoitus = [Muu_TEM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Muu_TEM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''UM''
	,tutkimusrahoitus = [UM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [UM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''OM''
	,tutkimusrahoitus = [OM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [OM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''SM''
	,tutkimusrahoitus = [SM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [SM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''PM''
	,tutkimusrahoitus = [PM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [PM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''VM''
	,tutkimusrahoitus = [VM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [VM] <> 0.0

Union all  
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''MMM''
	,tutkimusrahoitus = [MMM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [MMM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''LVM''
	,tutkimusrahoitus = [LVM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [LVM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''STM''
	,tutkimusrahoitus = [STM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [STM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''YM''
	,tutkimusrahoitus = [YM]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [YM] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''KUNNAT''
	,tutkimusrahoitus = [Kunnat]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Kunnat] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''JULK_MUU''
	,tutkimusrahoitus = [Muu_julkinen_rahoitus]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Muu_julkinen_rahoitus] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''RAHASTO_K''
	,tutkimusrahoitus = [Kotimaiset_rahastot]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Kotimaiset_rahastot] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''YRITYS_K''
	,tutkimusrahoitus = [Kotimaiset_yritykset]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Kotimaiset_yritykset] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''YRITYS_U''
	,tutkimusrahoitus = [Ulkomaiset_yritykset]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Ulkomaiset_yritykset] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''EU_PUITE''
	,tutkimusrahoitus = [EU_puiteohjelmarahoitus]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [EU_puiteohjelmarahoitus] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''EU_ALUE''
	,tutkimusrahoitus = [EU_aluekehitysrahoitus]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [EU_aluekehitysrahoitus] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''EU_SOS''
	,tutkimusrahoitus = [EU_sosiaalirahasto]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [EU_sosiaalirahasto] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''EU_MUU''
	,tutkimusrahoitus = [Muu_EU]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Muu_EU] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''RAHASTO_U''
	,tutkimusrahoitus = [Ulkomaiset_rahastot]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Ulkomaiset_rahastot] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''JARJESTO_U''
	,tutkimusrahoitus = [Kansainvaliset_jarjestot]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Kansainvaliset_jarjestot] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''MUU_U''
	,tutkimusrahoitus = [Muu_ulkomainen_rahoitus]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Muu_ulkomainen_rahoitus] <> 0.0

Union all 
Select 
	 [tilastovuosi]
	,[tilv_date]
	,[oppilaitos_avain]
	,[tieteenala_avain]
	,rahoituslahde_avain = ''KOULU''
	,tutkimusrahoitus = [Korkeakoulun_omat_varat]
	,[tietolahde]
    ,[rivinumero]
From VipunenTK_DW.[dbo].[f_5_3_Yliopistojen_tutkimustyovuodet_ja_tutkimusmenot_rahoituslahteittain_menolajeittain_yliopistoittain] 
Where [Korkeakoulun_omat_varat] <> 0.0

 ) kaikki
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = kaikki.oppilaitos_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
--	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_tieteenala d_ta
	ON d_ta.tieteenala_avain = kaikki.tieteenala_avain
LEFT JOIN VipunenTK.dbo.d_tutkimuksen_rahoituslahde d_rl
	ON d_rl.rahoituslahde_avain = kaikki.rahoituslahde_avain
	


' 
GO
/****** Object:  View [dbo].[v_f_koulutukseen_sijoittuneet_2v_tarkastelu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_koulutukseen_sijoittuneet_2v_tarkastelu]'))
EXEC dbo.sp_executesql @statement = N'




/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_f_koulutukseen_sijoittuneet_2v_tarkastelu] AS
SELECT [aineistorivinumero]
      ,[tarkastelujakso]
      ,[tilv]
      ,[tilv_date]
      ,[tutkryh]
      ,[suorv]=(case when [suorv]='''' then ''-1'' else [suorv] end)
      ,[suorlk]=(case when [suorlk]='''' then ''-1'' else [suorlk] end)
      ,[sp]
      ,[syntv]=(case when [syntv]='''' then ''-1'' else [syntv] end)
      ,[aikielir1]
      ,[tutkkaskun]
      ,[kansalr1]
      ,[pohjmaa]
      ,[eumaa]
      ,[etamaa]
      ,[tunn]=(case when [tunn]='''' then ''-1'' else [tunn] end)
      ,[jarj]
      ,[kkielir1]
      ,[tutklaja]
      ,[tutktav]
      ,[aikoul]
      ,[tutkmaak]
      ,[pohjkoulk]  = (case when [pohjkoulk]='''' then ''-1'' else [pohjkoulk] end)
      ,[koulutus] = (case when [koulutus]='''' then ''-1'' else [koulutus] end)
      ,[oppilaitos]=(case when [oppilaitos]='''' then ''-1'' else [oppilaitos] end)
      ,[koulutuksen_jarjestaja]
      ,[koulutuksen_maakunta]= (case when [koulutuksen_maakunta]='''' then ''-1'' else [koulutuksen_maakunta]end)
      ,[monihaku]
      ,[paaasiallinen_toiminta]
      ,[ammattiasema]
      ,[lkm]
      ,[tietolahde]
      ,[aineisto]
      ,[lukiokoulutuksessa]
      ,[ammatillisessa_koulutuksessa]
      ,[ammattikorkeakoulutuksessa]
      ,[yliopistokoulutuksessa]
      ,[lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa]
      ,[toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa]
      ,[ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa]
      ,[koulutuksen_paattaneiden_toiminta]
      ,[lukiokoulutuksessa_ke]= (cast ((case when [lukiokoulutuksessa] = 1 then ''Kyllä'' else ''Ei'' end) as nchar(5)))
      ,[ammatillisessa_koulutuksessa_ke] = (cast((case when ammatillisessa_koulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5)))
      ,[ammattikorkeakoulutuksessa_ke]= (cast((case when ammattikorkeakoulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5)))
      ,[yliopistokoulutuksessa_ke]= cast((case when yliopistokoulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa_ke]= cast((case when lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa= 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa_ke]= cast((case when toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa= 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa_ke] = cast((case when ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[rivinumero]
      ,[ika_1v]
      ,[ika_5v]
  FROM [VipunenTK_DW].[dbo].[_f_koulutukseen_sijoittuneet_2v_tarkastelu]





' 
GO
/****** Object:  View [dbo].[v_f_koulutukseen_sijoittuneet_6v_tarkastelu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_koulutukseen_sijoittuneet_6v_tarkastelu]'))
EXEC dbo.sp_executesql @statement = N'
/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_f_koulutukseen_sijoittuneet_6v_tarkastelu] AS
SELECT [aineistorivinumero]
      ,[tarkastelujakso]
      ,[tilv]
      ,[tilv_date]
      ,[tutkryh]
      ,[suorv]=(case when [suorv]='''' then ''-1'' else [suorv] end)
      ,[suorlk]=(case when [suorlk]='''' then ''-1'' else [suorlk] end)
      ,[sp]
      ,[syntv]=(case when [syntv]='''' then ''-1'' else [syntv] end)
      ,[aikielir1]
      ,[tutkkaskun]
      ,[kansalr1]
      ,[pohjmaa]
      ,[eumaa]
      ,[etamaa]
      ,[tunn]
      ,[jarj]
      ,[kkielir1]
      ,[tutklaja]
      ,[tutktav]
      ,[aikoul]
      ,[tutkmaak]
      ,[pohjkoulk]
      ,[koulutus] = (case when [koulutus]='''' then ''-1'' else [koulutus] end)
      ,[oppilaitos]
      ,[koulutuksen_jarjestaja]
      ,[koulutuksen_maakunta]= (case when [koulutuksen_maakunta]='''' then ''-1'' else [koulutuksen_maakunta]end)
      ,[monihaku]
      ,[paaasiallinen_toiminta]
      ,[ammattiasema]
      ,[lkm]
      ,[tietolahde]
      ,[aineisto]
      ,[lukiokoulutuksessa]
      ,[ammatillisessa_koulutuksessa]
      ,[ammattikorkeakoulutuksessa]
      ,[yliopistokoulutuksessa]
      ,[lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa]
      ,[toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa]
      ,[ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa]
      ,[koulutuksen_paattaneiden_toiminta]
      ,[lukiokoulutuksessa_ke]= (cast ((case when [lukiokoulutuksessa] = 1 then ''Kyllä'' else ''Ei'' end) as nchar(5)))
      ,[ammatillisessa_koulutuksessa_ke] = (cast((case when ammatillisessa_koulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5)))
      ,[ammattikorkeakoulutuksessa_ke]= (cast((case when ammattikorkeakoulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5)))
      ,[yliopistokoulutuksessa_ke]= cast((case when yliopistokoulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa_ke]= cast((case when lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa= 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa_ke]= cast((case when toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa= 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa_ke] = cast((case when ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa = 1 then ''Kyllä'' else ''Ei''end) as nchar(5))
      ,[rivinumero]
      ,[ika_1v]
      ,[ika_5v]
  FROM [VipunenTK_DW].[dbo].[_f_koulutukseen_sijoittuneet_6v_tarkastelu]

' 
GO
/****** Object:  View [dbo].[v_f_Moninkertainen_haku_aiemmat_tutkinnot]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Moninkertainen_haku_aiemmat_tutkinnot]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_Moninkertainen_haku_aiemmat_tutkinnot] AS
--Palauttaa moninkertaisen haun aineistosta K3.16 aiemmat tutkinnot
--Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_aiemmat_tutkinnot

--Delete from VipunenTK.dbo.f_Moninkertainen_haku_aiemmat_tutkinnot 
--Insert into VipunenTK.dbo.f_Moninkertainen_haku_aiemmat_tutkinnot Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_aiemmat_tutkinnot 

-- aiemmin suoritetut tutkinnot, yo
SELECT 
	   --CSC Jarmo 12.9.2014
	   --Kommentoidut tiedot löytyvät hakijan tiedoista. Niitä on turha monistaa joka faktatauluun. Rivinumero linkittää eri faktataulut.
	   --[Tilastovuosi]
    --  ,[tilv_date]
    --  ,[Sukupuoli_avain]
    --  ,sukupuoli_id = isnull(d_sp.id, -2)
    --  ,f.[Ika]
    --  ,Ika_id = isnull(d_ika.id, -2)
    --  ,[Syntymavuosi]
    --  ,[Aidinkielir1_avain]
    --  ,Aidinkielir1_id = isnull(d_ak.id, -2)
    --  ,[Kotikunta_vuotta_aiemmin_avain]
    --  ,Kotikunta_vuotta_aiemmin_id = isnull(d_al.id, -2)
    --  ,[Hetuntila_avain]
    --  ,Hetuntila_id = isnull(d_ho.id, -2)
    --  ,[Toiminta_vuotta_aiemmin_avain]
    --  ,Toiminta_vuotta_aiemmin_id = isnull(d_pt.id, -2)
    Aiemmin_suoritettu_tutkinto_oppilaitos_avain,
    Aiemmin_suoritettu_tutkinto_oppilaitos_id = isnull(d_ol.id, -2),
    Aiemmin_suoritettu_tutkinto_oppilaitoksen_alueluokitus_avain = d_ol.sijaintikuntakoodi,
    Aiemmin_suoritettu_tutkinto_oppilaitoksen_alueluokitus_id = isnull(d_ol_al.id, -2),
	Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain,
	Aiemmin_suoritettu_tutkinto_koulutusluokitus_id = ISNULL(d_kl.id, -2),
	Aiemmin_suoritettu_tutkinto_suoritusvuosi,
	Aiemmin_suoritettu_tutkinto_ika,
	Aiemmin_suoritettu_tutkinto_ajankohta_id = ISNULL(d_sa.id, -2),
	Aiemmin_suoritettu_tutkinto_sektori,
	Aiemmin_suoritettu_tutkinto_sektori_id = ISNULL(d_tu.id, -2),
	Aiemmin_suoritettu_tutkinto_tuorein = Cast(Aiemmin_suoritettu_tutkinto_tuorein as nvarchar(50)),
	lkm, 
	f.tietolahde,
	rivinumero
FROM ( --f

SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnyotutk,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aikyotutkkoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosiyotutk,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosiyotutk <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosiyotutk as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''yo'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosiyotutk <> '''' 
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aikyotutk=''K''

UNION ALL
-- aiemmin suoritetut tutkinnot, amm
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnamm,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aikammkoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosiamm,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosiamm <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosiamm as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''amm'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosiamm <> '''' 
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosiamm + ISNULL(aikammkoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aikamm=''K''

UNION ALL
-- aiemmin suoritetut tutkinnot, amk
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnamk,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aikamkkoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosiamk,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosiamk <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosiamk as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''amk'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosiamk <> '''' 
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosiamk + ISNULL(aikamkkoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aikamk=''K''

UNION ALL
-- aiemmin suoritetut tutkinnot, ylamk
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnylamk,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aikylamkkoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosiylamk,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosiylamk <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosiylamk as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''ylamk'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosiylamk <> '''' 
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aikylamk=''K''

UNION ALL
-- aiemmin suoritetut tutkinnot, alkk
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnalkk,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aikalkkkoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosialkk,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosialkk <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosialkk as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''alkk'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosialkk <> '''' 
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aikalkk=''K''

UNION ALL
-- aiemmin suoritetut tutkinnot, ylkk
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnylkk,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aikylkkkoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosiylkk,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosiylkk <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosiylkk as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''ylkk'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosiylkk <> '''' 
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aikylkk=''K''

UNION ALL
-- aiemmin suoritetut tutkinnot, listri
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = tunnlistri,
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = aiklistrikoulk,
Aiemmin_suoritettu_tutkinto_suoritusvuosi = suvuosilistri,
Aiemmin_suoritettu_tutkinto_ika = Case when suvuosilistri <> '''' then Cast(Tilastovuosi as integer) - Cast(suvuosilistri as integer) else NULL end,
Aiemmin_suoritettu_tutkinto_sektori = ''listri'',
Aiemmin_suoritettu_tutkinto_tuorein = Case 
	when suvuosilistri <> '''' 
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosiyotutk + ISNULL(aikyotutkkoulk_opmast,'''')
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosiamm + ISNULL(aikammkoulk_opmast,'''')
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosiamk + ISNULL(aikamkkoulk_opmast,'''')
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosiylamk + ISNULL(aikylamkkoulk_opmast,'''')
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosialkk + ISNULL(aikalkkkoulk_opmast,'''')
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosiylkk + ISNULL(aikylkkkoulk_opmast,'''')
	 and suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''') >= suvuosilistri + ISNULL(aiklistrikoulk_opmast,'''')
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE aiklistri=''K''

UNION ALL
-- ei aiemmin suoritettuja tutkintoja
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Aiemmin_suoritettu_tutkinto_oppilaitos_avain = ''-1'',
Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain = ''-1'',
Aiemmin_suoritettu_tutkinto_suoritusvuosi = ''-1'',
Aiemmin_suoritettu_tutkinto_ika = -1,
Aiemmin_suoritettu_tutkinto_sektori = ''ei'',
Aiemmin_suoritettu_tutkinto_tuorein = ''E'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE Coalesce(aikyotutk,'''')<>''K'' and Coalesce(aikamm,'''')<>''K'' and Coalesce(aikamk,'''')<>''K'' and Coalesce(aikylamk,'''')<>''K'' and Coalesce(aikalkk,'''')<>''K'' and Coalesce(aikylkk,'''')<>''K'' and Coalesce(aiklistri,'''')<>''K''

) f
--LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
--	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
--LEFT JOIN VipunenTK.dbo.d_ika 
--	ON d_ika.ika_avain = Cast(f.Ika as nvarchar(10))
--LEFT JOIN VipunenTK.dbo.d_aidinkieli_versio1 d_ak
--	ON d_ak.aidinkieli_versio1_koodi = f.Aidinkielir1_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_al
--	ON d_al.alueluokitus_avain = f.Kotikunta_vuotta_aiemmin_avain
--LEFT JOIN VipunenTK.dbo.d_hetu_ok d_ho
--	ON d_ho.hetu_ok_avain = f.Hetuntila_avain
--LEFT JOIN VipunenTK.dbo.d_paaasiallinen_toiminta d_pt
--	ON d_pt.paaasiallinen_toiminta_koodi = f.Toiminta_vuotta_aiemmin_avain
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = f.Aiemmin_suoritettu_tutkinto_oppilaitos_avain
LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_koulutusluokitus d_kl
	ON d_kl.koulutusluokitus_avain = f.Aiemmin_suoritettu_tutkinto_koulutusluokitus_avain
LEFT JOIN VipunenTK.dbo.d_tutkinto d_tu
	ON d_tu.tutkinto_avain = f.Aiemmin_suoritettu_tutkinto_sektori
LEFT JOIN VipunenTK.dbo.d_suhteellinen_ajankohta d_sa
	ON d_sa.suhteellinen_ajankohta_avain = 
		Cast(case 
			when f.Aiemmin_suoritettu_tutkinto_ika=-1 then ''tilv-ei''
			when f.Aiemmin_suoritettu_tutkinto_ika=0 then ''tilv''
			when f.Aiemmin_suoritettu_tutkinto_ika between 1 and 10 then ''tilv-'' + Cast(f.Aiemmin_suoritettu_tutkinto_ika as nvarchar(2))
			when f.Aiemmin_suoritettu_tutkinto_ika>10 then ''tilv-yli10''
			else ''-1'' end as nvarchar(10))
' 
GO
/****** Object:  View [dbo].[v_f_Moninkertainen_haku_edellisen_vuoden_opiskelut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Moninkertainen_haku_edellisen_vuoden_opiskelut]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_Moninkertainen_haku_edellisen_vuoden_opiskelut] AS
--Palauttaa moninkertaisen haun aineistosta K3.16 opiskelut
--Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_edellisen_vuoden_opiskelut

--Delete from VipunenTK.dbo.f_Moninkertainen_haku_edellisen_vuoden_opiskelut 
--Insert into VipunenTK.dbo.f_Moninkertainen_haku_edellisen_vuoden_opiskelut Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_edellisen_vuoden_opiskelut 

-- edellisen vuoden opiskelut, yo
SELECT 
	   --CSC Jarmo 12.9.2014
	   --Kommentoidut tiedot löytyvät hakijan tiedoista. Niitä on turha monistaa joka faktatauluun. Rivinumero linkittää eri faktataulut.
	   --[Tilastovuosi]
    --  ,[tilv_date]
    --  ,[Sukupuoli_avain]
    --  ,sukupuoli_id = isnull(d_sp.id, -2)
    --  ,f.[Ika]
    --  ,Ika_id = isnull(d_ika.id, -2)
    --  ,[Syntymavuosi]
    --  ,[Aidinkielir1_avain]
    --  ,Aidinkielir1_id = isnull(d_ak.id, -2)
    --  ,[Kotikunta_vuotta_aiemmin_avain]
    --  ,Kotikunta_vuotta_aiemmin_id = isnull(d_al.id, -2)
    --  ,[Hetuntila_avain]
    --  ,Hetuntila_id = isnull(d_ho.id, -2)
    --  ,[Toiminta_vuotta_aiemmin_avain]
    --  ,Toiminta_vuotta_aiemmin_id = isnull(d_pt.id, -2)
    Edellisen_vuoden_opiskelu_oppilaitos_avain,
    Edellisen_vuoden_opiskelu_oppilaitos_id = isnull(d_ol.id, -2),
    Edellisen_vuoden_opiskelu_oppilaitoksen_alueluokitus_avain = d_ol.sijaintikuntakoodi,
    Edellisen_vuoden_opiskelu_oppilaitoksen_alueluokitus_id = isnull(d_ol_al.id, -2),
	Edellisen_vuoden_opiskelu_koulutusluokitus_avain,
	Edellisen_vuoden_opiskelu_koulutusluokitus_id = ISNULL(d_kl.id, -2),
	f.Edellisen_vuoden_opiskelu_avain,
	Edellisen_vuoden_opiskelu_id = ISNULL(d_evo.id, -2),
	lkm, 
	f.tietolahde,
	rivinumero
FROM ( --f

SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = yotutkopisxtunn,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = yotutkopisxkoulk,
Edellisen_vuoden_opiskelu_avain = ''yotutk'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yotutkopisx=''K''

UNION ALL
-- edellisen vuoden opiskelut, amm
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = ammopisxtunn,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = ammopisxkoulk,
Edellisen_vuoden_opiskelu_avain = ''amm'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE ammopisx=''K''

UNION ALL
-- edellisen vuoden opiskelut, amk1
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = amkopisxtunn1,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = amkopisxkoulk1,
Edellisen_vuoden_opiskelu_avain = ''amk-1'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkopisx1=''K''

UNION ALL
-- edellisen vuoden opiskelut, amk2
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = amkopisxtunn2,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = amkopisxkoulk2,
Edellisen_vuoden_opiskelu_avain = ''amk-2'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkopisx2=''K''

UNION ALL
-- edellisen vuoden opiskelut, amk3
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = amkopisxtunn3,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = amkopisxkoulk3,
Edellisen_vuoden_opiskelu_avain = ''amk-3'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkopisx3=''K''

UNION ALL
-- edellisen vuoden opiskelut, yo1
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = yoopisxtunn1,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = yoopisxkoulk1,
Edellisen_vuoden_opiskelu_avain = ''yo-1'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yoopisx1=''K''

UNION ALL
-- edellisen vuoden opiskelut, yo2
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = yoopisxtunn2,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = yoopisxkoulk2,
Edellisen_vuoden_opiskelu_avain = ''yo-2'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yoopisx2=''K''

UNION ALL
-- edellisen vuoden opiskelut, yo3
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = yoopisxtunn3,
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = yoopisxkoulk3,
Edellisen_vuoden_opiskelu_avain = ''yo-3'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yoopisx3=''K''

UNION ALL
-- edellisen vuoden opiskelut, amm
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain, 
Hetuntila_avain = htok, --Lisää kaikkiin muihinkin näkymiin
Toiminta_vuotta_aiemmin_avain = ptoim1r3x, --Lisää kaikkiin muihinkin näkymiin
Edellisen_vuoden_opiskelu_oppilaitos_avain = ''-1'',
Edellisen_vuoden_opiskelu_koulutusluokitus_avain = ''-1'',
Edellisen_vuoden_opiskelu_avain = ''ei'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yotutkopisx<>''K'' and ammopisx<>''K'' and amkopisx1<>''K'' and amkopisx2<>''K'' and amkopisx3<>''K'' and yoopisx1<>''K'' and yoopisx2<>''K'' and yoopisx3<>''K'' 

) f
--LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
--	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
--LEFT JOIN VipunenTK.dbo.d_ika 
--	ON d_ika.ika_avain = Cast(f.Ika as nvarchar(10))
--LEFT JOIN VipunenTK.dbo.d_aidinkieli_versio1 d_ak
--	ON d_ak.aidinkieli_versio1_koodi = f.Aidinkielir1_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_al
--	ON d_al.alueluokitus_avain = f.Kotikunta_vuotta_aiemmin_avain
--LEFT JOIN VipunenTK.dbo.d_hetu_ok d_ho
--	ON d_ho.hetu_ok_avain = f.Hetuntila_avain
--LEFT JOIN VipunenTK.dbo.d_paaasiallinen_toiminta d_pt
--	ON d_pt.paaasiallinen_toiminta_koodi = f.Toiminta_vuotta_aiemmin_avain
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = f.Edellisen_vuoden_opiskelu_oppilaitos_avain
LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_koulutusluokitus d_kl
	ON d_kl.koulutusluokitus_avain = f.Edellisen_vuoden_opiskelu_koulutusluokitus_avain
LEFT JOIN VipunenTK.dbo.d_edellisen_vuoden_opiskelu d_evo
	ON d_evo.edellisen_vuoden_opiskelu_avain = f.Edellisen_vuoden_opiskelu_avain
' 
GO
/****** Object:  View [dbo].[v_f_Moninkertainen_haku_edelliset_haut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Moninkertainen_haku_edelliset_haut]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Moninkertainen_haku_edelliset_haut] AS
--Palauttaa moninkertaisen haun aineistosta K3.16 edelliset haut
--Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_edelliset_haut

--Delete from VipunenTK.dbo.f_Moninkertainen_haku_edelliset_haut 
--Insert into VipunenTK.dbo.f_Moninkertainen_haku_edelliset_haut Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_edelliset_haut 

-- edelliset haut, luhakux
SELECT 
	   --CSC Jarmo 12.9.2014
	   --Kommentoidut tiedot löytyvät hakijan tiedoista. Niitä on turha monistaa joka faktatauluun. Rivinumero linkittää eri faktataulut.
	   --[Tilastovuosi]
    --  ,[tilv_date]
    --  ,[Sukupuoli_avain]
    --  ,sukupuoli_id = isnull(d_sp.id, -2)
    --  ,f.[Ika]
    --  ,Ika_id = isnull(d_ika.id, -2)
    --  ,[Syntymavuosi]
    --  ,[Aidinkielir1_avain]
    --  ,Aidinkielir1_id = isnull(d_ak.id, -2)
    --  ,[Kotikunta_vuotta_aiemmin_avain]
    --  ,Kotikunta_vuotta_aiemmin_id = isnull(d_al.id, -2)
    --  ,[Hetuntila_avain]
    --  ,Hetuntila_id = isnull(d_ho.id, -2)
    --  ,[Toiminta_vuotta_aiemmin_avain]
    --  ,Toiminta_vuotta_aiemmin_id = isnull(d_pt.id, -2)
	Edellinen_haku_avain,
	Edellinen_haku_id = isnull(d_hk.id, -2),
	Edellinen_haku_ajankohta,
	Edellinen_haku_ajankohta_id = isnull(d_sa.id, -2),
	Johdettu_Hakenut_toiselle_asteelle = Cast(Johdettu_Hakenut_toiselle_asteelle as nvarchar(50)),
	Johdettu_Hakenut_korkeakoulutukseen = Cast(Johdettu_Hakenut_korkeakoulutukseen as nvarchar(50)),
	Johdettu_Hakenut = Cast(Johdettu_Hakenut as nvarchar(50)),
	lkm, 
	f.tietolahde,
	rivinumero
FROM ( --f
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''lu'',
Edellinen_haku_ajankohta = ''tilv-1'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhakux=''E'' and ammhakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhakux=''E'' and ammhakux=''E'' and amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luhakux=''K''

UNION ALL
-- edelliset haut, luhaku2x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''lu'',
Edellinen_haku_ajankohta = ''tilv-2'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku2x=''E'' and ammhaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku2x=''E'' and ammhaku2x=''E'' and amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luhaku2x=''K''

UNION ALL
-- edelliset haut, luhaku3x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''lu'',
Edellinen_haku_ajankohta = ''tilv-3'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku3x=''E'' and ammhaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku3x=''E'' and ammhaku3x=''E'' and amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luhaku3x=''K''

UNION ALL
-- edelliset haut, ammhakux
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''amm'',
Edellinen_haku_ajankohta = ''tilv-1'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhakux=''E'' and ammhakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhakux=''E'' and ammhakux=''E'' and amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE ammhakux=''K''

UNION ALL
-- edelliset haut, ammhaku2x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''amm'',
Edellinen_haku_ajankohta = ''tilv-2'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku2x=''E'' and ammhaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku2x=''E'' and ammhaku2x=''E'' and amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE ammhaku2x=''K''

UNION ALL
-- edelliset haut, ammhaku3x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''amm'',
Edellinen_haku_ajankohta = ''tilv-3'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku3x=''E'' and ammhaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku3x=''E'' and ammhaku3x=''E'' and amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE ammhaku3x=''K''

UNION ALL
-- edelliset haut, amkhakux
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''amk'',
Edellinen_haku_ajankohta = ''tilv-1'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhakux=''E'' and ammhakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhakux=''E'' and ammhakux=''E'' and amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhakux=''K''

UNION ALL
-- edelliset haut, amkhaku2x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''amk'',
Edellinen_haku_ajankohta = ''tilv-2'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku2x=''E'' and ammhaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku2x=''E'' and ammhaku2x=''E'' and amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhaku2x=''K''

UNION ALL
-- edelliset haut, amkhaku3x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''amk'',
Edellinen_haku_ajankohta = ''tilv-3'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku3x=''E'' and ammhaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku3x=''E'' and ammhaku3x=''E'' and amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhaku3x=''K''

UNION ALL
-- edelliset haut, yohakux
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''yo'',
Edellinen_haku_ajankohta = ''tilv-1'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhakux=''E'' and ammhakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhakux=''E'' and ammhakux=''E'' and amkhakux=''E'' and yohakux=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakux=''K''

UNION ALL
-- edelliset haut, yohaku2x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''yo'',
Edellinen_haku_ajankohta = ''tilv-2'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku2x=''E'' and ammhaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku2x=''E'' and ammhaku2x=''E'' and amkhaku2x=''E'' and yohaku2x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohaku2x=''K''

UNION ALL
-- edelliset haut, yohaku3x
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''yo'',
Edellinen_haku_ajankohta = ''tilv-3'',
Johdettu_Hakenut_toiselle_asteelle = Case when luhaku3x=''E'' and ammhaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut_korkeakoulutukseen = Case when amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
Johdettu_Hakenut = Case when luhaku3x=''E'' and ammhaku3x=''E'' and amkhaku3x=''E'' and yohaku3x=''E'' then ''E'' else ''K'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohaku3x=''K''

UNION ALL
-- ei edellisiä hakuja
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Edellinen_haku_avain = ''ei'',
Edellinen_haku_ajankohta = ''tilv-ei'',
Johdettu_Hakenut_toiselle_asteelle = ''E'',
Johdettu_Hakenut_korkeakoulutukseen = ''E'',
Johdettu_Hakenut = ''E'',
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE Coalesce(luhakux,'''')<>''K'' and Coalesce(luhaku2x,'''')<>''K'' and Coalesce(luhaku3x,'''')<>''K'' 
	and Coalesce(ammhakux,'''')<>''K'' and Coalesce(ammhaku2x,'''')<>''K'' and Coalesce(ammhaku3x,'''')<>''K'' 
	and Coalesce(amkhakux,'''')<>''K'' and Coalesce(amkhaku2x,'''')<>''K'' and Coalesce(amkhaku3x,'''')<>''K'' 
	and Coalesce(yohakux,'''')<>''K'' and Coalesce(yohaku2x,'''')<>''K'' and Coalesce(yohaku3x,'''')<>''K'' 
) f
--LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
--	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
--LEFT JOIN VipunenTK.dbo.d_ika 
--	ON d_ika.ika_avain = Cast(f.Ika as nvarchar(10))
--LEFT JOIN VipunenTK.dbo.d_aidinkieli_versio1 d_ak
--	ON d_ak.aidinkieli_versio1_koodi = f.Aidinkielir1_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_al
--	ON d_al.alueluokitus_avain = f.Kotikunta_vuotta_aiemmin_avain
--LEFT JOIN VipunenTK.dbo.d_hetu_ok d_ho
--	ON d_ho.hetu_ok_avain = f.Hetuntila_avain
--LEFT JOIN VipunenTK.dbo.d_paaasiallinen_toiminta d_pt
--	ON d_pt.paaasiallinen_toiminta_koodi = f.Toiminta_vuotta_aiemmin_avain
LEFT JOIN VipunenTK.dbo.d_hakukohde d_hk
	ON d_hk.hakukohde_avain = f.Edellinen_haku_avain
LEFT JOIN VipunenTK.dbo.d_suhteellinen_ajankohta d_sa
	ON d_sa.suhteellinen_ajankohta_avain = f.Edellinen_haku_ajankohta

' 
GO
/****** Object:  View [dbo].[v_f_Moninkertainen_haku_hakijat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Moninkertainen_haku_hakijat]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_Moninkertainen_haku_hakijat] AS
--Palauttaa moninkertaisen haun aineistosta K3.16 hakijoiden lukumäärät
--Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_hakijat

--Delete from VipunenTK.dbo.f_Moninkertainen_haku_hakijat 
--Insert into VipunenTK.dbo.f_Moninkertainen_haku_hakijat Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_hakijat

-- Hakijoiden perustiedot ja lukumäärät
SELECT [Tilastovuosi]
      ,[tilv_date]
      ,Koulutuksen_alkamislukukausi_avain
      ,Koulutuksen_alkamislukukausi_date = cast(Tilastovuosi + Case when Koulutuksen_alkamislukukausi = ''2'' then ''-07-01'' else ''-01-01'' end as DATE)
      ,[Sukupuoli_avain]
      ,sukupuoli_id = isnull(d_sp.id, -2)
      ,f.[Ika]
      ,Ika_id = isnull(d_ika.id, -2)
      ,[Syntymavuosi]
      ,[Aidinkielir1_avain]
      ,Aidinkielir1_id = isnull(d_ak.id, -2)
      ,[Kotikunta_vuotta_aiemmin_avain]
      ,Kotikunta_vuotta_aiemmin_id = isnull(d_al.id, -1)
      ,[Hetuntila_avain]
      ,Hetuntila_id = isnull(d_ho.id, -2)
      ,[Toiminta_vuotta_aiemmin_avain]
      ,Toiminta_vuotta_aiemmin_id = isnull(d_pt.id, -1)
      ,[lkm]
      ,f.[tietolahde]
      ,[rivinumero]
FROM (
SELECT 
Tilastovuosi, 
tilv_date,
Koulutuksen_alkamislukukausi_avain,
Koulutuksen_alkamislukukausi,
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
lkm,
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku

) f
LEFT JOIN VipunenTK.dbo.d_kausi
	ON d_kausi.kausi_id = f.Koulutuksen_alkamislukukausi_avain
LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
LEFT JOIN VipunenTK.dbo.d_ika 
	ON d_ika.ika_avain = Cast(f.Ika as nvarchar(10))
LEFT JOIN VipunenTK.dbo.d_aidinkieli_versio1 d_ak
	ON d_ak.aidinkieli_versio1_koodi = f.Aidinkielir1_avain
LEFT JOIN VipunenTK.dbo.d_alueluokitus d_al
	ON d_al.alueluokitus_avain = f.Kotikunta_vuotta_aiemmin_avain
LEFT JOIN VipunenTK.dbo.d_hetu_ok d_ho
	ON d_ho.hetu_ok_avain = f.Hetuntila_avain
LEFT JOIN VipunenTK.dbo.d_paaasiallinen_toiminta d_pt
	ON d_pt.paaasiallinen_toiminta_koodi = f.Toiminta_vuotta_aiemmin_avain
' 
GO
/****** Object:  View [dbo].[v_f_Moninkertainen_haku_uudet_haut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Moninkertainen_haku_uudet_haut]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Moninkertainen_haku_uudet_haut] AS
--Palauttaa moninkertaisen haun aineistosta K3.16 uudet haut
--Select * into VipunenTK.dbo.f_Moninkertainen_haku_uudet_haut from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_uudet_haut

--Delete from VipunenTK.dbo.f_Moninkertainen_haku_uudet_haut 
--Insert into VipunenTK.dbo.f_Moninkertainen_haku_uudet_haut Select * from VipunenTK_DW.dbo.v_f_Moninkertainen_haku_uudet_haut 

-- Uudet haut, haku luamm, prioriteetti 1
SELECT 
	   --CSC Jarmo 11.9.2014
	   --Kommentoidut tiedot löytyvät hakijan tiedoista. Niitä on turha monistaa joka faktatauluun. Rivinumero linkittää eri faktataulut.
	   --[Tilastovuosi]
    --  ,[tilv_date]
    --  ,[Sukupuoli_avain]
    --  ,sukupuoli_id = isnull(d_sp.id, -2)
    --  ,f.[Ika]
    --  ,Ika_id = isnull(d_ika.id, -2)
    --  ,[Syntymavuosi]
    --  ,[Aidinkielir1_avain]
    --  ,Aidinkielir1_id = isnull(d_ak.id, -2)
    --  ,[Kotikunta_vuotta_aiemmin_avain]
    --  ,Kotikunta_vuotta_aiemmin_id = isnull(d_al.id, -2)
    --  ,[Hetuntila_avain]
    --  ,Hetuntila_id = isnull(d_ho.id, -2)
    --  ,[Toiminta_vuotta_aiemmin_avain]
    --  ,Toiminta_vuotta_aiemmin_id = isnull(d_pt.id, -2)
       Hakukohde_avain
      ,Hakukohde_id = ISNULL(d_hk.id, -2)
      ,Hakukohde_oppilaitos_avain
      ,Hakukohde_oppilaitos_id = isnull(d_ol.id, -2)
      ,Hakukohde_oppilaitoksen_alueluokitus_avain = d_ol.sijaintikuntakoodi
      ,Hakukohde_oppilaitoksen_alueluokitus_id = isnull(d_ol_al.id, -2)
      ,Hakukohde_koulutusaste2002_avain
	  ,Hakukohde_koulutusaste2002_id = isnull(d_ka02.id, -1)
	  ,Hakukohde_opintoala2002_avain
	  ,Hakukohde_opintoala2002_id = isnull(d_oa02.id, -1)
	  ,Hakukohde_opintoala1995_avain
	  ,Hakukohde_opintoala1995_id = isnull(d_oa95.id, -1)
	  ,Hakukohde_prioriteetti_avain
	  ,Hakukohde_prioriteetti_id = isnull(d_hp.id, -2)
	  ,f.Hakukohde_hyvaksytty
	  ,f.Hakukohde_vastaanotettu
	  ,Hakukohteen_tulos_id = isnull(d_ht.id, -2)
	  ,f.Hakukohde_tutkinnon_taso
	  ,f.Hakukohde_tutkinnon_taso_tarkennus
	  ,Hakukohde_tutkinnon_taso_id = isnull(d_htt.id, -1)
	  ,f.Hakukohde_erillisvalinta
	  ,Hakukohde_erillisvalinta_id = isnull(d_hev.id, -1)
	  ,Hakukohde_koulutuksen_alkamislukukausi_avain
	  ,Hakukohde_koulutuksen_alkamislukukausi_id = isnull(d_kau.kausi_id, -2)

--Johdetut muuttujat
	  ,Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_sektori_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_sektori_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = CAST(Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = CAST(Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku as nvarchar(50))
	  ,Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = CAST(Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = CAST(Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku as nvarchar(50))
	  ,Johdettu_Hakenut_Amk_ja_Yo = Cast(Johdettu_Hakenut_Amk_ja_Yo as nvarchar(50))
	  ,Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Cast(Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste as nvarchar(50))
	  ,Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Cast(Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus as nvarchar(50))

	  ,[lkm]
      ,f.[tietolahde]
      ,[rivinumero]
FROM ( --f
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = Case when luammhaku1_opmast=''31'' then ''lu'' else ''amm'' end, --''luamm'',
Hakukohde_oppilaitos_avain = luammhaku1_tunn, 
Hakukohde_koulutusaste2002_avain = luammhaku1_opmast_avain, 
Hakukohde_opintoala2002_avain = luammhaku1_opmopa_avain, 
Hakukohde_opintoala1995_avain = luammhaku1_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_1'', 
Hakukohde_hyvaksytty = luammhaku1_hyv,
Hakukohde_vastaanotettu = luammhaku1_vastotto,
Hakukohde_tutkinnon_taso = ''-1'',
Hakukohde_tutkinnon_taso_tarkennus = ''-1'',
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when luammhaku1_tunn in (yotutkopisxtunn, ammopisxtunn) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when luammhaku1_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end, 
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when luammhaku1_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when luammhaku1_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when luammhaku1_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when luammhaku1_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when luammhaku1_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when luammhaku1_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2)  in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when luammhaku1_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when luammhaku1_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when luammhaku1_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when luammhaku1_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when luammhaku1_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when luammhaku1_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when luammhaku1_opmast=''31'' 
	then --lu
	Case when ''K'' in (yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (ammopisx) then ''K'' else ''E'' end
	end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when luammhaku1_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk, yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm, ammopisx) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikyotutk, aikamm) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx, aikyotutk, aikamm) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luammhaku1_tunn<>''''

UNION ALL
-- Uudet haut, haku luamm, prioriteetti 2
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika,
Syntymavuosi,  
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = Case when luammhaku2_opmast=''31'' then ''lu'' else ''amm'' end, --''luamm'',
Hakukohde_oppilaitos_avain = luammhaku2_tunn, 
Hakukohde_koulutusaste2002_avain = luammhaku2_opmast_avain, 
Hakukohde_opintoala2002_avain = luammhaku2_opmopa_avain, 
Hakukohde_opintoala1995_avain = luammhaku2_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_2'', 
Hakukohde_hyvaksytty = luammhaku2_hyv,
Hakukohde_vastaanotettu = luammhaku2_vastotto,
Hakukohde_tutkinnon_taso = ''-1'',
Hakukohde_tutkinnon_taso_tarkennus = ''-1'',
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when luammhaku2_tunn in (yotutkopisxtunn, ammopisxtunn) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when luammhaku2_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when luammhaku2_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when luammhaku2_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when luammhaku2_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when luammhaku2_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when luammhaku2_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when luammhaku2_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2)  in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when luammhaku2_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when luammhaku2_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when luammhaku2_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when luammhaku2_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when luammhaku2_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when luammhaku2_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when luammhaku2_opmast=''31'' 
	then --lu
	Case when ''K'' in (yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (ammopisx) then ''K'' else ''E'' end
	end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when luammhaku2_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk, yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm, ammopisx) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikyotutk, aikamm) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx, aikyotutk, aikamm) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luammhaku2_tunn<>''''

UNION ALL
-- Uudet haut, haku luamm, prioriteetti 3
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = Case when luammhaku3_opmast=''31'' then ''lu'' else ''amm'' end, --''luamm'',
Hakukohde_oppilaitos_avain = luammhaku3_tunn, 
Hakukohde_koulutusaste2002_avain = luammhaku3_opmast_avain, 
Hakukohde_opintoala2002_avain = luammhaku3_opmopa_avain, 
Hakukohde_opintoala1995_avain = luammhaku3_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_3'', 
Hakukohde_hyvaksytty = luammhaku3_hyv,
Hakukohde_vastaanotettu = luammhaku3_vastotto,
Hakukohde_tutkinnon_taso = ''-1'',
Hakukohde_tutkinnon_taso_tarkennus = ''-1'',
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when luammhaku3_tunn in (yotutkopisxtunn, ammopisxtunn) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when luammhaku3_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when luammhaku3_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when luammhaku3_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when luammhaku3_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when luammhaku3_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when luammhaku3_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when luammhaku3_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2)  in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when luammhaku3_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when luammhaku3_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when luammhaku3_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when luammhaku3_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when luammhaku3_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when luammhaku3_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when luammhaku3_opmast=''31'' 
	then --lu
	Case when ''K'' in (yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (ammopisx) then ''K'' else ''E'' end
	end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when luammhaku3_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk, yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm, ammopisx) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikyotutk, aikamm) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx, aikyotutk, aikamm) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luammhaku3_tunn<>''''

UNION ALL
-- Uudet haut, haku luamm, prioriteetti 4
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika,
Syntymavuosi,  
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = Case when luammhaku4_opmast=''31'' then ''lu'' else ''amm'' end, --''luamm'',
Hakukohde_oppilaitos_avain = luammhaku4_tunn, 
Hakukohde_koulutusaste2002_avain = luammhaku4_opmast_avain, 
Hakukohde_opintoala2002_avain = luammhaku4_opmopa_avain, 
Hakukohde_opintoala1995_avain = luammhaku4_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_4'', 
Hakukohde_hyvaksytty = luammhaku4_hyv,
Hakukohde_vastaanotettu = luammhaku4_vastotto,
Hakukohde_tutkinnon_taso = ''-1'',
Hakukohde_tutkinnon_taso_tarkennus = ''-1'',
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when luammhaku4_tunn in (yotutkopisxtunn, ammopisxtunn) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when luammhaku4_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when luammhaku4_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when luammhaku4_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when luammhaku4_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when luammhaku4_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when luammhaku4_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when luammhaku4_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2)  in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when luammhaku4_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when luammhaku4_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when luammhaku4_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when luammhaku4_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when luammhaku4_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when luammhaku4_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when luammhaku4_opmast=''31'' 
	then --lu
	Case when ''K'' in (yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (ammopisx) then ''K'' else ''E'' end
	end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when luammhaku4_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk, yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm, ammopisx) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikyotutk, aikamm) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx, aikyotutk, aikamm) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luammhaku4_tunn<>''''

UNION ALL
-- Uudet haut, haku luamm, prioriteetti 5
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = Case when luammhaku5_opmast=''31'' then ''lu'' else ''amm'' end, --''luamm'',
Hakukohde_oppilaitos_avain = luammhaku5_tunn, 
Hakukohde_koulutusaste2002_avain = luammhaku5_opmast_avain, 
Hakukohde_opintoala2002_avain = luammhaku5_opmopa_avain, 
Hakukohde_opintoala1995_avain = luammhaku5_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_5'', 
Hakukohde_hyvaksytty = luammhaku5_hyv,
Hakukohde_vastaanotettu = luammhaku5_vastotto,
Hakukohde_tutkinnon_taso = ''-1'',
Hakukohde_tutkinnon_taso_tarkennus = ''-1'',
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when luammhaku5_tunn in (yotutkopisxtunn, ammopisxtunn) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when luammhaku5_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when luammhaku5_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when luammhaku5_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when luammhaku5_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when luammhaku5_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when luammhaku5_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when luammhaku5_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2)  in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when luammhaku5_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when luammhaku5_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when luammhaku5_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when luammhaku5_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when luammhaku5_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when luammhaku5_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when luammhaku5_opmast=''31'' 
	then --lu
	Case when ''K'' in (yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (ammopisx) then ''K'' else ''E'' end
	end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when luammhaku5_opmast=''31'' 
	then --lu
	Case when ''K'' in (aikyotutk, yotutkopisx) then ''K'' else ''E'' end
	else --amm
	Case when ''K'' in (aikamm, ammopisx) then ''K'' else ''E'' end
	end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikyotutk, aikamm) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (yotutkopisx, ammopisx, aikyotutk, aikamm) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE luammhaku5_tunn<>''''

UNION ALL
-- Uudet haut, haku amk, prioriteetti 1
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''amk'',
Hakukohde_oppilaitos_avain = amkhaku1_tunn, 
Hakukohde_koulutusaste2002_avain = amkhaku1_opmast_avain, 
Hakukohde_opintoala2002_avain = amkhaku1_opmopa_avain, 
Hakukohde_opintoala1995_avain = amkhaku1_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_1'', 
Hakukohde_hyvaksytty = amkhaku1_hyv,
Hakukohde_vastaanotettu = amkhaku1_vastotto,
Hakukohde_tutkinnon_taso = Case when amkhaku1_koultyp <> '''' then ''AMK'' + amkhaku1_koultyp else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when amkhaku1_koultyp <> '''' then ''AMKTA'' + amkhaku1_koultyp else ''-1'' end,
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when amkhaku1_tunn in (amkopisxtunn1,amkopisxtunn2,amkopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when amkhaku1_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when amkhaku1_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when amkhaku1_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when amkhaku1_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when amkhaku1_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when amkhaku1_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when amkhaku1_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when amkhaku1_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when amkhaku1_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala)
 ) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when amkhaku1_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when amkhaku1_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when amkhaku1_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhaku1_tunn<>''''

UNION ALL
-- Uudet haut, haku amk, prioriteetti 2
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''amk'',
Hakukohde_oppilaitos_avain = amkhaku2_tunn, 
Hakukohde_koulutusaste2002_avain = amkhaku2_opmast_avain, 
Hakukohde_opintoala2002_avain = amkhaku2_opmopa_avain, 
Hakukohde_opintoala1995_avain = amkhaku2_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_2'', 
Hakukohde_hyvaksytty = amkhaku2_hyv,
Hakukohde_vastaanotettu = amkhaku2_vastotto,
Hakukohde_tutkinnon_taso = Case when amkhaku2_koultyp <> '''' then ''AMK'' + amkhaku2_koultyp else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when amkhaku2_koultyp <> '''' then ''AMKTA'' + amkhaku2_koultyp else ''-1'' end,
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when amkhaku2_tunn in (amkopisxtunn1,amkopisxtunn2,amkopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when amkhaku2_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when amkhaku2_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when amkhaku2_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when amkhaku2_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when amkhaku2_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when amkhaku2_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when amkhaku2_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when amkhaku2_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when amkhaku2_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala)
 ) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when amkhaku2_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when amkhaku2_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when amkhaku2_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhaku2_tunn<>''''

UNION ALL
-- Uudet haut, haku amk, prioriteetti 3
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''amk'',
Hakukohde_oppilaitos_avain = amkhaku3_tunn, 
Hakukohde_koulutusaste2002_avain = amkhaku3_opmast_avain, 
Hakukohde_opintoala2002_avain = amkhaku3_opmopa_avain, 
Hakukohde_opintoala1995_avain = amkhaku3_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_3'', 
Hakukohde_hyvaksytty = amkhaku3_hyv,
Hakukohde_vastaanotettu = amkhaku3_vastotto,
Hakukohde_tutkinnon_taso = Case when amkhaku3_koultyp <> '''' then ''AMK'' + amkhaku3_koultyp else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when amkhaku3_koultyp <> '''' then ''AMKTA'' + amkhaku3_koultyp else ''-1'' end,
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when amkhaku3_tunn in (amkopisxtunn1,amkopisxtunn2,amkopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when amkhaku3_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when amkhaku3_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when amkhaku3_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when amkhaku3_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when amkhaku3_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when amkhaku3_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when amkhaku3_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when amkhaku3_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when amkhaku3_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala)
 ) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when amkhaku3_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when amkhaku3_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when amkhaku3_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhaku3_tunn<>''''

UNION ALL
-- Uudet haut, haku amk, prioriteetti 4
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''amk'',
Hakukohde_oppilaitos_avain = amkhaku4_tunn, 
Hakukohde_koulutusaste2002_avain = amkhaku4_opmast_avain, 
Hakukohde_opintoala2002_avain = amkhaku4_opmopa_avain, 
Hakukohde_opintoala1995_avain = amkhaku4_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_4'', 
Hakukohde_hyvaksytty = amkhaku4_hyv,
Hakukohde_vastaanotettu = amkhaku4_vastotto,
Hakukohde_tutkinnon_taso = Case when amkhaku4_koultyp <> '''' then ''AMK'' + amkhaku4_koultyp else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when amkhaku4_koultyp <> '''' then ''AMKTA'' + amkhaku4_koultyp else ''-1'' end,
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when amkhaku4_tunn in (amkopisxtunn1,amkopisxtunn2,amkopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when amkhaku4_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when amkhaku4_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when amkhaku4_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when amkhaku4_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when amkhaku4_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when amkhaku4_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when amkhaku4_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when amkhaku4_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when amkhaku4_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala)
 ) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when amkhaku4_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when amkhaku4_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when amkhaku4_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhaku4_tunn<>''''

UNION ALL
-- Uudet haut, haku amk, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''amk'',
Hakukohde_oppilaitos_avain = amkhakum_tunn, 
Hakukohde_koulutusaste2002_avain = amkhakum_opmast_avain, 
Hakukohde_opintoala2002_avain = amkhakum_opmopa_avain, 
Hakukohde_opintoala1995_avain = amkhakum_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_muu'', 
Hakukohde_hyvaksytty = amkhakum_hyv,
Hakukohde_vastaanotettu = amkhakum_vastotto,
Hakukohde_tutkinnon_taso = Case when amkhakum_koultyp <> '''' then ''AMK'' + amkhakum_koultyp else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when amkhakum_koultyp <> '''' then ''AMKTA'' + amkhakum_koultyp else ''-1'' end,
Hakukohde_erillisvalinta = ''-1'',
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when amkhakum_tunn in (amkopisxtunn1,amkopisxtunn2,amkopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when amkhakum_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when amkhakum_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when amkhakum_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when amkhakum_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when amkhakum_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when amkhakum_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when amkhakum_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when amkhakum_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when amkhakum_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala)
 ) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when amkhakum_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when amkhakum_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when amkhakum_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, amkopisx1, amkopisx2, amkopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE amkhakum_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde a, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakua_tunn, 
Hakukohde_koulutusaste2002_avain = yohakua_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakua_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakua_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakua_hyv,
Hakukohde_vastaanotettu = yohakua_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakua_harekast <> '''' then ''YO'' + yohakua_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakua_ylempi <> '''' then ''YOTA'' + yohakua_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakua_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakua_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakua_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakua_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakua_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakua_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakua_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakua_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakua_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakua_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakua_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakua_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakua_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakua_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakua_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde b, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakub_tunn, 
Hakukohde_koulutusaste2002_avain = yohakub_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakub_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakub_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakub_hyv,
Hakukohde_vastaanotettu = yohakub_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakub_harekast <> '''' then ''YO'' + yohakub_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakub_ylempi <> '''' then ''YOTA'' + yohakub_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakub_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakub_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakub_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakub_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakub_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakub_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakub_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakub_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakub_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakub_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakub_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakub_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakub_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakub_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakub_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde c, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakuc_tunn, 
Hakukohde_koulutusaste2002_avain = yohakuc_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakuc_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakuc_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakuc_hyv,
Hakukohde_vastaanotettu = yohakuc_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakuc_harekast <> '''' then ''YO'' + yohakuc_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakuc_ylempi <> '''' then ''YOTA'' + yohakuc_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakuc_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakuc_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakuc_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakuc_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakuc_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakuc_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakuc_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakuc_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakuc_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakuc_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakuc_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakuc_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakuc_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakuc_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakuc_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde d, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakud_tunn, 
Hakukohde_koulutusaste2002_avain = yohakud_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakud_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakud_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakud_hyv,
Hakukohde_vastaanotettu = yohakud_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakud_harekast <> '''' then ''YO'' + yohakud_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakud_ylempi <> '''' then ''YOTA'' + yohakud_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakud_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakud_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakud_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakud_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakud_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakud_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakud_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakud_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakud_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakud_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakud_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakud_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakud_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakud_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakud_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde e, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakue_tunn, 
Hakukohde_koulutusaste2002_avain = yohakue_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakue_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakue_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakue_hyv,
Hakukohde_vastaanotettu = yohakue_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakue_harekast <> '''' then ''YO'' + yohakue_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakue_ylempi <> '''' then ''YOTA'' + yohakue_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakue_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakue_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakue_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakue_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakue_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakue_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakue_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakue_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakue_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakue_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakue_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakue_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakue_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakue_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakue_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde f, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakuf_tunn, 
Hakukohde_koulutusaste2002_avain = yohakuf_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakuf_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakuf_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakuf_hyv,
Hakukohde_vastaanotettu = yohakuf_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakuf_harekast <> '''' then ''YO'' + yohakuf_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakuf_ylempi <> '''' then ''YOTA'' + yohakuf_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakuf_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakuf_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakuf_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakuf_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakuf_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakuf_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakuf_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakuf_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakuf_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakuf_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakuf_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakuf_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakuf_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakuf_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakuf_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde g, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakug_tunn, 
Hakukohde_koulutusaste2002_avain = yohakug_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakug_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakug_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakug_hyv,
Hakukohde_vastaanotettu = yohakug_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakug_harekast <> '''' then ''YO'' + yohakug_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakug_ylempi <> '''' then ''YOTA'' + yohakug_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakug_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakug_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakug_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakug_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakug_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakug_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakug_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakug_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakug_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakug_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakug_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakug_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakug_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakug_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakug_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde h, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakuh_tunn, 
Hakukohde_koulutusaste2002_avain = yohakuh_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakuh_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakuh_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakuh_hyv,
Hakukohde_vastaanotettu = yohakuh_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakuh_harekast <> '''' then ''YO'' + yohakuh_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakuh_ylempi <> '''' then ''YOTA'' + yohakuh_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakuh_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakuh_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakuh_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakuh_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakuh_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakuh_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakuh_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakuh_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakuh_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakuh_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakuh_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakuh_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakuh_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakuh_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakuh_tunn<>''''

UNION ALL
-- Uudet haut, haku yo, kohde i, prioriteetti muu
SELECT 
Tilastovuosi, 
tilv_date, 
Sukupuoli_avain, 
Ika, 
Syntymavuosi, 
Aidinkielir1_avain, 
Kotikunta_vuotta_aiemmin_avain,  
Hetuntila_avain = htok,
Toiminta_vuotta_aiemmin_avain = ptoim1r3x,
Haku_avain = ''yo'',
Hakukohde_oppilaitos_avain = yohakui_tunn, 
Hakukohde_koulutusaste2002_avain = yohakui_opmast_avain, 
Hakukohde_opintoala2002_avain = yohakui_opmopa_avain, 
Hakukohde_opintoala1995_avain = yohakui_opm95opa_avain, 
Hakukohde_prioriteetti_avain = ''pr_ei'', 
Hakukohde_hyvaksytty = yohakui_hyv,
Hakukohde_vastaanotettu = yohakui_vastotto,
Hakukohde_tutkinnon_taso = Case when yohakui_harekast <> '''' then ''YO'' + yohakui_harekast else ''-1'' end,
Hakukohde_tutkinnon_taso_tarkennus = Case when yohakui_ylempi <> '''' then ''YOTA'' + yohakui_ylempi else ''-1'' end,
Hakukohde_erillisvalinta = yohakui_erval,
Hakukohde_koulutuksen_alkamislukukausi_avain = Koulutuksen_alkamislukukausi_avain,
--Johdettu_Hakija_opiskelee_hakukohteessa = Case when yohakui_tunn in (yoopisxtunn1,yoopisxtunn2,yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_koulutusaste02_Aiempi_tutkinto_Haku = Case when yohakui_opmast in (aikyotutkkoulk_opmast, aikammkoulk_opmast, aikamkkoulk_opmast, aikylamkkoulk_opmast, aikalkkkoulk_opmast, aikylkkkoulk_opmast, aiklistrikoulk_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusaste02_Aiempi_opiskelu_Haku = Case when yohakui_opmast in (yotutkopisxkoulk_opmast, ammopisxkoulk_opmast, amkopisxkoulk1_opmast, amkopisxkoulk2_opmast, amkopisxkoulk3_opmast, yoopisxkoulk1_opmast, yoopisxkoulk2_opmast, yoopisxkoulk3_opmast) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_tutkinto_Haku = case when yohakui_opm95opa  in (aikyotutkkoulk_opm95opa, aikammkoulk_opm95opa, aikamkkoulk_opm95opa, aikylamkkoulk_opm95opa, aikalkkkoulk_opm95opa, aikylkkkoulk_opm95opa, aiklistrikoulk_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala95_Aiempi_opiskelu_Haku = Case when yohakui_opm95opa in (yotutkopisxkoulk_opm95opa, ammopisxkoulk_opm95opa, amkopisxkoulk1_opm95opa, amkopisxkoulk2_opm95opa, amkopisxkoulk3_opm95opa, yoopisxkoulk1_opm95opa, yoopisxkoulk2_opm95opa, yoopisxkoulk3_opm95opa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_tutkinto_Haku = Case when yohakui_opmopa in (aikyotutkkoulk_opmopa, aikammkoulk_opmopa, aikamkkoulk_opmopa, aikylamkkoulk_opmopa, aikalkkkoulk_opmopa, aikylkkkoulk_opmopa, aiklistrikoulk_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_opintoala02_Aiempi_opiskelu_Haku = Case when yohakui_opmopa in (yotutkopisxkoulk_opmopa, ammopisxkoulk_opmopa, amkopisxkoulk1_opmopa, amkopisxkoulk2_opmopa, amkopisxkoulk3_opmopa, yoopisxkoulk1_opmopa, yoopisxkoulk2_opmopa, yoopisxkoulk3_opmopa) then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_tutkinto_Haku = case when yohakui_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (aikyotutkkoulk_opm95ala, aikammkoulk_opm95ala, aikamkkoulk_opm95ala, aikylamkkoulk_opm95ala, aikalkkkoulk_opm95ala, aikylkkkoulk_opm95ala, aiklistrikoulk_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala95_Aiempi_opiskelu_Haku = Case when yohakui_opm95ala
 in (select koulutusala1995_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,8)=''OPM95ALA'' and SUBSTRING(koulutusluokitus_avain,9,2) in (yotutkopisxkoulk_opm95ala, ammopisxkoulk_opm95ala, amkopisxkoulk1_opm95ala, amkopisxkoulk2_opm95ala, amkopisxkoulk3_opm95ala, yoopisxkoulk1_opm95ala, yoopisxkoulk2_opm95ala, yoopisxkoulk3_opm95ala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_tutkinto_Haku = Case when yohakui_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (aikyotutkkoulk_opmala, aikammkoulk_opmala, aikamkkoulk_opmala, aikylamkkoulk_opmala, aikalkkkoulk_opmala, aikylkkkoulk_opmala, aiklistrikoulk_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_koulutusala02_Aiempi_opiskelu_Haku = Case when yohakui_opmala
 in (select koulutusala2002_koodi from VipunenTK.dbo.d_koulutusluokitus where left(koulutusluokitus_avain,6)=''OPMALA'' and SUBSTRING(koulutusluokitus_avain,7,4) in (yotutkopisxkoulk_opmala, ammopisxkoulk_opmala, amkopisxkoulk1_opmala, amkopisxkoulk2_opmala, amkopisxkoulk3_opmala, yoopisxkoulk1_opmala, yoopisxkoulk2_opmala, yoopisxkoulk3_opmala))
  then ''K'' else ''E'' end,
Johdettu_Sama_oppilaitos_Aiempi_tutkinto_Haku = Case when yohakui_tunn in (tunnyotutk, tunnamm, tunnamk, tunnylamk, tunnalkk, tunnylkk, tunnlistri) then ''K'' else ''E'' end,	
Johdettu_Sama_oppilaitos_Aiempi_opiskelu_Haku = Case when yohakui_tunn in (yotutkopisxtunn, ammopisxtunn, amkopisxtunn1, amkopisxtunn2, amkopisxtunn3, yoopisxtunn1, yoopisxtunn2, yoopisxtunn3) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikalkk, aikylkk, aiklistri, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri) then ''K'' else ''E'' end,	
Johdettu_Sama_laaja_sektori_Aiempi_opiskelu_Haku = Case when ''K'' in (amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Sama_laaja_sektori_Aiempi_tutkinto_tai_opiskelu_Haku = Case when ''K'' in (aikamk, aikylamk, aikalkk, aikylkk, aiklistri, amkopisx1, amkopisx2, amkopisx3, yoopisx1, yoopisx2, yoopisx3) then ''K'' else ''E'' end,
Johdettu_Hakenut_Amk_ja_Yo = Case when 
	(amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>'''')
	and (yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Korkea_aste_ja_Toinen_aste = Case when 
	(luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''' or luammhaku1_tunn<>'''')
	and (amkhaku1_tunn<>'''' or amkhaku2_tunn<>'''' or amkhaku3_tunn<>'''' or amkhaku4_tunn<>'''' or amkhakum_tunn<>''''
			or yohakua_tunn<>'''' or yohakub_tunn<>'''' or yohakuc_tunn<>'''' or yohakud_tunn<>'''' or yohakue_tunn<>'''' or yohakuf_tunn<>'''' or yohakug_tunn<>'''' or yohakuh_tunn<>'''' or yohakui_tunn<>'''') 
	then ''K'' else ''E'' end,
Johdettu_Hakenut_Lukio_ja_Ammatillinen_koulutus = Case when 
	((luammhaku1_tunn<>'''' and luammhaku1_opmast=''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast=''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast=''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast=''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast=''31''))
	and ((luammhaku1_tunn<>'''' and luammhaku1_opmast<>''31'') or (luammhaku2_tunn<>'''' and luammhaku2_opmast<>''31'') or (luammhaku3_tunn<>'''' and luammhaku3_opmast<>''31'') or (luammhaku4_tunn<>'''' and luammhaku4_opmast<>''31'') or (luammhaku5_tunn<>'''' and luammhaku5_opmast<>''31''))
	then ''K'' else ''E'' end,
lkm, 
tietolahde,
rivinumero
FROM VipunenTK_DW.dbo.f_K3_16_Moninkertainen_haku
WHERE yohakui_tunn<>''''

) f
--LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
--	ON d_sp.sukupuoli_koodi = f.sukupuoli_avain
--LEFT JOIN VipunenTK.dbo.d_ika 
--	ON d_ika.ika_avain = Cast(f.Ika as nvarchar(10))
--LEFT JOIN VipunenTK.dbo.d_aidinkieli_versio1 d_ak
--	ON d_ak.aidinkieli_versio1_koodi = f.Aidinkielir1_avain
--LEFT JOIN VipunenTK.dbo.d_alueluokitus d_al
--	ON d_al.alueluokitus_avain = f.Kotikunta_vuotta_aiemmin_avain
--LEFT JOIN VipunenTK.dbo.d_hetu_ok d_ho
--	ON d_ho.hetu_ok_avain = f.Hetuntila_avain
--LEFT JOIN VipunenTK.dbo.d_paaasiallinen_toiminta d_pt
--	ON d_pt.paaasiallinen_toiminta_koodi = f.Toiminta_vuotta_aiemmin_avain
LEFT JOIN VipunenTK.dbo.d_hakukohde d_hk
	ON d_hk.hakukohde_avain = f.Haku_avain
LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d_ol
	ON d_ol.oppilaitos_avain = f.Hakukohde_oppilaitos_avain
LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ol_al
	ON d_ol_al.alueluokitus_avain = d_ol.sijaintikuntakoodi
LEFT JOIN VipunenTK.dbo.d_koulutusluokitus d_ka02
	ON d_ka02.koulutusluokitus_avain = f.Hakukohde_koulutusaste2002_avain
LEFT JOIN VipunenTK.dbo.d_koulutusluokitus d_oa02
	ON d_oa02.koulutusluokitus_avain = f.Hakukohde_opintoala2002_avain
LEFT JOIN VipunenTK.dbo.d_koulutusluokitus d_oa95
	ON d_oa95.koulutusluokitus_avain = f.Hakukohde_opintoala1995_avain
LEFT JOIN VipunenTK.dbo.d_hakukohteen_prioriteetti d_hp
	ON d_hp.hakukohteen_prioriteetti_avain = f.Hakukohde_prioriteetti_avain
LEFT JOIN VipunenTK.dbo.d_hakukohteen_tulos d_ht
	ON d_ht.hakukohde_hyvaksytty_koodi = f.Hakukohde_hyvaksytty
	AND d_ht.hakukohde_vastaanotettu_koodi = f.Hakukohde_vastaanotettu
LEFT JOIN VipunenTK.dbo.d_hakukohteen_tutkinnon_taso d_htt
	ON d_htt.hakukohde_tutkinnon_taso_koodi = f.Hakukohde_tutkinnon_taso
	AND d_htt.Hakukohde_tutkinnon_taso_tarkennus_koodi = f.Hakukohde_tutkinnon_taso_tarkennus
LEFT JOIN VipunenTK.dbo.d_hakukohde_erillisvalinta d_hev
	ON d_hev.hakukohde_erillisvalinta_avain = f.Hakukohde_erillisvalinta
LEFT JOIN VipunenTK.dbo.d_kausi d_kau
	ON d_kau.kausi_id = f.Hakukohde_koulutuksen_alkamislukukausi_avain

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_erityisen_tuen_oppilaiden_opetus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_erityisen_tuen_oppilaiden_opetus]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_erityisen_tuen_oppilaiden_opetus] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d4.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d5.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  kaikki.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d2.id,-2),
  kaikki.perusopetuksen_yleisopetuksen_osuus,
  perusopetuksen_yleisopetuksen_osuus_id=ISNULL(d3.id,-2),
  erityisen_tuen_oppilaiden_opetus
  
  FROM

(

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int4'',
  erityisen_tuen_oppilaiden_opetus=inte4
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE inte4>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int4'',
  erityisen_tuen_oppilaiden_opetus=int164
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int164>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int4'',
  erityisen_tuen_oppilaiden_opetus=int794
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int794>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int4'',
  erityisen_tuen_oppilaiden_opetus=intl4
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE intl4>0

--
UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int3'',
  erityisen_tuen_oppilaiden_opetus=inte3
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE inte3>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int3'',
  erityisen_tuen_oppilaiden_opetus=int163
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int163>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int3'',
  erityisen_tuen_oppilaiden_opetus=int793
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int793>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int3'',
  erityisen_tuen_oppilaiden_opetus=intl3
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE intl3>0

--
UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int2'',
  erityisen_tuen_oppilaiden_opetus=inte2
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE inte2>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int2'',
  erityisen_tuen_oppilaiden_opetus=int162
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int162>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int2'',
  erityisen_tuen_oppilaiden_opetus=int792
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int792>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int2'',
  erityisen_tuen_oppilaiden_opetus=intl2
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE intl2>0

--
UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int1'',
  erityisen_tuen_oppilaiden_opetus=inte1
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE inte1>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int1'',
  erityisen_tuen_oppilaiden_opetus=int161
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int161>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int1'',
  erityisen_tuen_oppilaiden_opetus=int791
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int791>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int1'',
  erityisen_tuen_oppilaiden_opetus=intl1
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE intl1>0

--
UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int0'',
  erityisen_tuen_oppilaiden_opetus=inte0
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE inte0>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int0'',
  erityisen_tuen_oppilaiden_opetus=int160
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int160>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int0'',
  erityisen_tuen_oppilaiden_opetus=int790
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE int790>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_yleisopetuksen_osuus=''int0'',
  erityisen_tuen_oppilaiden_opetus=intl0
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE intl0>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_yleisopetuksen_osuus=''int_ei'',
  erityisen_tuen_oppilaiden_opetus=ove-intey
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ove-intey>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_yleisopetuksen_osuus=''int_ei'',
  erityisen_tuen_oppilaiden_opetus=ov1+ov2+ov3+ov4+ov5+ov6-int16y
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov1+ov2+ov3+ov4+ov5+ov6-int16y>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_yleisopetuksen_osuus=''int_ei'',
  erityisen_tuen_oppilaiden_opetus=ov7+ov8+ov9-int79y
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov7+ov8+ov9-int79y>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_yleisopetuksen_osuus=''int_ei'',
  erityisen_tuen_oppilaiden_opetus=ov10-intly
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov10-intly>0


) kaikki


LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=kaikki.perusopetuksen_vuosiluokat

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d2
ON d2.perusopetuksen_erityisen_tuen_paatos_koodi=kaikki.perusopetuksen_erityisen_tuen_paatos

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_yleisopetuksen_osuus d3
ON d3.perusopetuksen_yleisopetuksen_osuus_koodi=kaikki.perusopetuksen_yleisopetuksen_osuus

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d4
ON d4.oppilaitoskoodi=kaikki.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d5
ON d5.alueluokitus_avain=d4.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_erityisen_tuen_oppilaiden_oppimaara]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_erityisen_tuen_oppilaiden_oppimaara]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_erityisen_tuen_oppilaiden_oppimaara] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_oppimaaran_yksilollistaminen,
  perusopetuksen_oppimaaran_yksilollistaminen_id=ISNULL(d3.id,-2),
  erityisen_tuen_oppilaiden_oppimaara
  FROM
(


SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks0'',
  erityisen_tuen_oppilaiden_oppimaara=yks160
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks160>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks0'',
  erityisen_tuen_oppilaiden_oppimaara=yks790
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks790>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks0'',
  erityisen_tuen_oppilaiden_oppimaara=yksl0
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yksl0>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks1'',
  erityisen_tuen_oppilaiden_oppimaara=yks161
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks161>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks1'',
  erityisen_tuen_oppilaiden_oppimaara=yks791
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks791>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks1'',
  erityisen_tuen_oppilaiden_oppimaara=yksl1
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yksl1>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks2'',
  erityisen_tuen_oppilaiden_oppimaara=yks162
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks162>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks2'',
  erityisen_tuen_oppilaiden_oppimaara=yks792
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks792>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks2'',
  erityisen_tuen_oppilaiden_oppimaara=yksl2
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yksl2>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks4'',
  erityisen_tuen_oppilaiden_oppimaara=yks164
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks164>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks4'',
  erityisen_tuen_oppilaiden_oppimaara=yks794
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks794>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks4'',
  erityisen_tuen_oppilaiden_oppimaara=yksl4
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yksl4>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''ykst'',
  erityisen_tuen_oppilaiden_oppimaara=yks16t
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks16t>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''ykst'',
  erityisen_tuen_oppilaiden_oppimaara=yks79t
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE yks79t>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_oppimaaran_yksilollistaminen=''ykst'',
  erityisen_tuen_oppilaiden_oppimaara=ykslt
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ykslt>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_6'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks_ei'',
  erityisen_tuen_oppilaiden_oppimaara=ov1+ov2+ov3+ov4+ov5+ov6-yks16y
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov1+ov2+ov3+ov4+ov5+ov6-yks16y>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks_ei'',
  erityisen_tuen_oppilaiden_oppimaara=ov7+ov8+ov9-yks79y
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov7+ov8+ov9-yks79y>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_oppimaaran_yksilollistaminen=''yks_ei'',
  erityisen_tuen_oppilaiden_oppimaara=ov10-yksly
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov10-yksly>0


) fakta

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d2
ON d2.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_oppimaaran_yksilollistaminen d3
ON d3.perusopetuksen_oppimaaran_yksilollistaminen_koodi=fakta.perusopetuksen_oppimaaran_yksilollistaminen

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_jopo_oppilaat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_jopo_oppilaat]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_jopo_oppilaat] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.sukupuoli,
  sukupuoli_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d3.id,-2),
  fakta.perusopetuksen_pidennetty_oppivelvollisuus,
  perusopetuksen_pidennetty_oppivelvollisuus_id=ISNULL(d4.id,-2),
  fakta.joustava_perusopetus,
  joustava_perusopetus_id=ISNULL(d5.id,-2),
  jopo_oppilaat
  
  FROM
(


SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  sukupuoli=2, --naiset
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  joustava_perusopetus=''K'',
  jopo_oppilaat=jopon
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE jopon>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  sukupuoli=1, --miehet
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  joustava_perusopetus=''K'',
  jopo_oppilaat=jopo-jopon
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE jopo-jopon>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  sukupuoli=1, --miehet
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  joustava_perusopetus=''E'',
  jopo_oppilaat=(ov7-ov7n)+(ov8-ov8n)+(ov9-ov9n)-(jopo-jopon)
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE (ov7-ov7n)+(ov8-ov8n)+(ov9-ov9n)-(jopo-jopon)>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7_9'',
  sukupuoli=2, --naiset
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  joustava_perusopetus=''E'',
  jopo_oppilaat=ov7n+ov8n+ov9n-jopon
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov7n+ov8n+ov9n-jopon>0

) fakta

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat
 
LEFT JOIN VipunenTK.dbo.d_sukupuoli d2
ON d2.sukupuoli_koodi=fakta.sukupuoli

LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d3
ON d3.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos
  
LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus d4
ON d4.perusopetuksen_pidennetty_oppivelvollisuus_koodi=fakta.perusopetuksen_pidennetty_oppivelvollisuus

LEFT JOIN  VipunenTK.dbo.d_joustava_perusopetus d5
ON d5.joustava_perusopetus_koodi=fakta.joustava_perusopetus

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_kuljetusetuutta_saavien_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_kuljetusetuutta_saavien_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_kuljetusetuutta_saavien_oppilaiden_lkm] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_pidennetty_oppivelvollisuus, 
  perusopetuksen_pidennetty_oppivelvollisuus_id=ISNULL(d3.id,-2),
  fakta.perusopetuksen_tehostettu_tuki,
  perusopetuksen_tehostettu_tuki_id=ISNULL(d4.id,-2),
  fakta.perusopetuksen_kuljetusetuus,
  perusopetuksen_kuljetusetuus_id=ISNULL(d5.id,-2),
  kuljetusetuutta_saavat_oppilaat
  
  FROM
  
  (

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kueipide
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kueipide>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kueipidp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kueipidp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kueipidl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kueipidl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kuertuve
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kuertuve>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kuertuvp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kuertuvp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kuertuvl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kuertuvl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kuertume
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kuertume>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kuertump
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kuertump>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kuertuml
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kuertuml>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kumuue
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kumuue>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kumuup
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kumuup>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''K'',
  kuljetusetuutta_saavat_oppilaat=kumuul
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE kumuul>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=muuec-kumuue
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muuec-kumuue>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=muupc-kumuup
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muupc-kumuup>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=muulc-kumuul
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muulc-kumuul>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertuvec-kuertuve
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvec-kuertuve>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertuvpc-kuertuvp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvpc-kuertuvp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertuvlc-kuertuvl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvlc-kuertuvl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertumec-kuertume
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumec-kuertume>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertumpc-kuertump
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumpc-kuertump>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertumlc-kuertuml
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumlc-kuertuml>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=eipide-kueipide
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipide-kueipide>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=eipidy-eipide-eipid10-kueipidp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipidy-eipide-eipid10-kueipidp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=eipid10-kueipidl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid10-kueipidl>0

) fakta


LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat
  
LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d2
ON d2.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos

LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus d3
ON d3.perusopetuksen_pidennetty_oppivelvollisuus_koodi=fakta.perusopetuksen_pidennetty_oppivelvollisuus

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki d4
ON d4.perusopetuksen_tehostettu_tuki_koodi=fakta.perusopetuksen_tehostettu_tuki

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_kuljetusetuus d5
ON d5.perusopetuksen_kuljetusetuus_koodi=fakta.perusopetuksen_kuljetusetuus

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_majoitusetuutta_saavien_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_majoitusetuutta_saavien_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_majoitusetuutta_saavien_oppilaiden_lkm] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_pidennetty_oppivelvollisuus, 
  perusopetuksen_pidennetty_oppivelvollisuus_id=ISNULL(d3.id,-2),
  fakta.perusopetuksen_tehostettu_tuki,
  perusopetuksen_tehostettu_tuki_id=ISNULL(d4.id,-2),
  fakta.perusopetuksen_majoitusetuus,
  perusopetuksen_majoitusetuus_id=ISNULL(d5.id,-2),
  majoitusetuutta_saavat_oppilaat
  
  FROM
  
  (

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maeipide
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maeipide>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maeipidp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maeipidp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maeipidl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maeipidl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maertuve
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maertuve>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maertuvp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maertuvp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maertuvl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maertuvl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maertume
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maertume>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maertump
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maertump>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=maertuml
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE maertuml>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=mamuue
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE mamuue>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=mamuup
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE mamuup>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_majoitusetuus=''K'',
  majoitusetuutta_saavat_oppilaat=mamuul
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE mamuul>0

-------------- Ei majoitusetuutta saavat


UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=muuec-mamuue
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muuec-mamuue>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=muupc-mamuup
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muupc-mamuup>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=muulc-mamuul
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muulc-mamuul>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertuvec-maertuve
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvec-maertuve>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertuvpc-maertuvp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvpc-maertuvp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertuvlc-maertuvl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvlc-maertuvl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertumec-maertume
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumec-maertume>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertumpc-maertump
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumpc-maertump>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=ertumlc-maertuml
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumlc-maertuml>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=eipide-maeipide
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipide-maeipide>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=eipidy-eipide-eipid10-maeipidp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipidy-eipide-eipid10-maeipidp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_kuljetusetuus=''E'',
  kuljetusetuutta_saavat_oppilaat=eipid10-maeipidl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid10-maeipidl>0

) fakta

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat
  
LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d2
ON d2.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos

LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus d3
ON d3.perusopetuksen_pidennetty_oppivelvollisuus_koodi=fakta.perusopetuksen_pidennetty_oppivelvollisuus

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki d4
ON d4.perusopetuksen_tehostettu_tuki_koodi=fakta.perusopetuksen_tehostettu_tuki

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_majoitusetuus d5
ON d5.perusopetuksen_majoitusetuus_koodi=fakta.perusopetuksen_majoitusetuus

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_oppilaiden_lkm] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.sukupuoli,
  sukupuoli_id=ISNULL(d2.id,-2),
  oppilaiden_lkm


FROM

(

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  sukupuoli=2,
  oppilaiden_lkm=oven
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE oven>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  sukupuoli=1,
  oppilaiden_lkm=ove-oven
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ove-oven>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1'',
  sukupuoli=2,
  oppilaiden_lkm=ov1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov1n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1'',
  sukupuoli=1,
  oppilaiden_lkm=ov1-ov1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov1-ov1n>0


UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk2'',
  sukupuoli=2,
  oppilaiden_lkm=ov2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov2n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk2'',
  sukupuoli=1,
  oppilaiden_lkm=ov2-ov2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov2-ov2n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk3'',
  sukupuoli=2,
  oppilaiden_lkm=ov3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov3n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk3'',
  sukupuoli=1,
  oppilaiden_lkm=ov3-ov3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov3-ov3n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk4'',
  sukupuoli=2,
  oppilaiden_lkm=ov4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov4n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk4'',
  sukupuoli=1,
  oppilaiden_lkm=ov4-ov4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov4-ov4n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk5'',
  sukupuoli=2,
  oppilaiden_lkm=ov5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov5n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk5'',
  sukupuoli=1,
  oppilaiden_lkm=ov5-ov5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov5-ov5n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk6'',
  sukupuoli=2,
  oppilaiden_lkm=ov6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov6n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk6'',
  sukupuoli=1,
  oppilaiden_lkm=ov6-ov6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov6-ov6n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7'',
  sukupuoli=2,
  oppilaiden_lkm=ov7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov7n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk7'',
  sukupuoli=1,
  oppilaiden_lkm=ov7-ov7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov7-ov7n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk8'',
  sukupuoli=2,
  oppilaiden_lkm=ov8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov8n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk8'',
  sukupuoli=1,
  oppilaiden_lkm=ov8-ov8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov8-ov8n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk9'',
  sukupuoli=2,
  oppilaiden_lkm=ov9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov9n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk9'',
  sukupuoli=1,
  oppilaiden_lkm=ov9-ov9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov9-ov9n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  sukupuoli=2,
  oppilaiden_lkm=ov10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov10n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  sukupuoli=1,
  oppilaiden_lkm=ov10-ov10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ov10-ov10n>0

) fakta

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat

LEFT JOIN VipunenTK.dbo.d_sukupuoli d2
ON d2.sukupuoli_koodi=fakta.sukupuoli

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_peruskoulun_aloittaneiden_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_peruskoulun_aloittaneiden_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_peruskoulun_aloittaneiden_oppilaiden_lkm] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  fakta.sukupuoli,
  sukupuoli_id=ISNULL(d1.id,-2),
  fakta.perusopetuksen_aloitusika,
  perusopetuksen_aloitusika_id=ISNULL(d2.id,-2),
  peruskoulun_aloittavien_oppilaiden_lkm
  
  FROM
  
(

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''2'', --nainen
  perusopetuksen_aloitusika=''ika6'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika61n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika61n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''1'',--mies
  perusopetuksen_aloitusika=''ika6'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika61-ika61n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika61-ika61n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''2'', 
  perusopetuksen_aloitusika=''ika7'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika71n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika71n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''1'',
  perusopetuksen_aloitusika=''ika7'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika71-ika71n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika71-ika71n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''2'', 
  perusopetuksen_aloitusika=''ika8'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika81n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika81n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''1'',
  perusopetuksen_aloitusika=''ika8'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika81-ika81n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika81-ika81n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''2'', 
  perusopetuksen_aloitusika=''ika9'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika91n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika91n>0

UNION ALL
SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''1'',
  perusopetuksen_aloitusika=''ika9'',
  peruskoulun_aloittavien_oppilaiden_lkm=ika91-ika91n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ika91-ika91n>0


) fakta

 
LEFT JOIN VipunenTK.dbo.d_sukupuoli d1
ON d1.sukupuoli_koodi=fakta.sukupuoli

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_aloitusika d2
ON d2.perusopetuksen_aloitusika_koodi=fakta.perusopetuksen_aloitusika

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_peruskoulun_ilman_todistusta_paattaneiden_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_peruskoulun_ilman_todistusta_paattaneiden_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_peruskoulun_ilman_todistusta_paattaneiden_oppilaiden_lkm] AS

SELECT 
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  fakta.sukupuoli,
  sukupuoli_id=ISNULL(d1.id,-2),
  peruskoulun_ilman_todistusta_paattaneiden_oppilaiden_lkm
  
  FROM
  
(

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''2'', --nainen
  peruskoulun_ilman_todistusta_paattaneiden_oppilaiden_lkm=ilmtodn
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ilmtodn>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=''1'', --mies
  peruskoulun_ilman_todistusta_paattaneiden_oppilaiden_lkm=ilmtod-ilmtodn
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ilmtod-ilmtodn>0

) fakta

 
LEFT JOIN VipunenTK.dbo.d_sukupuoli d1
ON d1.sukupuoli_koodi=fakta.sukupuoli

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_tehostetun_tuen_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_tehostetun_tuen_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_tehostetun_tuen_oppilaiden_lkm] AS

SELECT 
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.sukupuoli,
  sukupuoli_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d3.id,-2),
  fakta.perusopetuksen_pidennetty_oppivelvollisuus,
  perusopetuksen_pidennetty_oppivelvollisuus_id=ISNULL(d4.id,-2),
  fakta.perusopetuksen_tehostettu_tuki,
  perusopetuksen_tehostettu_tuki_id=ISNULL(d5.id,-2),
  tehostetun_tuen_oppilaat
  
  FROM
  
(  

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  perusopetuksen_vuosiluokat=''lk0'', --esiopetus
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=tehoen
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehoen>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk0'', --esiopetus
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=tehoe-tehoen
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehoe-tehoen>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho1-teho1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho1-teho1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho2-teho2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho2-teho2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho3-teho3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho3-teho3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho4-teho4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho4-teho4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho5-teho5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho5-teho5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho6-teho6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho6-teho6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho7-teho7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho7-teho7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho8-teho8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho8-teho8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho9-teho9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho9-teho9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, --mies
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  tehostetun_tuen_oppilaat=teho10-teho10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE teho10-teho10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  perusopetuksen_vuosiluokat=''lk0'', --esiopetus
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipiden
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipiden>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  perusopetuksen_vuosiluokat=''lk0'', --esiopetus
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipide-eipiden
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipide-eipiden>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid1-eipid1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid1-eipid1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid2-eipid2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid2-eipid2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid3-eipid3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid3-eipid3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid4-eipid4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid4-eipid4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid5-eipid5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid5-eipid5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid6-eipid6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid6-eipid6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid7-eipid7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid7-eipid7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid8-eipid8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid8-eipid8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid9-eipid9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid9-eipid9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  tehostetun_tuen_oppilaat=eipid10-eipid10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipid10-eipid10n>0


UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuven
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuven>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuve-ertuven
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuve-ertuven>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv1-ertuv1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv1-ertuv1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv2-ertuv2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv2-ertuv2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv3-ertuv3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv3-ertuv3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv4-ertuv4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv4-ertuv4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv5-ertuv5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv5-ertuv5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv6-ertuv6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv6-ertuv6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv7-ertuv7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv7-ertuv7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv8-ertuv8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv8-ertuv8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv9-ertuv9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv9-ertuv9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  tehostetun_tuen_oppilaat=ertuv10-ertuv10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuv10-ertuv10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertumen
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumen>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertume-ertumen
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertume-ertumen>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum1-ertum1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum1-ertum1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum2-ertum2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum2-ertum2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum3-ertum3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum3-ertum3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum4-ertum4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum4-ertum4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum5-ertum5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum5-ertum5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum6-ertum6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum6-ertum6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum7-ertum7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum7-ertum7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum8-ertum8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum8-ertum8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum9-ertum9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum9-ertum9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  tehostetun_tuen_oppilaat=ertum10-ertum10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertum10-ertum10n>0


--kaatoluokat

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  perusopetuksen_vuosiluokat=''lk0'', --esiopetus
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavoven
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavoven>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=2, --nainen
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov10n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, --mies
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'',
  perusopetuksen_vuosiluokat=''lk0'', --esiopetus
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavove-tavoven
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavove-tavoven>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1, 
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk1'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov1-tavov1n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov1-tavov1n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk2'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov2-tavov2n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov2-tavov2n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk3'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov3-tavov3n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov3-tavov3n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk4'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov4-tavov4n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov4-tavov4n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk5'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov5-tavov5n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov5-tavov5n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk6'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov6-tavov6n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov6-tavov6n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk7'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov7-tavov7n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov7-tavov7n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk8'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov8-tavov8n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov8-tavov8n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk9'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov9-tavov9n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov9-tavov9n>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  sukupuoli=1,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  tehostetun_tuen_oppilaat=tavov10-tavov10n
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tavov10-tavov10n>0


) fakta


LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat 
 
LEFT JOIN VipunenTK.dbo.d_sukupuoli d2
ON d2.sukupuoli_koodi=fakta.sukupuoli

LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d3
ON d3.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos

LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus d4
ON d4.perusopetuksen_pidennetty_oppivelvollisuus_koodi=fakta.perusopetuksen_pidennetty_oppivelvollisuus

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki d5
ON d5.perusopetuksen_tehostettu_tuki_koodi=fakta.perusopetuksen_tehostettu_tuki

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi


' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_tukea_saavien_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_tukea_saavien_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_tukea_saavien_oppilaiden_lkm] AS

SELECT

  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d1.id,-2),
  fakta.perusopetuksen_tehostettu_tuki,
  perusopetuksen_tehostettu_tuki_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_tukimuoto,
  perusopetuksen_tukimuoto_id=ISNULL(d3.id,-2),
  tukea_saavat_oppilaat
  
  FROM
  
(  

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  --perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  perusopetuksen_tukimuoto=''tuki_osa'',
  tukea_saavat_oppilaat=tehoosa
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehoosa>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_tukimuoto=''tuki_osa'',
  tukea_saavat_oppilaat=ertuosa
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuosa>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  --perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  perusopetuksen_tukimuoto=''tuki_tuki'',
  tukea_saavat_oppilaat=tehotuki
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehotuki>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_tukimuoto=''tuki_tuki'',
  tukea_saavat_oppilaat=ertutuki
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertutuki>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  --perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  perusopetuksen_tukimuoto=''tuki_avu'',
  tukea_saavat_oppilaat=tehoavu
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehoavu>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_tukimuoto=''tuki_avu'',
  tukea_saavat_oppilaat=ertuavu
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuavu>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''E'',
 -- perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  perusopetuksen_tukimuoto=''tuki_muu'',
  tukea_saavat_oppilaat=tehomuu
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehomuu>0


UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_tukimuoto=''tuki_muu'',
  tukea_saavat_oppilaat=ertumuu
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumuu>0

/* Ei voi ottaa mukaan, yksi henkilö voi saada montaa tukimuotoa (?)
UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''E'',
 -- perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_teho'',
  perusopetuksen_tukimuoto=''tuki_ei'',
  tukea_saavat_oppilaat=tehoy-tehoosa-tehotuki-tehoavu-tehomuu
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE tehoy-tehoosa-tehotuki-tehoavu-tehomuu>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  perusopetuksen_tukimuoto=''tuki_ei'',
  tukea_saavat_oppilaat=ertuyc-ertuosa-ertutuki-ertuavu-ertumuu
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuyc-ertuosa-ertutuki-ertuavu-ertumuu>0


UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_tehostettu_tuki=''ertu_ei'',
  perusopetuksen_tukimuoto=''tuki_ei'',
  tukea_saavat_oppilaat=ovy-tehoy-ertuyc
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ovy-tehoy-ertuyc>0
*/


) fakta

LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d1
ON d1.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos


LEFT JOIN VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki d2
ON d2.perusopetuksen_tehostettu_tuki_koodi=fakta.perusopetuksen_tehostettu_tuki

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_tukimuoto d3
ON d3.perusopetuksen_tukimuoto_koodi=fakta.perusopetuksen_tukimuoto

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_vieraskielisten_tehostetun_tuen_oppilaiden_lkm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_Perusasteen_erityisopetus_R_2_22_vieraskielisten_tehostetun_tuen_oppilaiden_lkm]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_f_Perusasteen_erityisopetus_R_2_22_vieraskielisten_tehostetun_tuen_oppilaiden_lkm] AS

SELECT
  tilv,
  oppilaitos=tunn,
  oppilaitoksen_taustatiedot_id=ISNULL(d6.id,-2),
  oppilaitoksen_sijainti_id=ISNULL(d9.id,-2),
  tiedtype,
  fakta.perusopetuksen_vuosiluokat,
  perusopetuksen_vuosiluokat_id=ISNULL(d1.id,-2),
  fakta.perusopetuksen_erityisen_tuen_paatos,
  perusopetuksen_erityisen_tuen_paatos_id=ISNULL(d2.id,-2),
  fakta.perusopetuksen_pidennetty_oppivelvollisuus, 
  perusopetuksen_pidennetty_oppivelvollisuus_id=ISNULL(d3.id,-2),
  fakta.perusopetuksen_tehostettu_tuki,
  perusopetuksen_tehostettu_tuki_id=ISNULL(d4.id,-2),
  fakta.vieraskielisyys,
  vieraskielisyys_id=ISNULL(d5.id,-2),
  vieraskieliset_tehostetun_tuen_oppilaat

FROM

(

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=vieipide
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE vieipide>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=vieipidp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE vieipidp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=vieipidl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE vieipidl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=viertuve
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE viertuve>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=viertuvp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE viertuvp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=viertuvl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE viertuvl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=viertume
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE viertume>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=viertump
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE viertump>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=viertuml
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE viertuml>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''-1'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=vimuue
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE vimuue>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''-1'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=vimuup
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE vimuup>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''-1'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=vimuul
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE vimuul>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=eipide-vieipide
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipide-vieipide>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=eipidpc-vieipidp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipidpc-vieipidp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''ertu_muu'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=eipidlc-vieipidl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE eipidlc-vieipidl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=ertuve-viertuve
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuve-viertuve>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=ertuvpc-viertuvp
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvpc-viertuvp>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_v'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=ertuvlc-viertuvl
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertuvlc-viertuvl>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=ertume-viertume
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertume-viertume>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=ertumpc-viertump
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumpc-viertump>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''K'',
  perusopetuksen_pidennetty_oppivelvollisuus=''K'', 
  perusopetuksen_tehostettu_tuki=''ertu_m'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=ertumlc-viertuml
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE ertumlc-viertuml>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk0'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''-1'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=muuec-vimuue
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muuec-vimuue>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk1_9'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''-1'',
  vieraskielisyys=''E'',
  vieraskieliset_tehostetun_tuen_oppilaat=muupc-vimuup
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muupc-vimuup>0

UNION ALL

SELECT 
  tilv,
  tunn,
  tiedtype,
  perusopetuksen_vuosiluokat=''lk10'',
  perusopetuksen_erityisen_tuen_paatos=''E'',
  perusopetuksen_pidennetty_oppivelvollisuus=''E'', 
  perusopetuksen_tehostettu_tuki=''-1'',
  vieraskielisyys=''K'',
  vieraskieliset_tehostetun_tuen_oppilaat=muulc-vimuul
FROM [VipunenTK_DW].[dbo].[f_R2_22_Oppilaitostason_oppil_ja_opisk]
WHERE muulc-vimuul>0

) fakta

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_vuosiluokat d1
ON d1.vuosiluokka_koodi=fakta.perusopetuksen_vuosiluokat
 
LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos d2
ON d2.perusopetuksen_erityisen_tuen_paatos_koodi=fakta.perusopetuksen_erityisen_tuen_paatos
  
LEFT JOIN  VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus d3
ON d3.perusopetuksen_pidennetty_oppivelvollisuus_koodi=fakta.perusopetuksen_pidennetty_oppivelvollisuus

LEFT JOIN VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki d4
ON d4.perusopetuksen_tehostettu_tuki_koodi=fakta.perusopetuksen_tehostettu_tuki

LEFT JOIN VipunenTK.dbo.d_vieraskielisyys d5
ON d5.vieraskielisyys_koodi=fakta.vieraskielisyys

LEFT JOIN VipunenTK.dbo.d_oppilaitoksen_taustatiedot d6
ON d6.oppilaitoskoodi=fakta.tunn

LEFT JOIN VipunenTK.dbo.d_alueluokitus d9
ON d9.alueluokitus_avain=d6.sijaintikuntakoodi

' 
GO
/****** Object:  View [dbo].[v_f_R4_14_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_14_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_f_R4_14_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan] AS

/* Lauseet siirtoon VipunenTK-kantaan nopeaa testiä varten
Drop table VipunenTK.dbo.f_alueella_tyossakayvat
Truncate table VipunenTK.dbo.f_alueella_tyossakayvat
Insert into VipunenTK.dbo.f_alueella_tyossakayvat
*/

SELECT [tilv]
      ,[tilv_date]
      ,[aineisto]
      ,[laatu_id]=0
      ,f.[tietolahde]
      ,[rivinumero]
      ,[lkm]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[mitenna_ammatti_id]=ISNULL(d1.id,-2)
      ,[tol2008_m1]
      ,[tol2008_m2]
      ,[mitenna_toimiala_id]=ISNULL(d2.id,-2)
      ,[sp]
      ,[sukupuoli_id]=ISNULL(d4.id,-1)
      ,[aikielir1]
      ,[aikielir1_id]=ISNULL(d6.id,-2)
      ,[ikar1]
      ,[ikar1_koodi]=ISNULL(d9.ika_avain,''-2'')
      ,[ika_id]=ISNULL(d9.id,''-2'')      
      ,[opmast]
      ,[koulutusaste_id]=ISNULL(d5.id,-2)
      ,[tutklaja]
      ,[tutkintolaji_id]=ISNULL(d12.id,-1)
      ,[opmopa]
      ,[opintoala2002_koodi]=ISNULL(d11.opintoala2002_koodi,-1)
      ,opintoala_id=ISNULL(d13.id,-1)
      ,[tilvasmaak]
      ,[asuinmaakunta_historia_id]=ISNULL(d7h.id,(select id from VipunenTK..d_alueluokitus_historia where alueluokitus_avain=''-1'' and f.tilv_date between alkaa and paattyy))
      ,[asuinmaakunta_id]=ISNULL(d7.id,-1)
      ,[tsekt]
      ,[tyonantajasektori_id]=ISNULL(d10.id,-1)
      ,[tmaak]
      ,[tyomaakunta_historia_id]=ISNULL(d8h.id,(select id from VipunenTK..d_alueluokitus_historia where alueluokitus_avain=''-1'' and f.tilv_date between alkaa and paattyy))
      ,[tyomaakunta_id]=ISNULL(d8.id,-2)
      ,[sose]
      ,[sosioekonominen_asema_id]=ISNULL(d3.id,-1)


FROM 

(

SELECT [tilv]
      ,[tilv_date]
      ,[sp]
      ,[aikielir1]
      ,[ikar1]
      ,[ikar1_koodi]=Cast(''5v''+ikar1 as nvarchar(10))
      ,[opmast]
      ,[tutklaja]
      ,[opmopa]
      ,opmopa_avain=''OPMOPA''+opmopa
      ,[tilvasmaak]
      ,[tol2008_m1]
      ,[tol2008_m2]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[tsekt]
      ,[tmaak]
      ,[sose]
      ,[lkm]
      ,[tietolahde]
      ,[rivinumero]
      ,aineisto = CAST(''R4.14'' as nvarchar(8))
FROM [VipunenTK_DW].[dbo].[f_R4_14_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan]

) f

  LEFT JOIN VipunenTK..d_mitenna_ammatti d1
	on d1.mitenna_ammatti_koodi=f.amm2001_m2
	and f.tilv_date between d1.alkaa and d1.paattyy
  LEFT JOIN VipunenTK..d_mitenna_toimiala d2
	on d2.tol_koodi=f.tol2008_m2
	and f.tilv_date between d2.alkaa and d2.paattyy
  LEFT JOIN VipunenTK..d_sosioekonominen_asema d3
	on d3.sosioekonominen_asema_koodi=f.sose
	and f.tilv_date between d3.alkaa and d3.paattyy	
  LEFT JOIN VipunenTK..d_sukupuoli d4
	on d4.sukupuoli_koodi=f.sp
	and f.tilv_date between d4.alkaa and d4.paattyy	
  LEFT JOIN VipunenTK..d_koulutusluokitus d5
	on d5.koulutusluokitus_avain=''OPMAST''+f.opmast
	

  LEFT JOIN VipunenTK..d_aidinkieli_versio1 d6
	on d6.aidinkieli_versio1_koodi=f.aikielir1
	and f.tilv_date between d6.alkaa and d6.paattyy	

  LEFT JOIN VipunenTK..d_alueluokitus_historia d7h
	on d7h.alueluokitus_avain=''MAAK''+f.tilvasmaak
	and f.tilv_date between d7h.alkaa and d7h.paattyy

  LEFT JOIN VipunenTK..d_alueluokitus d7
	on d7.alueluokitus_avain=''MAAK''+f.tilvasmaak

  LEFT JOIN VipunenTK..d_alueluokitus_historia d8h
	on d8h.alueluokitus_avain=''MAAK''+f.tmaak
	and f.tilv_date between d8h.alkaa and d8h.paattyy


  LEFT JOIN VipunenTK..d_alueluokitus d8
	on d8.alueluokitus_avain=''MAAK''+f.tmaak


  LEFT JOIN VipunenTK..d_ika d9
	on d9.ika_avain=f.ikar1_koodi
  LEFT JOIN VipunenTK..d_tyonantajasektori d10
	on d10.tyonantajasektori_koodi=f.tsekt
	and f.tilv_date between d10.alkaa and d10.paattyy	
  LEFT JOIN VipunenTK..d_opintoala2002 d11
	on d11.opintoala2002_koodi=f.opmopa
  LEFT JOIN VipunenTK..d_ammatillisen_koulutuksen_koulutuslaji d12
	on d12.ammatillisen_koulutuksen_koulutuslaji_koodi=f.tutklaja
	and f.tilv_date between d12.alkaa and d12.paattyy	
  LEFT JOIN VipunenTK..d_koulutusluokitus d13
	on d13.koulutusluokitus_avain=f.opmopa_avain


' 
GO
/****** Object:  View [dbo].[v_f_R4_14b_Alueella_tyossakayvat_tilastokeskuksen_toimialan_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_14b_Alueella_tyossakayvat_tilastokeskuksen_toimialan_mukaan]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_f_R4_14b_Alueella_tyossakayvat_tilastokeskuksen_toimialan_mukaan] AS

/* Lauseet siirtoon VipunenTK-kantaan nopeaa testiä varten
Drop table VipunenTK.dbo.f_alueella_tyossakayvat_toimialoittain
Truncate table VipunenTK.dbo.f_alueella_tyossakayvat_toimialoittain
Insert into VipunenTK.dbo.f_alueella_tyossakayvat_toimialoittain
 select * from VipunenTK_DW.dbo.v_f_R4_14b_Alueella_tyossakayvat_tilastokeskuksen_toimialan_mukaan
*/

SELECT [tilv]
      ,[tilv_date]
      ,[aineisto]
      ,[laatu_id]=0
      ,f.[tietolahde]
      ,[rivinumero]
      ,[lkm]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[mitenna_ammatti_id]=ISNULL(d1.id,-2)
      ,[tol2008_m1]
      ,[tol2008_m2]
      ,[mitenna_toimiala_id]=ISNULL(d2.id,-2)
	  ,f.[tol2008]
	  ,[tol2008_id]=ISNULL(d3.id, -2)
      ,[ikar1]
      ,[ikar1_koodi]=ISNULL(d9.ika_avain,''-2'')
      ,[ika_id]=ISNULL(d9.id,''-2'')      
      ,[opmast]
      ,[koulutusaste_id]=ISNULL(d5.id,-2)
      ,[tutklaja]
      ,[tutkintolaji_id]=ISNULL(d12.id,-1)
      ,[opmopa]
      ,[opintoala2002_koodi]=ISNULL(d11.opintoala2002_koodi,-1)
      ,opintoala_id=ISNULL(d13.id,-1)
      ,[tmaak]
      ,[tyomaakunta_historia_id]=ISNULL(d8h.id,(select id from VipunenTK..d_alueluokitus_historia where alueluokitus_avain=''-1'' and f.tilv_date between alkaa and paattyy))
      ,[tyomaakunta_id]=ISNULL(d8.id,-2)


FROM 

(

SELECT [tilv]
      ,[tilv_date]
      ,[ikar1]
      ,[ikar1_koodi]=Cast(''5v''+ikar1 as nvarchar(10))
      ,[opmast]
      ,[tutklaja]
      ,[opmopa]
      ,opmopa_avain=''OPMOPA''+opmopa
      ,[tol2008_m1]
      ,[tol2008_m2]
	  ,[tol2008]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[tmaak]
      ,[lkm]
      ,[tietolahde]
      ,[rivinumero]
      ,aineisto = CAST(''R4.14b'' as nvarchar(8))
FROM [VipunenTK_DW].[dbo].[f_R4_14b_Alueella_tyossakayvat_tilastokeskuksen_toimialan_mukaan]

) f

  LEFT JOIN VipunenTK..d_mitenna_ammatti d1
	on d1.mitenna_ammatti_koodi=f.amm2001_m2
	and f.tilv_date between d1.alkaa and d1.paattyy
  
  LEFT JOIN VipunenTK..d_mitenna_toimiala d2
	on d2.tol_koodi=f.tol2008_m2
	and f.tilv_date between d2.alkaa and d2.paattyy
  
  LEFT JOIN VipunenTK..d_toimiala_tk d3
	on d3.tol2008=f.tol2008
	and f.tilv_date between d3.alkaa and d3.paattyy

  
  LEFT JOIN VipunenTK..d_koulutusluokitus d5
	on d5.koulutusluokitus_avain=''OPMAST''+f.opmast
	--and f.tilv_date between d5.alkaa and d5.paattyy	



  LEFT JOIN VipunenTK..d_alueluokitus_historia d8h
	on d8h.alueluokitus_avain=''MAAK''+f.tmaak
	and f.tilv_date between d8h.alkaa and d8h.paattyy
  LEFT JOIN VipunenTK..d_alueluokitus d8
	on d8.alueluokitus_avain=''MAAK''+f.tmaak


  LEFT JOIN VipunenTK..d_ika d9
	on d9.ika_avain=f.ikar1_koodi
  
  LEFT JOIN VipunenTK..d_opintoala2002 d11
	on d11.opintoala2002_koodi=f.opmopa
  
  LEFT JOIN VipunenTK..d_ammatillisen_koulutuksen_koulutuslaji d12
	on d12.ammatillisen_koulutuksen_koulutuslaji_koodi=f.tutklaja
	and f.tilv_date between d12.alkaa and d12.paattyy	
  
  LEFT JOIN VipunenTK..d_koulutusluokitus d13
	on d13.koulutusluokitus_avain=f.opmopa_avain





' 
GO
/****** Object:  View [dbo].[v_f_R4_15_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan_1vuotisikaryh]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_15_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan_1vuotisikaryh]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_f_R4_15_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan_1vuotisikaryh] AS

/* Lauseet siirtoon VipunenTK-kantaan nopeaa testiä varten
Drop table VipunenTK.dbo.f_alueella_tyossakayvat_1v
Truncate table VipunenTK.dbo.f_alueella_tyossakayvat_1v
Insert into VipunenTK.dbo.f_alueella_tyossakayvat_1v
*/

SELECT [tilv]
      ,[tilv_date]
      ,[aineisto]
      ,[laatu_id]=0
      ,f.[tietolahde]
      ,[rivinumero]
      ,[lkm]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[mitenna_ammatti_id]=ISNULL(d1.id,-2)
      ,[tol2008_m1]
      ,[tol2008_m2]
      ,[mitenna_toimiala_id]=ISNULL(d2.id,-2)
      ,[aikielir1]
      ,[aikielir1_id]=ISNULL(d6.id,-2)
      ,[ikar1]
      ,[ikar1_koodi]=ISNULL(d9.ika_avain,''-2'')
      ,[ika_id]=ISNULL(d9.id,''-2'')      
      ,[tilvasmaak]
      ,[asuinmaakunta_historia_id]=ISNULL(d7h.id,(select id from VipunenTK..d_alueluokitus_historia where alueluokitus_avain=''-1'' and f.tilv_date between alkaa and paattyy))
      ,[asuinmaakunta_id]=ISNULL(d7.id,-2)      
      ,[tmaak]
      ,[tyomaakunta_historia_id]=ISNULL(d8h.id,(select id from VipunenTK..d_alueluokitus_historia where alueluokitus_avain=''-1'' and f.tilv_date between alkaa and paattyy))
      ,[tyomaakunta_id]=ISNULL(d8.id,-2)




FROM

(

SELECT [tilv]
      ,[tilv_date]
      ,[aikielir1]
      ,[ikar1]=ika
      ,[ikar1_koodi]=Cast(ika as nvarchar(10))
      ,[tilvasmaak]
      ,[tol2008_m1]
      ,[tol2008_m2]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[tmaak]
      ,[lkm]
      ,[tietolahde]
      ,[rivinumero]
      ,aineisto = CAST(''R4.15'' as nvarchar(8))
  FROM [VipunenTK_DW].[dbo].[f_R4_15_Alueella_tyossakayvat_toimialan_ammryhm_ja_koul_mukaan_1vuotisikaryh]

) f

  LEFT JOIN VipunenTK..d_mitenna_ammatti d1
	on d1.mitenna_ammatti_koodi=f.amm2001_m2
	and f.tilv_date between d1.alkaa and d1.paattyy
  LEFT JOIN VipunenTK..d_mitenna_toimiala d2
	on d2.tol_koodi=f.tol2008_m2
	and f.tilv_date between d2.alkaa and d2.paattyy
  LEFT JOIN VipunenTK..d_aidinkieli_versio1 d6
	on d6.aidinkieli_versio1_koodi=f.aikielir1
	and f.tilv_date between d6.alkaa and d6.paattyy	

  LEFT JOIN VipunenTK..d_alueluokitus_historia d7h
	on d7h.alueluokitus_avain=''MAAK''+f.tilvasmaak
	and f.tilv_date between d7h.alkaa and d7h.paattyy

  LEFT JOIN VipunenTK..d_alueluokitus d7
	on d7.alueluokitus_avain=''MAAK''+f.tilvasmaak


  LEFT JOIN VipunenTK..d_alueluokitus_historia d8h
	on d8h.alueluokitus_avain=''MAAK''+f.tmaak
	and f.tilv_date between d8h.alkaa and d8h.paattyy

  LEFT JOIN VipunenTK..d_alueluokitus d8
	on d8.alueluokitus_avain=''MAAK''+f.tmaak


  LEFT JOIN VipunenTK..d_ika d9
	on d9.ika_avain=f.ikar1_koodi
' 
GO
/****** Object:  View [dbo].[v_f_R4_16_Tyossakayvat_ammateittain]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_16_Tyossakayvat_ammateittain]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_R4_16_Tyossakayvat_ammateittain] AS

/* Lauseet siirtoon VipunenTK-kantaan nopeaa testiä varten
Drop table VipunenTK.dbo.f_tyossakayvat_ammateittain
Truncate table VipunenTK.dbo.f_tyossakayvat_ammateittain
Insert into VipunenTK.dbo.f_tyossakayvat_ammateittain
  Select * from VipunenTK_DW.dbo.[v_f_R4_16_Tyossakayvat_ammateittain]
*/


SELECT [tilv]
      ,[tilv_date]
      ,[aineisto]
      ,[laatu_id]=0
      ,f.[tietolahde]
      ,[rivinumero]
      ,[lkm]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[mitenna_ammatti2_id]=ISNULL(d1.id,-2)
      ,[amm2001_m]
      ,[mitenna_ammatti_id]=ISNULL(d13.id,-1)
      ,[sp]
      ,[sukupuoli_id]=ISNULL(d4.id,-1)
      ,[aikielir1]
      ,[aikielir1_id]=ISNULL(d6.id,-2)
      ,[ikar1]
      ,[ikar1_koodi]=ISNULL(d9.ika_avain,''-2'')
      ,[ika_id]=ISNULL(d9.id,''-2'')     
      ,[opmast]
      ,[koulutusaste_id]=ISNULL(d5.id,-2)
      ,[tutklaja]
      ,[tutkintolaji_id]=ISNULL(d12.id,-1)
      ,[opmopa]
      ,[koulutusluokitus_id]=ISNULL(d14.id,-1)
      ,[opintoala2002_koodi]=ISNULL(d11.opintoala2002_koodi,-1)
      ,[tmaak]
      ,[tyomaakunta_historia_id]=ISNULL(d8h.id,(select id from VipunenTK..d_alueluokitus_historia where alueluokitus_avain=''-1'' and f.tilv_date between alkaa and paattyy))
      ,[tyomaakunta_id]=ISNULL(d8.id,-2)



FROM

(

SELECT [tilv]
      ,[tilv_date]
      ,[sp]
      ,[aikielir1]
      ,[ikar1]=ika
      ,[ikar1_koodi]=Cast(ika as nvarchar(10))
      ,[opmast]
      ,[tutklaja]
      ,[opmopa]
      ,[amm2001_m1]
      ,[amm2001_m2]
      ,[amm2001_m]
      ,[tmaak]
      ,[amm2001_mnim]
      ,[lkm]
      ,[tietolahde]
      ,[rivinumero]
      ,aineisto = CAST(''R4.16'' as nvarchar(8))
  FROM [VipunenTK_DW].[dbo].[f_R4_16_Tyossakayvat_ammateittain]

) f

  LEFT JOIN VipunenTK..d_mitenna_ammatti d1
	on d1.mitenna_ammatti_koodi=f.amm2001_m2
	and f.tilv_date between d1.alkaa and d1.paattyy

  LEFT JOIN VipunenTK..d_sukupuoli d4
	on d4.sukupuoli_koodi=f.sp
	and f.tilv_date between d4.alkaa and d4.paattyy	

  LEFT JOIN VipunenTK..d_koulutusluokitus d5
	on d5.koulutusluokitus_avain=''OPMAST''+f.opmast

  LEFT JOIN VipunenTK..d_aidinkieli_versio1 d6
	on d6.aidinkieli_versio1_koodi=f.aikielir1
	and f.tilv_date between d6.alkaa and d6.paattyy	

  LEFT JOIN VipunenTK..d_alueluokitus_historia d8h
	on d8h.alueluokitus_avain=''MAAK''+f.tmaak
	and f.tilv_date between d8h.alkaa and d8h.paattyy

  LEFT JOIN VipunenTK..d_alueluokitus d8
	on d8.alueluokitus_avain=''MAAK''+f.tmaak
	
  LEFT JOIN VipunenTK..d_ika d9
	on d9.ika_avain=f.ikar1_koodi

  LEFT JOIN VipunenTK..d_opintoala2002 d11
	on d11.opintoala2002_koodi=f.opmopa

  LEFT JOIN VipunenTK..d_ammatillisen_koulutuksen_koulutuslaji d12
	on d12.ammatillisen_koulutuksen_koulutuslaji_koodi=f.tutklaja
	and f.tilv_date between d12.alkaa and d12.paattyy	

  LEFT JOIN VipunenTK..d_mitenna_ammatti d13
	on d13.mitenna_ammatti_koodi=f.amm2001_m
	and f.tilv_date between d13.alkaa and d13.paattyy
	
  LEFT JOIN VipunenTK..d_koulutusluokitus d14
  on d14.koulutusluokitus_avain=case when f.opmopa=''-1'' then ''-1'' else ''OPMOPA''+f.opmopa End




' 
GO
/****** Object:  View [dbo].[v_f_R4_19_R4_20_Tyollisten_ammattisiirtymat_ja_aiemmat_ammatit]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_R4_19_R4_20_Tyollisten_ammattisiirtymat_ja_aiemmat_ammatit]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_f_R4_19_R4_20_Tyollisten_ammattisiirtymat_ja_aiemmat_ammatit] AS

SELECT tilastovuosi = [tilv]
      ,sukupuoli_koodi = sp
      ,aidinkieli_versio1_koodi = [aikielir1]
      ,ika_avain = [ikar1]
      ,tyopaikan_sijaintimaakunta_avain= [tmaak]
      ,mitenna_ammattiryhma2_koodi = [amm2001_m2]
      ,paaasiallinen_toiminta_siirtyman_paassa_koodi = [ptoim1r7_2009]
      ,tyopaikan_sijainti_v_tilastovuonna_avain = [tmaakr1_2009]
      ,mitenna_ammattiryhma2_siirtyman_paassa_koodi = [amm2001_m2_2009]
      ,[lkm]
      ,[suhteellinen_ajankohta_avain]
      ,perusjoukko_tyolliset_avain = tilv
      ,siirtyman_tarkastelusuunta_avain = 1
     
  FROM [VipunenTK_DW].[dbo].[sa_R4_19_Tyollisten_ammattisiirtymat]

UNION ALL

SELECT tilastovuosi = [tilv]
      ,sukupuoli_koodi = ''-1''
      ,aidinkieli_versio1_koodi = [aikielir1]
      ,ika_avain = [ikar1]
      ,tyopaikan_sijaintimaakunta_avain = [tmaak]
      ,mitenna_ammattiryhma2_koodi = [amm2001_m2]
      ,paaasiallinen_toiminta_siirtyman_paassa_koodi = [ptoim1r7_2004]
      ,tyopaikan_sijainti_v_tilastovuonna_avain = [tmaakr1_2004]
      ,mitenna_ammattiryhma2_siirtyman_paassa_koodi = [amm2001_m2_2004]
      ,[lkm]
      ,[suhteellinen_ajankohta_avain]
      ,perusjoukko_tyolliset_avain = tilv
      ,siirtyman_tarkastelusuunta_avain = 2

  FROM [VipunenTK_DW].[dbo].[sa_R4_20_Tyollisten_aiemmat_ammatit]
' 
GO
/****** Object:  View [dbo].[v_f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7]'))
EXEC dbo.sp_executesql @statement = N'











CREATE VIEW [dbo].[v_f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7] AS
--
--Drop table VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7
--Select * into VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7 from VipunenTK_DW.dbo.v_f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7

--Truncate table VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7 
--Insert into VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7 Select * from VipunenTK_DW.dbo.v_f_tutkinnon_suorittaneiden_aiempi_koulutus_4_7 

    Select 
	   [tilastovuosi]
      ,[tilv_date]
      ,[sukupuoli_koodi]
      ,[aidinkieli_versio1_koodi]
      ,[suorv]
      ,[suorlk]
      ,[suorituskausikoodi]
      ,data.[koulutusluokitus_avain]
      ,[alvv]
      ,[allk]
      ,[aloituskausikoodi]
      ,data.[oppisopimuskoulutus_koodi]
      ,data.[ammatillisen_koulutuksen_koulutuslaji_koodi]
      ,data.[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi]
	  ,ammatillinen_koulutus_ryhma = akl.[ammatillisen_koulutuksen_luokittelu_4_7_4_8_avain]
	  ,ammatillinen_koulutus_ryhma_avain = akl.[ammatillisen_koulutuksen_luokittelu_avain]
      ,[nuorten_aikuisten_koulutus_amm_koodi]
      ,[syntv]
      ,[ika_avain]
      ,[henkiloiden_lkm]
      ,[lulkm] = Case when lu_ika <= jaksovuosi then lulkm else 0 end
      ,[lukoulk] = Case when lu_ika <= jaksovuosi then lukoulk else '''' end
      ,[lusuorv] = Case when lu_ika <= jaksovuosi then lusuorv else '''' end
      ,[luaikoul] = Case when lu_ika <= jaksovuosi then luaikoul else '''' end
      ,[lu_ika] = Case when lu_ika <= jaksovuosi then lu_ika else NULL end
      ,[lu_aiempi_tutkinto_suoritettu] = Case when lu_ika <= jaksovuosi then lu_aiempi_tutkinto_suoritettu else ''E'' end
      ,[ammlkm] = Case when amm_ika <= jaksovuosi then ammlkm else 0 end
      ,[ammkoulk] = Case when amm_ika <= jaksovuosi then ammkoulk else '''' end
      ,[ammsuorv] = Case when amm_ika <= jaksovuosi then ammsuorv else '''' end
      ,[ammoppis] = Case when amm_ika <= jaksovuosi then ammoppis else '''' end
      ,[ammtutklaja] = Case when amm_ika <= jaksovuosi then ammtutklaja else '''' end
      ,[ammtutktav] = Case when amm_ika <= jaksovuosi then ammtutklaja else '''' end
      ,[amm_ika] = Case when amm_ika <= jaksovuosi then amm_ika else NULL end
      ,[amm_aiempi_tutkinto_suoritettu] = Case when amm_ika <= jaksovuosi then amm_aiempi_tutkinto_suoritettu else ''E'' end
      ,[opistlkm] = Case when opist_ika <= jaksovuosi then opistlkm else 0 end
      ,[opistkoulk] = Case when opist_ika <= jaksovuosi then opistkoulk else '''' end
      ,[opistsuorv] = Case when opist_ika <= jaksovuosi then opistsuorv else '''' end
      ,[opist_ika] = Case when opist_ika <= jaksovuosi then opist_ika else NULL end
      ,[opist_aiempi_tutkinto_suoritettu] = Case when opist_ika <= jaksovuosi then opist_aiempi_tutkinto_suoritettu else ''E'' end
      ,[ammkalkm] = Case when ammka_ika <= jaksovuosi then ammkalkm else 0 end
      ,[ammkakoulk] = Case when ammka_ika <= jaksovuosi then ammkakoulk else '''' end
      ,[ammkasuorv] = Case when ammka_ika <= jaksovuosi then ammkasuorv else '''' end
      ,[ammka_ika] = Case when ammka_ika <= jaksovuosi then ammka_ika else NULL end
      ,[ammka_aiempi_tutkinto_suoritettu] = Case when ammka_ika <= jaksovuosi then ammka_aiempi_tutkinto_suoritettu else ''E'' end
      ,[amklkm] = Case when amk_ika <= jaksovuosi then amklkm else 0 end
      ,[amkkoulk] = Case when amk_ika <= jaksovuosi then amkkoulk else '''' end
      ,[amksuorv] = Case when amk_ika <= jaksovuosi then amksuorv else '''' end
      ,[amkaikoul] = Case when amk_ika <= jaksovuosi then amkaikoul else '''' end
      ,[amk_ika] = Case when amk_ika <= jaksovuosi then amk_ika else '''' end
      ,[amk_aiempi_tutkinto_suoritettu] = Case when amk_ika <= jaksovuosi then amk_aiempi_tutkinto_suoritettu else ''E'' end
      ,[akklkm] = Case when akk_ika <= jaksovuosi then akklkm else 0 end
      ,[akkkoulk] = Case when akk_ika <= jaksovuosi then akkkoulk else '''' end
      ,[akksuorv] = Case when akk_ika <= jaksovuosi then akksuorv else '''' end
      ,[akk_ika] = Case when akk_ika <= jaksovuosi then akk_ika else NULL end
      ,[akk_aiempi_tutkinto_suoritettu] = Case when akk_ika <= jaksovuosi then akk_aiempi_tutkinto_suoritettu else ''E'' end
      ,[ylamklkm] = Case when ylamk_ika <= jaksovuosi then ylamklkm else 0 end
      ,[ylamkkoulk] = Case when ylamk_ika <= jaksovuosi then ylamkkoulk else '''' end
      ,[ylamksuorv] = Case when ylamk_ika <= jaksovuosi then ylamksuorv else '''' end
      ,[ylamk_ika] = Case when ylamk_ika <= jaksovuosi then ylamk_ika else NULL end
      ,[ylamk_aiempi_tutkinto_suoritettu] = Case when ylamk_ika <= jaksovuosi then ylamk_aiempi_tutkinto_suoritettu else ''E'' end
      ,[ykklkm] = Case when ykk_ika <= jaksovuosi then ykklkm else 0 end
      ,[ykkkoulk] = Case when ykk_ika <= jaksovuosi then ykkkoulk else '''' end
      ,[ykksuorv] = Case when ykk_ika <= jaksovuosi then ykksuorv else '''' end
      ,[ykk_ika] = Case when ykk_ika <= jaksovuosi then ykk_ika else NULL end
      ,[ykk_aiempi_tutkinto_suoritettu] = Case when ykk_ika <= jaksovuosi then ykk_aiempi_tutkinto_suoritettu else ''E'' end
      ,[laakerlkm] = Case when laaker_ika <= jaksovuosi then laakerlkm else 0 end
      ,[laakerkoulk] = Case when laaker_ika <= jaksovuosi then laakerkoulk else '''' end
      ,[laakersuorv] = Case when laaker_ika <= jaksovuosi then laakersuorv else '''' end
      ,[laaker_ika] = Case when laaker_ika <= jaksovuosi then laaker_ika else NULL end
      ,[laaker_aiempi_tutkinto_suoritettu] = Case when laaker_ika <= jaksovuosi then laaker_aiempi_tutkinto_suoritettu else ''E'' end
      ,[lislkm] = Case when lis_ika <= jaksovuosi then lislkm else 0 end
      ,[liskoulk] = Case when lis_ika <= jaksovuosi then liskoulk else '''' end
      ,[lissuorv] = Case when lis_ika <= jaksovuosi then lissuorv else '''' end
      ,[lis_ika] = Case when lis_ika <= jaksovuosi then lis_ika else NULL end
      ,[lis_aiempi_tutkinto_suoritettu] = Case when lis_ika <= jaksovuosi then lis_aiempi_tutkinto_suoritettu else ''E'' end
      ,[tohtlkm] = Case when toht_ika <= jaksovuosi then tohtlkm else 0 end
      ,[tohtkoulk] = Case when toht_ika <= jaksovuosi then tohtkoulk else '''' end
      ,[tohtsuorv] = Case when toht_ika <= jaksovuosi then tohtsuorv else '''' end
      ,[toht_ika] = Case when toht_ika <= jaksovuosi then toht_ika else NULL end
      ,[toht_aiempi_tutkinto_suoritettu] = Case when toht_ika <= jaksovuosi then toht_aiempi_tutkinto_suoritettu else ''E'' end


      ,data.[tietolahde]
      ,[rivinumero]
	  ,tarkastelujakso_koodi
	from [dbo].[f_4_7_Tutkinnon_suorittaneiden_aiempi_koulutus] data
	join VipunenTK.dbo.d_tarkastelujakso on tarkastelujakso_koodi in (''1'', ''2'', ''3'', ''4'', ''7'', ''10'', ''13'', ''16'', ''99'') 
	--Huom! Tässä tehdään karteesinen tulo tarkoituksella / CSC Jarmo 14.9.2015
	left join VipunenTK_lisatiedot.dbo.ammatillinen_koulutus_luokittelu akl
		on  akl.[oppisopimuskoulutus_koodi] = data.oppisopimuskoulutus_koodi
		and akl.[ammatillisen_koulutuksen_koulutuslaji_koodi] = data.ammatillisen_koulutuksen_koulutuslaji_koodi
		and akl.[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi] = data.opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi
	left join VipunenTK.dbo.d_koulutusluokitus kl
		on kl.koulutusluokitus_avain = data.koulutusluokitus_avain
	where 
	-- tarkastelujaksojen määrä riippuu koulutusaste2002:sta
	--   61,62,63,71,72,73,81,82 niin käytetään tarkastelujaksoja (''4'', ''7'', ''10'', ''13'', ''16'', ''99'')
	--   31, 32, 50, 90 (itse asiassa kaikki joita ei ole mainittu edellisellä rivillä) niin käytetään tarkastelujaksoja (''1'', ''2'', ''3'', ''4'', ''7'', ''10'', ''13'', ''16'', ''99'') 
		( kl.koulutusaste2002_koodi in (''61'',''62'',''63'',''71'',''72'',''73'',''81'',''82'') and tarkastelujakso_koodi in (''4'', ''7'', ''10'', ''13'', ''16'', ''99'') )
		or
		( kl.koulutusaste2002_koodi not in (''61'',''62'',''63'',''71'',''72'',''73'',''81'',''82'') and tarkastelujakso_koodi in (''1'', ''2'', ''3'', ''4'', ''7'', ''10'', ''13'', ''16'', ''99'') )






' 
GO
/****** Object:  View [dbo].[v_f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8]'))
EXEC dbo.sp_executesql @statement = N'













CREATE VIEW [dbo].[v_f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8] AS

--CSC Jarmo 6.10.2015
-- Tehty kopiona ja muokkauksena 4.7-näkymästä
--  4_7 -> 4_8
--  aiempi -> myohempi
-- lisätty alla oleva ehto
	----Poistetaan tulevaisuuteen ulottuvat tarkastelujaksot /CSC Jarmo 4.11.2015
	--where tarkastelujakso_koodi = ''99''
	--or cast(data.suorv as int) + d_tarkastelujakso.jaksovuosi <= cast(data.tilastovuosi as int)
-- lisätty ehto koulutusastekohtaisesta tarkastelujaksojen määrästä /CSC Jarmo 11.3.2016

--Drop table VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8
--Select * into VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8 from VipunenTK_DW.dbo.v_f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8

--Truncate table VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8 
--Insert into VipunenTK_DW.dbo.f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8 Select * from VipunenTK_DW.dbo.v_f_tutkinnon_suorittaneiden_myohempi_koulutus_4_8 

    Select 
	   [tilastovuosi]
      ,[tilv_date]
      ,[sukupuoli_koodi]
      ,[aidinkieli_versio1_koodi]
      ,[suorv]
      ,[suorlk]
      ,[suorituskausikoodi]
      ,data.[koulutusluokitus_avain]
      ,[alvv]
      ,[allk]
      ,[aloituskausikoodi]
      ,data.[oppisopimuskoulutus_koodi]
      ,data.[ammatillisen_koulutuksen_koulutuslaji_koodi]
      ,data.[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi]
	  ,ammatillinen_koulutus_ryhma = akl.[ammatillisen_koulutuksen_luokittelu_4_7_4_8_avain]
	  ,ammatillinen_koulutus_ryhma_avain = akl.[ammatillisen_koulutuksen_luokittelu_avain]
      ,[nuorten_aikuisten_koulutus_amm_koodi]
      ,[syntv]
      ,[ika_avain]
      ,[henkiloiden_lkm]
      ,[lulkm] = Case when lu_ika <= jaksovuosi then lulkm else 0 end
      ,[lukoulk] = Case when lu_ika <= jaksovuosi then lukoulk else '''' end
      ,[lusuorv] = Case when lu_ika <= jaksovuosi then lusuorv else '''' end
      ,[luaikoul] = Case when lu_ika <= jaksovuosi then luaikoul else '''' end
      ,[lu_ika] = Case when lu_ika <= jaksovuosi then lu_ika else NULL end
      ,[lu_myohempi_tutkinto_suoritettu] = Case when lu_ika <= jaksovuosi then lu_myohempi_tutkinto_suoritettu else ''E'' end
      ,[ammlkm] = Case when amm_ika <= jaksovuosi then ammlkm else 0 end
      ,[ammkoulk] = Case when amm_ika <= jaksovuosi then ammkoulk else '''' end
      ,[ammsuorv] = Case when amm_ika <= jaksovuosi then ammsuorv else '''' end
      ,[ammoppis] = Case when amm_ika <= jaksovuosi then ammoppis else '''' end
      ,[ammtutklaja] = Case when amm_ika <= jaksovuosi then ammtutklaja else '''' end
      ,[ammtutktav] = Case when amm_ika <= jaksovuosi then ammtutklaja else '''' end
      ,[amm_ika] = Case when amm_ika <= jaksovuosi then amm_ika else NULL end
      ,[amm_myohempi_tutkinto_suoritettu] = Case when amm_ika <= jaksovuosi then amm_myohempi_tutkinto_suoritettu else ''E'' end
      ,[opistlkm] = Case when opist_ika <= jaksovuosi then opistlkm else 0 end
      ,[opistkoulk] = Case when opist_ika <= jaksovuosi then opistkoulk else '''' end
      ,[opistsuorv] = Case when opist_ika <= jaksovuosi then opistsuorv else '''' end
      ,[opist_ika] = Case when opist_ika <= jaksovuosi then opist_ika else NULL end
      ,[opist_myohempi_tutkinto_suoritettu] = Case when opist_ika <= jaksovuosi then opist_myohempi_tutkinto_suoritettu else ''E'' end
      ,[ammkalkm] = Case when ammka_ika <= jaksovuosi then ammkalkm else 0 end
      ,[ammkakoulk] = Case when ammka_ika <= jaksovuosi then ammkakoulk else '''' end
      ,[ammkasuorv] = Case when ammka_ika <= jaksovuosi then ammkasuorv else '''' end
      ,[ammka_ika] = Case when ammka_ika <= jaksovuosi then ammka_ika else NULL end
      ,[ammka_myohempi_tutkinto_suoritettu] = Case when ammka_ika <= jaksovuosi then ammka_myohempi_tutkinto_suoritettu else ''E'' end
      ,[amklkm] = Case when amk_ika <= jaksovuosi then amklkm else 0 end
      ,[amkkoulk] = Case when amk_ika <= jaksovuosi then amkkoulk else '''' end
      ,[amksuorv] = Case when amk_ika <= jaksovuosi then amksuorv else '''' end
      ,[amkaikoul] = Case when amk_ika <= jaksovuosi then amkaikoul else '''' end
      ,[amk_ika] = Case when amk_ika <= jaksovuosi then amk_ika else '''' end
      ,[amk_myohempi_tutkinto_suoritettu] = Case when amk_ika <= jaksovuosi then amk_myohempi_tutkinto_suoritettu else ''E'' end
      ,[akklkm] = Case when akk_ika <= jaksovuosi then akklkm else 0 end
      ,[akkkoulk] = Case when akk_ika <= jaksovuosi then akkkoulk else '''' end
      ,[akksuorv] = Case when akk_ika <= jaksovuosi then akksuorv else '''' end
      ,[akk_ika] = Case when akk_ika <= jaksovuosi then akk_ika else NULL end
      ,[akk_myohempi_tutkinto_suoritettu] = Case when akk_ika <= jaksovuosi then akk_myohempi_tutkinto_suoritettu else ''E'' end
      ,[ylamklkm] = Case when ylamk_ika <= jaksovuosi then ylamklkm else 0 end
      ,[ylamkkoulk] = Case when ylamk_ika <= jaksovuosi then ylamkkoulk else '''' end
      ,[ylamksuorv] = Case when ylamk_ika <= jaksovuosi then ylamksuorv else '''' end
      ,[ylamk_ika] = Case when ylamk_ika <= jaksovuosi then ylamk_ika else NULL end
      ,[ylamk_myohempi_tutkinto_suoritettu] = Case when ylamk_ika <= jaksovuosi then ylamk_myohempi_tutkinto_suoritettu else ''E'' end
      ,[ykklkm] = Case when ykk_ika <= jaksovuosi then ykklkm else 0 end
      ,[ykkkoulk] = Case when ykk_ika <= jaksovuosi then ykkkoulk else '''' end
      ,[ykksuorv] = Case when ykk_ika <= jaksovuosi then ykksuorv else '''' end
      ,[ykk_ika] = Case when ykk_ika <= jaksovuosi then ykk_ika else NULL end
      ,[ykk_myohempi_tutkinto_suoritettu] = Case when ykk_ika <= jaksovuosi then ykk_myohempi_tutkinto_suoritettu else ''E'' end
      ,[laakerlkm] = Case when laaker_ika <= jaksovuosi then laakerlkm else 0 end
      ,[laakerkoulk] = Case when laaker_ika <= jaksovuosi then laakerkoulk else '''' end
      ,[laakersuorv] = Case when laaker_ika <= jaksovuosi then laakersuorv else '''' end
      ,[laaker_ika] = Case when laaker_ika <= jaksovuosi then laaker_ika else NULL end
      ,[laaker_myohempi_tutkinto_suoritettu] = Case when laaker_ika <= jaksovuosi then laaker_myohempi_tutkinto_suoritettu else ''E'' end
      ,[lislkm] = Case when lis_ika <= jaksovuosi then lislkm else 0 end
      ,[liskoulk] = Case when lis_ika <= jaksovuosi then liskoulk else '''' end
      ,[lissuorv] = Case when lis_ika <= jaksovuosi then lissuorv else '''' end
      ,[lis_ika] = Case when lis_ika <= jaksovuosi then lis_ika else NULL end
      ,[lis_myohempi_tutkinto_suoritettu] = Case when lis_ika <= jaksovuosi then lis_myohempi_tutkinto_suoritettu else ''E'' end
      ,[tohtlkm] = Case when toht_ika <= jaksovuosi then tohtlkm else 0 end
      ,[tohtkoulk] = Case when toht_ika <= jaksovuosi then tohtkoulk else '''' end
      ,[tohtsuorv] = Case when toht_ika <= jaksovuosi then tohtsuorv else '''' end
      ,[toht_ika] = Case when toht_ika <= jaksovuosi then toht_ika else NULL end
      ,[toht_myohempi_tutkinto_suoritettu] = Case when toht_ika <= jaksovuosi then toht_myohempi_tutkinto_suoritettu else ''E'' end


      ,data.[tietolahde]
      ,[rivinumero]
	  ,tarkastelujakso_koodi
	from [dbo].[f_4_8_Tutkinnon_suorittaneiden_myohempi_koulutus] data
	join VipunenTK.dbo.d_tarkastelujakso on tarkastelujakso_koodi in (''1'', ''2'', ''3'', ''4'', ''7'', ''10'', ''13'', ''16'', ''99'') 
	--Huom! Tässä tehdään karteesinen tulo tarkoituksella / CSC Jarmo 14.9.2015
	left join VipunenTK_lisatiedot.dbo.ammatillinen_koulutus_luokittelu akl
		on  akl.[oppisopimuskoulutus_koodi] = data.oppisopimuskoulutus_koodi
		and akl.[ammatillisen_koulutuksen_koulutuslaji_koodi] = data.ammatillisen_koulutuksen_koulutuslaji_koodi
		and akl.[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi] = data.opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi
	--Poistetaan tulevaisuuteen ulottuvat tarkastelujaksot /CSC Jarmo 4.11.2015
	left join VipunenTK.dbo.d_koulutusluokitus kl
		on kl.koulutusluokitus_avain = data.koulutusluokitus_avain

	where 
	-- tarkastelujaksojen määrä riippuu koulutusaste2002:sta
	--   61,62,63,71,72,73,81,82 niin käytetään tarkastelujaksoja (''4'', ''7'', ''10'', ''13'', ''16'', ''99'')
	--   31, 32, 50, 90 (itse asiassa kaikki joita ei ole mainittu edellisellä rivillä) niin käytetään tarkastelujaksoja (''1'', ''2'', ''3'', ''4'', ''7'', ''10'', ''13'', ''16'', ''99'') 
		(
			( kl.koulutusaste2002_koodi in (''61'',''62'',''63'',''71'',''72'',''73'',''81'',''82'') and tarkastelujakso_koodi in (''4'', ''7'', ''10'', ''13'', ''16'', ''99'') )
			or
			( kl.koulutusaste2002_koodi not in (''61'',''62'',''63'',''71'',''72'',''73'',''81'',''82'') and tarkastelujakso_koodi in (''1'', ''2'', ''3'', ''4'', ''7'', ''10'', ''13'', ''16'', ''99'') )
		) 
		and 
		(
			tarkastelujakso_koodi = ''99''
			or 
			cast(data.suorv as int) + d_tarkastelujakso.jaksovuosi <= cast(data.tilastovuosi as int)
		)














' 
GO
/****** Object:  View [dbo].[v_f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15] AS
/*
CSC Jarmo 8.6.2015
Jos valtiota ei löydy dimensiosta, käytetään arvoa -1 tuntematon
 syynä ovat poistuneet valtiot (Neuvostoliitto, Jugoslavia, Tsekkoslovakia)

Drop table VipunenTK.dbo.f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15
Select * into VipunenTK.dbo.f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15 from VipunenTK_DW.dbo.v_f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15

Delete from VipunenTK.dbo.f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15 
Insert into VipunenTK.dbo.f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15 Select * from VipunenTK_DW.dbo.v_f_ulkomaalaiset_maan_kansalaisuuden_aidinkielen_mukaan_2_13_14_15 
*/

SELECT [tilastovuosi] = tilastointivuosi
      ,[tilv_date]
	  ,Nakokulma
      ,lahde_avain = f.[lahde]
	  ,lahde_id = ISNULL(d_la.id, -2)
      ,koulutusluokitus_avain = [koulutusluokitus]
	  ,koulutusluokitus_id = ISNULL(d_kl.id, -2)
      ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_avain = f.opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus
	  ,opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_id = ISNULL(d_osp.id, -2)
      ,ammatillisen_koulutuksen_koulutuslaji_avain = f.ammatillisen_koulutuksen_koulutuslaji
	  ,ammatillisen_koulutuksen_koulutuslaji_id = ISNULL(d_am.id, -2)
      ,opetushallinnon_koulutus_avain = f.opetushallinnon_koulutus
	  ,opetushallinnon_koulutus_id = ISNULL(d_ohk.id, -2)
      ,koulutuksen_opetuskieli_avain = f.koulutuksen_opetuskieli
	  ,koulutuksen_opetuskieli_id = ISNULL(d_ki.id, -2)
      ,nuorten_aikuisten_koulutus_amm_avain = f.nuorten_aikuisten_koulutus_amm
	  ,nuorten_aikuisten_koulutus_amm_id = ISNULL(d_na.id, -2)
      ,koulutuksen_sijaintimaakunta_avain = Case when f.koulutuksen_sijaintimaakunta=''-1'' then '''' else ''MAAK'' end + f.koulutuksen_sijaintimaakunta
	  ,koulutuksen_sijaintimaakunta_id = ISNULL(d_ksm.id, -2)
      ,sukupuoli_avain = f.sukupuoli
	  ,sukupuoli_id = ISNULL(d_sp.id, -2)
      ,aikuisopiskelija_avain = f.aikuisopiskelija
	  ,aikuisopiskelija_id = ISNULL(d_ao.id, -2)
	  ,koulutuksen_aloittamislukuvuosi
	  ,koulutuksen_aloittamislukukausi
      ,koulutuksen_aloittamislukukausi_avain = f.koulutuksen_aloittamislukuvuosi + koulutuksen_aloittamislukukausi
	  ,koulutuksen_aloittamislukukausi_id = ISNULL(d_ka.kausi_id, -2)
      ,kirjoillaolo_tammikuu_avain = f.kirjoillaolo_tammikuu
	  ,kirjoillaolo_tammikuu_id = ISNULL(d_ot.id, -2)
      ,kirjoillaolo_syyskuu_avain = f.kirjoillaolo_syyskuu
	  ,kirjoillaolo_syyskuu_id = ISNULL(d_os.id, -2)
      ,kotikunnan_kuntaryhma_avain = f.kotikunnan_kuntaryhma
	  ,kotikunnan_kuntaryhma_id = ISNULL(d_kr.id, -2)
      ,koulutusryhma_koulutuslaji3_avain = f.koulutusryhma_koulutuslaji3
	  ,koulutusryhma_koulutuslaji3_id = ISNULL(d_kl3.id, -2)
      ,kansalaisuus_maa_avain = f.kansalaisuus_maa
	  ,kansalaisuus_maa_id = ISNULL(d_kva.id, -1)
      ,kansalaisuus_versio1_avain = f.kansalaisuus_versio1
	  ,kansalaisuus_versio1_id = ISNULL(d_kka1.id, -2)
      ,syntymavaltio_maa_avain = f.syntymavaltio_maa
	  ,syntymavaltio_maa_id = ISNULL(d_sva.id, -1)
      ,syntymavaltio_kansalaisuus_versio1_avain = f.syntymavaltio_kansalaisuus_versio1
	  ,syntymavaltio_kansalaisuus_versio1_id = ISNULL(d_ska1.id, -2)
      ,aidinkieli_kieli_avain = f.aidinkieli_kieli
	  ,aidinkieli_kieli_id = ISNULL(d_ak.id, -2)
      ,aidinkieli_versio3_avain = f.aidinkieli_versio3
	  ,aidinkieli_versio3_id = ISNULL(d_a3.id, -2)
      ,koulutussektori_avain = f.koulutussektori
	  ,koulutussektori_id = ISNULL(d_ks.id, -2)
      ,[opiskelijoiden_lkm]
      ,f.[tietolahde]
      ,[rivinumero]
  FROM ( --f
Select   
	   [tilastointivuosi]
      ,[tilv_date]
      ,[lahde]
      ,[koulutusluokitus]
      ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus]
      ,[ammatillisen_koulutuksen_koulutuslaji]
      ,[opetushallinnon_koulutus]
      ,[koulutuksen_opetuskieli]
      ,[nuorten_aikuisten_koulutus_amm]
      ,[koulutuksen_sijaintimaakunta]
      ,[sukupuoli]
      ,[aikuisopiskelija]
      ,[koulutuksen_aloittamislukuvuosi]
      ,[koulutuksen_aloittamislukukausi]
      ,[kirjoillaolo_tammikuu]
      ,[kirjoillaolo_syyskuu]
      ,[kotikunnan_kuntaryhma]
      ,[koulutusryhma_koulutuslaji3]
      ,[kansalaisuus_maa]
      ,[kansalaisuus_versio1]
      ,[syntymavaltio_maa] = Cast(''-1'' as nvarchar(3))
      ,[syntymavaltio_kansalaisuus_versio1] = Cast(''-1'' as nvarchar(2))
      ,[aidinkieli_kieli] = Cast(''-1'' as nvarchar(10))
      ,[aidinkieli_versio3] = Cast(''-1'' as nvarchar(2))
      ,[koulutussektori]
      ,[opiskelijoiden_lkm]
      ,[tietolahde]
      ,[rivinumero]
	  ,Nakokulma = Cast(''Kansalaisuuden mukaan'' as nvarchar(50))
from [dbo].[f_2_13_Tutkintoon_johtavan_koulutuksen_opiskelijat_kansalaisuuden_mukaan]

Union all
Select   
	   [tilastointivuosi]
      ,[tilv_date]
      ,[lahde]
      ,[koulutusluokitus]
      ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus]
      ,[ammatillisen_koulutuksen_koulutuslaji]
      ,[opetushallinnon_koulutus]
      ,[koulutuksen_opetuskieli]
      ,[nuorten_aikuisten_koulutus_amm]
      ,[koulutuksen_sijaintimaakunta]
      ,[sukupuoli]
      ,[aikuisopiskelija]
      ,[koulutuksen_aloittamislukuvuosi]
      ,[koulutuksen_aloittamislukukausi]
      ,[kirjoillaolo_tammikuu]
      ,[kirjoillaolo_syyskuu]
      ,[kotikunnan_kuntaryhma]
      ,[koulutusryhma_koulutuslaji3]
      ,[kansalaisuus_maa] = Cast(''-1'' as nvarchar(3))
      ,[kansalaisuus_versio1] = Cast(''-1'' as nvarchar(2))
      ,[syntymavaltio_maa]
      ,[syntymavaltio_kansalaisuus_versio1]
      ,[aidinkieli_kieli] = Cast(''-1'' as nvarchar(10))
      ,[aidinkieli_versio3] = Cast(''-1'' as nvarchar(2))
      ,[koulutussektori]
      ,[opiskelijoiden_lkm]
      ,[tietolahde]
      ,[rivinumero]
	  ,Nakokulma = Cast(''Syntymämaan mukaan'' as nvarchar(50))
from [dbo].[f_2_14_Tutkintoon_johtavan_koulutuksen_opiskelijat_syntymamaan_mukaan]

Union all
Select   
	   [tilastointivuosi]
      ,[tilv_date]
      ,[lahde]
      ,[koulutusluokitus]
      ,[opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus]
      ,[ammatillisen_koulutuksen_koulutuslaji]
      ,[opetushallinnon_koulutus]
      ,[koulutuksen_opetuskieli]
      ,[nuorten_aikuisten_koulutus_amm]
      ,[koulutuksen_sijaintimaakunta]
      ,[sukupuoli]
      ,[aikuisopiskelija]
      ,[koulutuksen_aloittamislukuvuosi]
      ,[koulutuksen_aloittamislukukausi]
      ,[kirjoillaolo_tammikuu]
      ,[kirjoillaolo_syyskuu]
      ,[kotikunnan_kuntaryhma]
      ,[koulutusryhma_koulutuslaji3]
      ,[kansalaisuus_maa] = Cast(''-1'' as nvarchar(3))
      ,[kansalaisuus_versio1] = Cast(''-1'' as nvarchar(2))
      ,[syntymavaltio_maa] = Cast(''-1'' as nvarchar(3))
      ,[syntymavaltio_kansalaisuus_versio1] = Cast(''-1'' as nvarchar(2))
      ,[aidinkieli_kieli]
      ,[aidinkieli_versio3]
      ,[koulutussektori]
      ,[opiskelijoiden_lkm]
      ,[tietolahde]
      ,[rivinumero]
	  ,Nakokulma = Cast(''Äidinkielen mukaan'' as nvarchar(50))
from [dbo].[f_2_15_Tutkintoon_johtavan_koulutuksen_opiskelijat_aidinkielen_mukaan]

  ) f
LEFT JOIN VipunenTK.dbo.d_lahde d_la
	ON d_la.lahde_koodi = f.lahde
LEFT JOIN VipunenTK.dbo.d_koulutusluokitus d_kl
	ON d_kl.koulutusluokitus_avain = f.koulutusluokitus
LEFT JOIN VipunenTK.dbo.d_opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus d_osp
	ON d_osp.opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi = f.opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus
LEFT JOIN VipunenTK.dbo.d_ammatillisen_koulutuksen_koulutuslaji d_am
	ON d_am.ammatillisen_koulutuksen_koulutuslaji_koodi = f.ammatillisen_koulutuksen_koulutuslaji
LEFT JOIN VipunenTK.dbo.d_opetushallinnon_koulutus d_ohk
	ON d_ohk.opetushallinnon_koulutus_koodi = f.opetushallinnon_koulutus
LEFT JOIN VipunenTK.dbo.d_kieli d_ki
	ON d_ki.kieli_avain = f.koulutuksen_opetuskieli
LEFT JOIN VipunenTK.dbo.d_nuorten_aikuisten_koulutus_amm d_na
	ON d_na.nuorten_aikuisten_koulutus_amm_koodi = f.nuorten_aikuisten_koulutus_amm
LEFT JOIN VipunenTK.dbo.d_alueluokitus d_ksm
	ON d_ksm.alueluokitus_avain = Case when f.koulutuksen_sijaintimaakunta=''-1'' then '''' else ''MAAK'' end + f.koulutuksen_sijaintimaakunta
LEFT JOIN VipunenTK.dbo.d_sukupuoli d_sp
	ON d_sp.sukupuoli_koodi = f.sukupuoli
LEFT JOIN VipunenTK.dbo.d_aikuisopiskelija d_ao
	ON d_ao.aikuisopiskelija_koodi = f.aikuisopiskelija
LEFT JOIN VipunenTK.dbo.d_kausi d_ka
	ON d_ka.kausi_id = f.koulutuksen_aloittamislukuvuosi + f.koulutuksen_aloittamislukukausi
LEFT JOIN VipunenTK.dbo.d_opiskelijan_olo d_ot
	ON d_ot.opiskelijan_olo_koodi = f.kirjoillaolo_tammikuu
LEFT JOIN VipunenTK.dbo.d_opiskelijan_olo d_os
	ON d_os.opiskelijan_olo_koodi = f.kirjoillaolo_syyskuu
LEFT JOIN VipunenTK.dbo.d_kuntaryhma d_kr
	ON d_kr.kuntaryhma_koodi = f.kotikunnan_kuntaryhma
LEFT JOIN VipunenTK.dbo.d_koulutuslaji3 d_kl3
	ON d_kl3.koulutuslaji3_koodi = f.koulutusryhma_koulutuslaji3
LEFT JOIN VipunenTK.dbo.d_valtio d_kva
	ON d_kva.valtio_avain = f.kansalaisuus_maa
LEFT JOIN VipunenTK.dbo.d_kansalaisuus_versio1 d_kka1
	ON d_kka1.kansalaisuus_versio1_koodi = f.kansalaisuus_versio1
LEFT JOIN VipunenTK.dbo.d_valtio d_sva
	ON d_sva.valtio_avain = f.syntymavaltio_maa
LEFT JOIN VipunenTK.dbo.d_kansalaisuus_versio1 d_ska1
	ON d_ska1.kansalaisuus_versio1_koodi = f.syntymavaltio_kansalaisuus_versio1
LEFT JOIN VipunenTK.dbo.d_kieli d_ak
	ON d_ak.kieli_avain = f.aidinkieli_kieli
LEFT JOIN VipunenTK.dbo.d_aidinkieli_versio3 d_a3
	ON d_a3.aidinkieli_versio3_koodi = f.aidinkieli_versio3
LEFT JOIN VipunenTK.dbo.d_koulutussektori d_ks
	ON d_ks.koulutussektori_koodi = f.koulutussektori





' 
GO
/****** Object:  View [dbo].[v_hakukohde]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hakukohde]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hakukohde] AS
/*
Drop table VipunenTK.dbo.d_hakukohde
Select * into VipunenTK.dbo.d_hakukohde from VipunenTK_DW.dbo.v_hakukohde
Truncate table  VipunenTK.dbo.d_hakukohde
Insert into VipunenTK.dbo.d_hakukohde
Select * from VipunenTK_DW.dbo.v_hakukohde
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hakukohde_avain]
      ,[hakukohde]
      ,[hakukohde_SV]
      ,[hakukohde_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_hakukohde]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hakukohde_avain]
      ,[hakukohde]
      ,[hakukohde_SV]
      ,[hakukohde_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_hakukohde]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_hakukohde_erillisvalinta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hakukohde_erillisvalinta]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hakukohde_erillisvalinta] AS
/*
Drop table VipunenTK.dbo.d_hakukohde_erillisvalinta
Select * into VipunenTK.dbo.d_hakukohde_erillisvalinta from VipunenTK_DW.dbo.v_hakukohde_erillisvalinta
Truncate table  VipunenTK.dbo.d_hakukohde_erillisvalinta
Insert into VipunenTK.dbo.d_hakukohde_erillisvalinta
Select * from VipunenTK_DW.dbo.v_hakukohde_erillisvalinta
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hakukohde_erillisvalinta_avain]
      ,[hakukohde_erillisvalinta]
      ,[hakukohde_erillisvalinta_SV]
      ,[hakukohde_erillisvalinta_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_hakukohde_erillisvalinta]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hakukohde_erillisvalinta_avain]
      ,[hakukohde_erillisvalinta]
      ,[hakukohde_erillisvalinta_SV]
      ,[hakukohde_erillisvalinta_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_hakukohde_erillisvalinta]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_hakukohteen_prioriteetti]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hakukohteen_prioriteetti]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hakukohteen_prioriteetti] AS
/*
Drop table VipunenTK.dbo.d_hakukohteen_prioriteetti
Select * into VipunenTK.dbo.d_hakukohteen_prioriteetti from VipunenTK_DW.dbo.v_hakukohteen_prioriteetti
Truncate table  VipunenTK.dbo.d_hakukohteen_prioriteetti
Insert into VipunenTK.dbo.d_hakukohteen_prioriteetti
Select * from VipunenTK_DW.dbo.v_hakukohteen_prioriteetti
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hakukohteen_prioriteetti_avain]
      ,[hakukohteen_prioriteetti]
      ,[hakukohteen_prioriteetti_SV]
      ,[hakukohteen_prioriteetti_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_hakukohteen_prioriteetti]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hakukohteen_prioriteetti_avain]
      ,[hakukohteen_prioriteetti]
      ,[hakukohteen_prioriteetti_SV]
      ,[hakukohteen_prioriteetti_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_hakukohteen_prioriteetti]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_hakukohteen_tulos]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hakukohteen_tulos]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hakukohteen_tulos] AS
/*
Drop table VipunenTK.dbo.d_hakukohteen_tulos
Select * into VipunenTK.dbo.d_hakukohteen_tulos from VipunenTK_DW.dbo.v_hakukohteen_tulos
Truncate table  VipunenTK.dbo.d_hakukohteen_tulos
Insert into VipunenTK.dbo.d_hakukohteen_tulos
Select * from VipunenTK_DW.dbo.v_hakukohteen_tulos
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,hakukohde_hyvaksytty_koodi
      ,hakukohde_hyvaksytty
      ,hakukohde_hyvaksytty_SV
      ,hakukohde_hyvaksytty_EN
      ,jarjestys_hyvaksytty
      ,hakukohde_vastaanotettu_koodi
      ,hakukohde_vastaanotettu
      ,hakukohde_vastaanotettu_SV
      ,hakukohde_vastaanotettu_EN
      ,jarjestys_vastaanotettu
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_hakukohteen_tulos]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,hakukohde_hyvaksytty_koodi
      ,hakukohde_hyvaksytty
      ,hakukohde_hyvaksytty_SV
      ,hakukohde_hyvaksytty_EN
      ,jarjestys_hyvaksytty
      ,hakukohde_vastaanotettu_koodi
      ,hakukohde_vastaanotettu
      ,hakukohde_vastaanotettu_SV
      ,hakukohde_vastaanotettu_EN
      ,jarjestys_vastaanotettu
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_hakukohteen_tulos]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_hakukohteen_tutkinnon_taso]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hakukohteen_tutkinnon_taso]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hakukohteen_tutkinnon_taso] AS
/*
Drop table VipunenTK.dbo.d_hakukohteen_tutkinnon_taso
Select * into VipunenTK.dbo.d_hakukohteen_tutkinnon_taso from VipunenTK_DW.dbo.v_hakukohteen_tutkinnon_taso
Truncate table  VipunenTK.dbo.d_hakukohteen_tutkinnon_taso
Insert into VipunenTK.dbo.d_hakukohteen_tutkinnon_taso
Select * from VipunenTK_DW.dbo.v_hakukohteen_tutkinnon_taso
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
	  ,hakukohde_tutkinnon_taso_koodi
	  ,hakukohde_tutkinnon_taso
	  ,hakukohde_tutkinnon_taso_SV
	  ,hakukohde_tutkinnon_taso_EN
	  ,jarjestys_hakukohde_tutkinnon_taso
	  ,hakukohde_tutkinnon_taso_tarkennus_koodi
	  ,hakukohde_tutkinnon_taso_tarkennus
	  ,hakukohde_tutkinnon_taso_tarkennus_SV
	  ,hakukohde_tutkinnon_taso_tarkennus_EN
	  ,jarjestys_hakukohde_tutkinnon_taso_tarkennus
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_hakukohteen_tutkinnon_taso]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
	  ,hakukohde_tutkinnon_taso_koodi
	  ,hakukohde_tutkinnon_taso
	  ,hakukohde_tutkinnon_taso_SV
	  ,hakukohde_tutkinnon_taso_EN
	  ,jarjestys_hakukohde_tutkinnon_taso
	  ,hakukohde_tutkinnon_taso_tarkennus_koodi
	  ,hakukohde_tutkinnon_taso_tarkennus
	  ,hakukohde_tutkinnon_taso_tarkennus_SV
	  ,hakukohde_tutkinnon_taso_tarkennus_EN
	  ,jarjestys_hakukohde_tutkinnon_taso_tarkennus
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_hakukohteen_tutkinnon_taso]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_hallinnonala]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hallinnonala]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hallinnonala] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[hallinnonala_koodi]
,[hallinnonala]
,[hallinnonala_SV]
,[hallinnonala_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_hallinnonala]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[hallinnonala_koodi]
,[hallinnonala]
,[hallinnonala_SV]
,[hallinnonala_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_hallinnonala]
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_hallinnonala2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hallinnonala2]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_hallinnonala2] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[hallinnonala_koodi]
,[hallinnonala]
,[hallinnonala_SV]
,[hallinnonala_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_hallinnonala2]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[hallinnonala_koodi]
,[hallinnonala]
,[hallinnonala_SV]
,[hallinnonala_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_hallinnonala2]
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_hetu_ok]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_hetu_ok]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_hetu_ok] AS
/*
Drop table VipunenTK.dbo.d_hetu_ok
Select * into VipunenTK.dbo.d_hetu_ok from VipunenTK_DW.dbo.v_hetu_ok
Truncate table  VipunenTK.dbo.d_hetu_ok
Insert into VipunenTK.dbo.d_hetu_ok
Select * from VipunenTK_DW.dbo.v_hetu_ok
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hetu_ok_avain]
      ,[hetu_ok]
      ,[hetu_ok_SV]
      ,[hetu_ok_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_hetu_ok]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[hetu_ok_avain]
      ,[hetu_ok]
      ,[hetu_ok_SV]
      ,[hetu_ok_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_hetu_ok]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_ika]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_ika]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_ika] AS
/*
--Drop table VipunenTK.dbo.d_ika
--Select * into VipunenTK.dbo.d_ika from VipunenTK_DW.dbo.v_ika
Truncate table VipunenTK.dbo.d_ika
Insert into VipunenTK.dbo.d_ika
Select * from VipunenTK_DW.dbo.v_ika
*/

SELECT 
--[luotu],
       [id]
      ,[ika_avain]
      ,[ika_int]
      ,[ika]
      ,[ika_SV]
      ,[ika_EN]
      ,[ika5v_int]
      ,[ika5v]
      ,[ika5v_SV]
      ,[ika5v_EN]
      ,[jarjestys_ika]
      ,[jarjestys_ika5v]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_ika]
  
UNION ALL

SELECT --[luotu] ,
	   [id]
	  ,[ika_avain]
      ,[ika_int]
      ,[ika]
      ,[ika_SV]
      ,[ika_EN]
      ,[ika5v_int]
      ,[ika5v]
      ,[ika5v_SV]
      ,[ika5v_EN]
      ,[jarjestys_ika]
      ,[jarjestys_ika5v]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[ika]
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla_SV,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla_EN,
	jarjestys_4e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla_SV,
	jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla_EN,
	jarjestys_4e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisella_koulutuksen_jarjestajalla
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002_SV,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002_EN,
	jarjestys_2e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002_SV,
	jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002_EN,
	jarjestys_2e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisella_koulutusalalla_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002_SV,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002_EN,
	jarjestys_1e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002_SV,
	jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002_EN,
	jarjestys_1e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisella_koulutusasteella_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutussektorilla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutussektorilla]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisella_koulutussektorilla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla_SV,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla_EN,
	jarjestys_7e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisella_koulutussektorilla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla_koodi,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla_SV,
	jatkaa_opiskelua_alkuperaisella_koulutussektorilla_EN,
	jarjestys_7e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisella_koulutussektorilla
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisella_opintoalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisella_opintoalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisella_opintoalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002_koodi,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002_SV,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002_EN,
	jarjestys_3e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisella_opintoalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002_koodi,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002_SV,
	jatkaa_opiskelua_alkuperaisella_opintoalalla_2002_EN,
	jarjestys_3e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisella_opintoalalla_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisessa_maakunnassa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisessa_maakunnassa]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisessa_maakunnassa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa_koodi,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa_SV,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa_EN,
	jarjestys_6e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisessa_maakunnassa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa_koodi,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa_SV,
	jatkaa_opiskelua_alkuperaisessa_maakunnassa_EN,
	jarjestys_6e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisessa_maakunnassa
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa_koodi,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa_SV,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa_EN,
	jarjestys_5e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa_koodi,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa_SV,
	jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa_EN,
	jarjestys_5e,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_alkuperaisessa_oppilaitoksessa
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla_koodi,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla_SV,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla_EN,
	jarjestys_4f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla_koodi,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla_SV,
	jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla_EN,
	jarjestys_4f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muulla_koulutuksen_jarjestajalla
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muulla_koulutusalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muulla_koulutusalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muulla_koulutusalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutusalalla_2002_koodi,
	jatkaa_opiskelua_muulla_koulutusalalla_2002,
	jatkaa_opiskelua_muulla_koulutusalalla_2002_SV,
	jatkaa_opiskelua_muulla_koulutusalalla_2002_EN,
	jarjestys_2f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muulla_koulutusalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutusalalla_2002_koodi,
	jatkaa_opiskelua_muulla_koulutusalalla_2002,
	jatkaa_opiskelua_muulla_koulutusalalla_2002_SV,
	jatkaa_opiskelua_muulla_koulutusalalla_2002_EN,
	jarjestys_2f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muulla_koulutusalalla_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muulla_koulutusasteella_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muulla_koulutusasteella_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muulla_koulutusasteella_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutusasteella_2002_koodi,
	jatkaa_opiskelua_muulla_koulutusasteella_2002,
	jatkaa_opiskelua_muulla_koulutusasteella_2002_SV,
	jatkaa_opiskelua_muulla_koulutusasteella_2002_EN,
	jarjestys_1f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muulla_koulutusasteella_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutusasteella_2002_koodi,
	jatkaa_opiskelua_muulla_koulutusasteella_2002,
	jatkaa_opiskelua_muulla_koulutusasteella_2002_SV,
	jatkaa_opiskelua_muulla_koulutusasteella_2002_EN,
	jarjestys_1f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muulla_koulutusasteella_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muulla_koulutussektorilla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muulla_koulutussektorilla]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muulla_koulutussektorilla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutussektorilla_koodi,
	jatkaa_opiskelua_muulla_koulutussektorilla,
	jatkaa_opiskelua_muulla_koulutussektorilla_SV,
	jatkaa_opiskelua_muulla_koulutussektorilla_EN,
	jarjestys_7f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muulla_koulutussektorilla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_koulutussektorilla_koodi,
	jatkaa_opiskelua_muulla_koulutussektorilla,
	jatkaa_opiskelua_muulla_koulutussektorilla_SV,
	jatkaa_opiskelua_muulla_koulutussektorilla_EN,
	jarjestys_7f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muulla_koulutussektorilla
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muulla_opintoalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muulla_opintoalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muulla_opintoalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_opintoalalla_2002_koodi,
	jatkaa_opiskelua_muulla_opintoalalla_2002,
	jatkaa_opiskelua_muulla_opintoalalla_2002_SV,
	jatkaa_opiskelua_muulla_opintoalalla_2002_EN,
	jarjestys_3f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muulla_opintoalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muulla_opintoalalla_2002_koodi,
	jatkaa_opiskelua_muulla_opintoalalla_2002,
	jatkaa_opiskelua_muulla_opintoalalla_2002_SV,
	jatkaa_opiskelua_muulla_opintoalalla_2002_EN,
	jarjestys_3f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muulla_opintoalalla_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muussa_maakunnassa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muussa_maakunnassa]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muussa_maakunnassa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muussa_maakunnassa_koodi,
	jatkaa_opiskelua_muussa_maakunnassa,
	jatkaa_opiskelua_muussa_maakunnassa_SV,
	jatkaa_opiskelua_muussa_maakunnassa_EN,
	jarjestys_6f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muussa_maakunnassa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muussa_maakunnassa_koodi,
	jatkaa_opiskelua_muussa_maakunnassa,
	jatkaa_opiskelua_muussa_maakunnassa_SV,
	jatkaa_opiskelua_muussa_maakunnassa_EN,
	jarjestys_6f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muussa_maakunnassa
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatkaa_opiskelua_muussa_oppilaitoksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatkaa_opiskelua_muussa_oppilaitoksessa]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatkaa_opiskelua_muussa_oppilaitoksessa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muussa_oppilaitoksessa_koodi,
	jatkaa_opiskelua_muussa_oppilaitoksessa,
	jatkaa_opiskelua_muussa_oppilaitoksessa_SV,
	jatkaa_opiskelua_muussa_oppilaitoksessa_EN,
	jarjestys_5f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatkaa_opiskelua_muussa_oppilaitoksessa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatkaa_opiskelua_muussa_oppilaitoksessa_koodi,
	jatkaa_opiskelua_muussa_oppilaitoksessa,
	jatkaa_opiskelua_muussa_oppilaitoksessa_SV,
	jatkaa_opiskelua_muussa_oppilaitoksessa_EN,
	jarjestys_5f,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatkaa_opiskelua_muussa_oppilaitoksessa
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_jatko_opiskelu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_jatko_opiskelu]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_jatko_opiskelu] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatko_opiskelu_koodi,
	jatko_opiskelu,
	jatko_opiskelu_SV,
	jatko_opiskelu_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_jatko_opiskelu
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	jatko_opiskelu_koodi,
	jatko_opiskelu,
	jatko_opiskelu_SV,
	jatko_opiskelu_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_jatko_opiskelu
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_joustava_perusopetus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_joustava_perusopetus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_joustava_perusopetus] AS
/*
Drop table VipunenTK.dbo.d_joustava_perusopetus
Select * into VipunenTK.dbo.d_joustava_perusopetus from VipunenTK_DW.dbo.v_joustava_perusopetus
Truncate table  VipunenTK.dbo.d_joustava_perusopetus
Insert into VipunenTK.dbo.d_joustava_perusopetus
Select * from VipunenTK_DW.dbo.v_joustava_perusopetus
*/

SELECT [id]
      --,[luotu]
      ,[joustava_perusopetus_koodi]
      ,[joustava_perusopetus]
      ,[joustava_perusopetus_SV]
      ,[joustava_perusopetus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_joustava_perusopetus]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[joustava_perusopetus_koodi]
      ,[joustava_perusopetus]
      ,[joustava_perusopetus_SV]
      ,[joustava_perusopetus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_joustava_perusopetus]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_kansalaisuus_versio1]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_kansalaisuus_versio1]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_kansalaisuus_versio1] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	kansalaisuus_versio1_koodi,
	kansalaisuus_versio1,
	kansalaisuus_versio1_SV,
	kansalaisuus_versio1_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_kansalaisuus_versio1
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	kansalaisuus_versio1_koodi,
	kansalaisuus_versio1,
	kansalaisuus_versio1_SV,
	kansalaisuus_versio1_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_kansalaisuus_versio1
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_kansalaisuus_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_kansalaisuus_versio2]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_kansalaisuus_versio2] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	kansalaisuus_versio2_koodi,
	kansalaisuus_versio2,
	kansalaisuus_versio2_SV,
	kansalaisuus_versio2_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_kansalaisuus_versio2
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	kansalaisuus_versio2_koodi,
	kansalaisuus_versio2,
	kansalaisuus_versio2_SV,
	kansalaisuus_versio2_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_kansalaisuus_versio2
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_kausi]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_kausi]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_kausi] AS 

/*
Truncate table VipunenTK.dbo.d_kausi
INSERT INTO [VipunenTK].[dbo].[d_kausi]
           ([kausi_id]
           ,[luotu]
           ,[alkaa]
           ,[paattyy]
           ,[vuosi]
           ,[vuosiselite]
           ,[vuosiselite_SV]
           ,[vuosiselite_EN]
           ,[lukukausi]
           ,[lukukausiselite]
           ,[lukukausiselite_SV]
           ,[lukukausiselite_EN]
           ,[lukuvuosikausiselite]
           ,[lukuvuosikausiselite_SV]
           ,[lukuvuosikausiselite_EN])
           ,[kuukausi]
           ,[kuukausiselite]
           ,[kuukausiselite_SV]
           ,[kuukausiselite_EN]
           ,[paiva]
           ,[lukuvuosi]
           ,[jarjestys]
           ,[poistettu]
           ,[tietolahde]
           ,[kommentti]
  Select * from VipunenTK_DW.dbo.v_kausi
*/

SELECT [kausi_id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[vuosi]
      ,[vuosiselite]
      ,[vuosiselite_SV]
      ,[vuosiselite_EN]
      ,[lukukausi]
      ,[lukukausiselite]
      ,[lukukausiselite_SV]
      ,[lukukausiselite_EN]
      ,[kuukausi]
      ,[kuukausiselite]
      ,[kuukausiselite_SV]
      ,[kuukausiselite_EN]
      ,[paiva]
      ,[lukuvuosi]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
      ,[lukuvuosikausiselite] = [vuosiselite] + '' '' + [lukukausiselite]
      ,[lukuvuosikausiselite_SV] = [vuosiselite_SV] + '' '' + [lukukausiselite_SV]
      ,[lukuvuosikausiselite_EN] = [vuosiselite_EN] + '' '' + [lukukausiselite_EN]
  FROM [VipunenTK_DW].[dbo].[d_kausi]
  
UNION ALL 

SELECT [kausi_id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[vuosi]
      ,[vuosiselite]
      ,[vuosiselite_SV]
      ,[vuosiselite_EN]
      ,[lukukausi]
      ,[lukukausiselite]
      ,[lukukausiselite_SV]
      ,[lukukausiselite_EN]
      ,[kuukausi]
      ,[kuukausiselite]
      ,[kuukausiselite_SV]
      ,[kuukausiselite_EN]
      ,[paiva]
      ,[lukuvuosi]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
      ,[lukuvuosikausiselite] = [vuosiselite] + '' '' + [lukukausiselite]
      ,[lukuvuosikausiselite_SV] = [vuosiselite_SV] + '' '' + [lukukausiselite_SV]
      ,[lukuvuosikausiselite_EN] = [vuosiselite_EN] + '' '' + [lukukausiselite_EN]
  FROM [VipunenTK_lisatiedot].[dbo].[kausi]
  
WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_kieli]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_kieli]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[v_kieli] as
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	kieli_avain,
	kieli_koodi,
	kieli,
	kieli_SV,
	kieli_EN,
	iso3kirjainta_koodi,
	jarjestys,
	jarjestys_iso3kirjainta,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_kieli
UNION
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	kieli_avain,
	kieli_koodi,
	kieli,
	kieli_SV,
	kieli_EN,
	iso3kirjainta_koodi,
	jarjestys,
	jarjestys_iso3kirjainta,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..kieli
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_kieli2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_kieli2]'))
EXEC dbo.sp_executesql @statement = N'

/*
truncate table VipunenTK.dbo.d_kieli2
insert into VipunenTK.dbo.d_kieli2
select * from VipunenTK_DW.dbo.v_kieli2
*/


CREATE VIEW [dbo].[v_kieli2] AS
SELECT
	id,
	luotu,
	kieli_koodi,
	kieli,
	kieli_SV,
	kieli_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_kieli2
UNION ALL
SELECT
	id,
	luotu,
	kieli_koodi,
	kieli,
	kieli_SV,
	kieli_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_kieli2
WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_koulutukseen_sijoittuneet_2v_dw]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutukseen_sijoittuneet_2v_dw]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutukseen_sijoittuneet_2v_dw] AS
(SELECT     rivinumero, tarkastelujakso, tilv,CAST(tilv + ''0101'' AS date) AS tilv_date, tutkryh, suorv, suorlk, sp, syntv, aikielir1, tutkkaskun, kansalr1, pohjmaa, eumaa, etamaa, tunn, jarj, kkielir1, tutklaja, tutktav, aikoul, 
                      tutkmaak, pohjkoulk, koulutus_1, oppilaitos_1, koulutuksen_jarjestaja_1, koulutuksen_maakunta_1, monihaku, paaasiallinen_toiminta, ammattiasema, lkm, tietolahde, 
                      aineisto, lukiokoulutuksessa, ammatillisessa_koulutuksessa, ammattikorkeakoulutuksessa, yliopistokoulutuksessa, 
                      lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa, toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa, 
                      ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa, koulutuksen_paattaneiden_toiminta
FROM         [_koulutukseen_sijoittuneet_2v_tarkastelu]
WHERE     koulutus_1 <> NULL AND koulutus_2 = NULL)
UNION ALL
(SELECT     rivinumero, tarkastelujakso, tilv,CAST(tilv + ''0101'' AS date) AS tilv_date, tutkryh, suorv, suorlk, sp, syntv, aikielir1, tutkkaskun, kansalr1, pohjmaa, eumaa, etamaa, tunn, jarj, kkielir1, tutklaja, tutktav, aikoul, 
                        tutkmaak, pohjkoulk, koulutus_1, oppilaitos_1, koulutuksen_jarjestaja_1, koulutuksen_maakunta_1, monihaku, paaasiallinen_toiminta, ammattiasema, lkm, 
                        tietolahde, aineisto, lukiokoulutuksessa, ammatillisessa_koulutuksessa, ammattikorkeakoulutuksessa, yliopistokoulutuksessa, 
                        lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa, toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa, 
                        ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa, koulutuksen_paattaneiden_toiminta
 FROM         [_koulutukseen_sijoittuneet_2v_tarkastelu]
 WHERE     koulutus_1 <> NULL AND koulutus_2 <> NULL)
UNION ALL
(SELECT     rivinumero, tarkastelujakso, tilv,CAST(tilv + ''0101'' AS date) AS tilv_date, tutkryh, suorv, suorlk, sp, syntv, aikielir1, tutkkaskun, kansalr1, pohjmaa, eumaa, etamaa, tunn, jarj, kkielir1, tutklaja, tutktav, aikoul, 
                        tutkmaak, pohjkoulk, koulutus_2, oppilaitos_2, koulutuksen_jarjestaja_2, koulutuksen_maakunta_2, monihaku, paaasiallinen_toiminta, ammattiasema, lkm, 
                        tietolahde, aineisto, lukiokoulutuksessa, ammatillisessa_koulutuksessa, ammattikorkeakoulutuksessa, yliopistokoulutuksessa, 
                        lukiokoulutuksessa_ja_ammatillisessa_koulutuksessa, toisen_asteen_ammatillisessa_koulutuksessa_ja_korkeakoulutuksessa, 
                        ammattikorkeakoulutuksessa_ja_yliopistokoulutuksessa, koulutuksen_paattaneiden_toiminta
 FROM         [_koulutukseen_sijoittuneet_2v_tarkastelu]
 WHERE     koulutus_1 <> NULL AND koulutus_2 <> NULL)
' 
GO
/****** Object:  View [dbo].[v_koulutuksen_jarjestajan_koko]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksen_jarjestajan_koko]'))
EXEC dbo.sp_executesql @statement = N'

/*
truncate table VipunenTK.dbo.d_koulutuksen_jarjestajan_koko
insert into VipunenTK.dbo.d_koulutuksen_jarjestajan_koko
select * into VipunenTK.dbo.d_koulutuksen_jarjestajan_koko from VipunenTK_DW.dbo.v_koulutuksen_jarjestajan_koko
*/


CREATE VIEW [dbo].[v_koulutuksen_jarjestajan_koko] AS
SELECT
	id,
	luotu,
	koko_koodi,
	koko,
	koko_SV,
	koko_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutuksen_jarjestajan_koko
UNION ALL
SELECT
	id,
	luotu,
	koko_koodi,
	koko,
	koko_SV,
	koko_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutuksen_jarjestajan_koko
WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_koulutuksen_jarjestamismuoto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksen_jarjestamismuoto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutuksen_jarjestamismuoto] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[koulutuksen_jarjestamismuoto_koodi]
,[koulutuksen_jarjestamismuoto]
,[koulutuksen_jarjestamismuoto_SV]
,[koulutuksen_jarjestamismuoto_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_koulutuksen_jarjestamismuoto]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[koulutuksen_jarjestamismuoto_koodi]
,[koulutuksen_jarjestamismuoto]
,[koulutuksen_jarjestamismuoto_SV]
,[koulutuksen_jarjestamismuoto_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_koulutuksen_jarjestamismuoto]
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutuksen_kesto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksen_kesto]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_koulutuksen_kesto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutuksen_kesto_koodi,
	koulutuksen_kesto,
	koulutuksen_kesto_SV,
	koulutuksen_kesto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutuksen_kesto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutuksen_kesto_koodi,
	koulutuksen_kesto,
	koulutuksen_kesto_SV,
	koulutuksen_kesto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutuksen_kesto
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_koulutuksen_kieli_versio1]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksen_kieli_versio1]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutuksen_kieli_versio1] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutuksen_kieli_versio1_koodi]
      ,[koulutuksen_kieli_versio1]
      ,[koulutuksen_kieli_versio1_SV]
      ,[koulutuksen_kieli_versio1_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_koulutuksen_kieli_versio1]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutuksen_kieli_versio1_koodi]
      ,[koulutuksen_kieli_versio1]
      ,[koulutuksen_kieli_versio1_SV]
      ,[koulutuksen_kieli_versio1_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutuksen_kieli_versio1]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_koulutuksen_paattaneiden_toiminta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksen_paattaneiden_toiminta]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutuksen_paattaneiden_toiminta] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutuksen_paattaneiden_toiminta_koodi]
      ,[koulutuksen_paattaneiden_toiminta]
      ,[koulutuksen_paattaneiden_toiminta_SV]
      ,[koulutuksen_paattaneiden_toiminta_EN]
      ,[jarjestys]
--      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_koulutuksen_paattaneiden_toiminta]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutuksen_paattaneiden_toiminta_koodi]
      ,[koulutuksen_paattaneiden_toiminta]
      ,[koulutuksen_paattaneiden_toiminta_SV]
      ,[koulutuksen_paattaneiden_toiminta_EN]
      ,[jarjestys]
--      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutuksen_paattaneiden_toiminta]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_koulutuksen_tavoite_toteuma]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksen_tavoite_toteuma]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutuksen_tavoite_toteuma] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[koulutuksen_tavoite_toteuma_koodi]
,[koulutuksen_tavoite_toteuma]
,[koulutuksen_tavoite_toteuma_SV]
,[koulutuksen_tavoite_toteuma_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_koulutuksen_tavoite_toteuma]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[koulutuksen_tavoite_toteuma_koodi]
,[koulutuksen_tavoite_toteuma]
,[koulutuksen_tavoite_toteuma_SV]
,[koulutuksen_tavoite_toteuma_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_koulutuksen_tavoite_toteuma]
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutuksesta_kulunut_aika]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuksesta_kulunut_aika]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_koulutuksesta_kulunut_aika] AS

-- delete from VipunenTK.dbo.d_koulutuksesta_kulunut_aika
-- Insert into VipunenTK.dbo.d_koulutuksesta_kulunut_aika Select * from VipunenTK_DW.dbo.v_koulutuksesta_kulunut_aika
-- Select * into VipunenTK.dbo.d_koulutuksesta_kulunut_aika from VipunenTK_DW.dbo.v_koulutuksesta_kulunut_aika
--
-- Select * from VipunenTK_DW.dbo.v_koulutuksesta_kulunut_aika

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutuksesta_kulunut_aika_koodi]
      ,[koulutuksesta_kulunut_aika]
      ,[koulutuksesta_kulunut_aika_SV]
      ,[koulutuksesta_kulunut_aika_EN]
      ,[jarjestys]
      ,[koulutuksesta_kulunut_aika_5v]
      ,[koulutuksesta_kulunut_aika_5v_SV]
      ,[koulutuksesta_kulunut_aika_5v_EN]
      ,[jarjestys_5v]
      ,[koulutuksesta_kulunut_aika_tthv]
      ,[koulutuksesta_kulunut_aika_tthv_SV]
      ,[koulutuksesta_kulunut_aika_tthv_EN]
      ,[jarjestys_tthv]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_koulutuksesta_kulunut_aika]

UNION ALL

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutuksesta_kulunut_aika_koodi]
      ,[koulutuksesta_kulunut_aika]
      ,[koulutuksesta_kulunut_aika_SV]
      ,[koulutuksesta_kulunut_aika_EN]
      ,[jarjestys]
      ,[koulutuksesta_kulunut_aika_5v]
      ,[koulutuksesta_kulunut_aika_5v_SV]
      ,[koulutuksesta_kulunut_aika_5v_EN]
      ,[jarjestys_5v]
      ,[koulutuksesta_kulunut_aika_tthv]
      ,[koulutuksesta_kulunut_aika_tthv_SV]
      ,[koulutuksesta_kulunut_aika_tthv_EN]
      ,[jarjestys_tthv]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_koulutuksesta_kulunut_aika]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_koulutusaste_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusaste_2002]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutusaste_2002] AS
/*
Drop table VipunenTK.dbo.d_koulutusaste_2002
Select * into VipunenTK.dbo.d_koulutusaste_2002 from VipunenTK_DW.dbo.v_koulutusaste_2002
Truncate table  VipunenTK.dbo.d_koulutusaste_2002
Insert into VipunenTK.dbo.d_koulutusaste_2002
Select * from VipunenTK_DW.dbo.v_koulutusaste_2002
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutusaste_2002koodi]
      ,[koulutusaste_2002]
      ,[koulutusaste_2002_SV]
      ,[koulutusaste_2002_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_koulutusaste_2002]
  
  UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[koulutusaste_2002koodi]
      ,[koulutusaste_2002]
      ,[koulutusaste_2002_SV]
      ,[koulutusaste_2002_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_koulutusaste_2002]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_koulutuslaji]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuslaji]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutuslaji] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutuslaji_koodi,
	koulutuslaji,
	koulutuslaji_SV,
	koulutuslaji_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutuslaji
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutuslaji_koodi,
	koulutuslaji,
	koulutuslaji_SV,
	koulutuslaji_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutuslaji
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutuslaji_okm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuslaji_okm]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/


create view [dbo].[v_koulutuslaji_okm] as

SELECT [id]
      ,[koulutuslaji_okm_avain]
      ,[koulutuslaji_okm]
      ,[koulutuslaji_okm_SV]
      ,[koulutuslaji_okm_EN]
      ,[koulutuslaji_okm2]
      ,[koulutuslaji_okm2_SV]
      ,[koulutuslaji_okm2_EN]
      ,[jarjestys]
      ,[jarjestys2]
  FROM [VipunenTK_dw].[dbo].[d_koulutuslaji_okm]

union all

SELECT [id]
      ,[koulutuslaji_okm_avain]
      ,[koulutuslaji_okm]
      ,[koulutuslaji_okm_SV]
      ,[koulutuslaji_okm_EN]
      ,[koulutuslaji_okm2]
      ,[koulutuslaji_okm2_SV]
      ,[koulutuslaji_okm2_EN]
      ,[jarjestys]
      ,[jarjestys2]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutuslaji_okm]
  WHERE virhetilanne = ''K''' 
GO
/****** Object:  View [dbo].[v_koulutuslaji2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuslaji2]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_koulutuslaji2] AS 

/*
truncate table VipunenTK.dbo.d_koulutuslaji2
insert into VipunenTK.dbo.d_koulutuslaji2
select * from [VipunenTK_DW].dbo.[v_koulutuslaji2]

drop table VipunenTK.dbo.d_koulutuslaji2
select * into VipunenTK.dbo.d_koulutuslaji2 from [VipunenTK_DW].dbo.[v_koulutuslaji2]
*/

SELECT [id]
      ,[luotu]
      ,[koulutuslaji2_koodi]
      ,[koulutuslaji2]
      ,[koulutuslaji2_SV]
      ,[koulutuslaji2_EN]
      ,[jarjestys_koulutuslaji2]
      ,[jarjestamistapa]
      ,[jarjestamistapa_SV]
      ,[jarjestamistapa_EN]
      ,[jarjestys_jarjestamistapa]
      ,[jarjestamismuoto]
      ,[jarjestamismuoto_SV]
      ,[jarjestamismuoto_EN]
      ,[jarjestys_jarjestamismuoto]
      ,[tutkintotyyppi]
      ,[tutkintotyyppi_SV]
      ,[tutkintotyyppi_EN]
      ,[jarjestys_tutkintotyyppi]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_koulutuslaji2]

UNION ALL 

SELECT [id]
      ,[luotu]
      ,[koulutuslaji2_koodi]
      ,[koulutuslaji2]
      ,[koulutuslaji2_SV]
      ,[koulutuslaji2_EN]
      ,[jarjestys_koulutuslaji2]
      ,[jarjestamistapa]
      ,[jarjestamistapa_SV]
      ,[jarjestamistapa_EN]
      ,[jarjestys_jarjestamistapa]
      ,[jarjestamismuoto]
      ,[jarjestamismuoto_SV]
      ,[jarjestamismuoto_EN]
      ,[jarjestys_jarjestamismuoto]
      ,[tutkintotyyppi]
      ,[tutkintotyyppi_SV]
      ,[tutkintotyyppi_EN]
      ,[jarjestys_tutkintotyyppi]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutuslaji2]

WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_koulutuslaji3]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutuslaji3]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_koulutuslaji3] AS 

/*
truncate table VipunenTK.dbo.d_koulutuslaji3
insert into VipunenTK.dbo.d_koulutuslaji3
select * from [VipunenTK_DW].dbo.[v_koulutuslaji3]

drop table VipunenTK.dbo.d_koulutuslaji3
select * into VipunenTK.dbo.d_koulutuslaji3 from [VipunenTK_DW].dbo.[v_koulutuslaji3]
*/

SELECT [id]
      ,[luotu]
      ,[koulutuslaji3_koodi]
      ,[koulutuslaji3]
      ,[koulutuslaji3_SV]
      ,[koulutuslaji3_EN]
      ,[jarjestys_koulutuslaji3]
      ,[jarjestamistapa]
      ,[jarjestamistapa_SV]
      ,[jarjestamistapa_EN]
      ,[jarjestys_jarjestamistapa]
      ,[jarjestamismuoto]
      ,[jarjestamismuoto_SV]
      ,[jarjestamismuoto_EN]
      ,[jarjestys_jarjestamismuoto]
      ,[tutkintotyyppi]
      ,[tutkintotyyppi_SV]
      ,[tutkintotyyppi_EN]
      ,[jarjestys_tutkintotyyppi]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_koulutuslaji3]

UNION ALL 

SELECT [id]
      ,[luotu]
      ,[koulutuslaji3_koodi]
      ,[koulutuslaji3]
      ,[koulutuslaji3_SV]
      ,[koulutuslaji3_EN]
      ,[jarjestys_koulutuslaji3]
      ,[jarjestamistapa]
      ,[jarjestamistapa_SV]
      ,[jarjestamistapa_EN]
      ,[jarjestys_jarjestamistapa]
      ,[jarjestamismuoto]
      ,[jarjestamismuoto_SV]
      ,[jarjestamismuoto_EN]
      ,[jarjestys_jarjestamismuoto]
      ,[tutkintotyyppi]
      ,[tutkintotyyppi_SV]
      ,[tutkintotyyppi_EN]
      ,[jarjestys_tutkintotyyppi]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutuslaji3]

WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_koulutusluokitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusluokitus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutusluokitus] AS 
/*
Select * into VipunenTK.dbo.d_koulutusluokitus from VipunenTK_DW.[dbo].[v_koulutusluokitus]
delete from VipunenTK.dbo.d_koulutusluokitus
Insert into VipunenTK.dbo.d_koulutusluokitus
  Select * from VipunenTK_DW.[dbo].[v_koulutusluokitus]
*/
SELECT DISTINCT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy] = ISNULL([paattyy], Cast(''9999-01-01'' as date))
      ,[koulutusluokitus_avain]
      ,[koulutus_koodi]
      ,[viimeisin_tilv] = ISNULL([viimeisin_tilv], '''')
      ,[koulutus]
      ,[koulutus_SV]
      ,[koulutus_EN]
      ,[koulutuslyhyt]
      ,[koulutuslyhyt_SV]
      ,[koulutuslyhyt_EN]
      ,[taso_koodi]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[koulutusaste_koodi]
      ,[koulutusaste]
      ,[koulutusaste_SV]
      ,[koulutusaste_EN]
      ,[koulutusala2002_koodi]
      ,[koulutusala2002]
      ,[koulutusala2002_SV]
      ,[koulutusala2002_EN]
      ,[opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[koulutusaste2002_koodi]
      ,[koulutusaste2002]
      ,[koulutusaste2002_SV]
      ,[koulutusaste2002_EN]
      ,[koulutusala1995_koodi]
      ,[koulutusala1995]
      ,[koulutusala1995_SV]
      ,[koulutusala1995_EN]
      ,[opintoala1995_koodi]
      ,[opintoala1995]
      ,[opintoala1995_SV]
      ,[opintoala1995_EN]
      ,[koulutusaste1995_koodi]
      ,[koulutusaste1995]
      ,[koulutusaste1995_SV]
      ,[koulutusaste1995_EN]
      ,[isclek_koodi]
      ,[isclek]
      ,[isclek_SV]
      ,[isclek_EN]
      ,[iscle_koodi]
      ,[iscle]
      ,[iscle_SV]
      ,[iscle_EN]
      ,[iscfik_koodi]
      ,[iscfik]
      ,[iscfik_SV]
      ,[iscfik_EN]
      ,[iscde_koodi]
      ,[iscde]
      ,[iscde_SV]
      ,[iscde_EN]
      ,[iscor_koodi]
      ,[iscor]
      ,[iscor_SV]
      ,[iscor_EN]
      ,[iscst_koodi]
      ,[iscst]
      ,[iscst_SV]
      ,[iscst_EN]
      ,[iscdu_koodi]
      ,[iscdu]
      ,[iscdu_SV]
      ,[iscdu_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[olo_koodi]
      ,[lakkautusvuosi]
      ,[korvaava_koulutus_koodi]
      ,[muutosvuosi]
      ,[jarjestys]
      ,[jarjestys_taso]
      ,[jarjestys_koulutusala]
      ,[jarjestys_koulutusaste]
      ,[jarjestys_koulutusala2002]
      ,[jarjestys_opintoala2002]
      ,[jarjestys_koulutusaste2002]
      ,[jarjestys_koulutusala1995]
      ,[jarjestys_opintoala1995]
      ,[jarjestys_koulutusaste1995]
      ,[jarjestys_isclek]
      ,[jarjestys_iscle]
      ,[jarjestys_iscfik]
      ,[jarjestys_iscde]
      ,[jarjestys_iscor]
      ,[jarjestys_iscst]
      ,[jarjestys_iscdu]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]

UNION ALL

SELECT DISTINCT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy] = ISNULL([paattyy], Cast(''9999-01-01'' as date))
      ,[koulutusluokitus_avain]
      ,[koulutus_koodi]
      ,[viimeisin_tilv] = ''''
      ,[koulutus]
      ,[koulutus_SV]
      ,[koulutus_EN]
      ,[koulutuslyhyt]
      ,[koulutuslyhyt_SV]
      ,[koulutuslyhyt_EN]
      ,[taso_koodi]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[koulutusaste_koodi]
      ,[koulutusaste]
      ,[koulutusaste_SV]
      ,[koulutusaste_EN]
      ,[koulutusala2002_koodi]
      ,[koulutusala2002]
      ,[koulutusala2002_SV]
      ,[koulutusala2002_EN]
      ,[opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[koulutusaste2002_koodi]
      ,[koulutusaste2002]
      ,[koulutusaste2002_SV]
      ,[koulutusaste2002_EN]
      ,[koulutusala1995_koodi]
      ,[koulutusala1995]
      ,[koulutusala1995_SV]
      ,[koulutusala1995_EN]
      ,[opintoala1995_koodi]
      ,[opintoala1995]
      ,[opintoala1995_SV]
      ,[opintoala1995_EN]
      ,[koulutusaste1995_koodi]
      ,[koulutusaste1995]
      ,[koulutusaste1995_SV]
      ,[koulutusaste1995_EN]
      ,[isclek_koodi]
      ,[isclek]
      ,[isclek_SV]
      ,[isclek_EN]
      ,[iscle_koodi]
      ,[iscle]
      ,[iscle_SV]
      ,[iscle_EN]
      ,[iscfik_koodi]
      ,[iscfik]
      ,[iscfik_SV]
      ,[iscfik_EN]
      ,[iscde_koodi]
      ,[iscde]
      ,[iscde_SV]
      ,[iscde_EN]
      ,[iscor_koodi]
      ,[iscor]
      ,[iscor_SV]
      ,[iscor_EN]
      ,[iscst_koodi]
      ,[iscst]
      ,[iscst_SV]
      ,[iscst_EN]
      ,[iscdu_koodi]
      ,[iscdu]
      ,[iscdu_SV]
      ,[iscdu_EN]
      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[olo_koodi]
      ,[lakkautusvuosi]
      ,[korvaava_koulutus_koodi]
      ,[muutosvuosi]
      ,[jarjestys]
      ,[jarjestys_taso]
      ,[jarjestys_koulutusala]
      ,[jarjestys_koulutusaste]
      ,[jarjestys_koulutusala2002]
      ,[jarjestys_opintoala2002]
      ,[jarjestys_koulutusaste2002]
      ,[jarjestys_koulutusala1995]
      ,[jarjestys_opintoala1995]
      ,[jarjestys_koulutusaste1995]
      ,[jarjestys_isclek]
      ,[jarjestys_iscle]
      ,[jarjestys_iscfik]
      ,[jarjestys_iscde]
      ,[jarjestys_iscor]
      ,[jarjestys_iscst]
      ,[jarjestys_iscdu]
      ,[virhetilanne]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutusluokitus]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_koulutusluokitus_historia]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusluokitus_historia]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_koulutusluokitus_historia] AS 
/*
CSC Jarmo 24.3.2014
CSC Jarmo 28.9.2015 lisätty isced2013-kentät

Drop table VipunenTK.dbo.d_koulutusluokitus_historia
Select * into VipunenTK.dbo.d_koulutusluokitus_historia from VipunenTK_DW.[dbo].[v_koulutusluokitus_historia]

Truncate table VipunenTK.dbo.d_koulutusluokitus_historia
Insert into VipunenTK.dbo.d_koulutusluokitus_historia
  Select * from VipunenTK_DW.[dbo].[v_koulutusluokitus_historia]

ennen (10979 row(s) affected)
jälkeen (10979 row(s) affected) OK
*/

SELECT DISTINCT d_koulutusluokitus.[id]
      ,d_koulutusluokitus.[luotu]
      ,[koulutusluokitus_avain]
      ,[koulutus_koodi]
      ,[korvaava_koulutus_koodi]
      ,[alkaa]
      ,[paattyy] = ISNULL([paattyy], Cast(''9999-01-01'' as date))
      ,[viimeisin_tilv] = ISNULL([viimeisin_tilv], '''')
      ,[koulutus]
      ,[koulutus_SV]
      ,[koulutus_EN]
      ,[koulutuslyhyt]
      ,[koulutuslyhyt_SV]
      ,[koulutuslyhyt_EN]
      ,[taso_koodi]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[koulutusaste_koodi]
      ,[koulutusaste]
      ,[koulutusaste_SV]
      ,[koulutusaste_EN]
      ,[koulutusala2002_koodi]
      ,[koulutusala2002]
      ,[koulutusala2002_SV]
      ,[koulutusala2002_EN]
      ,[opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[koulutusaste2002_koodi]
      ,[koulutusaste2002]
      ,[koulutusaste2002_SV]
      ,[koulutusaste2002_EN]
      ,[koulutusala1995_koodi]
      ,[koulutusala1995]
      ,[koulutusala1995_SV]
      ,[koulutusala1995_EN]
      ,[opintoala1995_koodi]
      ,[opintoala1995]
      ,[opintoala1995_SV]
      ,[opintoala1995_EN]
      ,[koulutusaste1995_koodi]
      ,[koulutusaste1995]
      ,[koulutusaste1995_SV]
      ,[koulutusaste1995_EN]
      ,[isclek_koodi]
      ,[isclek]
      ,[isclek_SV]
      ,[isclek_EN]
      ,[iscle_koodi]
      ,[iscle]
      ,[iscle_SV]
      ,[iscle_EN]
      ,[iscfik_koodi]
      ,[iscfik]
      ,[iscfik_SV]
      ,[iscfik_EN]
      ,[iscde_koodi]
      ,[iscde]
      ,[iscde_SV]
      ,[iscde_EN]
      ,[iscor_koodi]
      ,[iscor]
      ,[iscor_SV]
      ,[iscor_EN]
      ,[iscst_koodi]
      ,[iscst]
      ,[iscst_SV]
      ,[iscst_EN]
      ,[iscdu_koodi]
      ,[iscdu]
      ,[iscdu_SV]
      ,[iscdu_EN]
	  ,[iscle2011_koodi]
	  ,[iscle2011]
	  ,[iscle2011_SV]
	  ,[iscle2011_EN]
	  ,[isccat2011_koodi]
	  ,[isccat2011]
	  ,[isccat2011_SV]
	  ,[isccat2011_EN]
	  ,[iscsubcat2011_koodi]
	  ,[iscsubcat2011]
	  ,[iscsubcat2011_SV]
	  ,[iscsubcat2011_EN]
	  ,d_koulutusluokitus.[iscfi2013_koodi]
	  ,[iscfi2013]
	  ,[iscfi2013_SV]
	  ,[iscfi2013_EN]
	  ,[iscfinarrow2013_koodi]
	  ,[iscfinarrow2013]
	  ,[iscfinarrow2013_SV]
	  ,[iscfinarrow2013_EN]
	  ,[iscfibroad2013_koodi]
	  ,[iscfibroad2013]
	  ,[iscfibroad2013_SV]
	  ,[iscfibroad2013_EN]

	  ,[OKM_ohjauksen_ala_koodi] = isnull(ktpo.[KTPO_ohjauksen_ala_2016_koodi], ktpo_virhe.[KTPO_ohjauksen_ala_2016_koodi])
	  ,[OKM_ohjauksen_ala] = isnull(ktpo.[KTPO_ohjauksen_ala_2016], ktpo_virhe.[KTPO_ohjauksen_ala_2016])
	  ,[OKM_ohjauksen_ala_SV] = isnull(ktpo.[KTPO_ohjauksen_ala_2016_SV], ktpo_virhe.[KTPO_ohjauksen_ala_2016_SV])
	  ,[OKM_ohjauksen_ala_EN] = isnull(ktpo.[KTPO_ohjauksen_ala_2016_EN], ktpo_virhe.[KTPO_ohjauksen_ala_2016_EN])
	  ,[OKM_ohjauksen_ala_yo_tav_koodi] = isnull(ktpo.[Yliopistot_tutkintotavoitteet_koodi], ktpo_virhe.[Yliopistot_tutkintotavoitteet_koodi])
	  ,[OKM_ohjauksen_ala_yo_tav] = isnull(ktpo.[Yliopistot_tutkintotavoitteet], ktpo_virhe.[Yliopistot_tutkintotavoitteet])
	  ,[OKM_ohjauksen_ala_yo_tav_SV] = isnull(ktpo.[Yliopistot_tutkintotavoitteet_SV], ktpo_virhe.[Yliopistot_tutkintotavoitteet_SV])
	  ,[OKM_ohjauksen_ala_yo_tav_EN] = isnull(ktpo.[Yliopistot_tutkintotavoitteet_EN], ktpo_virhe.[Yliopistot_tutkintotavoitteet_EN])
	  ,[OKM_ohjauksen_ala_amk_tav_koodi] = isnull(ktpo.[Ammattikorkeakoulut_tutkintotavoitteet_koodi], ktpo_virhe.[Ammattikorkeakoulut_tutkintotavoitteet_koodi])
	  ,[OKM_ohjauksen_ala_amk_tav] = isnull(ktpo.[Ammattikorkeakoulut_tutkintotavoitteet], ktpo_virhe.[Ammattikorkeakoulut_tutkintotavoitteet])
	  ,[OKM_ohjauksen_ala_amk_tav_SV] = isnull(ktpo.[Ammattikorkeakoulut_tutkintotavoitteet_SV], ktpo_virhe.[Ammattikorkeakoulut_tutkintotavoitteet_SV])
	  ,[OKM_ohjauksen_ala_amk_tav_EN] = isnull(ktpo.[Ammattikorkeakoulut_tutkintotavoitteet_EN], ktpo_virhe.[Ammattikorkeakoulut_tutkintotavoitteet_EN])

	  -- koulutusaste taso 2 tulee nyt Tilastokeskuksesta
	  ,[Koulutusaste_taso2_koodi] --= Cast(''-1'' as nvarchar(10))
	  ,[Koulutusaste_taso2] --= Cast(''Tulossa'' as nvarchar(255))
	  ,[Koulutusaste_taso2_SV] --= Cast(''På kommande'' as nvarchar(255))
	  ,[Koulutusaste_taso2_EN] --= Cast(''Coming'' as nvarchar(255))

      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[olo_koodi]
      ,[lakkautusvuosi]

      ,[muutosvuosi]
      ,[jarjestys]
      ,[jarjestys_taso]
      ,[jarjestys_koulutusala]
      ,[jarjestys_koulutusaste]
      ,[jarjestys_koulutusala2002]
      ,[jarjestys_opintoala2002]
      ,[jarjestys_koulutusaste2002]
      ,[jarjestys_koulutusala1995]
      ,[jarjestys_opintoala1995]
      ,[jarjestys_koulutusaste1995]
      ,[jarjestys_isclek]
      ,[jarjestys_iscle]
      ,[jarjestys_iscfik]
      ,[jarjestys_iscde]
      ,[jarjestys_iscor]
      ,[jarjestys_iscst]
      ,[jarjestys_iscdu]
	  ,[jarjestys_iscle2011]
	  ,[jarjestys_isccat2011]
	  ,[jarjestys_iscsubcat2011]
	  ,[jarjestys_iscfi2013]
	  ,[jarjestys_iscfinarrow2013]
	  ,[jarjestys_iscfibroad2013]

	  ,[jarjestys_OKM_ohjauksen_ala] = isnull(ktpo.[jarjestys_KTPO_ohjauksen_ala_2016], ktpo_virhe.[jarjestys_KTPO_ohjauksen_ala_2016])
	  ,[jarjestys_OKM_ohjauksen_ala_yo_tav] = isnull(ktpo.[jarjestys_Yliopistot_tutkintotavoitteet], ktpo_virhe.[jarjestys_Yliopistot_tutkintotavoitteet])
	  ,[jarjestys_OKM_ohjauksen_ala_amk_tav] = isnull(ktpo.[jarjestys_Ammattikorkeakoulut_tutkintotavoitteet], ktpo_virhe.[jarjestys_Ammattikorkeakoulut_tutkintotavoitteet])
	  ,[jarjestys_Koulutusaste_taso2] --= Cast(''998'' as nvarchar(10))

      ,d_koulutusluokitus.[virhetilanne]
      ,d_koulutusluokitus.[tietolahde]

  FROM [VipunenTK_DW].[dbo].[d_koulutusluokitus]

	LEFT JOIN [VipunenTK_lisatiedot].[dbo].[isced_suomi_ohjauksenala] ktpo
	ON ktpo.[iscfi2013_koodi] = d_koulutusluokitus.iscfi2013_koodi
	LEFT JOIN [VipunenTK_lisatiedot].[dbo].[isced_suomi_ohjauksenala] ktpo_virhe
	ON ktpo_virhe.[iscfi2013_koodi] = ''-2''

UNION ALL

SELECT DISTINCT [VipunenTK_lisatiedot].[dbo].[koulutusluokitus].[id]
      ,[VipunenTK_lisatiedot].[dbo].[koulutusluokitus].[luotu]
      ,[koulutusluokitus_avain]
      ,[koulutus_koodi]
      ,[korvaava_koulutus_koodi]
      ,[alkaa]
      ,[paattyy] = ISNULL([paattyy], Cast(''9999-01-01'' as date))
      ,[viimeisin_tilv] = ''''
      ,[koulutus]
      ,[koulutus_SV]
      ,[koulutus_EN]
      ,[koulutuslyhyt]
      ,[koulutuslyhyt_SV]
      ,[koulutuslyhyt_EN]
      ,[taso_koodi]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[koulutusaste_koodi]
      ,[koulutusaste]
      ,[koulutusaste_SV]
      ,[koulutusaste_EN]
      ,[koulutusala2002_koodi]
      ,[koulutusala2002]
      ,[koulutusala2002_SV]
      ,[koulutusala2002_EN]
      ,[opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[koulutusaste2002_koodi]
      ,[koulutusaste2002]
      ,[koulutusaste2002_SV]
      ,[koulutusaste2002_EN]
      ,[koulutusala1995_koodi]
      ,[koulutusala1995]
      ,[koulutusala1995_SV]
      ,[koulutusala1995_EN]
      ,[opintoala1995_koodi]
      ,[opintoala1995]
      ,[opintoala1995_SV]
      ,[opintoala1995_EN]
      ,[koulutusaste1995_koodi]
      ,[koulutusaste1995]
      ,[koulutusaste1995_SV]
      ,[koulutusaste1995_EN]
      ,[isclek_koodi]
      ,[isclek]
      ,[isclek_SV]
      ,[isclek_EN]
      ,[iscle_koodi]
      ,[iscle]
      ,[iscle_SV]
      ,[iscle_EN]
      ,[iscfik_koodi]
      ,[iscfik]
      ,[iscfik_SV]
      ,[iscfik_EN]
      ,[iscde_koodi]
      ,[iscde]
      ,[iscde_SV]
      ,[iscde_EN]
      ,[iscor_koodi]
      ,[iscor]
      ,[iscor_SV]
      ,[iscor_EN]
      ,[iscst_koodi]
      ,[iscst]
      ,[iscst_SV]
      ,[iscst_EN]
      ,[iscdu_koodi]
      ,[iscdu]
      ,[iscdu_SV]
      ,[iscdu_EN]
	  ,[iscle2011_koodi]
	  ,[iscle2011]
	  ,[iscle2011_SV]
	  ,[iscle2011_EN]
	  ,[isccat2011_koodi]
	  ,[isccat2011]
	  ,[isccat2011_SV]
	  ,[isccat2011_EN]
	  ,[iscsubcat2011_koodi]
	  ,[iscsubcat2011]
	  ,[iscsubcat2011_SV]
	  ,[iscsubcat2011_EN]
	  ,[VipunenTK_lisatiedot].[dbo].[koulutusluokitus].[iscfi2013_koodi]
	  ,[iscfi2013]
	  ,[iscfi2013_SV]
	  ,[iscfi2013_EN]
	  ,[iscfinarrow2013_koodi]
	  ,[iscfinarrow2013]
	  ,[iscfinarrow2013_SV]
	  ,[iscfinarrow2013_EN]
	  ,[iscfibroad2013_koodi]
	  ,[iscfibroad2013]
	  ,[iscfibroad2013_SV]
	  ,[iscfibroad2013_EN]

	  ,[OKM_ohjauksen_ala_koodi] = ktpo.[KTPO_ohjauksen_ala_2016_koodi]
	  ,[OKM_ohjauksen_ala] = ktpo.[KTPO_ohjauksen_ala_2016]
	  ,[OKM_ohjauksen_ala_SV] = ktpo.[KTPO_ohjauksen_ala_2016_SV]
	  ,[OKM_ohjauksen_ala_EN] = ktpo.[KTPO_ohjauksen_ala_2016_EN]
	  ,[OKM_ohjauksen_ala_yo_tav_koodi] = ktpo.[Yliopistot_tutkintotavoitteet_koodi]
	  ,[OKM_ohjauksen_ala_yo_tav] = ktpo.[Yliopistot_tutkintotavoitteet]
	  ,[OKM_ohjauksen_ala_yo_tav_SV] = ktpo.[Yliopistot_tutkintotavoitteet_SV]
	  ,[OKM_ohjauksen_ala_yo_tav_EN] = ktpo.[Yliopistot_tutkintotavoitteet_EN]
	  ,[OKM_ohjauksen_ala_amk_tav_koodi] = ktpo.[Ammattikorkeakoulut_tutkintotavoitteet_koodi]
	  ,[OKM_ohjauksen_ala_amk_tav] = ktpo.[Ammattikorkeakoulut_tutkintotavoitteet]
	  ,[OKM_ohjauksen_ala_amk_tav_SV] = ktpo.[Ammattikorkeakoulut_tutkintotavoitteet_SV]
	  ,[OKM_ohjauksen_ala_amk_tav_EN] = ktpo.[Ammattikorkeakoulut_tutkintotavoitteet_EN]

	  ,[Koulutusaste_taso2_koodi] --= Cast(''-1'' as nvarchar(10))
	  ,[Koulutusaste_taso2] --= Cast(''Tulossa'' as nvarchar(255))
	  ,[Koulutusaste_taso2_SV] --= Cast(''På kommande'' as nvarchar(255))
	  ,[Koulutusaste_taso2_EN] --= Cast(''Coming'' as nvarchar(255))

      ,[SCD_alkaa]
      ,[SCD_paattyy]
      ,[olo_koodi]
      ,[lakkautusvuosi]
      ,[muutosvuosi]
      ,[jarjestys]
      ,[jarjestys_taso]
      ,[jarjestys_koulutusala]
      ,[jarjestys_koulutusaste]
      ,[jarjestys_koulutusala2002]
      ,[jarjestys_opintoala2002]
      ,[jarjestys_koulutusaste2002]
      ,[jarjestys_koulutusala1995]
      ,[jarjestys_opintoala1995]
      ,[jarjestys_koulutusaste1995]
      ,[jarjestys_isclek]
      ,[jarjestys_iscle]
      ,[jarjestys_iscfik]
      ,[jarjestys_iscde]
      ,[jarjestys_iscor]
      ,[jarjestys_iscst]
      ,[jarjestys_iscdu]
	  ,[jarjestys_iscle2011]
	  ,[jarjestys_isccat2011]
	  ,[jarjestys_iscsubcat2011]
	  ,[jarjestys_iscfi2013]
	  ,[jarjestys_iscfinarrow2013]
	  ,[jarjestys_iscfibroad2013]

	  ,[jarjestys_OKM_ohjauksen_ala] = ktpo.[jarjestys_KTPO_ohjauksen_ala_2016]
	  ,[jarjestys_OKM_ohjauksen_ala_yo_tav] = ktpo.[jarjestys_Yliopistot_tutkintotavoitteet]
	  ,[jarjestys_OKM_ohjauksen_ala_amk_tav] = ktpo.[jarjestys_Ammattikorkeakoulut_tutkintotavoitteet]
	  ,[jarjestys_Koulutusaste_taso2] = Cast(''998'' as nvarchar(10))

      ,[VipunenTK_lisatiedot].[dbo].[koulutusluokitus].[virhetilanne]
      ,[VipunenTK_lisatiedot].[dbo].[koulutusluokitus].[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutusluokitus]
	LEFT JOIN [VipunenTK_lisatiedot].[dbo].[isced_suomi_ohjauksenala] ktpo
	ON ktpo.[iscfi2013_koodi] = ''-1''
  WHERE [VipunenTK_lisatiedot].[dbo].[koulutusluokitus].virhetilanne = ''K''







' 
GO
/****** Object:  View [dbo].[v_koulutusmuoto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusmuoto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutusmuoto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutusmuoto_koodi,
	koulutusmuoto,
	koulutusmuoto_SV,
	koulutusmuoto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutusmuoto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutusmuoto_koodi,
	koulutusmuoto,
	koulutusmuoto_SV,
	koulutusmuoto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutusmuoto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutusohjelma_amk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusohjelma_amk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutusohjelma_amk] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutusohjelma_amk_koodi,
	koulutusohjelma_amk,
	koulutusohjelma_amk_SV,
	koulutusohjelma_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutusohjelma_amk
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutusohjelma_amk_koodi,
	koulutusohjelma_amk,
	koulutusohjelma_amk_SV,
	koulutusohjelma_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutusohjelma_amk
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutusohjelma_ammpk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusohjelma_ammpk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutusohjelma_ammpk] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutusohjelma_ammpk_koodi,
	koulutusohjelma_ammpk,
	koulutusohjelma_ammpk_SV,
	koulutusohjelma_ammpk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutusohjelma_ammpk
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutusohjelma_ammpk_koodi,
	koulutusohjelma_ammpk,
	koulutusohjelma_ammpk_SV,
	koulutusohjelma_ammpk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutusohjelma_ammpk
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutusryhma]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutusryhma]'))
EXEC dbo.sp_executesql @statement = N'

/****** Script for SelectTopNRows command from SSMS  ******/


CREATE view [dbo].[v_koulutusryhma] as

SELECT [id]
      ,[koulutusryhma_koodi]
      ,[koulutusryhma]
      ,[koulutusryhma_SV]
      ,[koulutusryhma_EN]
      ,[koulutusryhma2]
      ,[koulutusryhma2_SV]
      ,[koulutusryhma2_EN]
      ,[jarjestys]
  FROM [VipunenTK_dw].[dbo].[d_koulutusryhma]

  union all

SELECT [id]
      ,[koulutusryhma_koodi]
      ,[koulutusryhma]
      ,[koulutusryhma_SV]
      ,[koulutusryhma_EN]
      ,[koulutusryhma2]
      ,[koulutusryhma2_SV]
      ,[koulutusryhma2_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[koulutusryhma]
  where virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_koulutussektori]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutussektori]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutussektori] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[koulutussektori_koodi]
,[koulutussektori]
,[koulutussektori_SV]
,[koulutussektori_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_koulutussektori]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[koulutussektori_koodi]
,[koulutussektori]
,[koulutussektori_SV]
,[koulutussektori_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_koulutussektori]
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_koulutustyyppi]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_koulutustyyppi]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_koulutustyyppi] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutustyyppi_koodi,
	koulutustyyppi,
	koulutustyyppi_SV,
	koulutustyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_koulutustyyppi
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	koulutustyyppi_koodi,
	koulutustyyppi,
	koulutustyyppi_SV,
	koulutustyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_koulutustyyppi
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_kylla_ei]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_kylla_ei]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_kylla_ei] AS

SELECT  [id]
      ,[kylla_ei_koodi]
      ,[kylla_ei]
      ,[kylla_ei_SV]
      ,[kylla_ei_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_kylla_ei]

UNION ALL

SELECT  [id]
      ,[kylla_ei_koodi]
      ,[kylla_ei]
      ,[kylla_ei_SV]
      ,[kylla_ei_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_kylla_ei]
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_lahde]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_lahde]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_lahde] AS
/*
Drop table VipunenTK.dbo.d_lahde
Select * into VipunenTK.dbo.d_lahde from VipunenTK_DW.dbo.v_lahde
Truncate table  VipunenTK.dbo.d_lahde
Insert into VipunenTK.dbo.d_lahde
Select * from VipunenTK_DW.dbo.v_lahde
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[lahde_koodi]
      ,[lahde]
      ,[lahde_SV]
      ,[lahde_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_lahde]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[lahde_koodi]
      ,[lahde]
      ,[lahde_SV]
      ,[lahde_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_lahde]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_lukiokoulutuksen_koulutuslaji]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_lukiokoulutuksen_koulutuslaji]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_lukiokoulutuksen_koulutuslaji] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	lukiokoulutuksen_koulutuslaji_koodi,
	lukiokoulutuksen_koulutuslaji,
	lukiokoulutuksen_koulutuslaji_SV,
	lukiokoulutuksen_koulutuslaji_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_lukiokoulutuksen_koulutuslaji
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	lukiokoulutuksen_koulutuslaji_koodi,
	lukiokoulutuksen_koulutuslaji,
	lukiokoulutuksen_koulutuslaji_SV,
	lukiokoulutuksen_koulutuslaji_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_lukiokoulutuksen_koulutuslaji
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_lukion_ainevalinnat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_lukion_ainevalinnat]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_lukion_ainevalinnat] AS 
/*
truncate table VipunenTK.dbo.d_lukion_ainevalinnat
insert into VipunenTK.dbo.d_lukion_ainevalinnat
select * from [VipunenTK_DW].dbo.[v_lukion_ainevalinnat]

drop table VipunenTK.dbo.d_lukion_ainevalinnat
select * into VipunenTK.dbo.d_lukion_ainevalinnat from [VipunenTK_DW].dbo.[v_lukion_ainevalinnat]
*/

SELECT [id]
      ,[luotu]
      ,[avain_aine]
      ,[avain_laajuus]
      ,[aineryhmä_jarjestys]
      ,[aineryhmä]
      ,[aineryhmä_SV]
      ,[aineryhmä_EN]
      ,[aine_jarjestys]
      ,[aine]
      ,[aine_SV]
      ,[aine_EN]
      ,[laajuus_jarjestys]
      ,[laajuus]
      ,[laajuus_SV]
      ,[laajuus_EN]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_lukion_ainevalinnat]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[avain_aine]
      ,[avain_laajuus]
      ,[aineryhmä_jarjestys]
      ,[aineryhmä]
      ,[aineryhmä_SV]
      ,[aineryhmä_EN]
      ,[aine_jarjestys]
      ,[aine]
      ,[aine_SV]
      ,[aine_EN]
      ,[laajuus_jarjestys]
      ,[laajuus]
      ,[laajuus_SV]
      ,[laajuus_EN]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_lukion_ainevalinnat]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_lukion_kieltenmaara]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_lukion_kieltenmaara]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_lukion_kieltenmaara] AS 
/*
truncate table VipunenTK.dbo.d_lukion_kieltenmaara
insert into VipunenTK.dbo.d_lukion_kieltenmaara
select * from VipunenTK_DW.dbo.v_lukion_kieltenmaara

drop table VipunenTK.dbo.d_lukion_kieltenmaara
select * into VipunenTK.dbo.d_lukion_kieltenmaara from VipunenTK_DW.dbo.v_lukion_kieltenmaara
*/


SELECT [id]
      ,[luotu]
      ,[kieltenmaara_koodi]
      ,[kieltenmaara]
      ,[kieltenmaara_SV]
      ,[kieltenmaara_EN]
      ,[kieltenmaara_jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_lukion_kieltenmaara]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[kieltenmaara_koodi]
      ,[kieltenmaara]
      ,[kieltenmaara_SV]
      ,[kieltenmaara_EN]
      ,[kieltenmaara_jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_lukion_kieltenmaara]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_maahantulo_ja_opiskelun_aloittaminen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_maahantulo_ja_opiskelun_aloittaminen]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

create view [dbo].[v_maahantulo_ja_opiskelun_aloittaminen] as

SELECT [id]
      ,[maahantulo_ja_opiskelun_aloittaminen_koodi]
      ,[maahantulo_ja_opiskelun_aloittaminen]
      ,[maahantulo_ja_opiskelun_aloittaminen_SV]
      ,[maahantulo_ja_opiskelun_aloittaminen_EN]
      ,[jarjestys]

  FROM [VipunenTK_lisatiedot].[dbo].[maahantulo_ja_opiskelun_aloittaminen]
where virhetilanne = ''K'' 

UNION ALL

SELECT [id]
      ,[maahantulo_ja_opiskelun_aloittaminen_koodi]
      ,[maahantulo_ja_opiskelun_aloittaminen]
      ,[maahantulo_ja_opiskelun_aloittaminen_SV]
      ,[maahantulo_ja_opiskelun_aloittaminen_EN]
      ,[jarjestys]

  FROM [VipunenTK_DW].[dbo].[d_maahantulo_ja_opiskelun_aloittaminen]

' 
GO
/****** Object:  View [dbo].[v_maassaolo]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_maassaolo]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_maassaolo] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	maassaolo_koodi,
	maassaolo,
	maassaolo_SV,
	maassaolo_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_maassaolo
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	maassaolo_koodi,
	maassaolo,
	maassaolo_SV,
	maassaolo_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_maassaolo
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_mitenna_ammatti]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_mitenna_ammatti]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_mitenna_ammatti] AS 
/*
Select * into VipunenTK.dbo.d_mitenna_ammatti from VipunenTK_DW.[dbo].[v_mitenna_ammatti]
Truncate table VipunenTK.dbo.d_mitenna_ammatti
Insert into VipunenTK.dbo.d_mitenna_ammatti
  Select * from VipunenTK_DW.[dbo].[v_mitenna_ammatti]
*/
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[mitenna_ammattiryhma1_koodi]
      ,[mitenna_ammattiryhma1]
      ,[mitenna_ammattiryhma1_SV]
      ,[mitenna_ammattiryhma1_EN]
      ,[mitenna_ammattiryhma2_koodi]
      ,[mitenna_ammattiryhma2]
      ,[mitenna_ammattiryhma2_SV]
      ,[mitenna_ammattiryhma2_EN]
      ,[mitenna_ammatti_koodi]
      ,[mitenna_ammatti]
      ,[mitenna_ammatti_SV]
      ,[mitenna_ammatti_EN]
      ,[jarjestys_ammattiryhma1]
      ,[jarjestys_ammattiryhma2]
      ,[jarjestys_ammatti]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_mitenna_ammatti]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[mitenna_ammattiryhma1_koodi]
      ,[mitenna_ammattiryhma1]
      ,[mitenna_ammattiryhma1_SV]
      ,[mitenna_ammattiryhma1_EN]
      ,[mitenna_ammattiryhma2_koodi]
      ,[mitenna_ammattiryhma2]
      ,[mitenna_ammattiryhma2_SV]
      ,[mitenna_ammattiryhma2_EN]
      ,[mitenna_ammatti_koodi]
      ,[mitenna_ammatti]
      ,[mitenna_ammatti_SV]
      ,[mitenna_ammatti_EN]
      ,[jarjestys_ammattiryhma1]
      ,[jarjestys_ammattiryhma2]
      ,[jarjestys_ammatti]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[mitenna_ammatti] 
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_mitenna_toimiala]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_mitenna_toimiala]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_mitenna_toimiala] AS 
/*
Select * into VipunenTK.dbo.d_mitenna_toimiala from VipunenTK_DW.[dbo].[v_mitenna_toimiala]
Truncate table VipunenTK.dbo.d_mitenna_toimiala
Insert into VipunenTK.dbo.d_mitenna_toimiala
  Select * from VipunenTK_DW.[dbo].[v_mitenna_toimiala]
*/
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[mitenna_toimiala1_koodi]
      ,[mitenna_toimiala1]
      ,[mitenna_toimiala1_SV]
      ,[mitenna_toimiala1_EN]
      ,[mitenna_toimiala2_koodi]
      ,[mitenna_toimiala2]
      ,[mitenna_toimiala2_SV]
      ,[mitenna_toimiala2_EN]
      ,[tol_koodi]
      ,[tol]
      ,[tol_SV]
      ,[tol_EN]
      ,[jarjestys_mitenna_toimiala1]
      ,[jarjestys_mitenna_toimiala2]
      ,[jarjestys_tol]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_mitenna_toimiala]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[mitenna_toimiala1_koodi]
      ,[mitenna_toimiala1]
      ,[mitenna_toimiala1_SV]
      ,[mitenna_toimiala1_EN]
      ,[mitenna_toimiala2_koodi]
      ,[mitenna_toimiala2]
      ,[mitenna_toimiala2_SV]
      ,[mitenna_toimiala2_EN]
      ,[tol_koodi]
      ,[tol]
      ,[tol_SV]
      ,[tol_EN]
      ,[jarjestys_mitenna_toimiala1]
      ,[jarjestys_mitenna_toimiala2]
      ,[jarjestys_tol]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[mitenna_toimiala]
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_moninkertainen_haku]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_moninkertainen_haku]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_moninkertainen_haku] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[moninkertainen_haku_koodi]
      ,[moninkertainen_haku]
      ,[moninkertainen_haku_SV]
      ,[moninkertainen_haku_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_moninkertainen_haku]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[moninkertainen_haku_koodi]
      ,[moninkertainen_haku]
      ,[moninkertainen_haku_SV]
      ,[moninkertainen_haku_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[moninkertainen_haku]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_nuorten_aikuisten_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_nuorten_aikuisten_koulutus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_nuorten_aikuisten_koulutus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	nuorten_aikuisten_koulutus_koodi,
	nuorten_aikuisten_koulutus,
	nuorten_aikuisten_koulutus_SV,
	nuorten_aikuisten_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_nuorten_aikuisten_koulutus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	nuorten_aikuisten_koulutus_koodi,
	nuorten_aikuisten_koulutus,
	nuorten_aikuisten_koulutus_SV,
	nuorten_aikuisten_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_nuorten_aikuisten_koulutus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_nuorten_aikuisten_koulutus_amm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_nuorten_aikuisten_koulutus_amm]'))
EXEC dbo.sp_executesql @statement = N'
create VIEW [dbo].[v_nuorten_aikuisten_koulutus_amm] AS
SELECT
	id,
	luotu,
	nuorten_aikuisten_koulutus_amm_koodi,
	nuorten_aikuisten_koulutus_amm,
	nuorten_aikuisten_koulutus_amm_SV,
	nuorten_aikuisten_koulutus_amm_EN,
	jarjestys
FROM dbo.d_nuorten_aikuisten_koulutus_amm
UNION ALL
SELECT
	id,
	luotu,
	nuorten_aikuisten_koulutus_amm_koodi,
	nuorten_aikuisten_koulutus_amm,
	nuorten_aikuisten_koulutus_amm_SV,
	nuorten_aikuisten_koulutus_amm_EN,
	jarjestys

FROM VipunenTK_lisatiedot..v_nuorten_aikuisten_koulutus_amm
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opettajan_tehtavatyyppi_ammatillisessa_koulutuksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajan_tehtavatyyppi_ammatillisessa_koulutuksessa]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_opettajan_tehtavatyyppi_ammatillisessa_koulutuksessa] AS
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajan_tehtavatyyppi_ammatillisessa_koulutuksessa
UNION ALL
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajan_tehtavatyyppi_ammatillisessa_koulutuksessa
WHERE virhetilanne=''K''




' 
GO
/****** Object:  View [dbo].[v_opettajan_tehtavatyyppi_lukiokoulutuksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajan_tehtavatyyppi_lukiokoulutuksessa]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_opettajan_tehtavatyyppi_lukiokoulutuksessa] AS
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajan_tehtavatyyppi_lukiokoulutuksessa
UNION ALL
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajan_tehtavatyyppi_lukiokoulutuksessa
WHERE virhetilanne=''K''



' 
GO
/****** Object:  View [dbo].[v_opettajan_tehtavatyyppi_perusopetuksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajan_tehtavatyyppi_perusopetuksessa]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opettajan_tehtavatyyppi_perusopetuksessa] AS
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajan_tehtavatyyppi_perusopetuksessa
UNION ALL
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajan_tehtavatyyppi_perusopetuksessa
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_opettajan_tehtavatyyppi_vapaassa_sivistystyossa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajan_tehtavatyyppi_vapaassa_sivistystyossa]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_opettajan_tehtavatyyppi_vapaassa_sivistystyossa] AS
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajan_tehtavatyyppi_vapaassa_sivistystyossa
UNION ALL
SELECT
	id,
	luotu,
	tehtavatyyppi_koodi,
	tehtavatyyppi,
	tehtavatyyppi_SV,
	tehtavatyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajan_tehtavatyyppi_vapaassa_sivistystyossa
WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_opettajankelpoisuus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajankelpoisuus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opettajankelpoisuus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opettajankelpoisuus_koodi,
	opettajankelpoisuus,
	opettajankelpoisuus_SV,
	opettajankelpoisuus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajankelpoisuus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opettajankelpoisuus_koodi,
	opettajankelpoisuus,
	opettajankelpoisuus_SV,
	opettajankelpoisuus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajankelpoisuus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_opettajankelpoisuus2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajankelpoisuus2]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opettajankelpoisuus2] AS
SELECT
	id,
	luotu,
	opettajankelpoisuus_koodi,
	opettajankelpoisuus,
	opettajankelpoisuus_SV,
	opettajankelpoisuus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajankelpoisuus2
UNION ALL
SELECT
	id,
	luotu,
	opettajankelpoisuus_koodi,
	opettajankelpoisuus,
	opettajankelpoisuus_SV,
	opettajankelpoisuus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajankelpoisuus2
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opettajat_aine]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_aine]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_opettajat_aine] AS
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_aine
UNION ALL
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_aine
WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_opettajat_aine_2016]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_aine_2016]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_opettajat_aine_2016] AS
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_aine_2016
UNION ALL
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_aine_2016
WHERE virhetilanne=''K''






' 
GO
/****** Object:  View [dbo].[v_opettajat_aine_2016_lukio]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_aine_2016_lukio]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_opettajat_aine_2016_lukio] AS
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_aine_2016_lukio
UNION ALL
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_aine_2016_lukio
WHERE virhetilanne=''K''






' 
GO
/****** Object:  View [dbo].[v_opettajat_aine_amm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_aine_amm]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_opettajat_aine_amm] AS
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_aine_amm
UNION ALL
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_aine_amm
WHERE virhetilanne=''K''






' 
GO
/****** Object:  View [dbo].[v_opettajat_aine_vst]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_aine_vst]'))
EXEC dbo.sp_executesql @statement = N'






CREATE VIEW [dbo].[v_opettajat_aine_vst] AS
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_aine_vst
UNION ALL
SELECT
	id,
	luotu,
	aine_koodi,
	aine,
	aine_SV,
	aine_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_aine_vst
WHERE virhetilanne=''K''







' 
GO
/****** Object:  View [dbo].[v_opettajat_koko_osa_aikainen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_koko_osa_aikainen]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_opettajat_koko_osa_aikainen] AS
SELECT
	id,
	luotu,
	koko_osa_aikainen_koodi,
	koko_osa_aikainen,
	koko_osa_aikainen_SV,
	koko_osa_aikainen_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_koko_osa_aikainen
UNION ALL
SELECT
	id,
	luotu,
	koko_osa_aikainen_koodi,
	koko_osa_aikainen,
	koko_osa_aikainen_SV,
	koko_osa_aikainen_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_koko_osa_aikainen
WHERE virhetilanne=''K''






' 
GO
/****** Object:  View [dbo].[v_opettajat_koulutusaste]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_koulutusaste]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_opettajat_koulutusaste] AS
SELECT
	id,
	luotu,
	koulutusaste_koodi,
	koulutusaste,
	koulutusaste_SV,
	koulutusaste_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_koulutusaste
UNION ALL
SELECT
	id,
	luotu,
	koulutusaste_koodi,
	koulutusaste,
	koulutusaste_SV,
	koulutusaste_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_koulutusaste
WHERE virhetilanne=''K''



' 
GO
/****** Object:  View [dbo].[v_opettajat_koulutusaste_amm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_koulutusaste_amm]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_opettajat_koulutusaste_amm] AS
SELECT
	id,
	luotu,
	koulutusaste_koodi,
	koulutusaste,
	koulutusaste_SV,
	koulutusaste_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_koulutusaste_amm
UNION ALL
SELECT
	id,
	luotu,
	koulutusaste_koodi,
	koulutusaste,
	koulutusaste_SV,
	koulutusaste_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_koulutusaste_amm
WHERE virhetilanne=''K''




' 
GO
/****** Object:  View [dbo].[v_opettajat_luokka_aste]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_luokka_aste]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_opettajat_luokka_aste] AS
SELECT
	id,
	luotu,
	luokka_aste_koodi,
	luokka_aste,
	luokka_aste_SV,
	luokka_aste_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_luokka_aste
UNION ALL
SELECT
	id,
	luotu,
	luokka_aste_koodi,
	luokka_aste,
	luokka_aste_SV,
	luokka_aste_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_luokka_aste
WHERE virhetilanne=''K''




' 
GO
/****** Object:  View [dbo].[v_opettajat_osa_aikaisuuden_syy]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_osa_aikaisuuden_syy]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_opettajat_osa_aikaisuuden_syy] AS
SELECT
	id,
	luotu,
	syy_koodi,
	syy,
	syy_SV,
	syy_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_osa_aikaisuuden_syy
UNION ALL
SELECT
	id,
	luotu,
	syy_koodi,
	syy,
	syy_SV,
	syy_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_osa_aikaisuuden_syy
WHERE virhetilanne=''K''






' 
GO
/****** Object:  View [dbo].[v_opettajat_tyosuhteen_luonne]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opettajat_tyosuhteen_luonne]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_opettajat_tyosuhteen_luonne] AS
SELECT
	id,
	luotu,
	tyosuhteen_luonne_koodi,
	tyosuhteen_luonne,
	tyosuhteen_luonne_SV,
	tyosuhteen_luonne_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opettajat_tyosuhteen_luonne
UNION ALL
SELECT
	id,
	luotu,
	tyosuhteen_luonne_koodi,
	tyosuhteen_luonne,
	tyosuhteen_luonne_SV,
	tyosuhteen_luonne_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opettajat_tyosuhteen_luonne
WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_opetuksen_jarjestajan_tiedoantajatyyppi]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetuksen_jarjestajan_tiedoantajatyyppi]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opetuksen_jarjestajan_tiedoantajatyyppi]
AS
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tiedonantajatyyppi_koodi]
      ,[tiedonantajatyyppi]
      ,[tiedonantajatyyppi_SV]
      ,[tiedonantajatyyppi_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_opetuksen_jarjestajan_tiedoantajatyyppi]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tiedonantajatyyppi_koodi]
      ,[tiedonantajatyyppi]
      ,[tiedonantajatyyppi_SV]
      ,[tiedonantajatyyppi_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[opetuksen_jarjestajan_tiedoantajatyyppi]
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_opetushallinnon_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetushallinnon_koulutus]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opetushallinnon_koulutus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opetushallinnon_koulutus_koodi,
	opetushallinnon_koulutus,
	opetushallinnon_koulutus_SV,
	opetushallinnon_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opetushallinnon_koulutus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opetushallinnon_koulutus_koodi,
	opetushallinnon_koulutus,
	opetushallinnon_koulutus_SV,
	opetushallinnon_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opetushallinnon_koulutus
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opetushallinnon_koulutusala]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetushallinnon_koulutusala]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opetushallinnon_koulutusala] AS

SELECT [id]
      --,[luotu]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolähde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_opetushallinnon_koulutusala]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[koulutusala_koodi]
      ,[koulutusala]
      ,[koulutusala_SV]
      ,[koulutusala_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolähde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_opetushallinnon_koulutusala]
  WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opetuskieli]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetuskieli]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_opetuskieli] AS

SELECT [id]
      ,[opetuskieli_koodi]
      ,[opetuskieli]
      ,[opetuskieli_SV]
      ,[opetuskieli_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_opetuskieli]
  
UNION ALL  
  
SELECT [id]
      ,[opetuskieli_koodi]
      ,[opetuskieli]
      ,[opetuskieli_SV]
      ,[opetuskieli_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_opetuskieli]  
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_opetuskieli2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetuskieli2]'))
EXEC dbo.sp_executesql @statement = N'
/*
truncate table VipunenTK.dbo.d_opetuskieli2
insert into VipunenTK.dbo.d_opetuskieli2
select * from VipunenTK_DW.dbo.v_opetuskieli2
*/


CREATE VIEW [dbo].[v_opetuskieli2] AS
SELECT
	id,
	luotu,
	opetuskieli_koodi,
	opetuskieli,
	opetuskieli_SV,
	opetuskieli_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opetuskieli2
UNION ALL
SELECT
	id,
	luotu,
	opetuskieli_koodi,
	opetuskieli,
	opetuskieli_SV,
	opetuskieli_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opetuskieli2
WHERE virhetilanne=''K''




' 
GO
/****** Object:  View [dbo].[v_opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_SV,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_koodi,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_SV,
	opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opetussuunnitelmaperusteinen_koulutus_nayttotutkintoon_valmistava_koulutus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_opetustuntien_sisalto_ja_tavoiteluokitus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opetustuntien_sisalto_ja_tavoiteluokitus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opetustuntien_sisalto_ja_tavoiteluokitus] AS 
/*
Select * into VipunenTK.dbo.d_opetustuntien_sisalto_ja_tavoiteluokitus from VipunenTK_DW.[dbo].[v_opetustuntien_sisalto_ja_tavoiteluokitus]
Truncate table VipunenTK.dbo.d_opetustuntien_sisalto_ja_tavoiteluokitus
Insert into VipunenTK.dbo.d_opetustuntien_sisalto_ja_tavoiteluokitus
  Select * from VipunenTK_DW.[dbo].[v_opetustuntien_sisalto_ja_tavoiteluokitus]
*/
SELECT [id]
      ,[Opetustuntikoodi]
      ,[Koulutusala_lajittelu]
      ,[Koulutusala]
      ,[Koulutusala_SV]
      ,[Koulutusala_EN]
      ,[Opintoala_lajittelu]
      ,[Opintoala]
      ,[Opintoala_SV]
      ,[Opintoala_EN]
      ,[Koulutustyyppi_lajittelu]
      ,[Koulutustyyppi]
      ,[Koulutustyyppi_SV]
      ,[Koulutustyyppi_EN]
      ,[Opetustunti_lajittelu]
      ,[Opetustunti]
      ,[Opetustunti_SV]
      ,[Opetustunti_EN]
  FROM [VipunenTK_DW].[dbo].[d_opetustuntien_sisalto_ja_tavoiteluokitus]
UNION ALL
SELECT [id]
      ,[Opetustuntikoodi]
      ,[Koulutusala_lajittelu]
      ,[Koulutusala]
      ,[Koulutusala_SV]
      ,[Koulutusala_EN]
      ,[Opintoala_lajittelu]
      ,[Opintoala]
      ,[Opintoala_SV]
      ,[Opintoala_EN]
      ,[Koulutustyyppi_lajittelu]
      ,[Koulutustyyppi]
      ,[Koulutustyyppi_SV]
      ,[Koulutustyyppi_EN]
      ,[Opetustunti_lajittelu]
      ,[Opetustunti]
      ,[Opetustunti_SV]
      ,[Opetustunti_EN]
  FROM [VipunenTK_lisatiedot].[dbo].[v_opetustuntien_sisalto_ja_tavoiteluokitus] 
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_opintoala2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintoala2002]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opintoala2002] AS
SELECT distinct [opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_opintoala2002]
  
  UNION ALL

SELECT [opintoala2002_koodi]
      ,[opintoala2002]
      ,[opintoala2002_SV]
      ,[opintoala2002_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_opintoala2002]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_koulutuksen_jarjestajan_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_koulutuksen_jarjestajan_mukaan]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opintojen_kulku_koulutuksen_jarjestajan_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_koodi]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_SV]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_EN]
      ,[jarjestys_4a]
      ,[jarjestys_4b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_koulutuksen_jarjestajan_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_koodi]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_SV]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_EN]
      ,[jarjestys_4a]
      ,[jarjestys_4b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_koulutuksen_jarjestajan_mukaan
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2_koodi]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2_SV]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2_EN]
      ,[jarjestys_4bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2_koodi]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2_SV]
      ,[opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2_EN]
      ,[jarjestys_4bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_koulutuksen_jarjestajan_mukaan_versio2
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_koulutusalan_2002_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_koulutusalan_2002_mukaan]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opintojen_kulku_koulutusalan_2002_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_koodi]
      ,[opintojen_kulku_koulutusalan_2002_mukaan]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_SV]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_EN]
      ,[jarjestys_2a]
      ,[jarjestys_2b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_koulutusalan_2002_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_koodi]
      ,[opintojen_kulku_koulutusalan_2002_mukaan]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_SV]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_EN]
      ,[jarjestys_2a]
      ,[jarjestys_2b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_koulutusalan_2002_mukaan
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_koulutusalan_2002_mukaan_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_koulutusalan_2002_mukaan_versio2]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opintojen_kulku_koulutusalan_2002_mukaan_versio2] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2_koodi]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2_SV]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2_EN]
      ,[jarjestys_2bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_koulutusalan_2002_mukaan_versio2
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2_koodi]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2_SV]
      ,[opintojen_kulku_koulutusalan_2002_mukaan_versio2_EN]
      ,[jarjestys_2bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_koulutusalan_2002_mukaan_versio2
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_koulutusasteen_2002_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_koulutusasteen_2002_mukaan]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opintojen_kulku_koulutusasteen_2002_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan_koodi]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan_SV]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan_EN]
      ,[jarjestys_1a]
      ,[jarjestys_1b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_koulutusasteen_2002_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan_koodi]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan_SV]
      ,[opintojen_kulku_koulutusasteen_2002_mukaan_EN]
      ,[jarjestys_1a]
      ,[jarjestys_1b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_koulutusasteen_2002_mukaan
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_koulutussektorin_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_koulutussektorin_mukaan]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_opintojen_kulku_koulutussektorin_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutussektorin_mukaan_koodi]
      ,[opintojen_kulku_koulutussektorin_mukaan]
      ,[opintojen_kulku_koulutussektorin_mukaan_SV]
      ,[opintojen_kulku_koulutussektorin_mukaan_EN]
      ,[jarjestys_7a]
      ,[jarjestys_7b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_koulutussektorin_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_koulutussektorin_mukaan_koodi]
      ,[opintojen_kulku_koulutussektorin_mukaan]
      ,[opintojen_kulku_koulutussektorin_mukaan_SV]
      ,[opintojen_kulku_koulutussektorin_mukaan_EN]
      ,[jarjestys_7a]
      ,[jarjestys_7b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_koulutussektorin_mukaan
WHERE virhetilanne=''K''




' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_maakunnan_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_maakunnan_mukaan]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opintojen_kulku_maakunnan_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_maakunnan_mukaan_koodi]
      ,[opintojen_kulku_maakunnan_mukaan]
      ,[opintojen_kulku_maakunnan_mukaan_SV]
      ,[opintojen_kulku_maakunnan_mukaan_EN]
      ,[jarjestys_6a]
      ,[jarjestys_6b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_maakunnan_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_maakunnan_mukaan_koodi]
      ,[opintojen_kulku_maakunnan_mukaan]
      ,[opintojen_kulku_maakunnan_mukaan_SV]
      ,[opintojen_kulku_maakunnan_mukaan_EN]
      ,[jarjestys_6a]
      ,[jarjestys_6b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_maakunnan_mukaan
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_opintoalan_2002_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_opintoalan_2002_mukaan]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opintojen_kulku_opintoalan_2002_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_opintoala_2002_mukaan_koodi]
      ,[opintojen_kulku_opintoala_2002_mukaan]
      ,[opintojen_kulku_opintoala_2002_mukaan_SV]
      ,[opintojen_kulku_opintoala_2002_mukaan_EN]
      ,[jarjestys_3a]
      ,[jarjestys_3b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_opintoalan_2002_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_opintoala_2002_mukaan_koodi]
      ,[opintojen_kulku_opintoala_2002_mukaan]
      ,[opintojen_kulku_opintoala_2002_mukaan_SV]
      ,[opintojen_kulku_opintoala_2002_mukaan_EN]
      ,[jarjestys_3a]
      ,[jarjestys_3b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_opintoalan_2002_mukaan
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_opintoalan_2002_mukaan_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_opintoalan_2002_mukaan_versio2]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_opintojen_kulku_opintoalan_2002_mukaan_versio2] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2_koodi]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2_SV]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2_EN]
      ,[jarjestys_3bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_opintoalan_2002_mukaan_versio2
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2_koodi]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2_SV]
      ,[opintojen_kulku_opintoala_2002_mukaan_versio2_EN]
      ,[jarjestys_3bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_opintoalan_2002_mukaan_versio2
WHERE virhetilanne=''K''



' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_oppilaitoksen_mukaan]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_oppilaitoksen_mukaan]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opintojen_kulku_oppilaitoksen_mukaan] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_oppilaitoksen_mukaan_koodi]
      ,[opintojen_kulku_oppilaitoksen_mukaan]
      ,[opintojen_kulku_oppilaitoksen_mukaan_SV]
      ,[opintojen_kulku_oppilaitoksen_mukaan_EN]
      ,[jarjestys_5a]
      ,[jarjestys_5b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_oppilaitoksen_mukaan
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_oppilaitoksen_mukaan_koodi]
      ,[opintojen_kulku_oppilaitoksen_mukaan]
      ,[opintojen_kulku_oppilaitoksen_mukaan_SV]
      ,[opintojen_kulku_oppilaitoksen_mukaan_EN]
      ,[jarjestys_5a]
      ,[jarjestys_5b]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_oppilaitoksen_mukaan
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_opintojen_kulku_oppilaitoksen_mukaan_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opintojen_kulku_oppilaitoksen_mukaan_versio2]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opintojen_kulku_oppilaitoksen_mukaan_versio2] AS
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2_koodi]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2_SV]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2_EN]
      ,[jarjestys_5bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM dbo.d_opintojen_kulku_oppilaitoksen_mukaan_versio2
UNION ALL
SELECT
	[id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2_koodi]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2_SV]
      ,[opintojen_kulku_oppilaitoksen_mukaan_versio2_EN]
      ,[jarjestys_5bb]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
FROM VipunenTK_lisatiedot..v_opintojen_kulku_oppilaitoksen_mukaan_versio2
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_opiskelijan_aikaisempi_yleissivistava_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opiskelijan_aikaisempi_yleissivistava_koulutus]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opiskelijan_aikaisempi_yleissivistava_koulutus] AS 

SELECT [id]
     -- ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus_koodi]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus_SV]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus_EN]
      ,[jarjestys]
     -- ,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_opiskelijan_aikaisempi_yleissivistava_koulutus]

UNION ALL

SELECT [id]
     -- ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus_koodi]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus_SV]
      ,[opiskelijan_aikaisempi_yleissivistava_koulutus_EN]
      ,[jarjestys]
     -- ,[virhetilanne]
     -- ,[poistettu]
      ,[tietolahde]
     -- ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[opiskelijan_aikaisempi_yleissivistava_koulutus]

WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_opiskelijan_fte_tieto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opiskelijan_fte_tieto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opiskelijan_fte_tieto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opiskelijan_fte_tieto_koodi,
	opiskelijan_fte_tieto,
	opiskelijan_fte_tieto_SV,
	opiskelijan_fte_tieto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opiskelijan_fte_tieto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opiskelijan_fte_tieto_koodi,
	opiskelijan_fte_tieto,
	opiskelijan_fte_tieto_SV,
	opiskelijan_fte_tieto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opiskelijan_fte_tieto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_opiskelijan_olo]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opiskelijan_olo]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opiskelijan_olo] AS
/*
Drop table VipunenTK.dbo.d_opiskelijan_olo
Select * into VipunenTK.dbo.d_opiskelijan_olo from VipunenTK_DW.dbo.v_opiskelijan_olo
Truncate table  VipunenTK.dbo.d_opiskelijan_olo
Insert into VipunenTK.dbo.d_opiskelijan_olo
Select * from VipunenTK_DW.dbo.v_opiskelijan_olo
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opiskelijan_olo_koodi]
      ,[opiskelijan_olo]
      ,[opiskelijan_olo_SV]
      ,[opiskelijan_olo_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_opiskelijan_olo]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opiskelijan_olo_koodi]
      ,[opiskelijan_olo]
      ,[opiskelijan_olo_SV]
      ,[opiskelijan_olo_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_opiskelijan_olo]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_opiskelijan_olo_tamm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opiskelijan_olo_tamm]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_opiskelijan_olo_tamm] AS
/*
Drop table VipunenTK.dbo.d_opiskelijan_olo
Select * into VipunenTK.dbo.d_opiskelijan_olo from VipunenTK_DW.dbo.v_opiskelijan_olo
Truncate table  VipunenTK.dbo.d_opiskelijan_olo
Insert into VipunenTK.dbo.d_opiskelijan_olo
Select * from VipunenTK_DW.dbo.v_opiskelijan_olo
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opiskelijan_olo_tamm_koodi]
      ,[opiskelijan_olo_tamm]
      ,[opiskelijan_olo_tamm_SV]
      ,[opiskelijan_olo_tamm_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_opiskelijan_olo_tamm]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[opiskelijan_olo_tamm_koodi]
      ,[opiskelijan_olo_tamm]
      ,[opiskelijan_olo_tamm_SV]
      ,[opiskelijan_olo_tamm_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_opiskelijan_olo_tamm]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_opiskelu_toiminta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opiskelu_toiminta]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_opiskelu_toiminta] AS
/*
truncate table VipunenTK.dbo.d_opiskelu_toiminta
insert into VipunenTK.dbo.d_opiskelu_toiminta
select * from [VipunenTK_DW].dbo.[v_opiskelu_toiminta]

drop table VipunenTK.dbo.d_opiskelu_toiminta
select * into VipunenTK.dbo.d_opiskelu_toiminta from [VipunenTK_DW].dbo.[v_opiskelu_toiminta]
Alter table VipunenTK.dbo.d_opiskelu_toiminta add primary key (Id)
*/

SELECT
	id,
	luotu,
	opiskelu_toiminta_koodi,
	opiskelu_toiminta,
	opiskelu_toiminta_SV,
	opiskelu_toiminta_EN,
	jarjestys_opiskelu_toiminta,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opiskelu_toiminta
UNION ALL
SELECT
	id,
	luotu,
	opiskelu_toiminta_koodi,
	opiskelu_toiminta,
	opiskelu_toiminta_SV,
	opiskelu_toiminta_EN,
	jarjestys_opiskelu_toiminta,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opiskelu_toiminta
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_opiskelumuoto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_opiskelumuoto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_opiskelumuoto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opiskelumuoto_koodi,
	opiskelumuoto,
	opiskelumuoto_SV,
	opiskelumuoto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_opiskelumuoto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	opiskelumuoto_koodi,
	opiskelumuoto,
	opiskelumuoto_SV,
	opiskelumuoto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_opiskelumuoto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_oppilaitoksen_taustatiedot_historia]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitoksen_taustatiedot_historia]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_oppilaitoksen_taustatiedot_historia] AS

/* 
3.1.2014 Jarmo. Muutettu ainoan oppilaitoksen haku koskemaan vain yliopistoja ja ammattikorkeakouluja
24.2.2014 Jarmo. Lisätty oppilaitos_avain-kenttä ja sen vaatima käsittely.

--Aletaan käyttää historia- ja nykytilaversioita
Drop table VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Select * into VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia from v_oppilaitoksen_taustatiedot_historia
Truncate table VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Delete from VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Insert into VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
  Select * from v_oppilaitoksen_taustatiedot_historia
*/

SELECT [id]
      ,[oppilaitos_avain]
      ,[oppilaitoskoodi]
      ,[oppilaitoksen_korvaavakoodi]
      ,[alkaa]
      ,[paattyy]
      ,[oppilaitos]
      ,[oppilaitos_SV]
      ,[oppilaitos_EN]
      ,[sairaalakoulukoodi]
      ,[sairaalakoulu]
      ,[sairaalakoulu_SV]
      ,[sairaalakoulu_EN]
      ,[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi]
      ,[oppilaitostyyppi_SV]
      ,[oppilaitostyyppi_EN]
      ,[peruskoulujen_ryhmityskoodi]
      ,[peruskoulujen_ryhmitys]
      ,[peruskoulujen_ryhmitys_SV]
      ,[peruskoulujen_ryhmitys_EN]
      ,[peruskoulujen_vuosilkskoodi]
      ,[peruskoulujen_vuosilks]
      ,[peruskoulujen_vuosilks_SV]
      ,[peruskoulujen_vuosilks_EN]
      ,[oppilaitoksen_omistajatyyppikoodi]
      ,[oppilaitoksen_omistajatyyppi]
      ,[oppilaitoksen_omistajatyyppi_SV]
      ,[oppilaitoksen_omistajatyyppi_EN]
      ,[opetuskielikoodi]
      ,[opetuskieli]
      ,[opetuskieli_SV]
      ,[opetuskieli_EN]
      ,[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta]
      ,[oppilaitoksen_sijaintikunta_SV]
      ,[oppilaitoksen_sijaintikunta_EN]
      ,[koordinaatti_itakoodi]
      ,[koordinaatti_pohjoiskoodi]
      ,[postinumerokoodi]
      ,jarjestys_oppilaitos = Cast(Left(Isnull(Nullif([oppilaitos],''Tuntematon''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys]
      ,[jarjestys_sairaalakoulu] = Cast(Left(Isnull(Nullif([sairaalakoulukoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_sairaalakoulu]
      ,jarjestys_oppilaitostyyppi = Cast(Left(Isnull(Nullif([oppilaitostyyppikoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_oppilaitostyyppi]
      ,jarjestys_peruskoulujen_ryhmitys = Cast(Left(Isnull(Nullif([peruskoulujen_ryhmityskoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_peruskoulujen_ryhmitys]
      ,jarjestys_peruskoulujen_vuosilks = Cast(Left(Isnull(Nullif([peruskoulujen_vuosilkskoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_peruskoulujen_vuosilks]
      ,jarjestys_omistajatyyppi = Cast(Left(Isnull(Nullif([oppilaitoksen_omistajatyyppikoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_omistajatyyppi]
      ,jarjestys_opetuskieli = Cast(Left(Isnull(Nullif([opetuskielikoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_opetuskieli]
      ,jarjestys_koulutuksen_jarjestaja = Cast(Left(Isnull(Nullif([koulutuksen_jarjestaja],''Tuntematon''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_koulutuksen_jarjestaja]
      ,[jarjestys_sijaintikunta] = Cast(Left(Isnull(Nullif([oppilaitoksen_sijaintikunta],''Tuntematon''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_sijaintikunta]
      ,jarjestys_koordinaatti_ita = Cast(Left(Isnull(Nullif([koordinaatti_itakoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_koordinaatti_ita]
      ,jarjestys_koordinaatti_pohjois = Cast(Left(Isnull(Nullif([koordinaatti_pohjoiskoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_koordinaatti_pohjois]
      ,jarjestys_postinumero = Cast(Left(Isnull(Nullif([postinumerokoodi],''-1''),''ööö''),10) as nvarchar(10)) --ol.[jarjestys_postinumero]
      ,[tietolahde_oppilaitos]
      ,[koulutuksen_jarjestajakoodi]
      ,[koulutuksen_jarjestajan_korvaavakoodi]
      ,[koulutuksen_jarjestaja]
      ,[koulutuksen_jarjestaja_SV]
      ,[koulutuksen_jarjestaja_EN]
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi]
      ,[koulutuksen_jarjestajan_omistajatyyppi]
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV]
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN]
      ,[koulutuksen_jarjestajan_kielikoodi]
      ,[koulutuksen_jarjestajan_kieli]
      ,[koulutuksen_jarjestajan_kieli_SV]
      ,[koulutuksen_jarjestajan_kieli_EN]
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi]
      ,[koulutuksen_jarjestajan_sijaintikunta]
      ,[koulutuksen_jarjestajan_sijaintikunta_SV]
      ,[koulutuksen_jarjestajan_sijaintikunta_EN]
      ,[jarjestys_koulutuksenjarjestaja] = Cast(Left(Isnull(Nullif([koulutuksen_jarjestaja],''Tuntematon''),''ööö''),10) as nvarchar(10)) --COALESCE(kj_alkaa.[jarjestys], kj_paattyy.[jarjestys], kj_tuntematon.jarjestys)
      ,jarjestys_koulutuksen_jarjestajan_kieli = Cast(Left(Isnull(Nullif([koulutuksen_jarjestajan_kielikoodi],''-1''),''ööö''),10) as nvarchar(10)) --[jarjestys_koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[jarjestys_koulutuksen_jarjestajan_kieli], kj_paattyy.[jarjestys_koulutuksen_jarjestajan_kieli], kj_tuntematon.jarjestys_koulutuksen_jarjestajan_kieli)
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = Cast(Left(Isnull(Nullif([koulutuksen_jarjestajan_sijaintikunta],''Tuntematon''),''ööö''),10) as nvarchar(10)) --COALESCE(kj_alkaa.[jarjestys_sijaintikunta], kj_paattyy.[jarjestys_sijaintikunta], kj_tuntematon.jarjestys_sijaintikunta)
      ,[tietolahde_koulutuksenjarjestaja]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos]
  FROM ( --kaikki

SELECT 
-- oppilaitos
       ol.[id]
      ,[oppilaitos_avain] = Cast(ol.[oppilaitos_avain] as nvarchar(10))
      ,[oppilaitoskoodi] = Cast(ol.[oppilaitoskoodi] as nvarchar(10))
      ,oppilaitoksen_korvaavakoodi = ol.[korvaavakoodi]
      ,ol.[alkaa]
      ,[paattyy] = ISNULL(ol.[paattyy], Cast(''9999-01-01'' as date))
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol.[oppilaitosselite_EN]
      ,ol.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol.[sairaalakouluselite_EN]
      ,ol.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol.[oppilaitostyyppiselite_EN]
      ,ol.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol.[peruskoulujen_ryhmitysselite_EN]
      ,ol.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol.[omistajatyyppiselite_EN]
      ,ol.[opetuskielikoodi]
      ,opetuskieli = ol.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol.[opetuskieliselite_EN]
      --,ol.[koulutuksen_jarjestajakoodi]
      --,ol.[koulutuksen_jarjestajaselite_FI]
      --,ol.[koulutuksen_jarjestajaselite_SV]
      --,ol.[koulutuksen_jarjestajaselite_EN]
      ,ol.[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta] = ol.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol.[sijaintikuntaselite_EN]
      ,ol.[koordinaatti_itakoodi]
      ,ol.[koordinaatti_pohjoiskoodi]
      ,ol.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = Isnull(Nullif(ol.[oppilaitosselite_FI],''Tuntematon''),''ööö'') --ol.[jarjestys]
      ,[jarjestys_sairaalakoulu] = Isnull(Nullif(ol.[sairaalakoulukoodi],''-1''),''ööö'') --ol.[jarjestys_sairaalakoulu]
      ,jarjestys_oppilaitostyyppi = Isnull(Nullif(ol.[sairaalakoulukoodi],''-1''),''ööö'') --ol.[jarjestys_oppilaitostyyppi]
      ,jarjestys_peruskoulujen_ryhmitys = Isnull(Nullif(ol.[sairaalakoulukoodi],''-1''),''ööö'') --ol.[jarjestys_peruskoulujen_ryhmitys]
      ,jarjestys_peruskoulujen_vuosilks = Isnull(Nullif(ol.[peruskoulujen_vuosilkskoodi],''-1''),''ööö'') --ol.[jarjestys_peruskoulujen_vuosilks]
      ,jarjestys_omistajatyyppi = Isnull(Nullif(ol.[omistajatyyppikoodi],''-1''),''ööö'') --ol.[jarjestys_omistajatyyppi]
      ,jarjestys_opetuskieli = Isnull(Nullif(ol.[opetuskielikoodi],''-1''),''ööö'') --ol.[jarjestys_opetuskieli]
      ,jarjestys_koulutuksen_jarjestaja = Isnull(Nullif(COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_FI], kj_paattyy.[koulutuksen_jarjestajaselite_FI], kj_tuntematon.koulutuksen_jarjestajaselite_FI),''Tuntematon''),''ööö'') --ol.[jarjestys_koulutuksen_jarjestaja]
      ,[jarjestys_sijaintikunta] = Isnull(Nullif(ol.[sijaintikuntaselite_FI],''Tuntematon''),''ööö'') --ol.[jarjestys_sijaintikunta]
      ,jarjestys_koordinaatti_ita = Isnull(Nullif(ol.[koordinaatti_itakoodi],''-1''),''ööö'') --ol.[jarjestys_koordinaatti_ita]
      ,jarjestys_koordinaatti_pohjois = Isnull(Nullif(ol.[koordinaatti_pohjoiskoodi],''-1''),''ööö'') --ol.[jarjestys_koordinaatti_pohjois]
      ,jarjestys_postinumero = Isnull(Nullif(ol.[postinumerokoodi],''-1''),''ööö'') --ol.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,[koulutuksen_jarjestajakoodi] = COALESCE(kj_alkaa.koulutuksen_jarjestajakoodi, kj_paattyy.koulutuksen_jarjestajakoodi, kj_tuntematon.koulutuksen_jarjestajakoodi)
      ,[koulutuksen_jarjestajan_korvaavakoodi] = COALESCE(nullif(kj_alkaa.[korvaavakoodi],''''), nullif(kj_paattyy.[korvaavakoodi],''''), kj_tuntematon.korvaavakoodi) --lisätty nulliffit, Anssi 17.10.2016
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      ,[koulutuksen_jarjestaja] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_FI], kj_paattyy.[koulutuksen_jarjestajaselite_FI], kj_tuntematon.koulutuksen_jarjestajaselite_FI)
      ,[koulutuksen_jarjestaja_SV] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_SV], kj_paattyy.[koulutuksen_jarjestajaselite_SV], kj_tuntematon.koulutuksen_jarjestajaselite_SV)
      ,[koulutuksen_jarjestaja_EN] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_EN], kj_paattyy.[koulutuksen_jarjestajaselite_EN], kj_tuntematon.koulutuksen_jarjestajaselite_EN)
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi] = COALESCE(kj_alkaa.[omistajatyyppikoodi], kj_paattyy.[omistajatyyppikoodi], kj_tuntematon.omistajatyyppikoodi)
      ,[koulutuksen_jarjestajan_omistajatyyppi] = COALESCE(kj_alkaa.[omistajatyyppiselite_FI], kj_paattyy.[omistajatyyppiselite_FI], kj_tuntematon.omistajatyyppiselite_FI)
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV] = COALESCE(kj_alkaa.[omistajatyyppiselite_SV], kj_paattyy.[omistajatyyppiselite_SV], kj_tuntematon.omistajatyyppiselite_SV)
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN] = COALESCE(kj_alkaa.[omistajatyyppiselite_EN], kj_paattyy.[omistajatyyppiselite_EN], kj_tuntematon.omistajatyyppiselite_EN)
      ,[koulutuksen_jarjestajan_kielikoodi] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kielikoodi], kj_paattyy.[koulutuksen_jarjestajan_kielikoodi], kj_tuntematon.koulutuksen_jarjestajan_kielikoodi)
      ,[koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_FI], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_FI], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_FI)
      ,[koulutuksen_jarjestajan_kieli_SV] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_SV], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_SV], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_SV)
      ,[koulutuksen_jarjestajan_kieli_EN] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_EN], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_EN], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_EN)
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = COALESCE(kj_alkaa.[sijaintikuntakoodi], kj_paattyy.[sijaintikuntakoodi], kj_tuntematon.sijaintikuntakoodi)
      ,[koulutuksen_jarjestajan_sijaintikunta] = COALESCE(kj_alkaa.[sijaintikuntaselite_FI], kj_paattyy.[sijaintikuntaselite_FI], kj_tuntematon.sijaintikuntaselite_FI)
      ,[koulutuksen_jarjestajan_sijaintikunta_SV] = COALESCE(kj_alkaa.[sijaintikuntaselite_SV], kj_paattyy.[sijaintikuntaselite_SV], kj_tuntematon.sijaintikuntaselite_SV)
      ,[koulutuksen_jarjestajan_sijaintikunta_EN] = COALESCE(kj_alkaa.[sijaintikuntaselite_EN], kj_paattyy.[sijaintikuntaselite_EN], kj_tuntematon.sijaintikuntaselite_EN)
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,[jarjestys_koulutuksenjarjestaja] = Isnull(Nullif(COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_FI], kj_paattyy.[koulutuksen_jarjestajaselite_FI], kj_tuntematon.koulutuksen_jarjestajaselite_FI),''Tuntematon''),''ööö'') --COALESCE(kj_alkaa.[jarjestys], kj_paattyy.[jarjestys], kj_tuntematon.jarjestys)
      --,[jarjestys_omistajatyyppi] = COALESCE(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,jarjestys_koulutuksen_jarjestajan_kieli = Isnull(Nullif(COALESCE(kj_alkaa.[omistajatyyppikoodi], kj_paattyy.[omistajatyyppikoodi], kj_tuntematon.omistajatyyppikoodi),''-1''),''ööö'') --[jarjestys_koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[jarjestys_koulutuksen_jarjestajan_kieli], kj_paattyy.[jarjestys_koulutuksen_jarjestajan_kieli], kj_tuntematon.jarjestys_koulutuksen_jarjestajan_kieli)
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = Isnull(Nullif(COALESCE(kj_alkaa.[sijaintikuntaselite_FI], kj_paattyy.[sijaintikuntaselite_FI], kj_tuntematon.sijaintikuntaselite_FI),''Tuntematon''),''ööö'') --COALESCE(kj_alkaa.[jarjestys_sijaintikunta], kj_paattyy.[jarjestys_sijaintikunta], kj_tuntematon.jarjestys_sijaintikunta)
      ,[tietolahde_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[tietolahde], kj_paattyy.[tietolahde], kj_tuntematon.tietolahde)
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(NULL as nvarchar(20))

      
FROM [VipunenTK_DW].[dbo].[d_oppilaitos] ol -- (17422 row(s) affected)
LEFT JOIN [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj_alkaa
	ON kj_alkaa.koulutuksen_jarjestajakoodi = ol.koulutuksen_jarjestajakoodi
	AND ol.alkaa between kj_alkaa.alkaa and isnull(kj_alkaa.paattyy,''9999-01-01'') --(121193 row(s) affected)
LEFT JOIN [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj_paattyy
	ON kj_paattyy.koulutuksen_jarjestajakoodi = ol.koulutuksen_jarjestajakoodi
	AND isnull(ol.paattyy, GETDATE()) between kj_paattyy.alkaa and isnull(kj_paattyy.paattyy,''9999-01-01'') --(121193 row(s) affected)
LEFT JOIN [VipunenTK_lisatiedot].[dbo].koulutuksen_jarjestaja kj_tuntematon
	ON kj_tuntematon.koulutuksen_jarjestajakoodi=''-1''

 
UNION ALL

SELECT 
-- oppilaitos
       ol_virhe.[id]
      ,ol_virhe.[oppilaitoskoodi]
      ,ol_virhe.[oppilaitoskoodi]
      ,oppilaitoksen_korvaavakoodi = ol_virhe.[korvaavakoodi]
      ,ol_virhe.[alkaa]
      ,ol_virhe.[paattyy]
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol_virhe.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol_virhe.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol_virhe.[oppilaitosselite_EN]
      ,ol_virhe.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol_virhe.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol_virhe.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol_virhe.[sairaalakouluselite_EN]
      ,ol_virhe.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol_virhe.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol_virhe.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol_virhe.[oppilaitostyyppiselite_EN]
      ,ol_virhe.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol_virhe.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol_virhe.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol_virhe.[peruskoulujen_ryhmitysselite_EN]
      ,ol_virhe.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol_virhe.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol_virhe.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol_virhe.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol_virhe.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol_virhe.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol_virhe.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol_virhe.[omistajatyyppiselite_EN]
      ,ol_virhe.[opetuskielikoodi]
      ,opetuskieli = ol_virhe.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol_virhe.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol_virhe.[opetuskieliselite_EN]
      --,ol_virhe.[koulutuksen_jarjestajakoodi]
      --,ol_virhe.[koulutuksen_jarjestajaselite_FI]
      --,ol_virhe.[koulutuksen_jarjestajaselite_SV]
      --,ol_virhe.[koulutuksen_jarjestajaselite_EN]
      ,ol_virhe.[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta] = ol_virhe.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol_virhe.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol_virhe.[sijaintikuntaselite_EN]
      ,ol_virhe.[koordinaatti_itakoodi]
      ,ol_virhe.[koordinaatti_pohjoiskoodi]
      ,ol_virhe.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol_virhe.[jarjestys]
      ,ol_virhe.[jarjestys_sairaalakoulu]
      ,ol_virhe.[jarjestys_oppilaitostyyppi]
      ,ol_virhe.[jarjestys_peruskoulujen_ryhmitys]
      ,ol_virhe.[jarjestys_peruskoulujen_vuosilks]
      ,ol_virhe.[jarjestys_omistajatyyppi]
      ,ol_virhe.[jarjestys_opetuskieli]
      ,ol_virhe.[jarjestys_koulutuksen_jarjestaja]
      ,ol_virhe.[jarjestys_sijaintikunta]
      ,ol_virhe.[jarjestys_koordinaatti_ita]
      ,ol_virhe.[jarjestys_koordinaatti_pohjois]
      ,ol_virhe.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol_virhe.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,kj_virhe.[koulutuksen_jarjestajakoodi]
      ,kj_virhe.[korvaavakoodi]
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      ,kj_virhe.[koulutuksen_jarjestajaselite_FI]
      ,kj_virhe.[koulutuksen_jarjestajaselite_SV]
      ,kj_virhe.[koulutuksen_jarjestajaselite_EN]
      ,kj_virhe.[omistajatyyppikoodi]
      ,kj_virhe.[omistajatyyppiselite_FI]
      ,kj_virhe.[omistajatyyppiselite_SV]
      ,kj_virhe.[omistajatyyppiselite_EN]
      ,kj_virhe.[koulutuksen_jarjestajan_kielikoodi]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_FI]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_SV]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_EN]
      ,kj_virhe.[sijaintikuntakoodi]
      ,kj_virhe.[sijaintikuntaselite_FI]
      ,kj_virhe.[sijaintikuntaselite_SV]
      ,kj_virhe.[sijaintikuntaselite_EN]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,kj_virhe.[jarjestys]
      --,[jarjestys_omistajatyyppi] = ISNULL(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,kj_virhe.[jarjestys_koulutuksen_jarjestajan_kieli]
      ,kj_virhe.[jarjestys_sijaintikunta]
      ,kj_virhe.[tietolahde]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(NULL as nvarchar(20))

      
FROM VipunenTK_lisatiedot.dbo.oppilaitos ol_virhe -- (17422 row(s) affected)
JOIN VipunenTK_lisatiedot.dbo.koulutuksen_jarjestaja kj_virhe
	ON kj_virhe.koulutuksen_jarjestajakoodi = ol_virhe.koulutuksen_jarjestajakoodi
WHERE ol_virhe.virhetilanne=''K''

--Luodaan koulutuksen järjestäjistä rivit
UNION ALL
SELECT 
-- oppilaitos
       id = (Select MAX(id) from [VipunenTK_DW].[dbo].[d_oppilaitos]) + kj.[id] + 100
      ,[oppilaitos_avain] = kj.koulutuksen_jarjestajakoodi
      ,''-1'' --kj.koulutuksen_jarjestajakoodi --ol.[oppilaitoskoodi]
      ,oppilaitoksen_korvaavakoodi = ol.[korvaavakoodi]
      ,kj.[alkaa]
      ,[paattyy] = ISNULL(kj.[paattyy], Cast(''9999-01-01'' as date))
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol.[oppilaitosselite_EN]
      ,ol.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol.[sairaalakouluselite_EN]
      ,ol.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol.[oppilaitostyyppiselite_EN]
      ,ol.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol.[peruskoulujen_ryhmitysselite_EN]
      ,ol.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol.[omistajatyyppiselite_EN]
      ,ol.[opetuskielikoodi]
      ,opetuskieli = ol.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol.[opetuskieliselite_EN]
      --,ol.[koulutuksen_jarjestajakoodi]
      --,ol.[koulutuksen_jarjestajaselite_FI]
      --,ol.[koulutuksen_jarjestajaselite_SV]
      --,ol.[koulutuksen_jarjestajaselite_EN]
      ,kj.[sijaintikuntakoodi]    -- korjattu ol.sijantikuntakoodista, joka palautti -1:stä - Lasse 23.5.2014
      ,[oppilaitoksen_sijaintikunta] = ol.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol.[sijaintikuntaselite_EN]
      ,ol.[koordinaatti_itakoodi]
      ,ol.[koordinaatti_pohjoiskoodi]
      ,ol.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol.[jarjestys]
      ,ol.[jarjestys_sairaalakoulu]
      ,ol.[jarjestys_oppilaitostyyppi]
      ,ol.[jarjestys_peruskoulujen_ryhmitys]
      ,ol.[jarjestys_peruskoulujen_vuosilks]
      ,ol.[jarjestys_omistajatyyppi]
      ,ol.[jarjestys_opetuskieli]
      ,ol.[jarjestys_koulutuksen_jarjestaja]
      ,ol.[jarjestys_sijaintikunta]
      ,ol.[jarjestys_koordinaatti_ita]
      ,ol.[jarjestys_koordinaatti_pohjois]
      ,ol.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,kj.[koulutuksen_jarjestajakoodi]
      ,[koulutuksen_jarjestajan_korvaavakoodi] = kj.korvaavakoodi --oli aiemmin null, Anssi 17.10.2016
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      
      ,[koulutuksen_jarjestaja] = kj.[koulutuksen_jarjestajaselite_FI]
      ,[koulutuksen_jarjestaja_SV] = kj.[koulutuksen_jarjestajaselite_SV]
      ,[koulutuksen_jarjestaja_EN] = kj.[koulutuksen_jarjestajaselite_EN]
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi] = kj.[omistajatyyppikoodi]
      ,[koulutuksen_jarjestajan_omistajatyyppi] = kj.[omistajatyyppiselite_FI]
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV] = kj.[omistajatyyppiselite_SV]
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN] = kj.[omistajatyyppiselite_EN]
      ,[koulutuksen_jarjestajan_kielikoodi] = kj.[koulutuksen_jarjestajan_kielikoodi]
      ,[koulutuksen_jarjestajan_kieli] = kj.[koulutuksen_jarjestajan_kieliselite_FI]
      ,[koulutuksen_jarjestajan_kieli_SV] = kj.[koulutuksen_jarjestajan_kieliselite_SV]
      ,[koulutuksen_jarjestajan_kieli_EN] = kj.[koulutuksen_jarjestajan_kieliselite_EN]
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = kj.[sijaintikuntakoodi]
      ,[koulutuksen_jarjestajan_sijaintikunta] = kj.[sijaintikuntaselite_FI]
      ,[koulutuksen_jarjestajan_sijaintikunta_SV] = kj.[sijaintikuntaselite_SV]
      ,[koulutuksen_jarjestajan_sijaintikunta_EN] = kj.[sijaintikuntaselite_EN]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,[jarjestys_koulutuksenjarjestaja] = kj.[jarjestys]
      --,[jarjestys_omistajatyyppi] = ISNULL(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,[jarjestys_koulutuksen_jarjestajan_kieli] = kj.[jarjestys_koulutuksen_jarjestajan_kieli]
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = kj.[jarjestys_sijaintikunta]
      ,[tietolahde_koulutuksenjarjestaja] = kj.[tietolahde]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(Case 
			when 1 = (
				Select COUNT(*) from [VipunenTK_DW].[dbo].[d_oppilaitos] ol_lkm
				Where ol_lkm.koulutuksen_jarjestajakoodi = kj.koulutuksen_jarjestajakoodi
				and kj.alkaa between ol_lkm.alkaa and isnull(ol_lkm.paattyy,''9999-01-01'')
				and kj.koulutuksen_jarjestajakoodi IS not null
				and kj.koulutuksen_jarjestajakoodi not IN (''-1'', ''-2'') 
				--3.1.2014 Jarmo haku saa toimia vain amkien ja yliopistojen osalta
				and ol_lkm.oppilaitostyyppikoodi in (''41'', ''42'')
				)
		    then (
				Select top 1 ol_lkm.oppilaitoskoodi from [VipunenTK_DW].[dbo].[d_oppilaitos] ol_lkm
				Where ol_lkm.koulutuksen_jarjestajakoodi = kj.koulutuksen_jarjestajakoodi
				and kj.alkaa between ol_lkm.alkaa and isnull(ol_lkm.paattyy,''9999-01-01'') 
				and kj.koulutuksen_jarjestajakoodi IS not null
				and kj.koulutuksen_jarjestajakoodi not IN (''-1'', ''-2'') 
				--3.1.2014 Jarmo haku saa toimia vain amkien ja yliopistojen osalta
				and ol_lkm.oppilaitostyyppikoodi in (''41'', ''42'')
				)
			else NULL
			end
       as nvarchar(10))

      
FROM [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj
JOIN VipunenTK_lisatiedot.dbo.oppilaitos ol
	ON ol.id = -1

) kaikki


' 
GO
/****** Object:  View [dbo].[v_oppilaitoksen_taustatiedot_historia_BU20141207_JN]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitoksen_taustatiedot_historia_BU20141207_JN]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_oppilaitoksen_taustatiedot_historia_BU20141207_JN] AS

/* 
3.1.2014 Jarmo. Muutettu ainoan oppilaitoksen haku koskemaan vain yliopistoja ja ammattikorkeakouluja
24.2.2014 Jarmo. Lisätty oppilaitos_avain-kenttä ja sen vaatima käsittely.

--Aletaan käyttää historia- ja nykytilaversioita
Drop table VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Select * into VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia from v_oppilaitoksen_taustatiedot_historia
Truncate table VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Delete from VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Insert into VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
  Select * from v_oppilaitoksen_taustatiedot_historia
*/


SELECT 
-- oppilaitos
       ol.[id]
      ,[oppilaitos_avain] = Cast(ol.[oppilaitos_avain] as nvarchar(10))
      ,[oppilaitoskoodi] = Cast(ol.[oppilaitoskoodi] as nvarchar(10))
      ,oppilaitoksen_korvaavakoodi = ol.[korvaavakoodi]
      ,ol.[alkaa]
      ,[paattyy] = ISNULL(ol.[paattyy], Cast(''9999-01-01'' as date))
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol.[oppilaitosselite_EN]
      ,ol.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol.[sairaalakouluselite_EN]
      ,ol.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol.[oppilaitostyyppiselite_EN]
      ,ol.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol.[peruskoulujen_ryhmitysselite_EN]
      ,ol.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol.[omistajatyyppiselite_EN]
      ,ol.[opetuskielikoodi]
      ,opetuskieli = ol.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol.[opetuskieliselite_EN]
      --,ol.[koulutuksen_jarjestajakoodi]
      --,ol.[koulutuksen_jarjestajaselite_FI]
      --,ol.[koulutuksen_jarjestajaselite_SV]
      --,ol.[koulutuksen_jarjestajaselite_EN]
      ,ol.[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta] = ol.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol.[sijaintikuntaselite_EN]
      ,ol.[koordinaatti_itakoodi]
      ,ol.[koordinaatti_pohjoiskoodi]
      ,ol.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol.[jarjestys]
      ,ol.[jarjestys_sairaalakoulu]
      ,ol.[jarjestys_oppilaitostyyppi]
      ,ol.[jarjestys_peruskoulujen_ryhmitys]
      ,ol.[jarjestys_peruskoulujen_vuosilks]
      ,ol.[jarjestys_omistajatyyppi]
      ,ol.[jarjestys_opetuskieli]
      ,ol.[jarjestys_koulutuksen_jarjestaja]
      ,ol.[jarjestys_sijaintikunta]
      ,ol.[jarjestys_koordinaatti_ita]
      ,ol.[jarjestys_koordinaatti_pohjois]
      ,ol.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,[koulutuksen_jarjestajakoodi] = COALESCE(kj_alkaa.koulutuksen_jarjestajakoodi, kj_paattyy.koulutuksen_jarjestajakoodi, kj_tuntematon.koulutuksen_jarjestajakoodi)
      ,[koulutuksen_jarjestajan_korvaavakoodi] = COALESCE(kj_alkaa.[korvaavakoodi], kj_paattyy.[korvaavakoodi], kj_tuntematon.korvaavakoodi) 
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      ,[koulutuksen_jarjestaja] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_FI], kj_paattyy.[koulutuksen_jarjestajaselite_FI], kj_tuntematon.koulutuksen_jarjestajaselite_FI)
      ,[koulutuksen_jarjestaja_SV] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_SV], kj_paattyy.[koulutuksen_jarjestajaselite_SV], kj_tuntematon.koulutuksen_jarjestajaselite_SV)
      ,[koulutuksen_jarjestaja_EN] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_EN], kj_paattyy.[koulutuksen_jarjestajaselite_EN], kj_tuntematon.koulutuksen_jarjestajaselite_EN)
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi] = COALESCE(kj_alkaa.[omistajatyyppikoodi], kj_paattyy.[omistajatyyppikoodi], kj_tuntematon.omistajatyyppikoodi)
      ,[koulutuksen_jarjestajan_omistajatyyppi] = COALESCE(kj_alkaa.[omistajatyyppiselite_FI], kj_paattyy.[omistajatyyppiselite_FI], kj_tuntematon.omistajatyyppiselite_FI)
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV] = COALESCE(kj_alkaa.[omistajatyyppiselite_SV], kj_paattyy.[omistajatyyppiselite_SV], kj_tuntematon.omistajatyyppiselite_SV)
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN] = COALESCE(kj_alkaa.[omistajatyyppiselite_EN], kj_paattyy.[omistajatyyppiselite_EN], kj_tuntematon.omistajatyyppiselite_EN)
      ,[koulutuksen_jarjestajan_kielikoodi] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kielikoodi], kj_paattyy.[koulutuksen_jarjestajan_kielikoodi], kj_tuntematon.koulutuksen_jarjestajan_kielikoodi)
      ,[koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_FI], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_FI], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_FI)
      ,[koulutuksen_jarjestajan_kieli_SV] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_SV], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_SV], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_SV)
      ,[koulutuksen_jarjestajan_kieli_EN] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_EN], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_EN], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_EN)
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = COALESCE(kj_alkaa.[sijaintikuntakoodi], kj_paattyy.[sijaintikuntakoodi], kj_tuntematon.sijaintikuntakoodi)
      ,[koulutuksen_jarjestajan_sijaintikunta] = COALESCE(kj_alkaa.[sijaintikuntaselite_FI], kj_paattyy.[sijaintikuntaselite_FI], kj_tuntematon.sijaintikuntaselite_FI)
      ,[koulutuksen_jarjestajan_sijaintikunta_SV] = COALESCE(kj_alkaa.[sijaintikuntaselite_SV], kj_paattyy.[sijaintikuntaselite_SV], kj_tuntematon.sijaintikuntaselite_SV)
      ,[koulutuksen_jarjestajan_sijaintikunta_EN] = COALESCE(kj_alkaa.[sijaintikuntaselite_EN], kj_paattyy.[sijaintikuntaselite_EN], kj_tuntematon.sijaintikuntaselite_EN)
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,[jarjestys_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[jarjestys], kj_paattyy.[jarjestys], kj_tuntematon.jarjestys)
      --,[jarjestys_omistajatyyppi] = COALESCE(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,[jarjestys_koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[jarjestys_koulutuksen_jarjestajan_kieli], kj_paattyy.[jarjestys_koulutuksen_jarjestajan_kieli], kj_tuntematon.jarjestys_koulutuksen_jarjestajan_kieli)
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[jarjestys_sijaintikunta], kj_paattyy.[jarjestys_sijaintikunta], kj_tuntematon.jarjestys_sijaintikunta)
      ,[tietolahde_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[tietolahde], kj_paattyy.[tietolahde], kj_tuntematon.tietolahde)
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(NULL as nvarchar(20))

      
FROM [VipunenTK_DW].[dbo].[d_oppilaitos] ol -- (17422 row(s) affected)
LEFT JOIN [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj_alkaa
	ON kj_alkaa.koulutuksen_jarjestajakoodi = ol.koulutuksen_jarjestajakoodi
	AND ol.alkaa between kj_alkaa.alkaa and isnull(kj_alkaa.paattyy,''9999-01-01'') --(121193 row(s) affected)
LEFT JOIN [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj_paattyy
	ON kj_paattyy.koulutuksen_jarjestajakoodi = ol.koulutuksen_jarjestajakoodi
	AND isnull(ol.paattyy, GETDATE()) between kj_paattyy.alkaa and isnull(kj_paattyy.paattyy,''9999-01-01'') --(121193 row(s) affected)
LEFT JOIN [VipunenTK_lisatiedot].[dbo].koulutuksen_jarjestaja kj_tuntematon
	ON kj_tuntematon.koulutuksen_jarjestajakoodi=''-1''

 
UNION ALL

SELECT 
-- oppilaitos
       ol_virhe.[id]
      ,ol_virhe.[oppilaitoskoodi]
      ,ol_virhe.[oppilaitoskoodi]
      ,oppilaitoksen_korvaavakoodi = ol_virhe.[korvaavakoodi]
      ,ol_virhe.[alkaa]
      ,ol_virhe.[paattyy]
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol_virhe.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol_virhe.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol_virhe.[oppilaitosselite_EN]
      ,ol_virhe.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol_virhe.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol_virhe.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol_virhe.[sairaalakouluselite_EN]
      ,ol_virhe.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol_virhe.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol_virhe.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol_virhe.[oppilaitostyyppiselite_EN]
      ,ol_virhe.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol_virhe.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol_virhe.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol_virhe.[peruskoulujen_ryhmitysselite_EN]
      ,ol_virhe.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol_virhe.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol_virhe.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol_virhe.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol_virhe.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol_virhe.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol_virhe.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol_virhe.[omistajatyyppiselite_EN]
      ,ol_virhe.[opetuskielikoodi]
      ,opetuskieli = ol_virhe.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol_virhe.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol_virhe.[opetuskieliselite_EN]
      --,ol_virhe.[koulutuksen_jarjestajakoodi]
      --,ol_virhe.[koulutuksen_jarjestajaselite_FI]
      --,ol_virhe.[koulutuksen_jarjestajaselite_SV]
      --,ol_virhe.[koulutuksen_jarjestajaselite_EN]
      ,ol_virhe.[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta] = ol_virhe.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol_virhe.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol_virhe.[sijaintikuntaselite_EN]
      ,ol_virhe.[koordinaatti_itakoodi]
      ,ol_virhe.[koordinaatti_pohjoiskoodi]
      ,ol_virhe.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol_virhe.[jarjestys]
      ,ol_virhe.[jarjestys_sairaalakoulu]
      ,ol_virhe.[jarjestys_oppilaitostyyppi]
      ,ol_virhe.[jarjestys_peruskoulujen_ryhmitys]
      ,ol_virhe.[jarjestys_peruskoulujen_vuosilks]
      ,ol_virhe.[jarjestys_omistajatyyppi]
      ,ol_virhe.[jarjestys_opetuskieli]
      ,ol_virhe.[jarjestys_koulutuksen_jarjestaja]
      ,ol_virhe.[jarjestys_sijaintikunta]
      ,ol_virhe.[jarjestys_koordinaatti_ita]
      ,ol_virhe.[jarjestys_koordinaatti_pohjois]
      ,ol_virhe.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol_virhe.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,kj_virhe.[koulutuksen_jarjestajakoodi]
      ,kj_virhe.[korvaavakoodi]
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      ,kj_virhe.[koulutuksen_jarjestajaselite_FI]
      ,kj_virhe.[koulutuksen_jarjestajaselite_SV]
      ,kj_virhe.[koulutuksen_jarjestajaselite_EN]
      ,kj_virhe.[omistajatyyppikoodi]
      ,kj_virhe.[omistajatyyppiselite_FI]
      ,kj_virhe.[omistajatyyppiselite_SV]
      ,kj_virhe.[omistajatyyppiselite_EN]
      ,kj_virhe.[koulutuksen_jarjestajan_kielikoodi]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_FI]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_SV]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_EN]
      ,kj_virhe.[sijaintikuntakoodi]
      ,kj_virhe.[sijaintikuntaselite_FI]
      ,kj_virhe.[sijaintikuntaselite_SV]
      ,kj_virhe.[sijaintikuntaselite_EN]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,kj_virhe.[jarjestys]
      --,[jarjestys_omistajatyyppi] = ISNULL(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,kj_virhe.[jarjestys_koulutuksen_jarjestajan_kieli]
      ,kj_virhe.[jarjestys_sijaintikunta]
      ,kj_virhe.[tietolahde]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(NULL as nvarchar(20))

      
FROM VipunenTK_lisatiedot.dbo.oppilaitos ol_virhe -- (17422 row(s) affected)
JOIN VipunenTK_lisatiedot.dbo.koulutuksen_jarjestaja kj_virhe
	ON kj_virhe.koulutuksen_jarjestajakoodi = ol_virhe.koulutuksen_jarjestajakoodi
WHERE ol_virhe.virhetilanne=''K''

--Luodaan koulutuksen järjestäjistä rivit
UNION ALL
SELECT 
-- oppilaitos
       id = (Select MAX(id) from [VipunenTK_DW].[dbo].[d_oppilaitos]) + kj.[id] + 100
      ,[oppilaitos_avain] = kj.koulutuksen_jarjestajakoodi
      ,''-1'' --kj.koulutuksen_jarjestajakoodi --ol.[oppilaitoskoodi]
      ,oppilaitoksen_korvaavakoodi = ol.[korvaavakoodi]
      ,kj.[alkaa]
      ,[paattyy] = ISNULL(kj.[paattyy], Cast(''9999-01-01'' as date))
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol.[oppilaitosselite_EN]
      ,ol.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol.[sairaalakouluselite_EN]
      ,ol.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol.[oppilaitostyyppiselite_EN]
      ,ol.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol.[peruskoulujen_ryhmitysselite_EN]
      ,ol.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol.[omistajatyyppiselite_EN]
      ,ol.[opetuskielikoodi]
      ,opetuskieli = ol.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol.[opetuskieliselite_EN]
      --,ol.[koulutuksen_jarjestajakoodi]
      --,ol.[koulutuksen_jarjestajaselite_FI]
      --,ol.[koulutuksen_jarjestajaselite_SV]
      --,ol.[koulutuksen_jarjestajaselite_EN]
      ,kj.[sijaintikuntakoodi]    -- korjattu ol.sijantikuntakoodista, joka palautti -1:stä - Lasse 23.5.2014
      ,[oppilaitoksen_sijaintikunta] = ol.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol.[sijaintikuntaselite_EN]
      ,ol.[koordinaatti_itakoodi]
      ,ol.[koordinaatti_pohjoiskoodi]
      ,ol.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol.[jarjestys]
      ,ol.[jarjestys_sairaalakoulu]
      ,ol.[jarjestys_oppilaitostyyppi]
      ,ol.[jarjestys_peruskoulujen_ryhmitys]
      ,ol.[jarjestys_peruskoulujen_vuosilks]
      ,ol.[jarjestys_omistajatyyppi]
      ,ol.[jarjestys_opetuskieli]
      ,ol.[jarjestys_koulutuksen_jarjestaja]
      ,ol.[jarjestys_sijaintikunta]
      ,ol.[jarjestys_koordinaatti_ita]
      ,ol.[jarjestys_koordinaatti_pohjois]
      ,ol.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,kj.[koulutuksen_jarjestajakoodi]
      ,[koulutuksen_jarjestajan_korvaavakoodi] = NULL
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      
      ,[koulutuksen_jarjestaja] = kj.[koulutuksen_jarjestajaselite_FI]
      ,[koulutuksen_jarjestaja_SV] = kj.[koulutuksen_jarjestajaselite_SV]
      ,[koulutuksen_jarjestaja_EN] = kj.[koulutuksen_jarjestajaselite_EN]
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi] = kj.[omistajatyyppikoodi]
      ,[koulutuksen_jarjestajan_omistajatyyppi] = kj.[omistajatyyppiselite_FI]
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV] = kj.[omistajatyyppiselite_SV]
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN] = kj.[omistajatyyppiselite_EN]
      ,[koulutuksen_jarjestajan_kielikoodi] = kj.[koulutuksen_jarjestajan_kielikoodi]
      ,[koulutuksen_jarjestajan_kieli] = kj.[koulutuksen_jarjestajan_kieliselite_FI]
      ,[koulutuksen_jarjestajan_kieli_SV] = kj.[koulutuksen_jarjestajan_kieliselite_SV]
      ,[koulutuksen_jarjestajan_kieli_EN] = kj.[koulutuksen_jarjestajan_kieliselite_EN]
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = kj.[sijaintikuntakoodi]
      ,[koulutuksen_jarjestajan_sijaintikunta] = kj.[sijaintikuntaselite_FI]
      ,[koulutuksen_jarjestajan_sijaintikunta_SV] = kj.[sijaintikuntaselite_SV]
      ,[koulutuksen_jarjestajan_sijaintikunta_EN] = kj.[sijaintikuntaselite_EN]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,[jarjestys_koulutuksenjarjestaja] = kj.[jarjestys]
      --,[jarjestys_omistajatyyppi] = ISNULL(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,[jarjestys_koulutuksen_jarjestajan_kieli] = kj.[jarjestys_koulutuksen_jarjestajan_kieli]
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = kj.[jarjestys_sijaintikunta]
      ,[tietolahde_koulutuksenjarjestaja] = kj.[tietolahde]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(Case 
			when 1 = (
				Select COUNT(*) from [VipunenTK_DW].[dbo].[d_oppilaitos] ol_lkm
				Where ol_lkm.koulutuksen_jarjestajakoodi = kj.koulutuksen_jarjestajakoodi
				and kj.alkaa between ol_lkm.alkaa and isnull(ol_lkm.paattyy,''9999-01-01'')
				and kj.koulutuksen_jarjestajakoodi IS not null
				and kj.koulutuksen_jarjestajakoodi not IN (''-1'', ''-2'') 
				--3.1.2014 Jarmo haku saa toimia vain amkien ja yliopistojen osalta
				and ol_lkm.oppilaitostyyppikoodi in (''41'', ''42'')
				)
		    then (
				Select top 1 ol_lkm.oppilaitoskoodi from [VipunenTK_DW].[dbo].[d_oppilaitos] ol_lkm
				Where ol_lkm.koulutuksen_jarjestajakoodi = kj.koulutuksen_jarjestajakoodi
				and kj.alkaa between ol_lkm.alkaa and isnull(ol_lkm.paattyy,''9999-01-01'') 
				and kj.koulutuksen_jarjestajakoodi IS not null
				and kj.koulutuksen_jarjestajakoodi not IN (''-1'', ''-2'') 
				--3.1.2014 Jarmo haku saa toimia vain amkien ja yliopistojen osalta
				and ol_lkm.oppilaitostyyppikoodi in (''41'', ''42'')
				)
			else NULL
			end
       as nvarchar(10))

      
FROM [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj
JOIN VipunenTK_lisatiedot.dbo.oppilaitos ol
	ON ol.id = -1
' 
GO
/****** Object:  View [dbo].[v_oppilaitoksen_taustatiedot_historia_talteen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitoksen_taustatiedot_historia_talteen]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_oppilaitoksen_taustatiedot_historia_talteen] AS

/* 
3.1.2014 Jarmo. Muutettu ainoan oppilaitoksen haku koskemaan vain yliopistoja ja ammattikorkeakouluja
24.2.2014 Jarmo. Lisätty oppilaitos_avain-kenttä ja sen vaatima käsittely.

--Aletaan käyttää historia- ja nykytilaversioita
Drop table VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Select * into VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia from v_oppilaitoksen_taustatiedot_historia
Truncate table VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Delete from VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
Insert into VipunenTK.dbo.d_oppilaitoksen_taustatiedot_historia
  Select * from v_oppilaitoksen_taustatiedot_historia
*/


SELECT 
-- oppilaitos
       ol.[id]
      ,[oppilaitos_avain] = Cast(ol.[oppilaitoskoodi] as nvarchar(10))
      ,[oppilaitoskoodi] = Cast(ol.[oppilaitoskoodi] as nvarchar(10))
      ,oppilaitoksen_korvaavakoodi = ol.[korvaavakoodi]
      ,ol.[alkaa]
      ,[paattyy] = ISNULL(ol.[paattyy], Cast(''9999-01-01'' as date))
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol.[oppilaitosselite_EN]
      ,ol.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol.[sairaalakouluselite_EN]
      ,ol.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol.[oppilaitostyyppiselite_EN]
      ,ol.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol.[peruskoulujen_ryhmitysselite_EN]
      ,ol.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol.[omistajatyyppiselite_EN]
      ,ol.[opetuskielikoodi]
      ,opetuskieli = ol.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol.[opetuskieliselite_EN]
      --,ol.[koulutuksen_jarjestajakoodi]
      --,ol.[koulutuksen_jarjestajaselite_FI]
      --,ol.[koulutuksen_jarjestajaselite_SV]
      --,ol.[koulutuksen_jarjestajaselite_EN]
      ,ol.[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta] = ol.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol.[sijaintikuntaselite_EN]
      ,ol.[koordinaatti_itakoodi]
      ,ol.[koordinaatti_pohjoiskoodi]
      ,ol.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol.[jarjestys]
      ,ol.[jarjestys_sairaalakoulu]
      ,ol.[jarjestys_oppilaitostyyppi]
      ,ol.[jarjestys_peruskoulujen_ryhmitys]
      ,ol.[jarjestys_peruskoulujen_vuosilks]
      ,ol.[jarjestys_omistajatyyppi]
      ,ol.[jarjestys_opetuskieli]
      ,ol.[jarjestys_koulutuksen_jarjestaja]
      ,ol.[jarjestys_sijaintikunta]
      ,ol.[jarjestys_koordinaatti_ita]
      ,ol.[jarjestys_koordinaatti_pohjois]
      ,ol.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,[koulutuksen_jarjestajakoodi] = COALESCE(kj_alkaa.koulutuksen_jarjestajakoodi, kj_paattyy.koulutuksen_jarjestajakoodi, kj_tuntematon.koulutuksen_jarjestajakoodi)
      ,[koulutuksen_jarjestajan_korvaavakoodi] = COALESCE(kj_alkaa.[korvaavakoodi], kj_paattyy.[korvaavakoodi], kj_tuntematon.korvaavakoodi) 
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      ,[koulutuksen_jarjestaja] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_FI], kj_paattyy.[koulutuksen_jarjestajaselite_FI], kj_tuntematon.koulutuksen_jarjestajaselite_FI)
      ,[koulutuksen_jarjestaja_SV] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_SV], kj_paattyy.[koulutuksen_jarjestajaselite_SV], kj_tuntematon.koulutuksen_jarjestajaselite_SV)
      ,[koulutuksen_jarjestaja_EN] = COALESCE(kj_alkaa.[koulutuksen_jarjestajaselite_EN], kj_paattyy.[koulutuksen_jarjestajaselite_EN], kj_tuntematon.koulutuksen_jarjestajaselite_EN)
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi] = COALESCE(kj_alkaa.[omistajatyyppikoodi], kj_paattyy.[omistajatyyppikoodi], kj_tuntematon.omistajatyyppikoodi)
      ,[koulutuksen_jarjestajan_omistajatyyppi] = COALESCE(kj_alkaa.[omistajatyyppiselite_FI], kj_paattyy.[omistajatyyppiselite_FI], kj_tuntematon.omistajatyyppiselite_FI)
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV] = COALESCE(kj_alkaa.[omistajatyyppiselite_SV], kj_paattyy.[omistajatyyppiselite_SV], kj_tuntematon.omistajatyyppiselite_SV)
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN] = COALESCE(kj_alkaa.[omistajatyyppiselite_EN], kj_paattyy.[omistajatyyppiselite_EN], kj_tuntematon.omistajatyyppiselite_EN)
      ,[koulutuksen_jarjestajan_kielikoodi] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kielikoodi], kj_paattyy.[koulutuksen_jarjestajan_kielikoodi], kj_tuntematon.koulutuksen_jarjestajan_kielikoodi)
      ,[koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_FI], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_FI], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_FI)
      ,[koulutuksen_jarjestajan_kieli_SV] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_SV], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_SV], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_SV)
      ,[koulutuksen_jarjestajan_kieli_EN] = COALESCE(kj_alkaa.[koulutuksen_jarjestajan_kieliselite_EN], kj_paattyy.[koulutuksen_jarjestajan_kieliselite_EN], kj_tuntematon.koulutuksen_jarjestajan_kieliselite_EN)
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = COALESCE(kj_alkaa.[sijaintikuntakoodi], kj_paattyy.[sijaintikuntakoodi], kj_tuntematon.sijaintikuntakoodi)
      ,[koulutuksen_jarjestajan_sijaintikunta] = COALESCE(kj_alkaa.[sijaintikuntaselite_FI], kj_paattyy.[sijaintikuntaselite_FI], kj_tuntematon.sijaintikuntaselite_FI)
      ,[koulutuksen_jarjestajan_sijaintikunta_SV] = COALESCE(kj_alkaa.[sijaintikuntaselite_SV], kj_paattyy.[sijaintikuntaselite_SV], kj_tuntematon.sijaintikuntaselite_SV)
      ,[koulutuksen_jarjestajan_sijaintikunta_EN] = COALESCE(kj_alkaa.[sijaintikuntaselite_EN], kj_paattyy.[sijaintikuntaselite_EN], kj_tuntematon.sijaintikuntaselite_EN)
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,[jarjestys_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[jarjestys], kj_paattyy.[jarjestys], kj_tuntematon.jarjestys)
      --,[jarjestys_omistajatyyppi] = COALESCE(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,[jarjestys_koulutuksen_jarjestajan_kieli] = COALESCE(kj_alkaa.[jarjestys_koulutuksen_jarjestajan_kieli], kj_paattyy.[jarjestys_koulutuksen_jarjestajan_kieli], kj_tuntematon.jarjestys_koulutuksen_jarjestajan_kieli)
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[jarjestys_sijaintikunta], kj_paattyy.[jarjestys_sijaintikunta], kj_tuntematon.jarjestys_sijaintikunta)
      ,[tietolahde_koulutuksenjarjestaja] = COALESCE(kj_alkaa.[tietolahde], kj_paattyy.[tietolahde], kj_tuntematon.tietolahde)
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(NULL as nvarchar(20))

      
FROM [VipunenTK_DW].[dbo].[d_oppilaitos] ol -- (17422 row(s) affected)
LEFT JOIN [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj_alkaa
	ON kj_alkaa.koulutuksen_jarjestajakoodi = ol.koulutuksen_jarjestajakoodi
	AND ol.alkaa between kj_alkaa.alkaa and isnull(kj_alkaa.paattyy,''9999-01-01'') --(121193 row(s) affected)
LEFT JOIN [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj_paattyy
	ON kj_paattyy.koulutuksen_jarjestajakoodi = ol.koulutuksen_jarjestajakoodi
	AND isnull(ol.paattyy, GETDATE()) between kj_paattyy.alkaa and isnull(kj_paattyy.paattyy,''9999-01-01'') --(121193 row(s) affected)
LEFT JOIN [VipunenTK_lisatiedot].[dbo].koulutuksen_jarjestaja kj_tuntematon
	ON kj_tuntematon.koulutuksen_jarjestajakoodi=''-1''

 
UNION ALL

SELECT 
-- oppilaitos
       ol_virhe.[id]
      ,ol_virhe.[oppilaitoskoodi]
      ,ol_virhe.[oppilaitoskoodi]
      ,oppilaitoksen_korvaavakoodi = ol_virhe.[korvaavakoodi]
      ,ol_virhe.[alkaa]
      ,ol_virhe.[paattyy]
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol_virhe.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol_virhe.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol_virhe.[oppilaitosselite_EN]
      ,ol_virhe.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol_virhe.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol_virhe.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol_virhe.[sairaalakouluselite_EN]
      ,ol_virhe.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol_virhe.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol_virhe.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol_virhe.[oppilaitostyyppiselite_EN]
      ,ol_virhe.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol_virhe.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol_virhe.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol_virhe.[peruskoulujen_ryhmitysselite_EN]
      ,ol_virhe.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol_virhe.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol_virhe.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol_virhe.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol_virhe.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol_virhe.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol_virhe.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol_virhe.[omistajatyyppiselite_EN]
      ,ol_virhe.[opetuskielikoodi]
      ,opetuskieli = ol_virhe.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol_virhe.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol_virhe.[opetuskieliselite_EN]
      --,ol_virhe.[koulutuksen_jarjestajakoodi]
      --,ol_virhe.[koulutuksen_jarjestajaselite_FI]
      --,ol_virhe.[koulutuksen_jarjestajaselite_SV]
      --,ol_virhe.[koulutuksen_jarjestajaselite_EN]
      ,ol_virhe.[sijaintikuntakoodi]
      ,[oppilaitoksen_sijaintikunta] = ol_virhe.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol_virhe.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol_virhe.[sijaintikuntaselite_EN]
      ,ol_virhe.[koordinaatti_itakoodi]
      ,ol_virhe.[koordinaatti_pohjoiskoodi]
      ,ol_virhe.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol_virhe.[jarjestys]
      ,ol_virhe.[jarjestys_sairaalakoulu]
      ,ol_virhe.[jarjestys_oppilaitostyyppi]
      ,ol_virhe.[jarjestys_peruskoulujen_ryhmitys]
      ,ol_virhe.[jarjestys_peruskoulujen_vuosilks]
      ,ol_virhe.[jarjestys_omistajatyyppi]
      ,ol_virhe.[jarjestys_opetuskieli]
      ,ol_virhe.[jarjestys_koulutuksen_jarjestaja]
      ,ol_virhe.[jarjestys_sijaintikunta]
      ,ol_virhe.[jarjestys_koordinaatti_ita]
      ,ol_virhe.[jarjestys_koordinaatti_pohjois]
      ,ol_virhe.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol_virhe.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,kj_virhe.[koulutuksen_jarjestajakoodi]
      ,kj_virhe.[korvaavakoodi]
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      ,kj_virhe.[koulutuksen_jarjestajaselite_FI]
      ,kj_virhe.[koulutuksen_jarjestajaselite_SV]
      ,kj_virhe.[koulutuksen_jarjestajaselite_EN]
      ,kj_virhe.[omistajatyyppikoodi]
      ,kj_virhe.[omistajatyyppiselite_FI]
      ,kj_virhe.[omistajatyyppiselite_SV]
      ,kj_virhe.[omistajatyyppiselite_EN]
      ,kj_virhe.[koulutuksen_jarjestajan_kielikoodi]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_FI]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_SV]
      ,kj_virhe.[koulutuksen_jarjestajan_kieliselite_EN]
      ,kj_virhe.[sijaintikuntakoodi]
      ,kj_virhe.[sijaintikuntaselite_FI]
      ,kj_virhe.[sijaintikuntaselite_SV]
      ,kj_virhe.[sijaintikuntaselite_EN]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,kj_virhe.[jarjestys]
      --,[jarjestys_omistajatyyppi] = ISNULL(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,kj_virhe.[jarjestys_koulutuksen_jarjestajan_kieli]
      ,kj_virhe.[jarjestys_sijaintikunta]
      ,kj_virhe.[tietolahde]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(NULL as nvarchar(20))

      
FROM VipunenTK_lisatiedot.dbo.oppilaitos ol_virhe -- (17422 row(s) affected)
JOIN VipunenTK_lisatiedot.dbo.koulutuksen_jarjestaja kj_virhe
	ON kj_virhe.koulutuksen_jarjestajakoodi = ol_virhe.koulutuksen_jarjestajakoodi
WHERE ol_virhe.virhetilanne=''K''

--Luodaan koulutuksen järjestäjistä rivit
UNION ALL
SELECT 
-- oppilaitos
       id = (Select MAX(id) from [VipunenTK_DW].[dbo].[d_oppilaitos]) + kj.[id] + 100
      ,[oppilaitos_avain] = kj.koulutuksen_jarjestajakoodi
      ,''-1'' --kj.koulutuksen_jarjestajakoodi --ol.[oppilaitoskoodi]
      ,oppilaitoksen_korvaavakoodi = ol.[korvaavakoodi]
      ,kj.[alkaa]
      ,[paattyy] = ISNULL(kj.[paattyy], Cast(''9999-01-01'' as date))
      --,[viimeisin_tilv]
      ,[oppilaitos] = ol.[oppilaitosselite_FI]
      ,[oppilaitos_SV] = ol.[oppilaitosselite_SV]
      ,[oppilaitos_EN] = ol.[oppilaitosselite_EN]
      ,ol.[sairaalakoulukoodi]
      ,[sairaalakoulu] = ol.[sairaalakouluselite_FI]
      ,[sairaalakoulu_SV] = ol.[sairaalakouluselite_SV]
      ,[sairaalakoulu_EN] = ol.[sairaalakouluselite_EN]
      ,ol.[oppilaitostyyppikoodi]
      ,[oppilaitostyyppi] = ol.[oppilaitostyyppiselite_FI]
      ,[oppilaitostyyppi_SV] = ol.[oppilaitostyyppiselite_SV]
      ,[oppilaitostyyppi_EN] = ol.[oppilaitostyyppiselite_EN]
      ,ol.[peruskoulujen_ryhmityskoodi]
      ,peruskoulujen_ryhmitys = ol.[peruskoulujen_ryhmitysselite_FI]
      ,peruskoulujen_ryhmitys_SV = ol.[peruskoulujen_ryhmitysselite_SV]
      ,peruskoulujen_ryhmitys_EN = ol.[peruskoulujen_ryhmitysselite_EN]
      ,ol.[peruskoulujen_vuosilkskoodi]
      ,peruskoulujen_vuosilks = ol.[peruskoulujen_vuosilksselite_FI]
      ,peruskoulujen_vuosilks_SV = ol.[peruskoulujen_vuosilksselite_SV]
      ,peruskoulujen_vuosilks_EN = ol.[peruskoulujen_vuosilksselite_EN]
      ,oppilaitoksen_omistajatyyppikoodi = ol.[omistajatyyppikoodi]
      ,oppilaitoksen_omistajatyyppi = ol.[omistajatyyppiselite_FI]
      ,oppilaitoksen_omistajatyyppi_SV = ol.[omistajatyyppiselite_SV]
      ,oppilaitoksen_omistajatyyppi_EN = ol.[omistajatyyppiselite_EN]
      ,ol.[opetuskielikoodi]
      ,opetuskieli = ol.[opetuskieliselite_FI]
      ,opetuskieli_SV = ol.[opetuskieliselite_SV]
      ,opetuskieli_EN = ol.[opetuskieliselite_EN]
      --,ol.[koulutuksen_jarjestajakoodi]
      --,ol.[koulutuksen_jarjestajaselite_FI]
      --,ol.[koulutuksen_jarjestajaselite_SV]
      --,ol.[koulutuksen_jarjestajaselite_EN]
      ,kj.[sijaintikuntakoodi]    -- korjattu ol.sijantikuntakoodista, joka palautti -1:stä - Lasse 23.5.2014
      ,[oppilaitoksen_sijaintikunta] = ol.[sijaintikuntaselite_FI]
      ,[oppilaitoksen_sijaintikunta_SV] = ol.[sijaintikuntaselite_SV]
      ,[oppilaitoksen_sijaintikunta_EN] = ol.[sijaintikuntaselite_EN]
      ,ol.[koordinaatti_itakoodi]
      ,ol.[koordinaatti_pohjoiskoodi]
      ,ol.[postinumerokoodi]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,jarjestys_oppilaitos = ol.[jarjestys]
      ,ol.[jarjestys_sairaalakoulu]
      ,ol.[jarjestys_oppilaitostyyppi]
      ,ol.[jarjestys_peruskoulujen_ryhmitys]
      ,ol.[jarjestys_peruskoulujen_vuosilks]
      ,ol.[jarjestys_omistajatyyppi]
      ,ol.[jarjestys_opetuskieli]
      ,ol.[jarjestys_koulutuksen_jarjestaja]
      ,ol.[jarjestys_sijaintikunta]
      ,ol.[jarjestys_koordinaatti_ita]
      ,ol.[jarjestys_koordinaatti_pohjois]
      ,ol.[jarjestys_postinumero]
      ,tietolahde_oppilaitos = ol.[tietolahde]

-- koulutuksen järjestäjä      
      --SELECT [id]
      ,kj.[koulutuksen_jarjestajakoodi]
      ,[koulutuksen_jarjestajan_korvaavakoodi] = NULL
      --,[alkaa]
      --,[paattyy]
      --,[viimeisin_tilv]
      
      ,[koulutuksen_jarjestaja] = kj.[koulutuksen_jarjestajaselite_FI]
      ,[koulutuksen_jarjestaja_SV] = kj.[koulutuksen_jarjestajaselite_SV]
      ,[koulutuksen_jarjestaja_EN] = kj.[koulutuksen_jarjestajaselite_EN]
      ,[koulutuksen_jarjestajan_omistajatyyppikoodi] = kj.[omistajatyyppikoodi]
      ,[koulutuksen_jarjestajan_omistajatyyppi] = kj.[omistajatyyppiselite_FI]
      ,[koulutuksen_jarjestajan_omistajatyyppi_SV] = kj.[omistajatyyppiselite_SV]
      ,[koulutuksen_jarjestajan_omistajatyyppi_EN] = kj.[omistajatyyppiselite_EN]
      ,[koulutuksen_jarjestajan_kielikoodi] = kj.[koulutuksen_jarjestajan_kielikoodi]
      ,[koulutuksen_jarjestajan_kieli] = kj.[koulutuksen_jarjestajan_kieliselite_FI]
      ,[koulutuksen_jarjestajan_kieli_SV] = kj.[koulutuksen_jarjestajan_kieliselite_SV]
      ,[koulutuksen_jarjestajan_kieli_EN] = kj.[koulutuksen_jarjestajan_kieliselite_EN]
      ,[koulutuksen_jarjestajan_ksijaintikuntakoodi] = kj.[sijaintikuntakoodi]
      ,[koulutuksen_jarjestajan_sijaintikunta] = kj.[sijaintikuntaselite_FI]
      ,[koulutuksen_jarjestajan_sijaintikunta_SV] = kj.[sijaintikuntaselite_SV]
      ,[koulutuksen_jarjestajan_sijaintikunta_EN] = kj.[sijaintikuntaselite_EN]
      --,[SCD_alkaa]
      --,[SCD_paattyy]
      ,[jarjestys_koulutuksenjarjestaja] = kj.[jarjestys]
      --,[jarjestys_omistajatyyppi] = ISNULL(kj_alkaa.[jarjestys_omistajatyyppi], kj_paattyy.[jarjestys_omistajatyyppi])
      ,[jarjestys_koulutuksen_jarjestajan_kieli] = kj.[jarjestys_koulutuksen_jarjestajan_kieli]
      ,[jarjestys_sijaintikunta_koulutuksenjarjestaja] = kj.[jarjestys_sijaintikunta]
      ,[tietolahde_koulutuksenjarjestaja] = kj.[tietolahde]
      ,[koulutuksen_jarjestajan_ainoa_oppilaitos] = CAST(Case 
			when 1 = (
				Select COUNT(*) from [VipunenTK_DW].[dbo].[d_oppilaitos] ol_lkm
				Where ol_lkm.koulutuksen_jarjestajakoodi = kj.koulutuksen_jarjestajakoodi
				and kj.alkaa between ol_lkm.alkaa and isnull(ol_lkm.paattyy,''9999-01-01'')
				and kj.koulutuksen_jarjestajakoodi IS not null
				and kj.koulutuksen_jarjestajakoodi not IN (''-1'', ''-2'') 
				--3.1.2014 Jarmo haku saa toimia vain amkien ja yliopistojen osalta
				and ol_lkm.oppilaitostyyppikoodi in (''41'', ''42'')
				)
		    then (
				Select top 1 ol_lkm.oppilaitoskoodi from [VipunenTK_DW].[dbo].[d_oppilaitos] ol_lkm
				Where ol_lkm.koulutuksen_jarjestajakoodi = kj.koulutuksen_jarjestajakoodi
				and kj.alkaa between ol_lkm.alkaa and isnull(ol_lkm.paattyy,''9999-01-01'') 
				and kj.koulutuksen_jarjestajakoodi IS not null
				and kj.koulutuksen_jarjestajakoodi not IN (''-1'', ''-2'') 
				--3.1.2014 Jarmo haku saa toimia vain amkien ja yliopistojen osalta
				and ol_lkm.oppilaitostyyppikoodi in (''41'', ''42'')
				)
			else NULL
			end
       as nvarchar(10))

      
FROM [VipunenTK_DW].[dbo].d_koulutuksen_jarjestaja kj
JOIN VipunenTK_lisatiedot.dbo.oppilaitos ol
	ON ol.id = -1
' 
GO
/****** Object:  View [dbo].[v_oppilaitostyyppi]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppilaitostyyppi]'))
EXEC dbo.sp_executesql @statement = N'

/*
truncate table VipunenTK.dbo.d_oppilaitostyyppi
insert into VipunenTK.dbo.d_oppilaitostyyppi
select * from VipunenTK_DW.dbo.v_oppilaitostyyppi
*/


CREATE VIEW [dbo].[v_oppilaitostyyppi] AS
SELECT
	id,
	luotu,
	oppilaitostyyppi_koodi,
	oppilaitostyyppi,
	oppilaitostyyppi_SV,
	oppilaitostyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_oppilaitostyyppi
UNION ALL
SELECT
	id,
	luotu,
	oppilaitostyyppi_koodi,
	oppilaitostyyppi,
	oppilaitostyyppi_SV,
	oppilaitostyyppi_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_oppilaitostyyppi
WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_oppisopimus_purkautunut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppisopimus_purkautunut]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_oppisopimus_purkautunut] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppisopimus_purkautunut_koodi,
	oppisopimus_purkautunut,
	oppisopimus_purkautunut_SV,
	oppisopimus_purkautunut_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_oppisopimus_purkautunut
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppisopimus_purkautunut_koodi,
	oppisopimus_purkautunut,
	oppisopimus_purkautunut_SV,
	oppisopimus_purkautunut_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_oppisopimus_purkautunut
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_oppisopimus_yrityksen_koko]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppisopimus_yrityksen_koko]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_oppisopimus_yrityksen_koko] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppisopimus_yrityksen_koko_koodi,
	oppisopimus_yrityksen_koko,
	oppisopimus_yrityksen_koko_SV,
	oppisopimus_yrityksen_koko_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_oppisopimus_yrityksen_koko
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppisopimus_yrityksen_koko_koodi,
	oppisopimus_yrityksen_koko,
	oppisopimus_yrityksen_koko_SV,
	oppisopimus_yrityksen_koko_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_oppisopimus_yrityksen_koko
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_oppisopimuskoulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppisopimuskoulutus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_oppisopimuskoulutus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppisopimuskoulutus_koodi,
	oppisopimuskoulutus,
	oppisopimuskoulutus_SV,
	oppisopimuskoulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_oppisopimuskoulutus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppisopimuskoulutus_koodi,
	oppisopimuskoulutus,
	oppisopimuskoulutus_SV,
	oppisopimuskoulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_oppisopimuskoulutus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_oppisopimuskoulutus_osallistuneet_ja_tutk_suorittaneet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_oppisopimuskoulutus_osallistuneet_ja_tutk_suorittaneet]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_oppisopimuskoulutus_osallistuneet_ja_tutk_suorittaneet] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppis_osallis_ja_tutk_suor_koodi,
	oppis_osallis_ja_tutk_suor,
	oppis_osallis_ja_tutk_suor_SV,
	oppis_osallis_ja_tutk_suor_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_oppisopimuskoulutus_osallistuneet_ja_tutk_suorittaneet
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	oppis_osallis_ja_tutk_suor_koodi,
	oppis_osallis_ja_tutk_suor,
	oppis_osallis_ja_tutk_suor_SV,
	oppis_osallis_ja_tutk_suor_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_oppisopimuskoulutus_osallistuneet_ja_tutk_suorittaneet
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_osatutkinto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_osatutkinto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_osatutkinto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	osatutkinto_koodi,
	osatutkinto,
	osatutkinto_SV,
	osatutkinto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_osatutkinto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	osatutkinto_koodi,
	osatutkinto,
	osatutkinto_SV,
	osatutkinto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_osatutkinto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_paaasiallinen_toiminta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_paaasiallinen_toiminta]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_paaasiallinen_toiminta] AS

SELECT [id]
      ,[alkaa]
      ,[paattyy]
      ,[paaasiallinen_toiminta_koodi]
      ,[paaasiallinen_toiminta]
      ,[paaasiallinen_toiminta_SV]
      ,[paaasiallinen_toiminta_EN]
      ,[jarjestys]
      ,[tietolahde]

  FROM [VipunenTK_DW].[dbo].[d_paaasiallinen_toiminta]
  where virhetilanne = ''E''
  
UNION ALL  

SELECT [id]
      ,[alkaa]
      ,[paattyy]
      ,[paaasiallinen_toiminta_koodi]
      ,[paaasiallinen_toiminta]
      ,[paaasiallinen_toiminta_SV]
      ,[paaasiallinen_toiminta_EN]
      ,[jarjestys]
      ,[tietolahde]

  FROM [VipunenTK_lisatiedot].[dbo].[v_paaasiallinen_toiminta]
  where virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_paaasiallinen_toiminta_ja_maasta_muuttaneet]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_paaasiallinen_toiminta_ja_maasta_muuttaneet]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_paaasiallinen_toiminta_ja_maasta_muuttaneet] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	paaasiallinen_toiminta_ja_maasta_muuttaneet_koodi,
	paaasiallinen_toiminta_ja_maasta_muuttaneet,
	paaasiallinen_toiminta_ja_maasta_muuttaneet_SV,
	paaasiallinen_toiminta_ja_maasta_muuttaneet_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_paaasiallinen_toiminta_ja_maasta_muuttaneet
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	paaasiallinen_toiminta_ja_maasta_muuttaneet_koodi,
	paaasiallinen_toiminta_ja_maasta_muuttaneet,
	paaasiallinen_toiminta_ja_maasta_muuttaneet_SV,
	paaasiallinen_toiminta_ja_maasta_muuttaneet_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_paaasiallinen_toiminta_ja_maasta_muuttaneet
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_paaasiallinen_toiminta_okm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_paaasiallinen_toiminta_okm]'))
EXEC dbo.sp_executesql @statement = N'
/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_paaasiallinen_toiminta_okm] AS

SELECT [id]
      ,[alkaa]
      ,[paattyy]
      ,[paaasiallinen_toiminta_okm_koodi]
      ,[paaasiallinen_toiminta_okm]
      ,[paaasiallinen_toiminta_okm_SV]
      ,[paaasiallinen_toiminta_okm_EN]
      ,[jarjestys]
      ,[tietolahde]

  FROM [VipunenTK_DW].[dbo].[d_paaasiallinen_toiminta_okm]
  where virhetilanne = ''E''
  
UNION ALL  

SELECT [id]
      ,[alkaa]
      ,[paattyy]
      ,[paaasiallinen_toiminta_okm_koodi]
      ,[paaasiallinen_toiminta_okm]
      ,[paaasiallinen_toiminta_okm_SV]
      ,[paaasiallinen_toiminta_okm_EN]
      ,[jarjestys]
      ,[tietolahde]

  FROM [VipunenTK_lisatiedot].[dbo].[v_paaasiallinen_toiminta_okm]
  where virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_paaasiallinen_toiminta_versio2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_paaasiallinen_toiminta_versio2]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_paaasiallinen_toiminta_versio2] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	paaasiallinen_toiminta_versio2_koodi,
	paaasiallinen_toiminta_versio2,
	paaasiallinen_toiminta_versio2_SV,
	paaasiallinen_toiminta_versio2_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_paaasiallinen_toiminta_versio2
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	paaasiallinen_toiminta_versio2_koodi,
	paaasiallinen_toiminta_versio2,
	paaasiallinen_toiminta_versio2_SV,
	paaasiallinen_toiminta_versio2_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_paaasiallinen_toiminta_versio2
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_paaasiallinen_toiminta_versio3]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_paaasiallinen_toiminta_versio3]'))
EXEC dbo.sp_executesql @statement = N'





CREATE VIEW [dbo].[v_paaasiallinen_toiminta_versio3] AS 
/*
Drop table VipunenTK.dbo.d_paaasiallinen_toiminta_versio3
Select * into VipunenTK.dbo.d_paaasiallinen_toiminta_versio3 from VipunenTK_DW.[dbo].[v_paaasiallinen_toiminta_versio3]
Alter table VipunenTK.dbo.d_paaasiallinen_toiminta_versio3 add primary key (Id)
Truncate table VipunenTK.dbo.d_paaasiallinen_toiminta_versio3
Insert into VipunenTK.dbo.d_paaasiallinen_toiminta_versio3
  Select * from VipunenTK_DW.[dbo].[v_paaasiallinen_toiminta_versio3]
*/
SELECT [id]
     -- ,[luotu]
      ,[paaasiallinen_toiminta_versio3_avain]
      ,[paaasiallinen_toiminta_versio3]
      ,[paaasiallinen_toiminta_versio3_SV]
      ,[paaasiallinen_toiminta_versio3_EN]
      ,[jarjestys_paaasiallinen_toiminta_versio3]
      ,[paaasiallinen_toiminta_versio3_TTHV]
      ,[paaasiallinen_toiminta_versio3_TTHV_SV]
      ,[paaasiallinen_toiminta_versio3_TTHV_EN]
      ,[jarjestys_paaasiallinen_toiminta_versio3_TTHV]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_paaasiallinen_toiminta_versio3]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[paaasiallinen_toiminta_versio3_avain]
      ,[paaasiallinen_toiminta_versio3]
      ,[paaasiallinen_toiminta_versio3_SV]
      ,[paaasiallinen_toiminta_versio3_EN]
      ,[jarjestys_paaasiallinen_toiminta_versio3]
      ,[paaasiallinen_toiminta_versio3_TTHV]
      ,[paaasiallinen_toiminta_versio3_TTHV_SV]
      ,[paaasiallinen_toiminta_versio3_TTHV_EN]
      ,[jarjestys_paaasiallinen_toiminta_versio3_TTHV]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[paaasiallinen_toiminta_versio3]
  WHERE virhetilanne=''K''






' 
GO
/****** Object:  View [dbo].[v_perusjoukko]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusjoukko]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusjoukko] AS

SELECT [id]
      --,[luotu]
      ,[perusjoukko_avain]
      ,[perusjoukko]
      ,[perusjoukko_SV]
      ,[perusjoukko_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusjoukko]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusjoukko_avain]
      ,[perusjoukko]
      ,[perusjoukko_SV]
      ,[perusjoukko_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusjoukko]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_perusjoukko_tyolliset]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusjoukko_tyolliset]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_perusjoukko_tyolliset] AS

SELECT [id]
      ,[perusjoukko_tyolliset_avain]
      ,[perusjoukko_tyolliset]
      ,[perusjoukko_tyolliset_SV]
      ,[perusjoukko_tyolliset_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_perusjoukko_tyolliset]
  
UNION ALL

SELECT [id]
      ,[perusjoukko_tyolliset_avain]
      ,[perusjoukko_tyolliset]
      ,[perusjoukko_tyolliset_SV]
      ,[perusjoukko_tyolliset_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[perusjoukko_tyolliset]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_ainevalinnat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_ainevalinnat]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_ainevalinnat] AS 
/*
truncate table VipunenTK.dbo.d_perusopetuksen_ainevalinnat
insert into VipunenTK.dbo.d_perusopetuksen_ainevalinnat
select * from [v_perusopetuksen_ainevalinnat]

drop table VipunenTK.dbo.d_perusopetuksen_ainevalinnat
select * into VipunenTK.dbo.d_perusopetuksen_ainevalinnat from [v_perusopetuksen_ainevalinnat]
*/

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[aineryhmä]
      ,[aineryhmä_SV]
      ,[aineryhmä_EN]
      ,[aine_koodi]
      ,[aine]
      ,[aine_SV]
      ,[aine_EN]
      ,[kielen_taso_koodi]
      ,[kielen_taso]
      ,[kielen_taso_SV]
      ,[kielen_taso_EN]
      ,[ainevalinta]
      ,[ainevalinta_SV]
      ,[ainevalinta_EN]
      ,[aineryhmä_jarjestys]
      ,[aine_jarjestys]
      ,[kielen_taso_jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_ainevalinnat]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[aineryhmä]
      ,[aineryhmä_SV]
      ,[aineryhmä_EN]
      ,[aine_koodi]
      ,[aine]
      ,[aine_SV]
      ,[aine_EN]
      ,[kielen_taso_koodi]
      ,[kielen_taso]
      ,[kielen_taso_SV]
      ,[kielen_taso_EN]
      ,[ainevalinta]
      ,[ainevalinta_SV]
      ,[ainevalinta_EN]
      ,[aineryhmä_jarjestys]
      ,[aine_jarjestys]
      ,[kielen_taso_jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[perusopetuksen_ainevalinnat]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_aloitusika]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_aloitusika]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_aloitusika] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_aloitusika
Select * into VipunenTK.dbo.d_perusopetuksen_aloitusika from VipunenTK_DW.dbo.v_perusopetuksen_aloitusika
Truncate table  VipunenTK.dbo.d_perusopetuksen_aloitusika
Insert into VipunenTK.dbo.d_perusopetuksen_aloitusika
Select * from VipunenTK_DW.dbo.v_perusopetuksen_aloitusika
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_aloitusika_koodi]
      ,[perusopetuksen_aloitusika]
      ,[perusopetuksen_aloitusika_SV]
      ,[perusopetuksen_aloitusika_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_aloitusika]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_aloitusika_koodi]
      ,[perusopetuksen_aloitusika]
      ,[perusopetuksen_aloitusika_SV]
      ,[perusopetuksen_aloitusika_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_aloitusika]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_erityisen_tuen_paatos]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_erityisen_tuen_paatos]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_erityisen_tuen_paatos] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos
Select * into VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos from VipunenTK_DW.dbo.v_perusopetuksen_erityisen_tuen_paatos
Truncate table  VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos
Insert into VipunenTK.dbo.d_perusopetuksen_erityisen_tuen_paatos
Select * from VipunenTK_DW.dbo.v_perusopetuksen_erityisen_tuen_paatos
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_erityisen_tuen_paatos_koodi]
      ,[perusopetuksen_erityisen_tuen_paatos]
      ,[perusopetuksen_erityisen_tuen_paatos_SV]
      ,[perusopetuksen_erityisen_tuen_paatos_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_erityisen_tuen_paatos]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_erityisen_tuen_paatos_koodi]
      ,[perusopetuksen_erityisen_tuen_paatos]
      ,[perusopetuksen_erityisen_tuen_paatos_SV]
      ,[perusopetuksen_erityisen_tuen_paatos_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_erityisen_tuen_paatos]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_kieltenmaara]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_kieltenmaara]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_kieltenmaara] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[kieltenmäärä_koodi]
      ,[kieltenmäärä]
      ,[kieltenmäärä_SV]
      ,[kieltenmäärä_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_kieltenmaara]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[kieltenmäärä_koodi]
      ,[kieltenmäärä]
      ,[kieltenmäärä_SV]
      ,[kieltenmäärä_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[perusopetuksen_kieltenmaara]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_kuljetusetuus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_kuljetusetuus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_kuljetusetuus] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_kuljetusetuus
Select * into VipunenTK.dbo.d_perusopetuksen_kuljetusetuus from VipunenTK_DW.dbo.v_perusopetuksen_kuljetusetuus
Truncate table  VipunenTK.dbo.d_perusopetuksen_kuljetusetuus
Insert into VipunenTK.dbo.d_perusopetuksen_kuljetusetuus
Select * from VipunenTK_DW.dbo.v_perusopetuksen_kuljetusetuus
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_kuljetusetuus_koodi]
      ,[perusopetuksen_kuljetusetuus]
      ,[perusopetuksen_kuljetusetuus_SV]
      ,[perusopetuksen_kuljetusetuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_kuljetusetuus]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_kuljetusetuus_koodi]
      ,[perusopetuksen_kuljetusetuus]
      ,[perusopetuksen_kuljetusetuus_SV]
      ,[perusopetuksen_kuljetusetuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_kuljetusetuus]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_majoitusetuus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_majoitusetuus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_majoitusetuus] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_majoitusetuus
Select * into VipunenTK.dbo.d_perusopetuksen_majoitusetuus from VipunenTK_DW.dbo.v_perusopetuksen_majoitusetuus
Truncate table  VipunenTK.dbo.d_perusopetuksen_majoitusetuus
Insert into VipunenTK.dbo.d_perusopetuksen_majoitusetuus
Select * from VipunenTK_DW.dbo.v_perusopetuksen_majoitusetuus
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_majoitusetuus_koodi]
      ,[perusopetuksen_majoitusetuus]
      ,[perusopetuksen_majoitusetuus_SV]
      ,[perusopetuksen_majoitusetuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_majoitusetuus]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_majoitusetuus_koodi]
      ,[perusopetuksen_majoitusetuus]
      ,[perusopetuksen_majoitusetuus_SV]
      ,[perusopetuksen_majoitusetuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_majoitusetuus]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_oppimaaran_yksilollistaminen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_oppimaaran_yksilollistaminen]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_oppimaaran_yksilollistaminen] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_oppimaaran_yksilollistaminen
Select * into VipunenTK.dbo.d_perusopetuksen_oppimaaran_yksilollistaminen from VipunenTK_DW.dbo.v_perusopetuksen_oppimaaran_yksilollistaminen
Truncate table  VipunenTK.dbo.d_perusopetuksen_oppimaaran_yksilollistaminen
Insert into VipunenTK.dbo.d_perusopetuksen_oppimaaran_yksilollistaminen
Select * from VipunenTK_DW.dbo.v_perusopetuksen_oppimaaran_yksilollistaminen
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_oppimaaran_yksilollistaminen_koodi]
      ,[perusopetuksen_oppimaaran_yksilollistaminen]
      ,[perusopetuksen_oppimaaran_yksilollistaminen_SV]
      ,[perusopetuksen_oppimaaran_yksilollistaminen_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_oppimaaran_yksilollistaminen]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_oppimaaran_yksilollistaminen_koodi]
      ,[perusopetuksen_oppimaaran_yksilollistaminen]
      ,[perusopetuksen_oppimaaran_yksilollistaminen_SV]
      ,[perusopetuksen_oppimaaran_yksilollistaminen_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_oppimaaran_yksilollistaminen]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_pidennetty_oppivelvollisuus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_pidennetty_oppivelvollisuus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_pidennetty_oppivelvollisuus] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus
Select * into VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus from VipunenTK_DW.dbo.v_perusopetuksen_pidennetty_oppivelvollisuus
Truncate table  VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus
Insert into VipunenTK.dbo.d_perusopetuksen_pidennetty_oppivelvollisuus
Select * from VipunenTK_DW.dbo.v_perusopetuksen_pidennetty_oppivelvollisuus
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_pidennetty_oppivelvollisuus_koodi]
      ,[perusopetuksen_pidennetty_oppivelvollisuus]
      ,[perusopetuksen_pidennetty_oppivelvollisuus_SV]
      ,[perusopetuksen_pidennetty_oppivelvollisuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_pidennetty_oppivelvollisuus]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_pidennetty_oppivelvollisuus_koodi]
      ,[perusopetuksen_pidennetty_oppivelvollisuus]
      ,[perusopetuksen_pidennetty_oppivelvollisuus_SV]
      ,[perusopetuksen_pidennetty_oppivelvollisuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_pidennetty_oppivelvollisuus]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_tehostettu_tuki]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_tehostettu_tuki]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_perusopetuksen_tehostettu_tuki] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki
Select * into VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki from VipunenTK_DW.dbo.v_perusopetuksen_tehostettu_tuki
Truncate table  VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki
Insert into VipunenTK.dbo.d_perusopetuksen_tehostettu_tuki
Select * from VipunenTK_DW.dbo.v_perusopetuksen_tehostettu_tuki
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_tehostettu_tuki_koodi]
      ,[perusopetuksen_tehostettu_tuki]
      ,[perusopetuksen_tehostettu_tuki_SV]
      ,[perusopetuksen_tehostettu_tuki_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_tehostettu_tuki]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_tehostettu_tuki_koodi]
      ,[perusopetuksen_tehostettu_tuki]
      ,[perusopetuksen_tehostettu_tuki_SV]
      ,[perusopetuksen_tehostettu_tuki_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_tehostettu_tuki]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_tukimuoto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_tukimuoto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_tukimuoto] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_tukimuoto
Select * into VipunenTK.dbo.d_perusopetuksen_tukimuoto from VipunenTK_DW.dbo.v_perusopetuksen_tukimuoto
Truncate table  VipunenTK.dbo.d_perusopetuksen_tukimuoto
Insert into VipunenTK.dbo.d_perusopetuksen_tukimuoto
Select * from VipunenTK_DW.dbo.v_perusopetuksen_tukimuoto
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_tukimuoto_koodi]
      ,[perusopetuksen_tukimuoto]
      ,[perusopetuksen_tukimuoto_SV]
      ,[perusopetuksen_tukimuoto_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_tukimuoto]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_tukimuoto_koodi]
      ,[perusopetuksen_tukimuoto]
      ,[perusopetuksen_tukimuoto_SV]
      ,[perusopetuksen_tukimuoto_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_tukimuoto]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_vuosiluokat]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_vuosiluokat]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_perusopetuksen_vuosiluokat] AS 
/*
Truncate table VipunenTK.dbo.d_perusopetuksen_vuosiluokat
Insert into VipunenTK.dbo.d_perusopetuksen_vuosiluokat select * from v_perusopetuksen_vuosiluokat
*/
SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[vuosiluokka_koodi]
      ,[vuosiluokka]
      ,[vuosiluokka_SV]
      ,[vuosiluokka_EN]
      ,[luokkajako_12_36_7_89]
      ,[luokkajako_12_36_7_89_SV]
      ,[luokkajako_12_36_7_89_EN]
      ,[luokkajako_16_79]
      ,[luokkajako_16_79_SV]
      ,[luokkajako_16_79_EN]
      ,[luokkajako_16_710]
      ,[luokkajako_16_710_SV]
      ,[luokkajako_16_710_EN]
      ,[jarjestys]
      ,[luokkajako_12_36_7_89_jarjestys]
      ,[luokkajako_16_79_jarjestys]
      ,[luokkajako_16_710_jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
	  ,[luokkajako_0_19_10]
	  ,[luokkajako_0_19_10_SV]
	  ,[luokkajako_0_19_10_EN]
	  ,[luokkajako_0_19_10_jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_vuosiluokat]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[vuosiluokka_koodi]
      ,[vuosiluokka]
      ,[vuosiluokka_SV]
      ,[vuosiluokka_EN]
      ,[luokkajako_12_36_7_89]
      ,[luokkajako_12_36_7_89_SV]
      ,[luokkajako_12_36_7_89_EN]
      ,[luokkajako_16_79]
      ,[luokkajako_16_79_SV]
      ,[luokkajako_16_79_EN]
      ,[luokkajako_16_710]
      ,[luokkajako_16_710_SV]
      ,[luokkajako_16_710_EN]
      ,[jarjestys]
      ,[luokkajako_12_36_7_89_jarjestys]
      ,[luokkajako_16_79_jarjestys]
      ,[luokkajako_16_710_jarjestys]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
	  ,[luokkajako_0_19_10]
	  ,[luokkajako_0_19_10_SV]
	  ,[luokkajako_0_19_10_EN]
	  ,[luokkajako_0_19_10_jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[perusopetuksen_vuosiluokat]
  
WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_perusopetuksen_yleisopetuksen_osuus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_perusopetuksen_yleisopetuksen_osuus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_perusopetuksen_yleisopetuksen_osuus] AS
/*
Drop table VipunenTK.dbo.d_perusopetuksen_yleisopetuksen_osuus
Select * into VipunenTK.dbo.d_perusopetuksen_yleisopetuksen_osuus from VipunenTK_DW.dbo.v_perusopetuksen_yleisopetuksen_osuus
Truncate table  VipunenTK.dbo.d_perusopetuksen_yleisopetuksen_osuus
Insert into VipunenTK.dbo.d_perusopetuksen_yleisopetuksen_osuus
Select * from VipunenTK_DW.dbo.v_perusopetuksen_yleisopetuksen_osuus
*/

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_yleisopetuksen_osuus_koodi]
      ,[perusopetuksen_yleisopetuksen_osuus]
      ,[perusopetuksen_yleisopetuksen_osuus_SV]
      ,[perusopetuksen_yleisopetuksen_osuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_perusopetuksen_yleisopetuksen_osuus]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[perusopetuksen_yleisopetuksen_osuus_koodi]
      ,[perusopetuksen_yleisopetuksen_osuus]
      ,[perusopetuksen_yleisopetuksen_osuus_SV]
      ,[perusopetuksen_yleisopetuksen_osuus_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_perusopetuksen_yleisopetuksen_osuus]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_pohjakoulutuksen_tila]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_pohjakoulutuksen_tila]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_pohjakoulutuksen_tila] AS 

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[pohjakoulutuksen_tila_koodi]
      ,[pohjakoulutuksen_tila]
      ,[pohjakoulutuksen_tila_SV]
      ,[pohjakoulutuksen_tila_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_pohjakoulutuksen_tila]

UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[pohjakoulutuksen_tila_koodi]
      ,[pohjakoulutuksen_tila]
      ,[pohjakoulutuksen_tila_SV]
      ,[pohjakoulutuksen_tila_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[pohjakoulutuksen_tila]

WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_pohjoismaa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_pohjoismaa]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_pohjoismaa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	pohjoismaa_koodi,
	pohjoismaa,
	pohjoismaa_SV,
	pohjoismaa_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_pohjoismaa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	pohjoismaa_koodi,
	pohjoismaa,
	pohjoismaa_SV,
	pohjoismaa_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_pohjoismaa
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_rahoituslahde]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_rahoituslahde]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_rahoituslahde] AS
/*
Drop table VipunenTK.dbo.d_rahoituslahde
Select * into VipunenTK.dbo.d_rahoituslahde from VipunenTK_DW.dbo.v_rahoituslahde
Truncate table  VipunenTK.dbo.d_rahoituslahde
Insert into VipunenTK.dbo.d_rahoituslahde
Select * from VipunenTK_DW.dbo.v_rahoituslahde
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[rahoituslahde_koodi]
      ,[rahoituslahde]
      ,[rahoituslahde_SV]
      ,[rahoituslahde_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_rahoituslahde]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[rahoituslahde_koodi]
      ,[rahoituslahde]
      ,[rahoituslahde_SV]
      ,[rahoituslahde_EN]
      ,[jarjestys]
      --,[virhetilanne]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_rahoituslahde]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_rahoituslahde_amm]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_rahoituslahde_amm]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_rahoituslahde_amm] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	rahoituslahde_amm_koodi,
	rahoituslahde_amm,
	rahoituslahde_amm_SV,
	rahoituslahde_amm_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_rahoituslahde_amm
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	rahoituslahde_amm_koodi,
	rahoituslahde_amm,
	rahoituslahde_amm_SV,
	rahoituslahde_amm_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_rahoituslahde_amm
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_sama_koulutusala]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_sama_koulutusala]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_sama_koulutusala] AS
/*
Drop table VipunenTK.dbo.d_sama_koulutusala
Select * into VipunenTK.dbo.d_sama_koulutusala from VipunenTK_DW.dbo.v_sama_koulutusala
Truncate table  VipunenTK.dbo.d_sama_koulutusala
Insert into VipunenTK.dbo.d_sama_koulutusala
Select * from VipunenTK_DW.dbo.v_sama_koulutusala
*/

SELECT [id]
      --,[luotu]
      ,[sama_koulutusala_avain]
      ,[sama_koulutusala]
      ,[sama_koulutusala_SV]
      ,[sama_koulutusala_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_sama_koulutusala]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[sama_koulutusala_avain]
      ,[sama_koulutusala]
      ,[sama_koulutusala_SV]
      ,[sama_koulutusala_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_sama_koulutusala]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_sarakeleveys]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_sarakeleveys]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_sarakeleveys]
AS
SELECT        sarakeleveys, leveys
FROM            dbo.sarakeleveys
' 
GO
/****** Object:  View [dbo].[v_sektoritutkimuslaitos]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_sektoritutkimuslaitos]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_sektoritutkimuslaitos] AS 

/*
truncate table VipunenTK.dbo.d_sektoritutkimuslaitos
insert into VipunenTK.dbo.d_sektoritutkimuslaitos
select * from [VipunenTK_DW].dbo.[v_sektoritutkimuslaitos]

drop table VipunenTK.dbo.d_sektoritutkimuslaitos
select * into VipunenTK.dbo.d_sektoritutkimuslaitos from [VipunenTK_DW].dbo.[v_sektoritutkimuslaitos]
*/

SELECT [id]
      ,[luotu]
      ,[sektoritutkimuslaitos_avain]
      ,[sektoritutkimuslaitos_lyhenne]
      ,[sektoritutkimuslaitos]
      ,[sektoritutkimuslaitos_SV]
      ,[sektoritutkimuslaitos_EN]
      ,[jarjestys_sektoritutkimuslaitos]
      ,[sektoritutkimuslaitos_lyhenne_historia]
      ,[sektoritutkimuslaitos_historia]
      ,[sektoritutkimuslaitos_historia_SV]
      ,[sektoritutkimuslaitos_historia_EN]
      ,[jarjestys_sektoritutkimuslaitos_historia]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_sektoritutkimuslaitos]

UNION ALL 

SELECT [id]
      ,[luotu]
      ,[sektoritutkimuslaitos_avain]
      ,[sektoritutkimuslaitos_lyhenne]
      ,[sektoritutkimuslaitos]
      ,[sektoritutkimuslaitos_SV]
      ,[sektoritutkimuslaitos_EN]
      ,[jarjestys_sektoritutkimuslaitos]
      ,[sektoritutkimuslaitos_lyhenne_historia]
      ,[sektoritutkimuslaitos_historia]
      ,[sektoritutkimuslaitos_historia_SV]
      ,[sektoritutkimuslaitos_historia_EN]
      ,[jarjestys_sektoritutkimuslaitos_historia]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[sektoritutkimuslaitos]

WHERE virhetilanne = ''K''



' 
GO
/****** Object:  View [dbo].[v_siirtyman_tarkastelusuunta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_siirtyman_tarkastelusuunta]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_siirtyman_tarkastelusuunta] AS

SELECT [id]
      ,[siirtyman_tarkastelusuunta_avain]
      ,[siirtyman_tarkastelusuunta]
      ,[siirtyman_tarkastelusuunta_SV]
      ,[siirtyman_tarkastelusuunta_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_siirtyman_tarkastelusuunta]
  
UNION ALL

SELECT [id]
      ,[siirtyman_tarkastelusuunta_avain]
      ,[siirtyman_tarkastelusuunta]
      ,[siirtyman_tarkastelusuunta_SV]
      ,[siirtyman_tarkastelusuunta_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[siirtyman_tarkastelusuunta]  
 
 WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_sosioekonominen_asema]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_sosioekonominen_asema]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_sosioekonominen_asema] AS 
/*
Select * into VipunenTK.dbo.d_sosioekonominen_asema from VipunenTK_DW.[dbo].[v_sosioekonominen_asema]
Truncate table VipunenTK.dbo.d_sosioekonominen_asema
Insert into VipunenTK.dbo.d_sosioekonominen_asema
  Select * from VipunenTK_DW.[dbo].[v_sosioekonominen_asema]
*/
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[sosioekonominen_asema_koodi]
      ,[sosioekonominen_asema_ryhma]
      ,[sosioekonominen_asema_ryhma_SV]
      ,[sosioekonominen_asema_ryhma_EN]
      ,[sosioekonominen_asema]
      ,[sosioekonominen_asema_SV]
      ,[sosioekonominen_asema_EN]
      ,[jarjestys_ryhma]
      ,[jarjestys_asema]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_sosioekonominen_asema]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[sosioekonominen_asema_koodi]
      ,[sosioekonominen_asema_ryhma]
      ,[sosioekonominen_asema_ryhma_SV]
      ,[sosioekonominen_asema_ryhma_EN]
      ,[sosioekonominen_asema]
      ,[sosioekonominen_asema_SV]
      ,[sosioekonominen_asema_EN]
      ,[jarjestys_ryhma]
      ,[jarjestys_asema]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[sosioekonominen_asema]
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_suhteellinen_ajankohta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_suhteellinen_ajankohta]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_suhteellinen_ajankohta] AS
/*
Drop table VipunenTK.dbo.d_suhteellinen_ajankohta
Select * into VipunenTK.dbo.d_suhteellinen_ajankohta from VipunenTK_DW.dbo.v_suhteellinen_ajankohta
Truncate table  VipunenTK.dbo.d_suhteellinen_ajankohta
Insert into VipunenTK.dbo.d_suhteellinen_ajankohta
Select * from VipunenTK_DW.dbo.v_suhteellinen_ajankohta
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[suhteellinen_ajankohta_avain]
      ,[suhteellinen_ajankohta]
      ,[suhteellinen_ajankohta_SV]
      ,[suhteellinen_ajankohta_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_suhteellinen_ajankohta]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[suhteellinen_ajankohta_avain]
      ,[suhteellinen_ajankohta]
      ,[suhteellinen_ajankohta_SV]
      ,[suhteellinen_ajankohta_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_suhteellinen_ajankohta]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_sukupuoli]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_sukupuoli]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_sukupuoli] AS
SELECT
	id,
	--luotu,
	alkaa,
	paattyy,
	sukupuoli_koodi,
	sukupuoli,
	sukupuoli_SV,
	sukupuoli_EN,
	jarjestys
	--virhetilanne,
	--poistettu,
	--tietolahde,
	--kommentti
FROM dbo.d_sukupuoli
UNION ALL
SELECT
	id,
	--luotu,
	alkaa,
	paattyy,
	sukupuoli_koodi,
	sukupuoli,
	sukupuoli_SV,
	sukupuoli_EN,
	jarjestys
	--virhetilanne,
	--poistettu,
	--tietolahde,
	--kommentti
FROM VipunenTK_lisatiedot..v_sukupuoli
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_suoritettu_tutkinto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_suoritettu_tutkinto]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_suoritettu_tutkinto] AS

SELECT [id]
      --,[luotu]
      ,[suoritettu_tutkinto_koodi]
      ,[suoritettu_tutkinto]
      ,[suoritettu_tutkinto_SV]
      ,[suoritettu_tutkinto_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolähde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_suoritettu_tutkinto]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[suoritettu_tutkinto_koodi]
      ,[suoritettu_tutkinto]
      ,[suoritettu_tutkinto_SV]
      ,[suoritettu_tutkinto_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolähde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[suoritettu_tutkinto]
  WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_suorlk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_suorlk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_suorlk] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[suorlk_koodi]
      ,[koodinselite]
      ,[koodinselite_SV]
      ,[koodinselite_EN]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_suorlk]
  
UNION ALL 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[suorlk_koodi]
      ,[koodinselite]
      ,[koodinselite_SV]
      ,[koodinselite_EN]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[suorlk]
  
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_suuntautumisvaihtoehto_amk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_suuntautumisvaihtoehto_amk]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[v_suuntautumisvaihtoehto_amk] as
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	suuntautumisvaihtoehto_amk_koodi,
	suuntautumisvaihtoehto_amk,
	suuntautumisvaihtoehto_amk_SV,
	suuntautumisvaihtoehto_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_suuntautumisvaihtoehto_amk
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	suuntautumisvaihtoehto_amk_koodi,
	suuntautumisvaihtoehto_amk,
	suuntautumisvaihtoehto_amk_SV,
	suuntautumisvaihtoehto_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..suuntautumisvaihtoehto_amk
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_tarkastelujakso]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tarkastelujakso]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tarkastelujakso] AS

-- delete from VipunenTK.dbo.d_tarkastelujakso
-- Insert into VipunenTK.dbo.d_tarkastelujakso Select * from VipunenTK_DW.dbo.v_tarkastelujakso
-- Select * into VipunenTK.dbo.d_tarkastelujakso from VipunenTK_DW.dbo.v_tarkastelujakso
--
-- Select * from VipunenTK_DW.dbo.v_tarkastelujakso

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tarkastelujakso_koodi]
      ,[tarkastelujakso]
      ,[tarkastelujakso_SV]
      ,[tarkastelujakso_EN]
      ,[jaksovuosi] 
      ,[jaksokausi]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
      ,[sijoittuminen 0_5 - 5_0 vuotta]
      ,[sijoittuminen 1_0 - 5_5 vuotta]
  FROM [VipunenTK_DW].[dbo].[d_tarkastelujakso]

UNION ALL

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tarkastelujakso_koodi]
      ,[tarkastelujakso]
      ,[tarkastelujakso_SV]
      ,[tarkastelujakso_EN]
      ,[jaksovuosi] 
      ,[jaksokausi]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
      ,[sijoittuminen 0_5 - 5_0 vuotta]
      ,[sijoittuminen 1_0 - 5_5 vuotta]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tarkastelujakso]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_tiedekunta_yo]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tiedekunta_yo]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tiedekunta_yo] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tiedekunta_yo_koodi,
	tiedekunta_yo,
	tiedekunta_yo_SV,
	tiedekunta_yo_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tiedekunta_yo
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tiedekunta_yo_koodi,
	tiedekunta_yo,
	tiedekunta_yo_SV,
	tiedekunta_yo_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tiedekunta_yo
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tieteenala]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tieteenala]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tieteenala] AS
/*
Drop table VipunenTK.dbo.d_tieteenala
Select * into VipunenTK.dbo.d_tieteenala from VipunenTK_DW.dbo.v_tieteenala
Truncate table  VipunenTK.dbo.d_tieteenala
Insert into VipunenTK.dbo.d_tieteenala
Select * from VipunenTK_DW.dbo.v_tieteenala
*/

SELECT [id]
      --,[luotu]
      ,[tieteenala_avain]
      ,[tieteenala2007]
      ,[tieteenala2007_SV]
      ,[tieteenala2007_EN]
      ,[jarjestys_tieteenala2007]
      ,[tieteenala2010]
      ,[tieteenala2010_SV]
      ,[tieteenala2010_EN]
      ,[jarjestys_tieteenala2010]
      ,[paatieteenala2007]
      ,[paatieteenala2007_SV]
      ,[paatieteenala2007_EN]
      ,[jarjestys_paatieteenala2007]
      ,[paatieteenala2010]
      ,[paatieteenala2010_SV]
      ,[paatieteenala2010_EN]
      ,[jarjestys_paatieteenala2010]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tieteenala]
  
UNION ALL

SELECT [id]
      --,[luotu]
       ,[tieteenala_avain]
      ,[tieteenala2007]
      ,[tieteenala2007_SV]
      ,[tieteenala2007_EN]
      ,[jarjestys_tieteenala2007]
      ,[tieteenala2010]
      ,[tieteenala2010_SV]
      ,[tieteenala2010_EN]
      ,[jarjestys_tieteenala2010]
      ,[paatieteenala2007]
      ,[paatieteenala2007_SV]
      ,[paatieteenala2007_EN]
      ,[jarjestys_paatieteenala2007]
      ,[paatieteenala2010]
      ,[paatieteenala2010_SV]
      ,[paatieteenala2010_EN]
      ,[jarjestys_paatieteenala2010]
     --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tieteenala]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_tietojen_ajankohta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tietojen_ajankohta]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tietojen_ajankohta] AS
(
SELECT [id]
      ,[alkaa]
      ,[paattyy]
      ,[tietojen_ajankohta_koodi]
      ,[tietojen_ajankohta]
      ,[tietojen_ajankohta_SV]
      ,[tietojen_ajankohta_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_tietojen_ajankohta]

UNION ALL

SELECT [id]
      ,[alkaa]
      ,[paattyy]
      ,[tietojen_ajankohta_koodi]
      ,[tietojen_ajankohta]
      ,[tietojen_ajankohta_SV]
      ,[tietojen_ajankohta_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tietojen_ajankohta]
  WHERE virhetilanne = ''K''
)
' 
GO
/****** Object:  View [dbo].[v_tilauskoulutuksen_sijaintimaa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tilauskoulutuksen_sijaintimaa]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tilauskoulutuksen_sijaintimaa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tilauskoulutuksen_sijaintimaa_koodi,
	tilauskoulutuksen_sijaintimaa,
	tilauskoulutuksen_sijaintimaa_SV,
	tilauskoulutuksen_sijaintimaa_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tilauskoulutuksen_sijaintimaa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tilauskoulutuksen_sijaintimaa_koodi,
	tilauskoulutuksen_sijaintimaa,
	tilauskoulutuksen_sijaintimaa_SV,
	tilauskoulutuksen_sijaintimaa_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tilauskoulutuksen_sijaintimaa
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_todistus_oppisopimuskoulutuksen_suorittamisesta]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_todistus_oppisopimuskoulutuksen_suorittamisesta]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_todistus_oppisopimuskoulutuksen_suorittamisesta] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	todistus_oppisopimuskoulutuksen_suorittamisesta_koodi,
	todistus_oppisopimuskoulutuksen_suorittamisesta,
	todistus_oppisopimuskoulutuksen_suorittamisesta_SV,
	todistus_oppisopimuskoulutuksen_suorittamisesta_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_todistus_oppisopimuskoulutuksen_suorittamisesta
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	todistus_oppisopimuskoulutuksen_suorittamisesta_koodi,
	todistus_oppisopimuskoulutuksen_suorittamisesta,
	todistus_oppisopimuskoulutuksen_suorittamisesta_SV,
	todistus_oppisopimuskoulutuksen_suorittamisesta_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_todistus_oppisopimuskoulutuksen_suorittamisesta
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_toimiala_2008]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_toimiala_2008]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[v_toimiala_2008] as
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	toimiala_2008_avain,
	toimiala_2008_koodi,
	toimiala_2008,
	toimiala_2008_SV,
	toimiala_2008_EN,
	taso,
	taso1,
	jarjestys,
	jarjestys_taso,
	jarjestys_taso1,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_toimiala_2008
UNION
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	toimiala_2008_avain,
	toimiala_2008_koodi,
	toimiala_2008,
	toimiala_2008_SV,
	toimiala_2008_EN,
	taso,
	taso1,
	jarjestys,
	jarjestys_taso,
	jarjestys_taso1,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..toimiala_2008
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_toimiala_tk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_toimiala_tk]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_toimiala_tk] AS 
/*
Drop table VipunenTK.dbo.d_toimiala_tk
Select * into VipunenTK.dbo.d_toimiala_tk from VipunenTK_DW.[dbo].[v_toimiala_tk]
Truncate table VipunenTK.dbo.d_toimiala_tk
Insert into VipunenTK.dbo.d_toimiala_tk
  Select * from VipunenTK_DW.[dbo].[v_toimiala_tk]
*/
SELECT [id]
     -- ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tol2008]
      ,[toimiala1]
      ,[toimiala1_SV]
      ,[toimiala1_EN]
      ,[toimiala2_koodi]
      ,[toimiala2]
      ,[toimiala2_SV]
      ,[toimiala2_EN]
      ,[toimiala3_koodi]
      ,[toimiala3]
      ,[toimiala3_SV]
      ,[toimiala3_EN]
      ,[toimiala4_koodi]
      ,[toimiala4]
      ,[toimiala4_SV]
      ,[toimiala4_EN]
      ,[toimiala5_koodi]
      ,[toimiala5]
      ,[toimiala5_SV]
      ,[toimiala5_EN]
      ,[toimiala6_koodi]
      ,[toimiala6]
      ,[toimiala6_SV]
      ,[toimiala6_EN]
      ,[jarjestys_toimiala1]
      ,[jarjestys_toimiala2]
      ,[jarjestys_toimiala3]
      ,[jarjestys_toimiala4]
      ,[jarjestys_toimiala5]
      ,[jarjestys_toimiala6]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_toimiala_tk]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tol2008]
      ,[toimiala1]
      ,[toimiala1_SV]
      ,[toimiala1_EN]
      ,[toimiala2_koodi]
      ,[toimiala2]
      ,[toimiala2_SV]
      ,[toimiala2_EN]
      ,[toimiala3_koodi]
      ,[toimiala3]
      ,[toimiala3_SV]
      ,[toimiala3_EN]
      ,[toimiala4_koodi]
      ,[toimiala4]
      ,[toimiala4_SV]
      ,[toimiala4_EN]
      ,[toimiala5_koodi]
      ,[toimiala5]
      ,[toimiala5_SV]
      ,[toimiala5_EN]
      ,[toimiala6_koodi]
      ,[toimiala6]
      ,[toimiala6_SV]
      ,[toimiala6_EN]
      ,[jarjestys_toimiala1]
      ,[jarjestys_toimiala2]
      ,[jarjestys_toimiala3]
      ,[jarjestys_toimiala4]
      ,[jarjestys_toimiala5]
      ,[jarjestys_toimiala6]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[toimiala_tk]
  WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_toimiala_tthv]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_toimiala_tthv]'))
EXEC dbo.sp_executesql @statement = N'




CREATE VIEW [dbo].[v_toimiala_tthv] AS 
/*
Drop table VipunenTK.dbo.d_toimiala_tthv
Select * into VipunenTK.dbo.d_toimiala_tthv from VipunenTK_DW.[dbo].[v_toimiala_tthv]
Alter table VipunenTK.dbo.d_toimiala_tthv add primary key (Id)
Trucate table VipunenTK.dbo.d_toimiala_tthv
Insert into VipunenTK.dbo.d_toimiala_tthv
  Select * from VipunenTK_DW.[dbo].[v_toimiala_tthv]
*/
SELECT [id]
     -- ,[luotu]
      ,[toimiala_tthv_avain]
      ,[toimiala_tthv]
      ,[toimiala_tthv_SV]
      ,[toimiala_tthv_EN]
      ,[toimiala_ja_tol_tthv]
      ,[toimiala_ja_tol_tthv_SV]
      ,[toimiala_ja_tol_tthv_EN]
      ,[jarjestys_toimiala_tthv]
      ,[paatoimiala_tthv]
      ,[paatoimiala_tthv_SV]
      ,[paatoimiala_tthv_EN]
      ,[jarjestys_paatoimiala_tthv]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_toimiala_tthv]
UNION ALL
SELECT [id]
      --,[luotu]
      ,[toimiala_tthv_avain]
      ,[toimiala_tthv]
      ,[toimiala_tthv_SV]
      ,[toimiala_tthv_EN]
      ,[toimiala_ja_tol_tthv]
      ,[toimiala_ja_tol_tthv_SV]
      ,[toimiala_ja_tol_tthv_EN]
      ,[jarjestys_toimiala_tthv]
      ,[paatoimiala_tthv]
      ,[paatoimiala_tthv_SV]
      ,[paatoimiala_tthv_EN]
      ,[jarjestys_paatoimiala_tthv]
      --,[virhetilanne]
      --,[poistettu]
      --,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[toimiala_tthv]
  WHERE virhetilanne=''K''





' 
GO
/****** Object:  View [dbo].[v_toimiala_tthv1_sama_kuin_ed_vuonna]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_toimiala_tthv1_sama_kuin_ed_vuonna]'))
EXEC dbo.sp_executesql @statement = N'

/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_toimiala_tthv1_sama_kuin_ed_vuonna] AS

SELECT [id]

      ,[toimiala_tthv1_sama_kuin_ed_vuonna_koodi]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna_SV]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_toimiala_tthv1_sama_kuin_ed_vuonna]

UNION ALL

SELECT [id]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna_koodi]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna_SV]
      ,[toimiala_tthv1_sama_kuin_ed_vuonna_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[v_toimiala_tthv1_sama_kuin_ed_vuonna]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_toimiala_tthv2_sama_kuin_ed_vuonna]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_toimiala_tthv2_sama_kuin_ed_vuonna]'))
EXEC dbo.sp_executesql @statement = N'

/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_toimiala_tthv2_sama_kuin_ed_vuonna] AS

SELECT [id]

      ,[toimiala_tthv2_sama_kuin_ed_vuonna_koodi]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna_SV]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_toimiala_tthv2_sama_kuin_ed_vuonna]

UNION ALL

SELECT [id]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna_koodi]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna_SV]
      ,[toimiala_tthv2_sama_kuin_ed_vuonna_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[v_toimiala_tthv2_sama_kuin_ed_vuonna]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_tulodesiili]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tulodesiili]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tulodesiili] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tulodesiili_koodi]
      ,[tulodesiili]
      ,[tulodesiili_SV]
      ,[tulodesiili_EN]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tulodesiili]

UNION ALL

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tulodesiili_koodi]
      ,[tulodesiili]
      ,[tulodesiili_SV]
      ,[tulodesiili_EN]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[tulodesiili]
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_tutkimuksen_rahoituslahde]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkimuksen_rahoituslahde]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[v_tutkimuksen_rahoituslahde] AS
/*
Drop table VipunenTK.dbo.d_tutkimuksen_rahoituslahde
Select * into VipunenTK.dbo.d_tutkimuksen_rahoituslahde from VipunenTK_DW.dbo.v_tutkimuksen_rahoituslahde
Truncate table  VipunenTK.dbo.d_tutkimuksen_rahoituslahde
Insert into VipunenTK.dbo.d_tutkimuksen_rahoituslahde
Select * from VipunenTK_DW.dbo.v_tutkimuksen_rahoituslahde
*/

SELECT [id]
      --,[luotu]
      ,[rahoituslahde_avain]
      ,[rahoituslahdetarkennus]
      ,[rahoituslahdetarkennus_SV]
      ,[rahoituslahdetarkennus_EN]
      ,[jarjestys_rahoituslahdetarkennus]
      ,[rahoituslahde]
      ,[rahoituslahde_SV]
      ,[rahoituslahde_EN]
      ,[jarjestys_rahoituslahde]
      ,[ulkopuolisen_rahoituksen_kansainvalisyys]
      ,[ulkopuolisen_rahoituksen_kansainvalisyys_SV]
      ,[ulkopuolisen_rahoituksen_kansainvalisyys_EN]
      ,[jarjestys_ulkopuolisen_rahoituksen_kansainvalisyys]
      ,[rahoituslahteen_tyyppi]
      ,[rahoituslahteen_tyyppi_SV]
      ,[rahoituslahteen_tyyppi_EN]
      ,[jarjestys_rahoituslahteen_tyyppi]
      ,[rahoituksen_laatu]
      ,[rahoituksen_laatu_SV]
      ,[rahoituksen_laatu_EN]
      ,[jarjestys_rahoituksen_laatu]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkimuksen_rahoituslahde]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[rahoituslahde_avain]
      ,[rahoituslahdetarkennus]
      ,[rahoituslahdetarkennus_SV]
      ,[rahoituslahdetarkennus_EN]
      ,[jarjestys_rahoituslahdetarkennus]
      ,[rahoituslahde]
      ,[rahoituslahde_SV]
      ,[rahoituslahde_EN]
      ,[jarjestys_rahoituslahde]
      ,[ulkopuolisen_rahoituksen_kansainvalisyys]
      ,[ulkopuolisen_rahoituksen_kansainvalisyys_SV]
      ,[ulkopuolisen_rahoituksen_kansainvalisyys_EN]
      ,[jarjestys_ulkopuolisen_rahoituksen_kansainvalisyys]
      ,[rahoituslahteen_tyyppi]
      ,[rahoituslahteen_tyyppi_SV]
      ,[rahoituslahteen_tyyppi_EN]
      ,[jarjestys_rahoituslahteen_tyyppi]
      ,[rahoituksen_laatu]
      ,[rahoituksen_laatu_SV]
      ,[rahoituksen_laatu_EN]
      ,[jarjestys_rahoituksen_laatu]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkimuksen_rahoituslahde]
  WHERE virhetilanne = ''K''



' 
GO
/****** Object:  View [dbo].[v_tutkimus_tehtava]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkimus_tehtava]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_tutkimus_tehtava] AS
/*
Drop table VipunenTK.dbo.d_tutkimus_tehtava
Select * into VipunenTK.dbo.d_tutkimus_tehtava from VipunenTK_DW.dbo.v_tutkimus_tehtava
Truncate table  VipunenTK.dbo.d_tutkimus_tehtava
Insert into VipunenTK.dbo.d_tutkimus_tehtava
Select * from VipunenTK_DW.dbo.v_tutkimus_tehtava
*/

SELECT [id]
      --,[luotu]
      ,[tutkimus_tehtava_avain]
      ,[tutkimus_tehtava]
      ,[tutkimus_tehtava_SV]
      ,[tutkimus_tehtava_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkimus_tehtava]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[tutkimus_tehtava_avain]
      ,[tutkimus_tehtava]
      ,[tutkimus_tehtava_SV]
      ,[tutkimus_tehtava_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkimus_tehtava]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_tutkimusmenojen_kohde]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkimusmenojen_kohde]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_tutkimusmenojen_kohde] AS
/*
Drop table VipunenTK.dbo.d_tutkimusmenojen_kohde
Select * into VipunenTK.dbo.d_tutkimusmenojen_kohde from VipunenTK_DW.dbo.v_tutkimusmenojen_kohde
Truncate table  VipunenTK.dbo.d_tutkimusmenojen_kohde
Insert into VipunenTK.dbo.d_tutkimusmenojen_kohde
Select * from VipunenTK_DW.dbo.v_tutkimusmenojen_kohde
*/

SELECT [id]
      --,[luotu]
      ,[menokohde_avain]
      ,[menokohde]
      ,[menokohde_SV]
      ,[menokohde_EN]
      ,[jarjestys_menokohde]
      ,[menotyyppi]
      ,[menotyyppi_SV]
      ,[menotyyppi_EN]
      ,[jarjestys_menotyyppi]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkimusmenojen_kohde]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[menokohde_avain]
      ,[menokohde]
      ,[menokohde_SV]
      ,[menokohde_EN]
      ,[jarjestys_menokohde]
      ,[menotyyppi]
      ,[menotyyppi_SV]
      ,[menotyyppi_EN]
      ,[jarjestys_menotyyppi]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkimusmenojen_kohde]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_tutkinnon_tavoite]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinnon_tavoite]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkinnon_tavoite] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinnon_tavoite_koodi,
	tutkinnon_tavoite,
	tutkinnon_tavoite_SV,
	tutkinnon_tavoite_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinnon_tavoite
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinnon_tavoite_koodi,
	tutkinnon_tavoite,
	tutkinnon_tavoite_SV,
	tutkinnon_tavoite_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinnon_tavoite
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tutkinnon_toteuma]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinnon_toteuma]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkinnon_toteuma] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinnon_toteuma_koodi,
	tutkinnon_toteuma,
	tutkinnon_toteuma_SV,
	tutkinnon_toteuma_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinnon_toteuma
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinnon_toteuma_koodi,
	tutkinnon_toteuma,
	tutkinnon_toteuma_SV,
	tutkinnon_toteuma_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinnon_toteuma
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tutkinto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkinto] AS
/*
Drop table VipunenTK.dbo.d_tutkinto
Select * into VipunenTK.dbo.d_tutkinto from VipunenTK_DW.dbo.v_tutkinto
Truncate table  VipunenTK.dbo.d_tutkinto
Insert into VipunenTK.dbo.d_tutkinto
Select * from VipunenTK_DW.dbo.v_tutkinto
*/

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tutkinto_avain]
      ,[tutkinto]
      ,[tutkinto_SV]
      ,[tutkinto_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkinto]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tutkinto_avain]
      ,[tutkinto]
      ,[tutkinto_SV]
      ,[tutkinto_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkinto]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisella_koulutuksen_jarjestajalla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisella_koulutuksen_jarjestajalla]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_tutkinto_alkuperaisella_koulutuksen_jarjestajalla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla_koodi,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla_SV,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla_EN,
	jarjestys_4c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisella_koulutuksen_jarjestajalla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla_koodi,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla_SV,
	tutkinto_alkuperaisella_koulutuksen_jarjestajalla_EN,
	jarjestys_4c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisella_koulutuksen_jarjestajalla
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisella_koulutusalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisella_koulutusalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_tutkinto_alkuperaisella_koulutusalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutusalalla_2002_koodi,
	tutkinto_alkuperaisella_koulutusalalla_2002,
	tutkinto_alkuperaisella_koulutusalalla_2002_SV,
	tutkinto_alkuperaisella_koulutusalalla_2002_EN,
	jarjestys_2c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisella_koulutusalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutusalalla_2002_koodi,
	tutkinto_alkuperaisella_koulutusalalla_2002,
	tutkinto_alkuperaisella_koulutusalalla_2002_SV,
	tutkinto_alkuperaisella_koulutusalalla_2002_EN,
	jarjestys_2c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisella_koulutusalalla_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisella_koulutusasteella_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisella_koulutusasteella_2002]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_tutkinto_alkuperaisella_koulutusasteella_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutusasteella_2002_koodi,
	tutkinto_alkuperaisella_koulutusasteella_2002,
	tutkinto_alkuperaisella_koulutusasteella_2002_SV,
	tutkinto_alkuperaisella_koulutusasteella_2002_EN,
	jarjestys_1c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisella_koulutusasteella_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutusasteella_2002_koodi,
	tutkinto_alkuperaisella_koulutusasteella_2002,
	tutkinto_alkuperaisella_koulutusasteella_2002_SV,
	tutkinto_alkuperaisella_koulutusasteella_2002_EN,
	jarjestys_1c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisella_koulutusasteella_2002
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisella_koulutussektorilla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisella_koulutussektorilla]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_alkuperaisella_koulutussektorilla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutussektorilla_koodi,
	tutkinto_alkuperaisella_koulutussektroilla,
	tutkinto_alkuperaisella_koulutussektorilla_SV,
	tutkinto_alkuperaisella_koulutussektorilla_EN,
	jarjestys_7c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisella_koulutussektorilla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_koulutussektorilla_koodi,
	tutkinto_alkuperaisella_koulutussektorilla,
	tutkinto_alkuperaisella_koulutussektorilla_SV,
	tutkinto_alkuperaisella_koulutussektorilla_EN,
	jarjestys_7c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisella_koulutussektorilla
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisella_opintoalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisella_opintoalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_alkuperaisella_opintoalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_opintoalalla_2002_koodi,
	tutkinto_alkuperaisella_opintoalalla_2002,
	tutkinto_alkuperaisella_opintoalalla_2002_SV,
	tutkinto_alkuperaisella_opintoalalla_2002_EN,
	jarjestys_3c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisella_opintoalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisella_opintoalalla_2002_koodi,
	tutkinto_alkuperaisella_opintoalalla_2002,
	tutkinto_alkuperaisella_opintoalalla_2002_SV,
	tutkinto_alkuperaisella_opintoalalla_2002_EN,
	jarjestys_3c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisella_opintoalalla_2002
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisessa_maakunnassa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisessa_maakunnassa]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_alkuperaisessa_maakunnassa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisessa_maakunnassa_koodi,
	tutkinto_alkuperaisessa_maakunnassa,
	tutkinto_alkuperaisessa_maakunnassa_SV,
	tutkinto_alkuperaisessa_maakunnassa_EN,
	jarjestys_6c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisessa_maakunnassa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisessa_maakunnassa_koodi,
	tutkinto_alkuperaisessa_maakunnassa,
	tutkinto_alkuperaisessa_maakunnassa_SV,
	tutkinto_alkuperaisessa_maakunnassa_EN,
	jarjestys_6c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisessa_maakunnassa
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_alkuperaisessa_oppilaitoksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_alkuperaisessa_oppilaitoksessa]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_alkuperaisessa_oppilaitoksessa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisessa_oppilaitoksessa_koodi,
	tutkinto_alkuperaisessa_oppilaitoksessa,
	tutkinto_alkuperaisessa_oppilaitoksessa_SV,
	tutkinto_alkuperaisessa_oppilaitoksessa_EN,
	jarjestys_5c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_alkuperaisessa_oppilaitoksessa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_alkuperaisessa_oppilaitoksessa_koodi,
	tutkinto_alkuperaisessa_oppilaitoksessa,
	tutkinto_alkuperaisessa_oppilaitoksessa_SV,
	tutkinto_alkuperaisessa_oppilaitoksessa_EN,
	jarjestys_5c,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_alkuperaisessa_oppilaitoksessa
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_amk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_amk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkinto_amk] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_amk_koodi,
	tutkinto_amk,
	tutkinto_amk_SV,
	tutkinto_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_amk
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_amk_koodi,
	tutkinto_amk,
	tutkinto_amk_SV,
	tutkinto_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_amk
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tutkinto_muulla_koulutuksen_jarjestajalla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muulla_koulutuksen_jarjestajalla]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muulla_koulutuksen_jarjestajalla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutuksen_jarjestajalla_koodi,
	tutkinto_muulla_koulutuksen_jarjestajalla,
	tutkinto_muulla_koulutuksen_jarjestajalla_SV,
	tutkinto_muulla_koulutuksen_jarjestajalla_EN,
	jarjestys_4d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muulla_koulutuksen_jarjestajalla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutuksen_jarjestajalla_koodi,
	tutkinto_muulla_koulutuksen_jarjestajalla,
	tutkinto_muulla_koulutuksen_jarjestajalla_SV,
	tutkinto_muulla_koulutuksen_jarjestajalla_EN,
	jarjestys_4d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muulla_koulutuksen_jarjestajalla
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_muulla_koulutusalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muulla_koulutusalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muulla_koulutusalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutusalalla_2002_koodi,
	tutkinto_muulla_koulutusalalla_2002,
	tutkinto_muulla_koulutusalalla_2002_SV,
	tutkinto_muulla_koulutusalalla_2002_EN,
	jarjestys_2d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muulla_koulutusalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutusalalla_2002_koodi,
	tutkinto_muulla_koulutusalalla_2002,
	tutkinto_muulla_koulutusalalla_2002_SV,
	tutkinto_muulla_koulutusalalla_2002_EN,
	jarjestys_2d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muulla_koulutusalalla_2002
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_muulla_koulutusasteella_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muulla_koulutusasteella_2002]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muulla_koulutusasteella_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutusasteella_2002_koodi,
	tutkinto_muulla_koulutusasteella_2002,
	tutkinto_muulla_koulutusasteella_2002_SV,
	tutkinto_muulla_koulutusasteella_2002_EN,
	jarjestys_1d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muulla_koulutusasteella_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutusasteella_2002_koodi,
	tutkinto_muulla_koulutusasteella_2002,
	tutkinto_muulla_koulutusasteella_2002_SV,
	tutkinto_muulla_koulutusasteella_2002_EN,
	jarjestys_1d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muulla_koulutusasteella_2002
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_muulla_koulutussektorilla]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muulla_koulutussektorilla]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muulla_koulutussektorilla] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutussektorilla_koodi,
	tutkinto_muulla_koulutussektroilla,
	tutkinto_muulla_koulutussektorilla_SV,
	tutkinto_muulla_koulutussektorilla_EN,
	jarjestys_7d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muulla_koulutussektorilla
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_koulutussektorilla_koodi,
	tutkinto_muulla_koulutussektorilla,
	tutkinto_muulla_koulutussektorilla_SV,
	tutkinto_muulla_koulutussektorilla_EN,
	jarjestys_7d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muulla_koulutussektorilla
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_muulla_opintoalalla_2002]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muulla_opintoalalla_2002]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muulla_opintoalalla_2002] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_opintoalalla_2002_koodi,
	tutkinto_muulla_opintoalalla_2002,
	tutkinto_muulla_opintoalalla_2002_SV,
	tutkinto_muulla_opintoalalla_2002_EN,
	jarjestys_3d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muulla_opintoalalla_2002
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muulla_opintoalalla_2002_koodi,
	tutkinto_muulla_opintoalalla_2002,
	tutkinto_muulla_opintoalalla_2002_SV,
	tutkinto_muulla_opintoalalla_2002_EN,
	jarjestys_3d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muulla_opintoalalla_2002
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_muussa_maakunnassa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muussa_maakunnassa]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muussa_maakunnassa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muussa_maakunnassa_koodi,
	tutkinto_muussa_maakunnassa,
	tutkinto_muussa_maakunnassa_SV,
	tutkinto_muussa_maakunnassa_EN,
	jarjestys_6d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muussa_maakunnassa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muussa_maakunnassa_koodi,
	tutkinto_muussa_maakunnassa,
	tutkinto_muussa_maakunnassa_SV,
	tutkinto_muussa_maakunnassa_EN,
	jarjestys_6d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muussa_maakunnassa
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_muussa_oppilaitoksessa]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_muussa_oppilaitoksessa]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_muussa_oppilaitoksessa] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muussa_oppilaitoksessa_koodi,
	tutkinto_muussa_oppilaitoksessa,
	tutkinto_muussa_oppilaitoksessa_SV,
	tutkinto_muussa_oppilaitoksessa_EN,
	jarjestys_5d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_muussa_oppilaitoksessa
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_muussa_oppilaitoksessa_koodi,
	tutkinto_muussa_oppilaitoksessa,
	tutkinto_muussa_oppilaitoksessa_SV,
	tutkinto_muussa_oppilaitoksessa_EN,
	jarjestys_5d,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_muussa_oppilaitoksessa
WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_suoritettu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_suoritettu]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkinto_suoritettu] AS
/*
Drop table VipunenTK.dbo.d_tutkinto_suoritettu
Select * into VipunenTK.dbo.d_tutkinto_suoritettu from VipunenTK_DW.dbo.v_tutkinto_suoritettu
Truncate table  VipunenTK.dbo.d_tutkinto_suoritettu
Insert into VipunenTK.dbo.d_tutkinto_suoritettu
Select * from VipunenTK_DW.dbo.v_tutkinto_suoritettu
*/

SELECT [id]
      --,[luotu]
      ,[tutkinto_suoritettu_avain]
      ,[tutkinto_suoritettu]
      ,[tutkinto_suoritettu_SV]
      ,[tutkinto_suoritettu_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkinto_suoritettu]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[tutkinto_suoritettu_avain]
      ,[tutkinto_suoritettu]
      ,[tutkinto_suoritettu_SV]
      ,[tutkinto_suoritettu_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkinto_suoritettu]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_tutkinto_yo]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkinto_yo]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_tutkinto_yo] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_yo_koodi,
	tutkinto_yo,
	tutkinto_yo_SV,
	tutkinto_yo_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkinto_yo
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkinto_yo_koodi,
	tutkinto_yo,
	tutkinto_yo_SV,
	tutkinto_yo_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkinto_yo
WHERE virhetilanne=''K''

' 
GO
/****** Object:  View [dbo].[v_tutkintoasetus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkintoasetus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkintoasetus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkintoasetus_koodi,
	tutkintoasetus,
	tutkintoasetus_SV,
	tutkintoasetus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkintoasetus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkintoasetus_koodi,
	tutkintoasetus,
	tutkintoasetus_SV,
	tutkintoasetus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkintoasetus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tutkintojen_maara]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkintojen_maara]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkintojen_maara] AS
/*
Drop table VipunenTK.dbo.d_tutkintojen_maara
Select * into VipunenTK.dbo.d_tutkintojen_maara from VipunenTK_DW.dbo.v_tutkintojen_maara
Truncate table  VipunenTK.dbo.d_tutkintojen_maara
Insert into VipunenTK.dbo.d_tutkintojen_maara
Select * from VipunenTK_DW.dbo.v_tutkintojen_maara
*/

SELECT [id]
      --,[luotu]
      ,[tutkintojen_maara_avain]
      ,[tutkintojen_maara]
      ,[tutkintojen_maara_SV]
      ,[tutkintojen_maara_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkintojen_maara]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[tutkintojen_maara_avain]
      ,[tutkintojen_maara]
      ,[tutkintojen_maara_SV]
      ,[tutkintojen_maara_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkintojen_maara]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_tutkintolaji_tyollistymiseen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkintolaji_tyollistymiseen]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkintolaji_tyollistymiseen] AS 

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tutkintolaji_tyollistymiseen_koodi]
      ,[tutkintolaji_tyollistymiseen]
      ,[tutkintolaji_tyollistymiseen_SV]
      ,[tutkintolaji_tyollistymiseen_EN]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkintolaji_tyollistymiseen]

UNION ALL

SELECT [id]
      ,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tutkintolaji_tyollistymiseen_koodi]
      ,[tutkintolaji_tyollistymiseen]
      ,[tutkintolaji_tyollistymiseen_SV]
      ,[tutkintolaji_tyollistymiseen_EN]
      ,[jarjestys]
      ,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[tutkintolaji_tyollistymiseen]

WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_tutkintonimike_ammpk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkintonimike_ammpk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkintonimike_ammpk] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkintonimike_ammpk_koodi,
	tutkintonimike_ammpk,
	tutkintonimike_ammpk_SV,
	tutkintonimike_ammpk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkintonimike_ammpk
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkintonimike_ammpk_koodi,
	tutkintonimike_ammpk,
	tutkintonimike_ammpk_SV,
	tutkintonimike_ammpk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkintonimike_ammpk
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tutkintoryhma]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkintoryhma]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tutkintoryhma] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkintoryhma_koodi,
	tutkintoryhma,
	tutkintoryhma_SV,
	tutkintoryhma_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tutkintoryhma
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tutkintoryhma_koodi,
	tutkintoryhma,
	tutkintoryhma_SV,
	tutkintoryhma_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tutkintoryhma
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tutkintotaso]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tutkintotaso]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tutkintotaso] AS
/*
Drop table VipunenTK.dbo.d_tutkintotaso
Select * into VipunenTK.dbo.d_tutkintotaso from VipunenTK_DW.dbo.v_tutkintotaso
Truncate table  VipunenTK.dbo.d_tutkintotaso
Insert into VipunenTK.dbo.d_tutkintotaso
Select * from VipunenTK_DW.dbo.v_tutkintotaso
*/

SELECT [id]
      --,[luotu]
      ,[tutkintotaso_koodi]
      ,[tutkintotaso]
      ,[tutkintotaso_SV]
      ,[tutkintotaso_EN]
      ,[jarjestys]
      ,[tutkintotaso_tk_henkilokunta]
      ,[tutkintotaso_tk_henkilokunta_SV]
      ,[tutkintotaso_tk_henkilokunta_EN]
      ,[jarjestys_tk_henkilokunta]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tutkintotaso]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[tutkintotaso_koodi]
      ,[tutkintotaso]
      ,[tutkintotaso_SV]
      ,[tutkintotaso_EN]
      ,[jarjestys]
      ,[tutkintotaso_tk_henkilokunta]
      ,[tutkintotaso_tk_henkilokunta_SV]
      ,[tutkintotaso_tk_henkilokunta_EN]
      ,[jarjestys_tk_henkilokunta]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tutkintotaso]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_tyonantajasektori]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyonantajasektori]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tyonantajasektori] AS
/*
--Drop table VipunenTK.dbo.d_tyonantajasektori
--Select * into VipunenTK.dbo.d_tyonantajasektori from VipunenTK_DW.dbo.v_tyonantajasektori
Truncate table VipunenTK.dbo.d_tyonantajasektori
Insert into VipunenTK.dbo.d_tyonantajasektori
Select * from VipunenTK_DW.dbo.v_tyonantajasektori
*/
SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tyonantajasektori_koodi]
      ,[tyonantajasektori]
      ,[tyonantajasektori_SV]
      ,[tyonantajasektori_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tyonantajasektori]
UNION ALL
  SELECT [id]
      --,[luotu]
      ,[alkaa]
      ,[paattyy]
      ,[tyonantajasektori_koodi]
      ,[tyonantajasektori]
      ,[tyonantajasektori_SV]
      ,[tyonantajasektori_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[tyonantajasektori]
  WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tyonantajasektori_sama_kuin_ed_vuonna]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyonantajasektori_sama_kuin_ed_vuonna]'))
EXEC dbo.sp_executesql @statement = N'

/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_tyonantajasektori_sama_kuin_ed_vuonna] AS

SELECT [id]

      ,[tyonantajasektori_sama_kuin_ed_vuonna_koodi]
      ,[tyonantajasektori_sama_kuin_ed_vuonna]
      ,[tyonantajasektori_sama_kuin_ed_vuonna_SV]
      ,[tyonantajasektori_sama_kuin_ed_vuonna_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_tyonantajasektori_sama_kuin_ed_vuonna]

UNION ALL

SELECT [id]
      ,[tyonantajasektori_sama_kuin_ed_vuonna_koodi]
      ,[tyonantajasektori_sama_kuin_ed_vuonna]
      ,[tyonantajasektori_sama_kuin_ed_vuonna_SV]
      ,[tyonantajasektori_sama_kuin_ed_vuonna_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[v_tyonantajasektori_sama_kuin_ed_vuonna]
  WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_tyonantajasektori2]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyonantajasektori2]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[v_tyonantajasektori2] AS
/*
Drop table VipunenTK.dbo.d_tyonantajasektori2
Select * into VipunenTK.dbo.d_tyonantajasektori2 from VipunenTK_DW.dbo.v_tyonantajasektori2
Alter table VipunenTK.dbo.d_tyonantajasektori2 add primary key (Id)
Truncate table VipunenTK.dbo.d_tyonantajasektori2
Insert into VipunenTK.dbo.d_tyonantajasektori2
Select * from VipunenTK_DW.dbo.v_tyonantajasektori2
*/
SELECT [id]
      --,[luotu]
      ,[tyonantajasektori2_avain]
      ,[tyonantajasektori2]
      ,[tyonantajasektori2_SV]
      ,[tyonantajasektori2_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_tyonantajasektori2]
UNION ALL
  SELECT [id]
      --,[luotu]
      ,[tyonantajasektori2_avain]
      ,[tyonantajasektori2]
      ,[tyonantajasektori2_SV]
      ,[tyonantajasektori2_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,[poistettu]
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[tyonantajasektori2]
  WHERE virhetilanne=''K''


' 
GO
/****** Object:  View [dbo].[v_tyopaikan_sijainti_v_tilastovuonna]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyopaikan_sijainti_v_tilastovuonna]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[v_tyopaikan_sijainti_v_tilastovuonna] AS

SELECT [id]
      ,[tyopaikan_sijainti_v_tilastovuonna_avain]
      ,[tyopaikan_sijainti_v_tilastovuonna]
      ,[tyopaikan_sijainti_v_tilastovuonna_SV]
      ,[tyopaikan_sijainti_v_tilastovuonna_EN]
      ,[jarjestys]

  FROM [VipunenTK_DW].[dbo].[d_tyopaikan_sijainti_v_tilastovuonna]
  
UNION ALL

SELECT [id]
      ,[tyopaikan_sijainti_v_tilastovuonna_avain]
      ,[tyopaikan_sijainti_v_tilastovuonna]
      ,[tyopaikan_sijainti_v_tilastovuonna_SV]
      ,[tyopaikan_sijainti_v_tilastovuonna_EN]
      ,[jarjestys]

  FROM [VipunenTK_lisatiedot].[dbo].[tyopaikan_sijainti_v_tilastovuonna]

WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_tyossakayntitilaston_tyonantajasektori]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyossakayntitilaston_tyonantajasektori]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tyossakayntitilaston_tyonantajasektori] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tyossakayntitilaston_tyonantajasektori_koodi,
	tyossakayntitilaston_tyonantajasektori,
	tyossakayntitilaston_tyonantajasektori_SV,
	tyossakayntitilaston_tyonantajasektori_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tyossakayntitilaston_tyonantajasektori
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tyossakayntitilaston_tyonantajasektori_koodi,
	tyossakayntitilaston_tyonantajasektori,
	tyossakayntitilaston_tyonantajasektori_SV,
	tyossakayntitilaston_tyonantajasektori_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tyossakayntitilaston_tyonantajasektori
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tyovoimapoliittinen]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyovoimapoliittinen]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tyovoimapoliittinen] AS  
SELECT [id]
,[alkaa]
,[paattyy]
,[tyovoimapoliittinen_koodi]
,[tyovoimapoliittinen]
,[tyovoimapoliittinen_SV]
,[tyovoimapoliittinen_EN]
,[jarjestys]
,[tietolahde]
FROM [dbo].[d_tyovoimapoliittinen]
UNION
SELECT [id]
,[alkaa]
,[paattyy]
,[tyovoimapoliittinen_koodi]
,[tyovoimapoliittinen]
,[tyovoimapoliittinen_SV]
,[tyovoimapoliittinen_EN]
,[jarjestys]
,[tietolahde]
FROM [VipunenTK_lisatiedot].[dbo].[v_tyovoimapoliittinen]
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_tyovoimapoliittinen_koulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_tyovoimapoliittinen_koulutus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_tyovoimapoliittinen_koulutus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tyovoimapoliittinen_koulutus_koodi,
	tyovoimapoliittinen_koulutus,
	tyovoimapoliittinen_koulutus_SV,
	tyovoimapoliittinen_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_tyovoimapoliittinen_koulutus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	tyovoimapoliittinen_koulutus_koodi,
	tyovoimapoliittinen_koulutus,
	tyovoimapoliittinen_koulutus_SV,
	tyovoimapoliittinen_koulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_tyovoimapoliittinen_koulutus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_uusi_vanha_opiskelija]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_uusi_vanha_opiskelija]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_uusi_vanha_opiskelija] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	uusi_vanha_opiskelija_koodi,
	uusi_vanha_opiskelija,
	uusi_vanha_opiskelija_SV,
	uusi_vanha_opiskelija_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_uusi_vanha_opiskelija
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	uusi_vanha_opiskelija_koodi,
	uusi_vanha_opiskelija,
	uusi_vanha_opiskelija_SV,
	uusi_vanha_opiskelija_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_uusi_vanha_opiskelija
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_vahintaan_45_op_suorittanut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_vahintaan_45_op_suorittanut]'))
EXEC dbo.sp_executesql @statement = N'

create view [dbo].[v_vahintaan_45_op_suorittanut] as
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	vahintaan_45_op_suorittanut_koodi,
	vahintaan_45_op_suorittanut,
	vahintaan_45_op_suorittanut_SV,
	vahintaan_45_op_suorittanut_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_vahintaan_45_op_suorittanut
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	vahintaan_45_op_suorittanut_koodi,
	vahintaan_45_op_suorittanut,
	vahintaan_45_op_suorittanut_SV,
	vahintaan_45_op_suorittanut_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..vahintaan_45_op_suorittanut
WHERE virhetilanne = ''K''


' 
GO
/****** Object:  View [dbo].[v_vahintaan_55_op_suorittanut]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_vahintaan_55_op_suorittanut]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[v_vahintaan_55_op_suorittanut] as
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	vahintaan_55_op_suorittanut_koodi,
	vahintaan_55_op_suorittanut,
	vahintaan_55_op_suorittanut_SV,
	vahintaan_55_op_suorittanut_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_vahintaan_55_op_suorittanut
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	vahintaan_55_op_suorittanut_koodi,
	vahintaan_55_op_suorittanut,
	vahintaan_55_op_suorittanut_SV,
	vahintaan_55_op_suorittanut_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..vahintaan_55_op_suorittanut
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_valiaikainen_amk]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_valiaikainen_amk]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_valiaikainen_amk] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	valiaikainen_amk_koodi,
	valiaikainen_amk,
	valiaikainen_amk_SV,
	valiaikainen_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_valiaikainen_amk
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	valiaikainen_amk_koodi,
	valiaikainen_amk,
	valiaikainen_amk_SV,
	valiaikainen_amk_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_valiaikainen_amk
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_valtio]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_valtio]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[v_valtio] as
SELECT
	id,luotu,alkaa,paattyy,
	valtio_avain,
	maa_koodi,maa,maa_SV,maa_EN,
	eumaa_koodi,eumaa,eumaa_SV,eumaa_EN,
	etamaa_koodi,etamaa,etamaa_SV,etamaa_EN,
	maanosa_koodi,maanosa,maanosa_SV,maanosa_EN,
	maanosa2_koodi,maanosa2,maanosa2_SV,maanosa2_EN,
	maanosa3_koodi,maanosa3,maanosa3_SV,maanosa3_EN,
	jarjestys,jarjestys_eumaa,jarjestys_etamaa,
	jarjestys_maanosa,jarjestys_maanosa2,jarjestys_maanosa3,
	virhetilanne,poistettu,tietolahde,kommentti
FROM dbo.d_valtio
UNION
SELECT
	id,luotu,alkaa,paattyy,
	valtio_avain,
	maa_koodi,maa,maa_SV,maa_EN,
	eumaa_koodi,eumaa,eumaa_SV,eumaa_EN,
	etamaa_koodi,etamaa,etamaa_SV,etamaa_EN,
	maanosa_koodi,maanosa,maanosa_SV,maanosa_EN,
	maanosa2_koodi,maanosa2,maanosa2_SV,maanosa2_EN,
	maanosa3_koodi,maanosa3,maanosa3_SV,maanosa3_EN,
	jarjestys,jarjestys_eumaa,jarjestys_etamaa,
	jarjestys_maanosa,jarjestys_maanosa2,jarjestys_maanosa3,
	virhetilanne,poistettu,tietolahde,kommentti
FROM VipunenTK_lisatiedot..v_valtio
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_valtio_nykytila]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_valtio_nykytila]'))
EXEC dbo.sp_executesql @statement = N'
Create View [dbo].[v_valtio_nykytila] as
/*
truncate table VipunenTK.dbo.d_valtio
insert into VipunenTK.dbo.d_valtio
select * from [VipunenTK_DW].dbo.[v_valtio_nykytila]

drop table VipunenTK.dbo.d_valtio
select * into VipunenTK.dbo.d_valtio from [VipunenTK_DW].dbo.[v_valtio_nykytila]
*/

SELECT
	id,
	d_valtio_historia.valtio_avain,
	maa_koodi,maa,maa_SV,maa_EN,
	eumaa_koodi,eumaa,eumaa_SV,eumaa_EN,
	etamaa_koodi,etamaa,etamaa_SV,etamaa_EN,
	maanosa_koodi,maanosa,maanosa_SV,maanosa_EN,
	maanosa2_koodi,maanosa2,maanosa2_SV,maanosa2_EN,
	maanosa3_koodi,maanosa3,maanosa3_SV,maanosa3_EN,
	jarjestys,jarjestys_eumaa,jarjestys_etamaa,
	jarjestys_maanosa,jarjestys_maanosa2,jarjestys_maanosa3,
	virhetilanne,poistettu,tietolahde,kommentti
FROM VipunenTK.dbo.d_valtio_historia
JOIN (Select valtio_avain, maxpaattyy=max(paattyy) from VipunenTK.dbo.d_valtio_historia group by valtio_avain) nykyavaimet
	ON d_valtio_historia.valtio_avain = nykyavaimet.valtio_avain AND d_valtio_historia.paattyy =  nykyavaimet.maxpaattyy

UNION
SELECT
	id,
	valtio_avain,
	maa_koodi,maa,maa_SV,maa_EN,
	eumaa_koodi,eumaa,eumaa_SV,eumaa_EN,
	etamaa_koodi,etamaa,etamaa_SV,etamaa_EN,
	maanosa_koodi,maanosa,maanosa_SV,maanosa_EN,
	maanosa2_koodi,maanosa2,maanosa2_SV,maanosa2_EN,
	maanosa3_koodi,maanosa3,maanosa3_SV,maanosa3_EN,
	jarjestys,jarjestys_eumaa,jarjestys_etamaa,
	jarjestys_maanosa,jarjestys_maanosa2,jarjestys_maanosa3,
	virhetilanne,poistettu,tietolahde,kommentti
FROM VipunenTK_lisatiedot..v_valtio
WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_vayla_nayttotutkintoon]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_vayla_nayttotutkintoon]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_vayla_nayttotutkintoon] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	vayla_nayttotutkintoon_koodi,
	vayla_nayttotutkintoon,
	vayla_nayttotutkintoon_SV,
	vayla_nayttotutkintoon_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_vayla_nayttotutkintoon
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	vayla_nayttotutkintoon_koodi,
	vayla_nayttotutkintoon,
	vayla_nayttotutkintoon_SV,
	vayla_nayttotutkintoon_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_vayla_nayttotutkintoon
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_vieraskielisyys]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_vieraskielisyys]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_vieraskielisyys] AS
/*
Drop table VipunenTK.dbo.d_vieraskielisyys
Select * into VipunenTK.dbo.d_vieraskielisyys from VipunenTK_DW.dbo.v_vieraskielisyys
Truncate table  VipunenTK.dbo.d_vieraskielisyys
Insert into VipunenTK.dbo.d_vieraskielisyys
Select * from VipunenTK_DW.dbo.v_vieraskielisyys
*/

SELECT [id]
      --,[luotu]
      ,[vieraskielisyys_koodi]
      ,[vieraskielisyys]
      ,[vieraskielisyys_SV]
      ,[vieraskielisyys_EN]
      ,[vieraskielisyys_lyhyt]
      ,[vieraskielisyys_lyhyt_SV]
      ,[vieraskielisyys_lyhyt_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_vieraskielisyys]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[vieraskielisyys_koodi]
      ,[vieraskielisyys]
      ,[vieraskielisyys_SV]
      ,[vieraskielisyys_EN]
      ,[vieraskielisyys_lyhyt]
      ,[vieraskielisyys_lyhyt_SV]
      ,[vieraskielisyys_lyhyt_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_vieraskielisyys]
  WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_VipunenTK_laatu]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_VipunenTK_laatu]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[v_VipunenTK_laatu] as
/*
CSC Jarmo 23.4.2015

Select * from VipunenTK_DW.dbo.v_VipunenTK_laatu
order by 
	cast(cast(virhe as float)/Cast((normaali+tuntematon+virhe+muut) as float)*100.0 as float) desc, 
	cast(cast(tuntematon as float)/Cast((normaali+tuntematon+virhe+muut) as float)*100.0 as float) desc, 
	taulu, sarake

Näkymä VipunenTK_DW.dbo.v_VipunenTK_laatu palauttaa alla olevan taulukon.
Näkymä palauttaa tulokset edellisestä laadun laskennasta. Laskennan voi uusia ajamalla proseduurin VipunenTK_DW.dbo.Laske_VipunenTK_laatu
Kentät
 taulu on VipunenTK-kannan faktataulu. Faktataulun pitää alkaa f-kirjaimella.
 sarake on dimensioon viittaaava faktataulun surrogaattikenttä. Ne ovat int-tyyppisiä ja loppuvat kirjaimiin id.
 kaikki on rivien määrä taulussa
 normaali on rivien määrä, joilla surrogaatin arvo on 0 tai suurempi.
 tuntematon on rivien määrä, joilla surrogaatin arvo on -1.
 virhe on rivien määrä, joilla surrogaatin arvo on -2.
 muut on rivien määrä, joilla surrogaatin arvo alle -2 tai NULL 
 virhe% on virherivien osuus kaikista riveistä
 tuntematon% on tuntemattomien rivien osuus kaikista riveistä

CSC Jarmo 22.6.2015
NULL-arvot muutetaan VipunenTK_laatu-tauluun arvoksi -3, jotta group by löytää ne

*/

Select 
	 arvot.taulu
	,arvot.sarake
	,kaikki = (normaali+tuntematon+virhe+muut)
	,arvot.normaali
	,arvot.tuntematon
	,arvot.virhe
	,arvot.muut
	,[virhe%] = cast(case when cast(virhe as float)=0.0 then 0.0 else cast(virhe as float)/Cast((normaali+tuntematon+virhe+muut) as float)*100.0 end as decimal(8,3))
	,[tuntematon%] = cast(case when cast(tuntematon as float) = 0.0 then 0.0 else cast(tuntematon as float)/Cast((normaali+tuntematon+virhe+muut) as float)*100.0 end as decimal(8,3))
from (Select distinct
	 a.taulu
	,a.sarake
	,normaali = isnull((Select lkm from [VipunenTK_DW].[dbo].[VipunenTK_laatu] b where b.taulu = a.taulu and b.sarake = a.sarake and b.arvo = 0),0)
	,tuntematon = isnull((Select lkm from [VipunenTK_DW].[dbo].[VipunenTK_laatu] b where b.taulu = a.taulu and b.sarake = a.sarake and b.arvo = -1),0)
	,virhe = isnull((Select lkm from [VipunenTK_DW].[dbo].[VipunenTK_laatu] b where b.taulu = a.taulu and b.sarake = a.sarake and b.arvo = -2),0)
	,muut = isnull((Select lkm from [VipunenTK_DW].[dbo].[VipunenTK_laatu] b where b.taulu = a.taulu and b.sarake = a.sarake and b.arvo = -3),0)
from [VipunenTK_DW].[dbo].[VipunenTK_laatu] a
) arvot



' 
GO
/****** Object:  View [dbo].[v_virkaryhma]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_virkaryhma]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[v_virkaryhma] AS
/*
Drop table VipunenTK.dbo.d_virkaryhma
Select * into VipunenTK.dbo.d_virkaryhma from VipunenTK_DW.dbo.v_virkaryhma
Truncate table  VipunenTK.dbo.d_virkaryhma
Insert into VipunenTK.dbo.d_virkaryhma
Select * from VipunenTK_DW.dbo.v_virkaryhma
*/

SELECT [id]
      --,[luotu]
      ,[virkaryhma_koodi]
      ,[virkaryhma]
      ,[virkaryhma_SV]
      ,[virkaryhma_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_virkaryhma]
  
UNION ALL

SELECT [id]
      --,[luotu]
      ,[virkaryhma_koodi]
      ,[virkaryhma]
      ,[virkaryhma_SV]
      ,[virkaryhma_EN]
      ,[jarjestys]
      --,[virhetilanne]
      --,poistettu
      ,[tietolahde]
      --,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[v_virkaryhma]
  WHERE virhetilanne = ''K''

' 
GO
/****** Object:  View [dbo].[v_yliopisto]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_yliopisto]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_yliopisto] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	yliopisto_koodi,
	yliopisto,
	yliopisto_SV,
	yliopisto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_yliopisto
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	yliopisto_koodi,
	yliopisto,
	yliopisto_SV,
	yliopisto_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_yliopisto
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_yllapitajan_kieli]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_yllapitajan_kieli]'))
EXEC dbo.sp_executesql @statement = N'/****** Script for SelectTopNRows command from SSMS  ******/


CREATE VIEW [dbo].[v_yllapitajan_kieli] AS

SELECT [id]
      ,[yllapitajan_kieli_koodi]
      ,[yllapitajan_kieli]
      ,[yllapitajan_kieli_SV]
      ,[yllapitajan_kieli_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_DW].[dbo].[d_yllapitajan_kieli]
  
UNION ALL

SELECT [id]
      ,[yllapitajan_kieli_koodi]
      ,[yllapitajan_kieli]
      ,[yllapitajan_kieli_SV]
      ,[yllapitajan_kieli_EN]
      ,[jarjestys]
      ,[tietolahde]
  FROM [VipunenTK_lisatiedot].[dbo].[v_yllapitajan_kieli]
WHERE virhetilanne = ''K''
' 
GO
/****** Object:  View [dbo].[v_yosairaala]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_yosairaala]'))
EXEC dbo.sp_executesql @statement = N'



CREATE VIEW [dbo].[v_yosairaala] AS 

/*
truncate table VipunenTK.dbo.d_yosairaala
insert into VipunenTK.dbo.d_yosairaala
select * from [VipunenTK_DW].dbo.[v_yosairaala]

drop table VipunenTK.dbo.d_yosairaala
select * into VipunenTK.dbo.d_yosairaala from [VipunenTK_DW].dbo.[v_yosairaala]
*/

SELECT [id]
      ,[luotu]
      ,[yosairaala_avain]
      ,[yosairaala_lyhenne]
      ,[yosairaala]
      ,[yosairaala_SV]
      ,[yosairaala_EN]
      ,[jarjestys_yosairaala]
      ,[yosairaala_lyhenne_historia]
      ,[yosairaala_historia]
      ,[yosairaala_historia_SV]
      ,[yosairaala_historia_EN]
      ,[jarjestys_yosairaala_historia]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_DW].[dbo].[d_yosairaala]

UNION ALL 

SELECT [id]
      ,[luotu]
      ,[yosairaala_avain]
      ,[yosairaala_lyhenne]
      ,[yosairaala]
      ,[yosairaala_SV]
      ,[yosairaala_EN]
      ,[jarjestys_yosairaala]
      ,[yosairaala_lyhenne_historia]
      ,[yosairaala_historia]
      ,[yosairaala_historia_SV]
      ,[yosairaala_historia_EN]
      ,[jarjestys_yosairaala_historia]
      --,[virhetilanne]
      ,[poistettu]
      ,[tietolahde]
      ,[kommentti]
  FROM [VipunenTK_lisatiedot].[dbo].[yosairaala]

WHERE virhetilanne = ''K''




' 
GO
/****** Object:  View [dbo].[v_yrittajan_oppisopimuskoulutus]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_yrittajan_oppisopimuskoulutus]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[v_yrittajan_oppisopimuskoulutus] AS
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	yrittajan_oppisopimuskoulutus_koodi,
	yrittajan_oppisopimuskoulutus,
	yrittajan_oppisopimuskoulutus_SV,
	yrittajan_oppisopimuskoulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM dbo.d_yrittajan_oppisopimuskoulutus
UNION ALL
SELECT
	id,
	luotu,
	alkaa,
	paattyy,
	yrittajan_oppisopimuskoulutus_koodi,
	yrittajan_oppisopimuskoulutus,
	yrittajan_oppisopimuskoulutus_SV,
	yrittajan_oppisopimuskoulutus_EN,
	jarjestys,
	virhetilanne,
	poistettu,
	tietolahde,
	kommentti
FROM VipunenTK_lisatiedot..v_yrittajan_oppisopimuskoulutus
WHERE virhetilanne=''K''
' 
GO
/****** Object:  View [dbo].[v_yrityksen_koko_tthv]    Script Date: 21.6.2017 10:20:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[v_yrityksen_koko_tthv]'))
EXEC dbo.sp_executesql @statement = N'
/****** Script for SelectTopNRows command from SSMS  ******/

CREATE VIEW [dbo].[v_yrityksen_koko_tthv] AS

SELECT [id]

      ,[yrityksen_koko_koodi]
      ,[yrityksen_koko]
      ,[yrityksen_koko_SV]
      ,[yrityksen_koko_EN]
      ,[jarjestys]
  FROM [VipunenTK_DW].[dbo].[d_yrityksen_koko_tthv]

UNION ALL

SELECT [id]
      ,[yrityksen_koko_koodi]
      ,[yrityksen_koko]
      ,[yrityksen_koko_SV]
      ,[yrityksen_koko_EN]
      ,[jarjestys]
  FROM [VipunenTK_lisatiedot].[dbo].[yrityksen_koko_tthv]
  WHERE virhetilanne = ''K''


' 
GO
IF NOT EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_DiagramPane1' , N'SCHEMA',N'dbo', N'VIEW',N'v_sarakeleveys', NULL,NULL))
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "sarakeleveys (dbo)"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 102
               Right = 208
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'v_sarakeleveys'
GO
IF NOT EXISTS (SELECT * FROM sys.fn_listextendedproperty(N'MS_DiagramPaneCount' , N'SCHEMA',N'dbo', N'VIEW',N'v_sarakeleveys', NULL,NULL))
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'v_sarakeleveys'
GO

USE [ANTERO]